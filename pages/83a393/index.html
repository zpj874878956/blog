<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker构建镜像 | 章工运维</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <script language="javascript" type="text/javascript" src="/js/pgmanor-self.js"></script>
    <link rel="alternate" type="application/rss+xml" href="https://blog.zzppjj.top/rss.xml" title="章工运维 RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://blog.zzppjj.top/feed.atom" title="章工运维 Atom Feed">
    <link rel="alternate" type="application/json" href="https://blog.zzppjj.top/feed.json" title="章工运维 JSON Feed">
    <meta name="description" content="业精于勤，荒于嬉">
    <meta name="twitter:title" content="Docker构建镜像">
    <meta name="twitter:description" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/10.docker/01.Docker%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F.html">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Docker构建镜像">
    <meta property="og:description" content="">
    <meta property="og:url" content="https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/10.docker/01.Docker%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F.html">
    <meta property="og:site_name" content="zpj">
    <meta property="article:published_time" content="2023-02-24T16:15:35.000Z">
    <meta property="article:tag" content="null">
    <meta itemprop="name" content="Docker构建镜像">
    <meta itemprop="description" content="">
    <meta name="keywords" content="分享生活,分享技术,zpj,jenkins,ansible,k8s,监控">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.2357ed77.css" as="style"><link rel="preload" href="/assets/js/app.73676f20.js" as="script"><link rel="preload" href="/assets/js/4.23144ec8.js" as="script"><link rel="preload" href="/assets/js/1.09d67b9a.js" as="script"><link rel="preload" href="/assets/js/3.fc5194e0.js" as="script"><link rel="preload" href="/assets/js/328.aff8c1bd.js" as="script"><link rel="preload" href="/assets/js/38.33c96ce4.js" as="script"><link rel="preload" href="/assets/js/21.2c073392.js" as="script"><link rel="prefetch" href="/assets/js/10.a3e162c2.js"><link rel="prefetch" href="/assets/js/100.75d0bcb8.js"><link rel="prefetch" href="/assets/js/101.ecd83997.js"><link rel="prefetch" href="/assets/js/102.ecfd6207.js"><link rel="prefetch" href="/assets/js/103.332844d2.js"><link rel="prefetch" href="/assets/js/104.db0bde22.js"><link rel="prefetch" href="/assets/js/105.cbd4753c.js"><link rel="prefetch" href="/assets/js/106.7a5d313e.js"><link rel="prefetch" href="/assets/js/107.f3dec78b.js"><link rel="prefetch" href="/assets/js/108.52a0f936.js"><link rel="prefetch" href="/assets/js/109.27477c80.js"><link rel="prefetch" href="/assets/js/11.1f9a8151.js"><link rel="prefetch" href="/assets/js/110.bebbe66e.js"><link rel="prefetch" href="/assets/js/111.42ef7c19.js"><link rel="prefetch" href="/assets/js/112.6fe9d090.js"><link rel="prefetch" href="/assets/js/113.c9a86711.js"><link rel="prefetch" href="/assets/js/114.3503a4c3.js"><link rel="prefetch" href="/assets/js/115.14ffeec7.js"><link rel="prefetch" href="/assets/js/116.e4425551.js"><link rel="prefetch" href="/assets/js/117.bc8fd7d3.js"><link rel="prefetch" href="/assets/js/118.ca53cac0.js"><link rel="prefetch" href="/assets/js/119.b7d83b66.js"><link rel="prefetch" href="/assets/js/12.ff601b7f.js"><link rel="prefetch" href="/assets/js/120.87624e26.js"><link rel="prefetch" href="/assets/js/121.1cbece42.js"><link rel="prefetch" href="/assets/js/122.fca02497.js"><link rel="prefetch" href="/assets/js/123.20f89d6e.js"><link rel="prefetch" href="/assets/js/124.5d36a6d6.js"><link rel="prefetch" href="/assets/js/125.011309fb.js"><link rel="prefetch" href="/assets/js/126.b4637b65.js"><link rel="prefetch" href="/assets/js/127.9042b697.js"><link rel="prefetch" href="/assets/js/128.472aa291.js"><link rel="prefetch" href="/assets/js/129.c208b435.js"><link rel="prefetch" href="/assets/js/13.e19f2a21.js"><link rel="prefetch" href="/assets/js/130.de5f9c8d.js"><link rel="prefetch" href="/assets/js/131.1da85aa7.js"><link rel="prefetch" href="/assets/js/132.542a0148.js"><link rel="prefetch" href="/assets/js/133.2a6f2a0a.js"><link rel="prefetch" href="/assets/js/134.d5fa07b6.js"><link rel="prefetch" href="/assets/js/135.75648017.js"><link rel="prefetch" href="/assets/js/136.a9384568.js"><link rel="prefetch" href="/assets/js/137.f5552d23.js"><link rel="prefetch" href="/assets/js/138.eda82db2.js"><link rel="prefetch" href="/assets/js/139.be711e4c.js"><link rel="prefetch" href="/assets/js/14.a223b1b9.js"><link rel="prefetch" href="/assets/js/140.708a3fbc.js"><link rel="prefetch" href="/assets/js/141.b0b86d18.js"><link rel="prefetch" href="/assets/js/142.55bb66aa.js"><link rel="prefetch" href="/assets/js/143.2b9a4434.js"><link rel="prefetch" href="/assets/js/144.b65e75b4.js"><link rel="prefetch" href="/assets/js/145.e1c6fca8.js"><link rel="prefetch" href="/assets/js/146.d7352f00.js"><link rel="prefetch" href="/assets/js/147.e73840d8.js"><link rel="prefetch" href="/assets/js/148.e4f50f91.js"><link rel="prefetch" href="/assets/js/149.3374e168.js"><link rel="prefetch" href="/assets/js/15.403e911f.js"><link rel="prefetch" href="/assets/js/150.1b638875.js"><link rel="prefetch" href="/assets/js/151.ab5d0425.js"><link rel="prefetch" href="/assets/js/152.23993ff3.js"><link rel="prefetch" href="/assets/js/153.d1668a0e.js"><link rel="prefetch" href="/assets/js/154.4b749d4b.js"><link rel="prefetch" href="/assets/js/155.26c4c260.js"><link rel="prefetch" href="/assets/js/156.c8e6b701.js"><link rel="prefetch" href="/assets/js/157.373856e9.js"><link rel="prefetch" href="/assets/js/158.66344055.js"><link rel="prefetch" href="/assets/js/159.a69fd44e.js"><link rel="prefetch" href="/assets/js/16.6eb3aab7.js"><link rel="prefetch" href="/assets/js/160.eb9992c2.js"><link rel="prefetch" href="/assets/js/161.c5b7c124.js"><link rel="prefetch" href="/assets/js/162.c03e3856.js"><link rel="prefetch" href="/assets/js/163.72619e7f.js"><link rel="prefetch" href="/assets/js/164.5e15702b.js"><link rel="prefetch" href="/assets/js/165.33c3df23.js"><link rel="prefetch" href="/assets/js/166.4a808932.js"><link rel="prefetch" href="/assets/js/167.1a771a9e.js"><link rel="prefetch" href="/assets/js/168.807fafc8.js"><link rel="prefetch" href="/assets/js/169.44315b3f.js"><link rel="prefetch" href="/assets/js/17.bbb7c9f2.js"><link rel="prefetch" href="/assets/js/170.5c0c8eb9.js"><link rel="prefetch" href="/assets/js/171.1cbb4415.js"><link rel="prefetch" href="/assets/js/172.735a4c1a.js"><link rel="prefetch" href="/assets/js/173.86f02e67.js"><link rel="prefetch" href="/assets/js/174.4993a291.js"><link rel="prefetch" href="/assets/js/175.195bd521.js"><link rel="prefetch" href="/assets/js/176.751bd9c0.js"><link rel="prefetch" href="/assets/js/177.d1974b60.js"><link rel="prefetch" href="/assets/js/178.fc5d303d.js"><link rel="prefetch" href="/assets/js/179.9975997c.js"><link rel="prefetch" href="/assets/js/18.fca5fd29.js"><link rel="prefetch" href="/assets/js/180.f94992e7.js"><link rel="prefetch" href="/assets/js/181.340cf666.js"><link rel="prefetch" href="/assets/js/182.417bc80c.js"><link rel="prefetch" href="/assets/js/183.632e104d.js"><link rel="prefetch" href="/assets/js/184.c8ef5d1a.js"><link rel="prefetch" href="/assets/js/185.296e5bbb.js"><link rel="prefetch" href="/assets/js/186.000557d1.js"><link rel="prefetch" href="/assets/js/187.197aff5f.js"><link rel="prefetch" href="/assets/js/188.ecae5f09.js"><link rel="prefetch" href="/assets/js/189.ebfded89.js"><link rel="prefetch" href="/assets/js/19.8792dbf3.js"><link rel="prefetch" href="/assets/js/190.a710d6b1.js"><link rel="prefetch" href="/assets/js/191.a84f2ed3.js"><link rel="prefetch" href="/assets/js/192.c203907e.js"><link rel="prefetch" href="/assets/js/193.852373e5.js"><link rel="prefetch" href="/assets/js/194.db2975db.js"><link rel="prefetch" href="/assets/js/195.6c7373e8.js"><link rel="prefetch" href="/assets/js/196.45d29e92.js"><link rel="prefetch" href="/assets/js/197.ee208995.js"><link rel="prefetch" href="/assets/js/198.76c918d3.js"><link rel="prefetch" href="/assets/js/199.f05f7bdc.js"><link rel="prefetch" href="/assets/js/2.3389b8bc.js"><link rel="prefetch" href="/assets/js/20.15ba8d27.js"><link rel="prefetch" href="/assets/js/200.bf07e380.js"><link rel="prefetch" href="/assets/js/201.35bb3033.js"><link rel="prefetch" href="/assets/js/202.e14ce853.js"><link rel="prefetch" href="/assets/js/203.7f07fe7f.js"><link rel="prefetch" href="/assets/js/204.95ffddd8.js"><link rel="prefetch" href="/assets/js/205.f487b7d0.js"><link rel="prefetch" href="/assets/js/206.2b3e5a91.js"><link rel="prefetch" href="/assets/js/207.7886e90d.js"><link rel="prefetch" href="/assets/js/208.98c314e0.js"><link rel="prefetch" href="/assets/js/209.9d37ba2d.js"><link rel="prefetch" href="/assets/js/210.6e7d41e6.js"><link rel="prefetch" href="/assets/js/211.0344832b.js"><link rel="prefetch" href="/assets/js/212.8e2c9c7f.js"><link rel="prefetch" href="/assets/js/213.84efa494.js"><link rel="prefetch" href="/assets/js/214.fdcd5348.js"><link rel="prefetch" href="/assets/js/215.190febcd.js"><link rel="prefetch" href="/assets/js/216.1b0ecbf6.js"><link rel="prefetch" href="/assets/js/217.94e4a648.js"><link rel="prefetch" href="/assets/js/218.15bb6f17.js"><link rel="prefetch" href="/assets/js/219.4d86a677.js"><link rel="prefetch" href="/assets/js/22.797a9a59.js"><link rel="prefetch" href="/assets/js/220.b30cd93b.js"><link rel="prefetch" href="/assets/js/221.dc967206.js"><link rel="prefetch" href="/assets/js/222.5424cc4c.js"><link rel="prefetch" href="/assets/js/223.d35ee4d9.js"><link rel="prefetch" href="/assets/js/224.97fc8dca.js"><link rel="prefetch" href="/assets/js/225.d1d60d3d.js"><link rel="prefetch" href="/assets/js/226.71cd887d.js"><link rel="prefetch" href="/assets/js/227.7cc9c57c.js"><link rel="prefetch" href="/assets/js/228.6381caa6.js"><link rel="prefetch" href="/assets/js/229.560474e6.js"><link rel="prefetch" href="/assets/js/23.30bb92f4.js"><link rel="prefetch" href="/assets/js/230.49126632.js"><link rel="prefetch" href="/assets/js/231.591150fc.js"><link rel="prefetch" href="/assets/js/232.60ba75d5.js"><link rel="prefetch" href="/assets/js/233.0ed6ef0d.js"><link rel="prefetch" href="/assets/js/234.7d2aa21f.js"><link rel="prefetch" href="/assets/js/235.0d13696d.js"><link rel="prefetch" href="/assets/js/236.3fef4d3c.js"><link rel="prefetch" href="/assets/js/237.95e3cf9c.js"><link rel="prefetch" href="/assets/js/238.0993135b.js"><link rel="prefetch" href="/assets/js/239.27177392.js"><link rel="prefetch" href="/assets/js/24.7240c649.js"><link rel="prefetch" href="/assets/js/240.23100c38.js"><link rel="prefetch" href="/assets/js/241.805a6f9f.js"><link rel="prefetch" href="/assets/js/242.8d15a365.js"><link rel="prefetch" href="/assets/js/243.e69346ee.js"><link rel="prefetch" href="/assets/js/244.8c1aa986.js"><link rel="prefetch" href="/assets/js/245.6f55369d.js"><link rel="prefetch" href="/assets/js/246.10a3da46.js"><link rel="prefetch" href="/assets/js/247.65f2f428.js"><link rel="prefetch" href="/assets/js/248.49375e99.js"><link rel="prefetch" href="/assets/js/249.1e9d53e7.js"><link rel="prefetch" href="/assets/js/25.9b40180a.js"><link rel="prefetch" href="/assets/js/250.01f8cd00.js"><link rel="prefetch" href="/assets/js/251.ff9464cb.js"><link rel="prefetch" href="/assets/js/252.f89f8487.js"><link rel="prefetch" href="/assets/js/253.e3891186.js"><link rel="prefetch" href="/assets/js/254.9012046f.js"><link rel="prefetch" href="/assets/js/255.fde63767.js"><link rel="prefetch" href="/assets/js/256.4888bec3.js"><link rel="prefetch" href="/assets/js/257.22289df7.js"><link rel="prefetch" href="/assets/js/258.f5e12a6c.js"><link rel="prefetch" href="/assets/js/259.f227bf91.js"><link rel="prefetch" href="/assets/js/26.5fef45bc.js"><link rel="prefetch" href="/assets/js/260.7c204404.js"><link rel="prefetch" href="/assets/js/261.29e85166.js"><link rel="prefetch" href="/assets/js/262.2c9def6c.js"><link rel="prefetch" href="/assets/js/263.98afd182.js"><link rel="prefetch" href="/assets/js/264.20a44127.js"><link rel="prefetch" href="/assets/js/265.deaca7c2.js"><link rel="prefetch" href="/assets/js/266.4d0f5c1e.js"><link rel="prefetch" href="/assets/js/267.30b05762.js"><link rel="prefetch" href="/assets/js/268.2238b76d.js"><link rel="prefetch" href="/assets/js/269.9bc35400.js"><link rel="prefetch" href="/assets/js/27.83995618.js"><link rel="prefetch" href="/assets/js/270.2cf931ea.js"><link rel="prefetch" href="/assets/js/271.33bb2a38.js"><link rel="prefetch" href="/assets/js/272.5ea99ff5.js"><link rel="prefetch" href="/assets/js/273.b6aeae60.js"><link rel="prefetch" href="/assets/js/274.02c41281.js"><link rel="prefetch" href="/assets/js/275.c03bf74d.js"><link rel="prefetch" href="/assets/js/276.8bb13531.js"><link rel="prefetch" href="/assets/js/277.e835c526.js"><link rel="prefetch" href="/assets/js/278.8db0ac89.js"><link rel="prefetch" href="/assets/js/279.b01f6f0b.js"><link rel="prefetch" href="/assets/js/28.5539ac79.js"><link rel="prefetch" href="/assets/js/280.58bf36ea.js"><link rel="prefetch" href="/assets/js/281.b093e33b.js"><link rel="prefetch" href="/assets/js/282.0afb811a.js"><link rel="prefetch" href="/assets/js/283.57d16abf.js"><link rel="prefetch" href="/assets/js/284.fed63bdb.js"><link rel="prefetch" href="/assets/js/285.3e281284.js"><link rel="prefetch" href="/assets/js/286.5fd82441.js"><link rel="prefetch" href="/assets/js/287.576684d7.js"><link rel="prefetch" href="/assets/js/288.5e1ddc82.js"><link rel="prefetch" href="/assets/js/289.c9665bb4.js"><link rel="prefetch" href="/assets/js/29.b7aeafd2.js"><link rel="prefetch" href="/assets/js/290.fea19ce6.js"><link rel="prefetch" href="/assets/js/291.7d306a45.js"><link rel="prefetch" href="/assets/js/292.d16a085d.js"><link rel="prefetch" href="/assets/js/293.a2ba2f0f.js"><link rel="prefetch" href="/assets/js/294.d855cbd9.js"><link rel="prefetch" href="/assets/js/295.0100374c.js"><link rel="prefetch" href="/assets/js/296.7be2d9ee.js"><link rel="prefetch" href="/assets/js/297.a4c0465d.js"><link rel="prefetch" href="/assets/js/298.1db5d5c2.js"><link rel="prefetch" href="/assets/js/299.38d8457c.js"><link rel="prefetch" href="/assets/js/30.fc6b86f2.js"><link rel="prefetch" href="/assets/js/300.1ba015d8.js"><link rel="prefetch" href="/assets/js/301.35b2e6ba.js"><link rel="prefetch" href="/assets/js/302.429cb0ec.js"><link rel="prefetch" href="/assets/js/303.8c006780.js"><link rel="prefetch" href="/assets/js/304.ca3d5644.js"><link rel="prefetch" href="/assets/js/305.84329278.js"><link rel="prefetch" href="/assets/js/306.45b281a2.js"><link rel="prefetch" href="/assets/js/307.be05fe98.js"><link rel="prefetch" href="/assets/js/308.80655fac.js"><link rel="prefetch" href="/assets/js/309.d0bca0f4.js"><link rel="prefetch" href="/assets/js/31.4b15d755.js"><link rel="prefetch" href="/assets/js/310.9674b6bd.js"><link rel="prefetch" href="/assets/js/311.6804abea.js"><link rel="prefetch" href="/assets/js/312.ab5a2f8b.js"><link rel="prefetch" href="/assets/js/313.b2fea146.js"><link rel="prefetch" href="/assets/js/314.a4369eb5.js"><link rel="prefetch" href="/assets/js/315.b3b11ac9.js"><link rel="prefetch" href="/assets/js/316.8785a926.js"><link rel="prefetch" href="/assets/js/317.a6abd001.js"><link rel="prefetch" href="/assets/js/318.5089ee03.js"><link rel="prefetch" href="/assets/js/319.fa74b2cc.js"><link rel="prefetch" href="/assets/js/32.d80ffae2.js"><link rel="prefetch" href="/assets/js/320.a5c03bfc.js"><link rel="prefetch" href="/assets/js/321.5e4dcfe8.js"><link rel="prefetch" href="/assets/js/322.23c23832.js"><link rel="prefetch" href="/assets/js/323.4ac1fe2e.js"><link rel="prefetch" href="/assets/js/324.301c9e00.js"><link rel="prefetch" href="/assets/js/325.82fff4a0.js"><link rel="prefetch" href="/assets/js/326.d653ce14.js"><link rel="prefetch" href="/assets/js/327.9d4e295a.js"><link rel="prefetch" href="/assets/js/329.dce67ef0.js"><link rel="prefetch" href="/assets/js/33.0a4b28c8.js"><link rel="prefetch" href="/assets/js/330.8ee58260.js"><link rel="prefetch" href="/assets/js/331.766ca988.js"><link rel="prefetch" href="/assets/js/332.2cef316c.js"><link rel="prefetch" href="/assets/js/333.5c1e99cd.js"><link rel="prefetch" href="/assets/js/334.8ef63e12.js"><link rel="prefetch" href="/assets/js/335.2a615cdf.js"><link rel="prefetch" href="/assets/js/336.b255636f.js"><link rel="prefetch" href="/assets/js/337.aeddf147.js"><link rel="prefetch" href="/assets/js/338.cf24395e.js"><link rel="prefetch" href="/assets/js/339.ae7ee883.js"><link rel="prefetch" href="/assets/js/34.bb8cbe99.js"><link rel="prefetch" href="/assets/js/340.f5e5e10b.js"><link rel="prefetch" href="/assets/js/341.60065767.js"><link rel="prefetch" href="/assets/js/342.880f2c51.js"><link rel="prefetch" href="/assets/js/343.47928836.js"><link rel="prefetch" href="/assets/js/344.317ead2b.js"><link rel="prefetch" href="/assets/js/345.a922de9a.js"><link rel="prefetch" href="/assets/js/346.b0e6bbb0.js"><link rel="prefetch" href="/assets/js/347.23210924.js"><link rel="prefetch" href="/assets/js/348.4cbe7dfd.js"><link rel="prefetch" href="/assets/js/349.bc36d23d.js"><link rel="prefetch" href="/assets/js/35.13e5c204.js"><link rel="prefetch" href="/assets/js/350.78ff49df.js"><link rel="prefetch" href="/assets/js/351.98baa8d7.js"><link rel="prefetch" href="/assets/js/352.dafe3072.js"><link rel="prefetch" href="/assets/js/353.3a6adbb4.js"><link rel="prefetch" href="/assets/js/354.00d0f928.js"><link rel="prefetch" href="/assets/js/355.934b4c3e.js"><link rel="prefetch" href="/assets/js/356.67857703.js"><link rel="prefetch" href="/assets/js/357.8ab62a9b.js"><link rel="prefetch" href="/assets/js/358.e06b5e02.js"><link rel="prefetch" href="/assets/js/359.5ca9d976.js"><link rel="prefetch" href="/assets/js/36.3ae18163.js"><link rel="prefetch" href="/assets/js/360.38cf065b.js"><link rel="prefetch" href="/assets/js/361.84c5e0ca.js"><link rel="prefetch" href="/assets/js/362.dbf28682.js"><link rel="prefetch" href="/assets/js/363.9d7bac1a.js"><link rel="prefetch" href="/assets/js/364.6f9aaa6c.js"><link rel="prefetch" href="/assets/js/365.76e0b937.js"><link rel="prefetch" href="/assets/js/366.958065e0.js"><link rel="prefetch" href="/assets/js/367.62fe05e9.js"><link rel="prefetch" href="/assets/js/368.52e42cf5.js"><link rel="prefetch" href="/assets/js/369.be5a8e9d.js"><link rel="prefetch" href="/assets/js/37.efb2744c.js"><link rel="prefetch" href="/assets/js/370.4926d8c5.js"><link rel="prefetch" href="/assets/js/371.2aadb305.js"><link rel="prefetch" href="/assets/js/372.dcb47317.js"><link rel="prefetch" href="/assets/js/373.99d87a09.js"><link rel="prefetch" href="/assets/js/374.1d37ebf9.js"><link rel="prefetch" href="/assets/js/375.040f7228.js"><link rel="prefetch" href="/assets/js/376.4e06867e.js"><link rel="prefetch" href="/assets/js/377.27d9e275.js"><link rel="prefetch" href="/assets/js/378.8d3c34d7.js"><link rel="prefetch" href="/assets/js/379.67dba2a0.js"><link rel="prefetch" href="/assets/js/380.c1836db3.js"><link rel="prefetch" href="/assets/js/381.3497ba24.js"><link rel="prefetch" href="/assets/js/382.d041ea4d.js"><link rel="prefetch" href="/assets/js/39.031f1004.js"><link rel="prefetch" href="/assets/js/40.7376f5a0.js"><link rel="prefetch" href="/assets/js/41.d0e792da.js"><link rel="prefetch" href="/assets/js/42.246f9e60.js"><link rel="prefetch" href="/assets/js/43.95799058.js"><link rel="prefetch" href="/assets/js/44.ad27a9ff.js"><link rel="prefetch" href="/assets/js/45.0b4092a6.js"><link rel="prefetch" href="/assets/js/46.0012a2ef.js"><link rel="prefetch" href="/assets/js/47.e4b364de.js"><link rel="prefetch" href="/assets/js/48.40886536.js"><link rel="prefetch" href="/assets/js/49.cb7bc92d.js"><link rel="prefetch" href="/assets/js/5.d7fd577a.js"><link rel="prefetch" href="/assets/js/50.6c993145.js"><link rel="prefetch" href="/assets/js/51.fd053414.js"><link rel="prefetch" href="/assets/js/52.3dd8f9c6.js"><link rel="prefetch" href="/assets/js/53.81b89f42.js"><link rel="prefetch" href="/assets/js/54.a7a1880d.js"><link rel="prefetch" href="/assets/js/55.4cf210c4.js"><link rel="prefetch" href="/assets/js/56.c0ed7408.js"><link rel="prefetch" href="/assets/js/57.2a7659d5.js"><link rel="prefetch" href="/assets/js/58.c322ef28.js"><link rel="prefetch" href="/assets/js/59.4544e7b8.js"><link rel="prefetch" href="/assets/js/6.45776bb3.js"><link rel="prefetch" href="/assets/js/60.919fca3f.js"><link rel="prefetch" href="/assets/js/61.faddc5df.js"><link rel="prefetch" href="/assets/js/62.29428be6.js"><link rel="prefetch" href="/assets/js/63.f496aeee.js"><link rel="prefetch" href="/assets/js/64.d6826e8b.js"><link rel="prefetch" href="/assets/js/65.b4163fb2.js"><link rel="prefetch" href="/assets/js/66.58d152d7.js"><link rel="prefetch" href="/assets/js/67.a6dac763.js"><link rel="prefetch" href="/assets/js/68.90c252f7.js"><link rel="prefetch" href="/assets/js/69.d041ba69.js"><link rel="prefetch" href="/assets/js/7.831c92c6.js"><link rel="prefetch" href="/assets/js/70.b1b69cc5.js"><link rel="prefetch" href="/assets/js/71.b99b548a.js"><link rel="prefetch" href="/assets/js/72.b6cd4d2e.js"><link rel="prefetch" href="/assets/js/73.615eba63.js"><link rel="prefetch" href="/assets/js/74.444d9de5.js"><link rel="prefetch" href="/assets/js/75.ffd9da23.js"><link rel="prefetch" href="/assets/js/76.84d4fa46.js"><link rel="prefetch" href="/assets/js/77.eedc1376.js"><link rel="prefetch" href="/assets/js/78.7095885b.js"><link rel="prefetch" href="/assets/js/79.48c95cb9.js"><link rel="prefetch" href="/assets/js/80.8f42ea9f.js"><link rel="prefetch" href="/assets/js/81.521ca7da.js"><link rel="prefetch" href="/assets/js/82.ecb175b7.js"><link rel="prefetch" href="/assets/js/83.e121013d.js"><link rel="prefetch" href="/assets/js/84.1c1a3c28.js"><link rel="prefetch" href="/assets/js/85.7e914dee.js"><link rel="prefetch" href="/assets/js/86.9585ccde.js"><link rel="prefetch" href="/assets/js/87.36363a25.js"><link rel="prefetch" href="/assets/js/88.db15b19f.js"><link rel="prefetch" href="/assets/js/89.20df314c.js"><link rel="prefetch" href="/assets/js/90.8df91573.js"><link rel="prefetch" href="/assets/js/91.5a7d83c5.js"><link rel="prefetch" href="/assets/js/92.9b428b1a.js"><link rel="prefetch" href="/assets/js/93.c50f82ea.js"><link rel="prefetch" href="/assets/js/94.6813fd20.js"><link rel="prefetch" href="/assets/js/95.942ec555.js"><link rel="prefetch" href="/assets/js/96.53a215ae.js"><link rel="prefetch" href="/assets/js/97.0c2c5e6a.js"><link rel="prefetch" href="/assets/js/98.88fccd9a.js"><link rel="prefetch" href="/assets/js/99.a61ea740.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.26b542fc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2357ed77.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="http://pic.zzppjj.top/LightPicture/2023/03/c818c3c19bf7c336.png" alt="章工运维" class="logo"> <span class="site-name can-hide">章工运维</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><a href="/ops/" class="link-title">运维</a> <span class="title" style="display:none;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">linux</a></li><li class="dropdown-item"><!----> <a href="/windows/" class="nav-link">windows</a></li><li class="dropdown-item"><!----> <a href="/middleware/" class="nav-link">中间件</a></li><li class="dropdown-item"><!----> <a href="/monitor/" class="nav-link">监控</a></li><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/storage/" class="nav-link">存储</a></li><li class="dropdown-item"><!----> <a href="/safety/" class="nav-link">安全</a></li><li class="dropdown-item"><!----> <a href="/firewalld/" class="nav-link">防火墙</a></li><li class="dropdown-item"><!----> <a href="/db/" class="nav-link">数据库</a></li><li class="dropdown-item"><!----> <a href="/sys/" class="nav-link">系统</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">docker</a></li><li class="dropdown-item"><!----> <a href="/tool/" class="nav-link">运维工具</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">other</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专题" class="dropdown-title"><a href="/topic/" class="link-title">专题</a> <span class="title" style="display:none;">专题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/elk/" class="nav-link">elk</a></li><li class="dropdown-item"><!----> <a href="/k8s/" class="nav-link">K8S</a></li><li class="dropdown-item"><!----> <a href="/ansible/" class="nav-link">ansible</a></li><li class="dropdown-item"><!----> <a href="/jenkins/" class="nav-link">Jenkins</a></li><li class="dropdown-item"><!----> <a href="/gitlabci/" class="nav-link">GitLabCI_CD</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="生活" class="dropdown-title"><a href="/life/" class="link-title">生活</a> <span class="title" style="display:none;">生活</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/suibi/" class="nav-link">随笔</a></li><li class="dropdown-item"><!----> <a href="/mianshi/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/gongju/" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/favorites/" class="nav-link">收藏夹</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><a href="/code/" class="link-title">编程</a> <span class="title" style="display:none;">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/shell/" class="nav-link">Shell</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">python</a></li><li class="dropdown-item"><!----> <a href="/go/" class="nav-link">golang</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友链</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/nav/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>索引</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.zzppjj.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://pic.zzppjj.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图床
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://artalk.zzppjj.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  评论
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.zzppjj.top/download/light/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  下载站点
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开往
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/zpj874878956" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="http://pic.zzppjj.top/LightPicture/2023/02/c7ac9de8fb6cfb17.jpg"> <div class="blogger-info"><h3>章工运维</h3> <span>业精于勤，荒于嬉</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><a href="/ops/" class="link-title">运维</a> <span class="title" style="display:none;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">linux</a></li><li class="dropdown-item"><!----> <a href="/windows/" class="nav-link">windows</a></li><li class="dropdown-item"><!----> <a href="/middleware/" class="nav-link">中间件</a></li><li class="dropdown-item"><!----> <a href="/monitor/" class="nav-link">监控</a></li><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/storage/" class="nav-link">存储</a></li><li class="dropdown-item"><!----> <a href="/safety/" class="nav-link">安全</a></li><li class="dropdown-item"><!----> <a href="/firewalld/" class="nav-link">防火墙</a></li><li class="dropdown-item"><!----> <a href="/db/" class="nav-link">数据库</a></li><li class="dropdown-item"><!----> <a href="/sys/" class="nav-link">系统</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">docker</a></li><li class="dropdown-item"><!----> <a href="/tool/" class="nav-link">运维工具</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">other</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专题" class="dropdown-title"><a href="/topic/" class="link-title">专题</a> <span class="title" style="display:none;">专题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/elk/" class="nav-link">elk</a></li><li class="dropdown-item"><!----> <a href="/k8s/" class="nav-link">K8S</a></li><li class="dropdown-item"><!----> <a href="/ansible/" class="nav-link">ansible</a></li><li class="dropdown-item"><!----> <a href="/jenkins/" class="nav-link">Jenkins</a></li><li class="dropdown-item"><!----> <a href="/gitlabci/" class="nav-link">GitLabCI_CD</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="生活" class="dropdown-title"><a href="/life/" class="link-title">生活</a> <span class="title" style="display:none;">生活</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/suibi/" class="nav-link">随笔</a></li><li class="dropdown-item"><!----> <a href="/mianshi/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/gongju/" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/favorites/" class="nav-link">收藏夹</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><a href="/code/" class="link-title">编程</a> <span class="title" style="display:none;">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/shell/" class="nav-link">Shell</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">python</a></li><li class="dropdown-item"><!----> <a href="/go/" class="nav-link">golang</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友链</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/nav/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>索引</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.zzppjj.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://pic.zzppjj.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图床
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://artalk.zzppjj.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  评论
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.zzppjj.top/download/light/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  下载站点
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开往
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/zpj874878956" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>windows</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>存储</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>防火墙</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>docker</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/83a393/" aria-current="page" class="active sidebar-link">Docker构建镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/83a393/#一、dockerfile-简介" class="sidebar-link">一、Dockerfile 简介</a></li><li class="sidebar-sub-header level2"><a href="/pages/83a393/#二、dockerfile-指令" class="sidebar-link">二、Dockerfile 指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_1、常用指令" class="sidebar-link">1、常用指令</a></li><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_2、指令详解" class="sidebar-link">2、指令详解</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_1、from" class="sidebar-link">1、FROM</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_2、copy" class="sidebar-link">2、COPY</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_3、add" class="sidebar-link">3、ADD</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_4、run" class="sidebar-link">4、RUN</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_5、cmd" class="sidebar-link">5、CMD</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_6、entrypoint" class="sidebar-link">6、ENTRYPOINT</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_7、env" class="sidebar-link">7、ENV</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_8、arg" class="sidebar-link">8、ARG</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_9、volume" class="sidebar-link">9、VOLUME</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_10、expose" class="sidebar-link">10、EXPOSE</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_11、workdir" class="sidebar-link">11、WORKDIR</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_12、user" class="sidebar-link">12、USER</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_13、healthcheck" class="sidebar-link">13、HEALTHCHECK</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_14、onbuild" class="sidebar-link">14、ONBUILD</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_15、label" class="sidebar-link">15、LABEL</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_16、-dockerignore-文件" class="sidebar-link">16、.dockerignore 文件</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/83a393/#三、镜像优化" class="sidebar-link">三、镜像优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_1、基础镜像选择" class="sidebar-link">1、基础镜像选择</a></li><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_2、配置国内软件源" class="sidebar-link">2、配置国内软件源</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/83a393/#四、构建镜像" class="sidebar-link">四、构建镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_1、命名" class="sidebar-link">1、命名</a></li><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_2、基于镜像部署服务" class="sidebar-link">2、基于镜像部署服务</a></li><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_3、使用makefile操作dockerfile" class="sidebar-link">3、使用Makefile操作Dockerfile</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/83a393/#五、多阶段构建镜像" class="sidebar-link">五、多阶段构建镜像</a></li><li class="sidebar-sub-header level2"><a href="/pages/83a393/#六、dockerfile-传参" class="sidebar-link">六、Dockerfile 传参</a></li><li class="sidebar-sub-header level2"><a href="/pages/83a393/#七、dockerfile-优化" class="sidebar-link">七、Dockerfile 优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_1、尽量不使用root用户" class="sidebar-link">1、尽量不使用root用户</a></li><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_2、移除所有缓存等不必要信息" class="sidebar-link">2、移除所有缓存等不必要信息</a></li><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_3、使用合理的entrypoint脚本" class="sidebar-link">3、使用合理的ENTRYPOINT脚本</a></li><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_4、设置时区" class="sidebar-link">4、设置时区</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_1、基于-alpine-镜像" class="sidebar-link">1、基于 Alpine 镜像</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_2、基于-centos7-镜像" class="sidebar-link">2、基于 Centos7 镜像</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_3、基于-debian-镜像" class="sidebar-link">3、基于 Debian 镜像</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_4、基于-ubuntu-镜像" class="sidebar-link">4、基于 Ubuntu 镜像</a></li><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_5、设置系统语言" class="sidebar-link">5、设置系统语言</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_1、基于-alpine-镜像-2" class="sidebar-link">1、基于 Alpine 镜像</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_2、基于-centos7-镜像-2" class="sidebar-link">2、基于 Centos7 镜像</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_3、基于-debian-镜像-2" class="sidebar-link">3、基于 Debian 镜像</a></li><li class="sidebar-sub-header level4"><a href="/pages/83a393/#_4、基于-ubuntu-镜像-2" class="sidebar-link">4、基于 Ubuntu 镜像</a></li><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_6、使用label标注作者、软件版本等元信息" class="sidebar-link">6、使用Label标注作者、软件版本等元信息</a></li><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_7、指定工作区" class="sidebar-link">7、指定工作区</a></li><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_8、run指令显示优化" class="sidebar-link">8、RUN指令显示优化</a></li><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_9、使用-url-添加源码" class="sidebar-link">9、使用 URL 添加源码</a></li><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_10、使用虚拟编译环境" class="sidebar-link">10、使用虚拟编译环境</a></li><li class="sidebar-sub-header level3"><a href="/pages/83a393/#_11、最小化层数" class="sidebar-link">11、最小化层数</a></li></ul></li></ul></li><li><a href="/pages/217e32/" class="sidebar-link">docker和docker-compose安装</a></li><li><a href="/pages/8884ac/" class="sidebar-link">如何选择docker基础镜像</a></li><li><a href="/pages/382a6c/" class="sidebar-link">常见的dockerfile汇总</a></li><li><a href="/pages/6e3cb9/" class="sidebar-link">基于官方php7.2.34镜像构建生产可用镜像</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>other</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>监控</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/ops/#运维" data-v-06225672>运维</a></li><li data-v-06225672><a href="/ops/#docker" data-v-06225672>docker</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/zpj874878956" target="_blank" title="作者" class="beLink" data-v-06225672>章工运维</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-02-24</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Docker构建镜像<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="一、dockerfile-简介"><a href="#一、dockerfile-简介" class="header-anchor">#</a> 一、Dockerfile 简介</h2> <p>什么是 Dockerfile？</p> <p>Dockerfile 是一个用来构建镜像的文本文件，文本内容包含了构建镜像所需的指令和说明。</p> <p>在构建时 docker Engine 会在当前目录中查找名为 “Dockerfile” 的文件，注意这个文件名必须为 “Dockerfile” 首字母大写。当您运行 docker build 命令的时候，Dockerfile 文件以及与 Dockerfile 文件处于同级路径下的所有文件都将一并提交至 docker Engine 来处理，docker Engine 将逐行解析 Dockerfile 文件，并执行相关操作。Dockerfile 的解析是由上而下的顺序进行。</p> <p>注意您放置 Dockerfile 的目录最好是一个空目录，或者只放置与本次构建相关的文件即可，因为在执行 build 时会将 Dockerfile 以及 Dockerfile 路径下的所有文件提交至 docker Engine 处理，因此您不应该在 Dockerfile 目录中放置一些无关的文件，这是无意义的并且这将会严重拖慢整个构建过程。</p> <h2 id="二、dockerfile-指令"><a href="#二、dockerfile-指令" class="header-anchor">#</a> 二、Dockerfile 指令</h2> <h3 id="_1、常用指令"><a href="#_1、常用指令" class="header-anchor">#</a> 1、常用指令</h3> <p>Docker 镜像可以通过 Docker hub 或者阿里云等仓库中获取，这些镜像是由官方或者社区人员提供的，对于 Docker 用户来说并不能满足我们的需求，但是从无开始构建镜像成本大。常用的数据库、中间件、应用软件等都有现成的 Docker 官方镜像或社区创建的镜像，我们只需要稍作配置就可以直接使用。</p> <p>使用现成镜像的好处除了省去自己做镜像的工作量外，更重要的是可以利用前人的经验。特别是使用那些官方镜像，因为 Docker 的工程师知道如何更好的在容器中运行软件。</p> <p>当然，某些情况下我们也不得不自己构建镜像，比如找不到现成的镜像，比如自己开发的应用程序，需要在镜像中加入特定的功能。</p> <p>在编写 Dockerfile 时，您需要用到 Dockerfile 指令来定义构建过程中所要执行的操作，这里列举几个常用的指令：</p> <table><thead><tr><th>常用指令</th> <th>说明</th></tr></thead> <tbody><tr><td><strong>FROM</strong></td> <td>FROM 指令是定义本阶段构建所要使用的基础镜像。</td></tr> <tr><td>MAINTAINER</td> <td>镜像维护者姓名或邮箱地址</td></tr> <tr><td><strong>RUN</strong></td> <td>构建镜像时运行的 shell 命令</td></tr> <tr><td><strong>CMD</strong></td> <td>运行容器时执行的 shell 命令</td></tr> <tr><td><strong>EXPOSE</strong></td> <td>仅仅只是声明端口，声明容器内应用所使用的端口号</td></tr> <tr><td><strong>ENV</strong></td> <td>设置容器环境变量，当然在您使用该镜像运行容器时，ENV 所定义的变量仍然对容器有效</td></tr> <tr><td><strong>ADD</strong></td> <td>拷贝文件或目录到镜像，如果是 URL 或压缩包会自动下载或自动解压</td></tr> <tr><td><strong>COPY</strong></td> <td>拷贝文件或目录到镜像容器内，跟 ADD 类似，但不具备自动下载或解压功能</td></tr> <tr><td>ENTRYPOINT</td> <td>运行容器时执行的 shell 命令</td></tr> <tr><td><strong>VOLUME</strong></td> <td>指定容器挂载点到宿主机自动生成的目录或其他容器</td></tr> <tr><td>USER</td> <td>为 RUN、CMD、和 ENTRYPOINT 执行命令指定运行用户</td></tr> <tr><td><strong>WORKDIR</strong></td> <td>为 RUN、CMD、ENTRYPOINT、COPY 和 ADD 设置工作目录，意思为切换目录</td></tr> <tr><td>HEALTHCHECK</td> <td>健康检查</td></tr> <tr><td>ARG</td> <td>构建时指定的一些参数</td></tr></tbody></table> <p><strong>RUN、CMD 与 ENTRYPOINT 的区别</strong></p> <ul><li>RUN：执行命令并创建新的镜像层，常用于安装软件包，在 docker build 过程中执行；</li> <li>CMD：设置容器启动后默认执行的命令及其参数，在 docker run 时运行，但 docker run 后跟参数时会替换（忽略） CMD，CMD 可以被覆盖，如果有 ENTRYPIOINT 的话，CMD 就是 ENTRYPIOINT 的参数。；</li> <li>ENTRYPOINT：配置容器启动时运行的命令，不管 docker run … 后是否运行有其他命令，ENTRYPOINT 指令后的命令一定会被执行， 后面如果再接命令，会报错多余的参数。</li> <li>CMD 和 ENTRYPIOINT 必须要有一个</li></ul> <h3 id="_2、指令详解"><a href="#_2、指令详解" class="header-anchor">#</a> 2、指令详解</h3> <h4 id="_1、from"><a href="#_1、from" class="header-anchor">#</a> 1、FROM</h4> <p>FROM 指令是定义本阶段构建所要使用的基础镜像。例如您需要将您的 java 开发的项目构建为一个镜像，那么您可能需要 tomcat 镜像，而制作 tomcat 镜像就可能需要 jdk 镜像，那么 jdk 镜像就需要一个基本的操作系统镜像，这可能是 utuntu、debian、alpine 等。</p> <p>根据以上，我们应该可以知道由于容器镜像是可以增量叠加的，那么 tomcat 镜像中就应该包含了 jdk 以及一个基本的操作系统。</p> <p>您可以从 hub.docker.com 网站上来挑选一个合适的镜像来作为您的基础镜像。</p> <h4 id="_2、copy"><a href="#_2、copy" class="header-anchor">#</a> 2、COPY</h4> <p>复制指令，从上下文目录中复制文件或者目录到容器里指定路径</p> <p>（上下文目录是指放置 Dockerfile 文件的目录）</p> <p>格式如下：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">COPY</span> [--chown=&lt;user&gt;:&lt;group&gt;] &lt;源路径1&gt;... &lt;目标路径&gt;</span>
<span class="token instruction"><span class="token keyword">COPY</span> [--chown=&lt;user&gt;:&lt;group&gt;] [<span class="token string">&quot;&lt;源路径1&gt;&quot;</span>,... <span class="token string">&quot;&lt;目标路径&gt;&quot;</span>]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注意 <code>[--chown=&lt;user&gt;:&lt;group&gt;]：</code> 可选参数，用户改变复制到容器内文件的拥有者和属组。</p> <p>&lt;源路径&gt;：源文件或者源目录，这里可以是通配符表达式，其通配符规则要满足 Go 的 filepath.Match 规则。例如：</p> <p>COPY hom* /mydir/</p> <p>COPY hom?.txt /mydir/</p> <p>&lt;目标路径&gt;：容器内的指定路径，该路径不用事先建好，路径不存在的话，会自动创建。</p> <h4 id="_3、add"><a href="#_3、add" class="header-anchor">#</a> 3、ADD</h4> <p>ADD 指令和 COPY 的使用格式一致（同样需求下，官方推荐使用 COPY）。功能也类似，不同之处如下：</p> <p>ADD 的优点：在执行 &lt;源文件&gt; 为 tar 压缩文件的话，压缩格式为 gzip, bzip2 以及 xz 的情况下，会自动复制并解压到 &lt; 目标路径 &gt;。</p> <p>ADD 的缺点：在不解压的前提下，无法复制 tar 压缩文件。会令镜像构建缓存失效，从而可能会令镜像构建变得比较缓慢。具体是否使用，可以根据是否需要自动解压来决定。</p> <p>对于使用 ADD 指令下载远程服务器上的 tar 包并解压，建议使用以下方式代替</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>RUN <span class="token function">curl</span> <span class="token parameter variable">-s</span> http://192.168.1.7/repository/tools/jdk-8u241-linux-x64.tar.gz <span class="token operator">|</span> <span class="token function">tar</span> <span class="token parameter variable">-xC</span> /opt/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4、run"><a href="#_4、run" class="header-anchor">#</a> 4、RUN</h4> <p>当我们在构建镜像过程中，需要执行一些配置，例如使用 mkdir 命令新建一个目录，用 sed 命令来替换一些文本内容等，当然可能在实际过程中需要更复杂的命令，那么此时您可以使用 RUN 指令来定义将要运行的命令。</p> <p>RUN 指令在 Dockerfile 中可以出现多次，docker Engine 在构建过程中会读取 Dockerfile 然后由上而下依次执行 RUN 指令所标记的命令。</p> <p>RUN 后面跟着的命令行命令。有以下俩种格式：</p> <p>Shell 格式</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">RUN</span> &lt;命令行命令&gt;</span>
<span class="token comment"># &lt;命令行命令&gt; 等同于，在终端操作的 shell 命令。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Exec 格式：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">RUN</span> [<span class="token string">&quot;可执行文件&quot;</span>, <span class="token string">&quot;参数1&quot;</span>, <span class="token string">&quot;参数2&quot;</span>]</span>
<span class="token comment"># 例如：</span>
<span class="token comment"># RUN [&quot;./test.php&quot;, &quot;dev&quot;, &quot;offline&quot;] 等价于 RUN ./test.php dev offline</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>注意在构建过程中 docker Engine 会为 Dockerfile 中的每个 RUN 指令创建一个镜像层（layer）来记录这种改变。因此为了减少不必要的镜像层数，通常的做法是将多个命令定义在一个 RUN 指令中，如下所示：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">RUN</span> mkdir demo <span class="token operator">\</span>
    &amp;&amp; cd demo <span class="token operator">\</span>
    &amp;&amp; wget https://www.demo.com/download/demo.tar.gz <span class="token operator">\</span>
    &amp;&amp; tar -xf demo.tar.gz <span class="token operator">\</span>
    &amp;&amp; rm -rf demo.tar.gz</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如上，以 &amp;&amp; 符号连接命令，这样执行后，只会创建 1 层镜像</p> <h4 id="_5、cmd"><a href="#_5、cmd" class="header-anchor">#</a> 5、CMD</h4> <p>类似于 RUN 指令，用于运行程序，但二者运行的时间点不同:</p> <p>CMD 在 docker run 时运行。</p> <p>RUN 是在 docker build 过程中执行。</p> <p>作用：为启动的容器指定默认要运行的程序，程序运行结束，容器也就结束。CMD 指令指定的程序可被 docker run 命令行参数中指定要运行的程序所覆盖。</p> <blockquote><p>注意</p> <p>如果 Dockerfile 中如果存在多个 CMD 指令，仅最后一个生效。</p></blockquote> <p>格式：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">CMD</span> &lt;shell 命令&gt; </span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;&lt;可执行文件或命令&gt;&quot;</span>,<span class="token string">&quot;&lt;param1&gt;&quot;</span>,<span class="token string">&quot;&lt;param2&gt;&quot;</span>,...] </span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;&lt;param1&gt;&quot;</span>,<span class="token string">&quot;&lt;param2&gt;&quot;</span>,...]  # 该写法是为 ENTRYPOINT 指令指定的程序提供默认参数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>推荐使用第二种格式，执行过程比较明确。第一种格式实际上在运行的过程中也会自动转换成第二种格式运行，并且默认可执行文件是 sh。</p> <p>例如您有一个 nodejs 程序，启动该程序的命令是 node server.js，然后您希望在使用该镜像运行容器时也以这种方式运行，那么您可以在 Dockerfile 中使用 CMD 来标记，如下：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;node&quot;</span>,<span class="token string">&quot;server.js&quot;</span>]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通常 CMD 指令出现在 Dockerfile 末尾处。当您将以上定义写入 Dockerfile 中并打包成镜像（demo:v1），然后您使用该镜像运行时，那么该容器将使用 Dockerfile 中 CMD 定义的命令来运行</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>docker  run  -d  --name=demo  deom:v1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当然您可以在运行时覆盖 CMD 指令中的命令，例如这里改成 npm start，命令如下</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>docker  run  -d  --name=demo  deom:v1  npm  start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_6、entrypoint"><a href="#_6、entrypoint" class="header-anchor">#</a> 6、ENTRYPOINT</h4> <p>类似于 CMD 指令，但其不会被 docker run 的命令行参数指定的指令所覆盖，而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序。</p> <p>但是，如果运行 docker run 时使用了 --entrypoint 选项，将覆盖 CMD 指令指定的程序。</p> <p>优点：在执行 docker run 的时候可以指定 ENTRYPOINT 运行所需的参数。</p> <p>注意：如果 Dockerfile 中如果存在多个 ENTRYPOINT 指令，仅最后一个生效。</p> <p>格式：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;&lt;executeable&gt;&quot;</span>,<span class="token string">&quot;&lt;param1&gt;&quot;</span>,<span class="token string">&quot;&lt;param2&gt;&quot;</span>,...]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以搭配 CMD 命令使用：一般是变参才会使用 CMD ，这里的 CMD 等于是在给 ENTRYPOINT 传参，以下示例会提到。</p> <p>示例：</p> <p>假设已通过 Dockerfile 构建了 nginx:test 镜像</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> nginx</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;nginx&quot;</span>, <span class="token string">&quot;-c&quot;</span>] # 定参</span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;/etc/nginx/nginx.conf&quot;</span>] # 变参</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>不传参运行</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>docker run nginx:test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>容器内会默认运行以下命令，启动主进程。</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>nginx -c /etc/nginx/nginx.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>传参运行</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>docker run nginx:test -c /etc/nginx/new.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>容器内会默认运行以下命令，启动主进程 (/etc/nginx/new.conf: 假设容器内已有此文件)</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>nginx -c /etc/nginx/new.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通常更好的做法是使用 ENTRYPOINT 来定义一个 docker-entrypoint.sh 脚本，然后在该脚本中定义一些预处理及条件判断，来应对更多未知情况。例如 cups 镜像的 Dockerfile</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">ARG</span> ARCH=amd64</span>
<span class="token instruction"><span class="token keyword">FROM</span> <span class="token variable">$ARCH</span>/debian:buster-slim</span>
<span class="token comment"># environment</span>
<span class="token instruction"><span class="token keyword">ENV</span> ADMIN_PASSWORD=admin</span>
<span class="token comment"># ……内容太多，中间内容已省略</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [ <span class="token string">&quot;docker-entrypoint.sh&quot;</span> ]</span>
<span class="token comment"># default command</span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;cupsd&quot;</span>, <span class="token string">&quot;-f&quot;</span>]</span>
<span class="token comment"># volumes</span>
<span class="token instruction"><span class="token keyword">VOLUME</span> [<span class="token string">&quot;/etc/cups&quot;</span>]</span>
<span class="token comment"># ports</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 631</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>该镜像的 docker-entrypoint.sh 文件内容如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/bin/bash -e</span>
<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">${ADMIN_PASSWORD}</span><span class="token entity" title="\n">\n</span><span class="token variable">${ADMIN_PASSWORD}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">passwd</span> admin
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> /etc/cups/cupsd.conf <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token function">cp</span> <span class="token parameter variable">-rpn</span> /etc/cups-skel/* /etc/cups/
<span class="token keyword">fi</span>
<span class="token builtin class-name">exec</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_7、env"><a href="#_7、env" class="header-anchor">#</a> 7、ENV</h4> <p>设置环境变量，定义了环境变量，那么在后续的指令中，就可以使用这个环境变量。当然在您使用该镜像运行容器时，ENV 所定义的变量仍然对容器有效，例如 MySQL 镜像的 Dockerfile 中就包含 root 用户的初始密码，使用 ENV 来指定。</p> <p>格式：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">ENV</span> &lt;key&gt; &lt;value&gt;</span>
<span class="token instruction"><span class="token keyword">ENV</span> &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>以下示例设置 NODE_VERSION = 16.19.0 ， 在后续的指令中可以通过 $NODE_VERSION 引用：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">ENV</span> NODE_VERSION 16.19.0</span>
<span class="token instruction"><span class="token keyword">RUN</span> curl -SLO <span class="token string">&quot;https://nodejs.org/download/release/latest-v16.x/node-v$NODE_VERSION-linux-x64.tar.gz&quot;</span> </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Dockerfile 中 ENV 指令像 RUN 指令一样，每一个都会创建一个临时层。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ENV <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/jdk1.8.0_241 <span class="token punctuation">\</span>
    <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.:<span class="token variable">$JAVA_HOME</span>/lib:<span class="token variable">$JAVA_HOME</span>/jre/lib 
ENV <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_8、arg"><a href="#_8、arg" class="header-anchor">#</a> 8、ARG</h4> <p>构建参数，与 ENV 作用一至。不过作用域不一样。ARG 设置的环境变量仅对 Dockerfile 内有效，也就是说只有 docker build 的过程中有效，构建好的镜像内不存在此环境变量。</p> <p>构建命令 docker build 中可以用 --build-arg &lt;参数名&gt;=&lt; 值 &gt; 来覆盖。</p> <p>格式</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">ARG</span> &lt;参数名&gt;[=&lt;默认值&gt;]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_9、volume"><a href="#_9、volume" class="header-anchor">#</a> 9、VOLUME</h4> <p>定义匿名数据卷。在启动容器时忘记挂载数据卷，会自动挂载到匿名卷。</p> <p>作用：</p> <p>避免重要的数据，因容器重启而丢失，这是非常致命的。</p> <p>避免容器不断变大。</p> <p>格式：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">VOLUME</span> [<span class="token string">&quot;&lt;路径1&gt;&quot;</span>, <span class="token string">&quot;&lt;路径2&gt;&quot;</span>...]</span>
<span class="token instruction"><span class="token keyword">VOLUME</span> &lt;路径</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在启动容器 docker run 的时候，我们可以通过 -v 参数修改挂载点。</p> <h4 id="_10、expose"><a href="#_10、expose" class="header-anchor">#</a> 10、EXPOSE</h4> <p>仅仅只是声明端口。</p> <p>作用：</p> <p>帮助镜像使用者理解这个镜像服务的守护端口，以方便配置映射。</p> <p>在运行时使用随机端口映射时，也就是 docker run -P 时，会自动随机映射 EXPOSE 的端口。</p> <p>格式：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">EXPOSE</span> &lt;端口1&gt; [&lt;端口2&gt;...]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_11、workdir"><a href="#_11、workdir" class="header-anchor">#</a> 11、WORKDIR</h4> <p>指定工作目录。用 WORKDIR 指定的工作目录，会在构建镜像的每一层中都存在。（WORKDIR 指定的工作目录，如果目录不存在则会自动创建）。</p> <p>格式：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">WORKDIR</span> &lt;工作目录路径&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_12、user"><a href="#_12、user" class="header-anchor">#</a> 12、USER</h4> <p>用于指定执行后续命令的用户和用户组，这边只是切换后续命令执行的用户（用户和用户组必须提前已经存在）。</p> <p>格式</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">USER</span> &lt;用户名&gt;[:&lt;用户组&gt;]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_13、healthcheck"><a href="#_13、healthcheck" class="header-anchor">#</a> 13、HEALTHCHECK</h4> <p>用于指定某个程序或者指令来监控 docker 容器服务的运行状态。</p> <p>格式：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">HEALTHCHECK</span> [选项] CMD &lt;命令&gt;：设置检查容器健康状况的命令</span>
<span class="token instruction"><span class="token keyword">HEALTHCHECK</span> <span class="token keyword">NONE</span>：如果基础镜像有健康检查指令，使用这行可以屏蔽掉其健康检查指令</span>
<span class="token instruction"><span class="token keyword">HEALTHCHECK</span> [选项] CMD &lt;命令&gt; : 这边 CMD 后面跟随的命令使用，可以参考 CMD 的用法。</span>
<span class="token instruction"><span class="token keyword">HEALTHCHECK</span> 支持下列选项：</span>
--interval=&lt;间隔&gt;：两次健康检查的间隔，默认为 30 秒；
--timeout=&lt;时长&gt;：健康检查命令运行超时时间，如果超过这个时间，本次健康检查就被视为失败，默认 30 秒；
--retries=&lt;次数&gt;：当连续失败指定次数后，则将容器状态视为 unhealthy，默认 3 次。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>和 CMD, ENTRYPOINT 一样，HEALTHCHECK 只可以出现一次，如果写了多个，只有最后一个生效。</p> <p>在 HEALTHCHECK [选项] CMD 后面的命令，格式和 ENTRYPOINT 一样，分为 shell 格式，和 exec 格式。命令的返回值决定了该次健康检查的成功与否：0：成功；1：失败；2：保留，不要使用这个值。</p> <p>假设我们有个镜像是个最简单的 Web 服务，我们希望增加健康检查来判断其 Web 服务是否在正常工作，我们可以用 curl 来帮助判断，其 Dockerfile 的 HEALTHCHECK 可以这么写：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> nginx</span>
<span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; apt-get install -y curl &amp;&amp; rm -rf /var/lib/apt/lists/*</span>
<span class="token instruction"><span class="token keyword">HEALTHCHECK</span> <span class="token options"><span class="token property">--interval</span><span class="token punctuation">=</span><span class="token string">5s</span> <span class="token property">--timeout</span><span class="token punctuation">=</span><span class="token string">3s</span></span> <span class="token operator">\</span>
  <span class="token keyword">CMD</span> curl -fs http://localhost/ || exit 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>当然您可以在 docker run 命令中，直接指明 healthcheck 相关策略，如下：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>docker run --rm -d \
    --name=elasticsearch \
    --health-cmd=&quot;curl --silent --fail localhost:9200/_cluster/health || exit 1&quot; \
    --health-interval=5s \
    --health-retries=12 \
    --health-timeout=2s \
    elasticsearch:7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_14、onbuild"><a href="#_14、onbuild" class="header-anchor">#</a> 14、ONBUILD</h4> <p>用于延迟构建命令的执行。简单的说，就是 Dockerfile 里用 ONBUILD 指定的命令，在本次构建镜像的过程中不会执行（假设镜像为 test-build）。当有新的 Dockerfile 使用了之前构建的镜像 FROM test-build ，这是执行新镜像的 Dockerfile 构建时候，会执行 test-build 的 Dockerfile 里的 ONBUILD 指定的命令。</p> <p>格式：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">ONBUILD</span> &lt;其它指令&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>假设我们要制作 Node.js 所写的应用的镜像。我们都知道 Node.js 使用 npm 进行包管理，所有依赖、配置、启动信息等会放到 package.json 文件里。在拿到程序代码后，需要先进行 npm install 才可以获得所有需要的依赖。将项目相关的指令加上 ONBUILD，这样在构建基础镜像的时候，这三行并不会被执行。基础镜像变化后，各个项目都用这个 Dockerfile 重新构建镜像，会继承基础镜像的更新。</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> node:slim</span>
<span class="token instruction"><span class="token keyword">RUN</span> mkdir /app</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
<span class="token instruction"><span class="token keyword">ONBUILD</span> <span class="token keyword">COPY</span> ./package.json /app</span>
<span class="token instruction"><span class="token keyword">ONBUILD</span> <span class="token keyword">RUN</span> [ <span class="token string">&quot;npm&quot;</span>, <span class="token string">&quot;install&quot;</span> ]</span>
<span class="token instruction"><span class="token keyword">ONBUILD</span> <span class="token keyword">COPY</span> . /app/</span>
<span class="token instruction"><span class="token keyword">CMD</span> [ <span class="token string">&quot;npm&quot;</span>, <span class="token string">&quot;start&quot;</span> ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_15、label"><a href="#_15、label" class="header-anchor">#</a> 15、LABEL</h4> <p>LABEL 指令用来给镜像以键值对的形式添加一些元数据（metadata）</p> <p>格式：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">LABEL</span> &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>我们还可以用一些标签来申明镜像的作者、文档地址等，例如：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">LABEL</span> org.opencontainers.image.authors=<span class="token string">&quot;deamon&quot;</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> org.opencontainers.image.documentation=<span class="token string">&quot;https://daemon.gitbooks.io&quot;</span></span>
或者
<span class="token instruction"><span class="token keyword">LABEL</span> vendor=ACME\ Incorporated <span class="token operator">\</span>
      com.example.is-beta= <span class="token operator">\</span>
      com.example.is-production=<span class="token string">&quot;&quot;</span> <span class="token operator">\</span>
      com.example.version=<span class="token string">&quot;0.0.1-beta&quot;</span> <span class="token operator">\</span>
      com.example.release-date=<span class="token string">&quot;2015-02-12&quot;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_16、-dockerignore-文件"><a href="#_16、-dockerignore-文件" class="header-anchor">#</a> 16、.dockerignore 文件</h4> <p>执行 <code>docker build</code> 命令时，当前的工作目录被称为构建上下文。默认情况下，Dockerfile 就位于该路径下。也可以通过 <code>-f</code> 参数来指定 dockerfile ，但 docker 客户端会将当前工作目录下的所有文件发送到 docker 守护进程进行构建。</p> <p>所以来说，当执行 docker build 进行构建镜像时，当前目录一定要 <code>干净</code> ，切记不要在家里录下创建一个 Dockerfile 紧接着 <code>docker build</code> 一把梭。</p> <p>正确做法是为项目建立一个文件夹，把构建镜像时所需要的资源放在这个文件夹下。比如这样：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>mkdir project
cd !$
vi Dockerfile
<span class="token comment"># 编写 Dockerfile</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>也可以通过 <code>.dockerignore</code> 文件来忽略不需要的文件发送到 docker 守护进程</p> <p>在 docker CLI 将上下文发送到 docker 守护程序之前，它会在上下文的根目录中查找一个名为.dockerignore 的文件。如果此文件存在，CLI 将修改上下文以排除与其中模式匹配的文件和目录。这有助于避免不必要地将大型或敏感文件和目录发送到守护程序，并可能使用或将它们添加到镜像中。</p> <p>例如：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># comment</span>
*/temp*
*/*/temp*
temp?
*.md
README-secret.md
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="三、镜像优化"><a href="#三、镜像优化" class="header-anchor">#</a> 三、镜像优化</h2> <h3 id="_1、基础镜像选择"><a href="#_1、基础镜像选择" class="header-anchor">#</a> 1、基础镜像选择</h3> <p>使用体积较小的基础镜像，比如 <code>alpine</code> 或者 <code>debian:buster-slim</code>，像 openjdk 可以选用 <code>openjdk:xxx-slim</code>，由于 openjdk 是基于 debian 的基础镜像构建的，所以向 debian 基础镜像一样，后面带个 <code>slim</code> 就是基于 <code>debian:xxx-slim</code> 镜像构建的。</p> <p>目前 Docker 官方已开始推荐使用 <code>Alpine</code> 替代之前的 <code>Ubuntu</code> 做为基础镜像环境。这样会带来多个好处。包括镜像下载速度加快，镜像安全性提高，主机之间的切换更方便，占用更少磁盘空间等。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE
debian                      buster-slim         e1af56d072b8        4 days ago          69.2MB
alpine                      latest              cc0abc535e36        8 days ago          5.59MB
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>不过需要注意的是，alpine 的 c 库是 <code>musl libc</code> ，而不是正统的 <code>glibc</code>，另外对于一些依赖 <code>glibc</code> 的大型项目，像 openjdk 、tomcat、rabbitmq 等都不建议使用 alpine 基础镜像，因为 musl libc 可能会导致 JVM 一些奇怪的问题。这也是为什么 tomcat 官方没有给出基础镜像是 alpine 的 Dockerfile 的原因。</p> <p>制作前端镜像时一定不要使用centos、Ubuntu等系统镜像，我们可以直接使用官方提供的nginx镜像来作为基础镜像，这样我们只需把制作好的web静态文件拷贝一下就可以了。</p> <p>您可以在hub.docker.com网站上搜索更小的镜像或者说更符合您要求的镜像，然后作为基础镜像来完成构建。</p> <table><thead><tr><th>基础镜像</th> <th>优点</th> <th>缺点</th> <th>备注</th></tr></thead> <tbody><tr><td>Alpine</td> <td>占用空间小</td> <td>基于musl libc和busybox</td> <td>官方推荐</td></tr> <tr><td>busybox</td> <td>占用空间小，极度轻量版</td> <td>工具太少</td> <td>不推荐，组件不全</td></tr> <tr><td>scratch</td> <td>空镜像，镜像大小约等于执行文件大小</td> <td>没有sh或bash，无法进入容器内进行交互式调试</td> <td>适合go语言</td></tr></tbody></table> <p>docker镜像常见的参数</p> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td>buster</td> <td>适用与 debian 10</td></tr> <tr><td>stretch</td> <td>适用于 debian 9</td></tr> <tr><td>jessie</td> <td>适用于 debian 8</td></tr> <tr><td>slim</td> <td>表示最小安装包，仅包含需要运行指定容器的特定工具集</td></tr> <tr><td>Alphine/alpine</td> <td>专门为容器构建的操作系统，比其他的操作系统更小，但是其上会缺少很多软件包并且使用的 glibc 等都是阉割版</td></tr> <tr><td>bullseye</td> <td>开发版本，处于未稳定状态</td></tr></tbody></table> <h3 id="_2、配置国内软件源"><a href="#_2、配置国内软件源" class="header-anchor">#</a> 2、配置国内软件源</h3> <p>使用默认的软件源安装构建时所需的依赖，对于绝大多数基础镜像来说，可以通过修改软件源的方式更换为国内的软件源镜像站。目前国内稳定可靠的镜像站主要有，华为云、阿里云、腾讯云、163 等。</p> <p>对于 alpine 基础镜像修改软件源</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>RUN <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g'</span> /etc/apk/repositories
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>debian 基础镜像修改默认软件源</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>RUN <span class="token function">sed</span> <span class="token parameter variable">-i</span> s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list
RUN <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s@http://deb.debian.org@http://mirrors.aliyun.com@g&quot;</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token function">rm</span> <span class="token parameter variable">-Rf</span> /var/lib/apt/lists/* <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Ubuntu 基础镜像修改默认软件源</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>RUN <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/archive.ubuntu.com/mirrors.aliyun.com/g'</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/security.ubuntu.com/mirrors.aliyun.com/g'</span> /etc/apt/sources.list
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>对于 CentOS ???</p> <p>你确定要用 230MB 大小的基础镜像？</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>REPOSITORY                               TAG           IMAGE ID       CREATED          SIZE
centos                                   latest        5d0da3dc9764   <span class="token number">16</span> months ago    231MB
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>建议这些命令就放在 RUN 指令的第一条，update 以下软件源，之后再 install 相应的依赖。</p> <h2 id="四、构建镜像"><a href="#四、构建镜像" class="header-anchor">#</a> 四、构建镜像</h2> <h3 id="_1、命名"><a href="#_1、命名" class="header-anchor">#</a> 1、命名</h3> <p>原则是见名知意。可使用三段式</p> <blockquote><p>镜像仓库地址/类型库/镜像名:版本号</p></blockquote> <ul><li>registry/runtime/Java:8.1.2</li> <li>registry/runtime/php-fpm-nginx:7.3-1.14</li> <li>registry/cicd/kubctl-helm:1.17-3.0</li> <li>registry/cicd/git-compose-docker:v1</li> <li>registry/applications/demo:git_commit_id</li></ul> <h3 id="_2、基于镜像部署服务"><a href="#_2、基于镜像部署服务" class="header-anchor">#</a> 2、基于镜像部署服务</h3> <p>那么现在我们就可以利用以上指令，将我们在宿主机上执行的操作，写在一个Dockerfile中，示例如下：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> centos:7</span>
<span class="token instruction"><span class="token keyword">MAINTAINER</span> 759600963@qq.com</span>
<span class="token comment">#执行下面命令，安装基础环境</span>
<span class="token instruction"><span class="token keyword">RUN</span> yum install -y gcc gcc-c++ make <span class="token operator">\</span>
    openssl-devel pcre-devel gd-devel <span class="token operator">\</span>
    iproute net-tools telnet wget curl &amp;&amp; <span class="token operator">\</span>
    yum clean all &amp;&amp; <span class="token operator">\</span>
    rm -rf /var/cache/yum/*</span>
<span class="token instruction"><span class="token keyword">RUN</span> wget http://nginx.org/download/nginx-1.20.1.tar.gz</span>
<span class="token instruction"><span class="token keyword">RUN</span> tar -zxf nginx-1.20.1.tar.gz -C /usr/src</span>
<span class="token instruction"><span class="token keyword">RUN</span> useradd -M -s /sbin/nologin nginx</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /usr/src/nginx-1.20.1</span>
<span class="token instruction"><span class="token keyword">RUN</span> ./configure --prefix=/usr/local/nginx --user=nginx --group=nginx &amp;&amp; make &amp;&amp; make install</span>
<span class="token instruction"><span class="token keyword">RUN</span> ln -s /usr/local/nginx/sbin/* /usr/local/sbin/</span>
<span class="token instruction"><span class="token keyword">RUN</span> ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /usr/local/nginx</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 80</span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;nginx&quot;</span>, <span class="token string">&quot;-g&quot;</span>, <span class="token string">&quot;daemon off;&quot;</span>]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>如上所示，FROM定义了基于centos7镜像来构建，这里使用了yum方式来安装依赖，并通过源码编译的方式进行安装。然后使用WORKDIR定义了进程的工作目录，使用EXPOSE声明了应用要使用的端口，最后使用CMD指定了容器启动时默认命令。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># docker pull centos:7</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>那么此时我们可以创建一个空目录例如nginx，然后将Dockerfile文件放置于该目录中，然后执行构建命令</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># docker build -t web:centos .</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>这里的-t参数是为这个构建的镜像取一个名字，设置一个标签，在自动生成镜像的命令指定镜像后，一定不要忘记写新生成镜像的存放路径，也就是空格后的 一 个“.”代表当前路径，否则会报错。</p></div> <p>当我们执行build后，docker会将build文件夹连同Dockerfile一起所有的文件（如果有其他文件）提交至docker engine来处理。docker Engine将逐行解析Dockerfile文件，并执行相关操作。Dockerfile的解析是由上而下的顺序进行。</p> <p>注意您放置Dockerfile的目录最好是一个空目录，或者只放置与本次构建相关的文件即可，因为在执行build时会将Dockerfile以及Dockerfile路径下的所有文件提交至docker Engine处理，因此您不应该在Dockerfile目录中放置一些无关的文件，这是无意义的并且这将会严重拖慢整个构建过程。</p> <p>使用新的镜像运行容器</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># docker run -itd --name testweb -p 80:80 web:centos</span>
73277ceaa7a9a72d7a729029360413cfc0364effb4062b3df25aa960c67b894a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3、使用makefile操作dockerfile"><a href="#_3、使用makefile操作dockerfile" class="header-anchor">#</a> 3、使用Makefile操作Dockerfile</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>IMAGE_BASE <span class="token operator">=</span> registry/runtime
IMAGE_NAME <span class="token operator">=</span> php-fpm
IMAGE_VERSION <span class="token operator">=</span> <span class="token number">7.3</span>
IMAGE_TAGVERSION <span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>GIT_COMMIT<span class="token variable">)</span></span>

all: build tag push

build:
  <span class="token function">docker</span> build <span class="token parameter variable">--rm</span> <span class="token parameter variable">-f</span> Dockerfile <span class="token parameter variable">-t</span> <span class="token variable">${IMAGE_BASE}</span>/<span class="token variable">${IMAGE_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${IMAGE_VERSION}</span> <span class="token builtin class-name">.</span>

tag:
  <span class="token function">docker</span> tag <span class="token variable">${IMAGE_BASE}</span>/<span class="token variable">${IMAGE_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${IMAGE_VERSION}</span> <span class="token variable">${IMAGE_BASE}</span>/<span class="token variable">${IMAGE_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${IMAGE_TAGVERSION}</span>

push:
  <span class="token function">docker</span> push <span class="token variable">${IMAGE_BASE}</span>/<span class="token variable">${IMAGE_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${IMAGE_TAGVERSION}</span>

<span class="token comment"># 构建并推送</span>
<span class="token function">make</span> 
<span class="token comment"># 仅构建</span>
<span class="token function">make</span> build 
<span class="token comment"># 仅打tag</span>
<span class="token function">make</span> tag
<span class="token comment"># 仅推送</span>
<span class="token function">make</span> push
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>makefile中的命令必须以tab作为开头(分隔符),不能用扩展的tab即用空格代替的tab。(如果是vim编辑的话,执行 set noexpandtab)。否则会报如下错误：<code>Makefile:10: *** multiple target patterns. Stop.</code></strong></p> <h2 id="五、多阶段构建镜像"><a href="#五、多阶段构建镜像" class="header-anchor">#</a> 五、多阶段构建镜像</h2> <p>在编写Dockerfile构建docker镜像时，常遇到以下问题：</p> <ol><li>RUN命令会让镜像新增layer，导致镜像变大，虽然通过&amp;&amp;连接多个命令能缓解此问题，但如果命令之间用到docker指令例如COPY、WORKDIR等，依然会导致多个layer；</li> <li>有些工具在构建过程中会用到，但是最终的镜像是不需要的（例如用npm编译构建前端工程），这要求Dockerfile的编写者花更多精力来清理这些工具，清理的过程又可能导致新的layer；</li></ol> <p>为了解决上述问题，从17.05版本开始Docker在构建镜像时增加了新特性：多阶段构建(multi-stage builds)，将构建过程分为多个阶段，每个阶段都可以指定一个基础镜像，这样在一个Dockerfile就能将多个镜像的特性同时用到</p> <p>我们可以在一个Dockerfile中使用多个FROM指令并将一次构建分成多个阶段来完成</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># build stage</span>
<span class="token instruction"><span class="token keyword">FROM</span> node:14.18.2-stretch-slim <span class="token keyword">AS</span> build-env</span>
<span class="token comment"># 工作目录</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
<span class="token comment"># 将git仓库下所有文件拷贝到工作目录</span>
<span class="token instruction"><span class="token keyword">COPY</span> . .</span>
<span class="token instruction"><span class="token keyword">RUN</span> npm install</span>
<span class="token instruction"><span class="token keyword">RUN</span> npm audit fix</span>
<span class="token instruction"><span class="token keyword">RUN</span> npm run build:production</span>

<span class="token comment"># production stage</span>
<span class="token comment"># 生产环境基础nginx镜像（上面的镜像已经打包为了静态文件）</span>
<span class="token instruction"><span class="token keyword">FROM</span> nginx:alpine</span>
<span class="token instruction"><span class="token keyword">ADD</span>  prod.conf /etc/nginx/conf.d/</span>
<span class="token comment"># 使用--from把上面产生的静态文件复制到nginx的运行目录</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">build-env</span></span> /app/dist /usr/share/nginx/html</span>
<span class="token instruction"><span class="token keyword">RUN</span> ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; <span class="token operator">\</span>
    echo <span class="token string">'Asia/Shanghai'</span> &gt;/etc/timezone</span>
<span class="token comment"># nginx容器内部暴露的端口</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 80</span>
<span class="token comment"># 运行的命令</span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;/bin/sh&quot;</span>, <span class="token string">&quot;-c&quot;</span>, <span class="token string">&quot;nginx -g \&quot;daemon off;\&quot;&quot;</span> ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>在第一个FROM指令后使用as build-env 意思是为该阶段取一个标记名为build-env，然后在第二个FROM之后使用了COPY --from=build-env，意思是从上一个名为builder的阶段中拷贝文件至本阶段中。</p> <h2 id="六、dockerfile-传参"><a href="#六、dockerfile-传参" class="header-anchor">#</a> 六、Dockerfile 传参</h2> <p>使用 ARG 和 build-arg 传入动态变量：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># base image </span>
<span class="token instruction"><span class="token keyword">FROM</span> centos:7 </span>
<span class="token comment"># MAINTAINER dot # deprecated </span>

<span class="token instruction"><span class="token keyword">LABEL</span> maintainer=<span class="token string">&quot;dot&quot;</span> version=<span class="token string">&quot;demo&quot;</span> </span>
<span class="token instruction"><span class="token keyword">LABEL</span> multiple=<span class="token string">&quot;true&quot;</span> </span>

<span class="token instruction"><span class="token keyword">ARG</span> USERNAME </span>
<span class="token instruction"><span class="token keyword">ARG</span> DIR=<span class="token string">&quot;defaultValue&quot;</span> </span>

<span class="token instruction"><span class="token keyword">RUN</span> useradd -m <span class="token variable">$USERNAME</span> -u 1001 &amp;&amp; mkdir <span class="token variable">$DIR</span> </span>

<span class="token comment"># docker build --build-arg USERNAME=&quot;test_arg&quot; -t test:arg . </span>
<span class="token comment"># docker run -ti --rm test:arg bash </span>
<span class="token comment"># ls </span>
bin             dev  home  lib64       media  opt   root  selinux  sys  usr 
defaultValue  etc  lib   lost+found  mnt    proc  sbin  srv      tmp  var
<span class="token comment"># tail -1 /etc/passwd </span>
test_arg:x:1001:1001::/home/test_arg:/bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="七、dockerfile-优化"><a href="#七、dockerfile-优化" class="header-anchor">#</a> 七、Dockerfile 优化</h2> <h3 id="_1、尽量不使用root用户"><a href="#_1、尽量不使用root用户" class="header-anchor">#</a> 1、尽量不使用root用户</h3> <p>在做基础运行时镜像时，创建运行时普通用户和用户组，并做工作区与权限限制，启动服务时尽量使用普通用户。</p> <p>gosu</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>FROM alpine:3.11.5
RUN <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&quot;</span> /etc/apk/repositories <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> apk <span class="token function">add</span> --no-cache gosu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2、移除所有缓存等不必要信息"><a href="#_2、移除所有缓存等不必要信息" class="header-anchor">#</a> 2、移除所有缓存等不必要信息</h3> <ul><li>删除解压后的源压缩包（参考第二章第二节）</li> <li>清理包管理器下载安装软件时的缓存
<ul><li>使用Alipine镜像中APK命令安装包时记得加上<code>--no-cache</code></li> <li>使用Ubuntu镜像中的APT命令安装软件后记得 <code>rm -rf /var/lib/apt/lists/*</code></li></ul></li></ul> <h3 id="_3、使用合理的entrypoint脚本"><a href="#_3、使用合理的entrypoint脚本" class="header-anchor">#</a> 3、使用合理的ENTRYPOINT脚本</h3> <p>示例：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token operator">=</span> <span class="token string">'postgres'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token function">chown</span> <span class="token parameter variable">-R</span> postgres <span class="token string">&quot;<span class="token variable">$PGDATA</span>&quot;</span>

    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> <span class="token parameter variable">-A</span> <span class="token string">&quot;<span class="token variable">$PGDATA</span>&quot;</span><span class="token variable">)</span></span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        gosu postgres initdb
    <span class="token keyword">fi</span>

    <span class="token builtin class-name">exec</span> gosu postgres <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">exec</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_4、设置时区"><a href="#_4、设置时区" class="header-anchor">#</a> 4、设置时区</h3> <p>由于绝大多数基础镜像都是默认采用 UTC 的时区，与北京时间相差 8 个小时，这将会导致容器内的时间与北京时间不一致，因而会对一些应用造成一些影响，还会影响容器内日志和监控的数据。</p> <p>因此对于东八区的用户，最好在构建镜像的时候设定一下容器内的时区，以免以后因为时区遇到一些 bug。</p> <p>可以通过环境变量设置容器内的时区。在启动的时候可以通过设置环境变量 <code>-e TZ=Asia/Shanghai</code> 来设定容器内的时区。</p> <h4 id="_1、基于-alpine-镜像"><a href="#_1、基于-alpine-镜像" class="header-anchor">#</a> 1、基于 Alpine 镜像</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>FROM alpine:3.15
ENV <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Asia/Shanghai
RUN <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g'</span> /etc/apk/repositories <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> apk <span class="token function">add</span> --no-cache tzdata <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">ln</span> <span class="token parameter variable">-sf</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime  <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;Asia/Shanghai&quot;</span> <span class="token operator">&gt;</span> /etc/timezone
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_2、基于-centos7-镜像"><a href="#_2、基于-centos7-镜像" class="header-anchor">#</a> 2、基于 Centos7 镜像</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>FROM centos:7
<span class="token comment">#定义时区参数</span>
ENV <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Asia/Shanghai
<span class="token comment">#设置时区</span>
RUN <span class="token function">ln</span> <span class="token parameter variable">-snf</span> /usr/share/zoneinfo/<span class="token variable">$TZ</span> /etc/localtime <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">'$TZ'</span> <span class="token operator">&gt;</span> /etc/timezone
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_3、基于-debian-镜像"><a href="#_3、基于-debian-镜像" class="header-anchor">#</a> 3、基于 Debian 镜像</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 由于 Debian 镜像中已经包含了tzdata，所以只需添加环境变量TZ即可。</span>
FROM debian:latest

ENV <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Asia/Shanghai
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_4、基于-ubuntu-镜像"><a href="#_4、基于-ubuntu-镜像" class="header-anchor">#</a> 4、基于 Ubuntu 镜像</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>FROM ubuntu:bionic

ENV <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Asia/Shanghai
RUN <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${TZ}</span>&quot;</span> <span class="token operator">&gt;</span> /etc/timezone
    <span class="token operator">&amp;&amp;</span> <span class="token function">ln</span> <span class="token parameter variable">-sf</span> /usr/share/zoneinfo/<span class="token variable">${TZ}</span> /etc/localtime
    <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> update
    <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> tzdata
    <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/apt/lists/*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_5、设置系统语言"><a href="#_5、设置系统语言" class="header-anchor">#</a> 5、设置系统语言</h3> <h4 id="_1、基于-alpine-镜像-2"><a href="#_1、基于-alpine-镜像-2" class="header-anchor">#</a> 1、基于 Alpine 镜像</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>FROM alpine:3.15
ENV <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>en_US.UTF-8 <span class="token punctuation">\</span>
    <span class="token assign-left variable"><span class="token environment constant">LANGUAGE</span></span><span class="token operator">=</span>en_US.UTF-8

RUN apk --no-cache <span class="token function">add</span> ca-certificates <span class="token function">wget</span> <span class="token punctuation">\</span> 
    <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">-O</span> /etc/apk/keys/sgerrand.rsa.pub https://alpine-pkgs.sgerrand.com/sgerrand.rsa.pub <span class="token punctuation">\</span> 
    <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> <span class="token parameter variable">-q</span> https://github.com/sgerrand/alpine-pkg-glibc/releases/download/2.33-r0/glibc-2.33-r0.apk <span class="token punctuation">\</span> 
    <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> <span class="token parameter variable">-q</span> https://github.com/sgerrand/alpine-pkg-glibc/releases/download/2.33-r0/glibc-bin-2.33-r0.apk <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> <span class="token parameter variable">-q</span> https://github.com/sgerrand/alpine-pkg-glibc/releases/download/2.33-r0/glibc-i18n-2.33-r0.apk <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> apk <span class="token function">add</span> glibc-bin-2.33-r0.apk glibc-i18n-2.33-r0.apk glibc-2.33-r0.apk <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /usr/lib/jvm glibc-2.29-r0.apk glibc-bin-2.29-r0.apk  glibc-i18n-2.29-r0.apk <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> /usr/glibc-compat/bin/localedef <span class="token parameter variable">--force</span> <span class="token parameter variable">--inputfile</span> POSIX <span class="token parameter variable">--charmap</span> UTF-8 <span class="token string">&quot;<span class="token environment constant">$LANG</span>&quot;</span> <span class="token operator">||</span> <span class="token boolean">true</span> <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;export LANG=<span class="token environment constant">$LANG</span>&quot;</span> <span class="token operator">&gt;</span> /etc/profile.d/locale.sh <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> apk del glibc-i18n
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_2、基于-centos7-镜像-2"><a href="#_2、基于-centos7-镜像-2" class="header-anchor">#</a> 2、基于 Centos7 镜像</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>FROM centos:7
<span class="token comment">#安装必要应用</span>
RUN yum <span class="token parameter variable">-y</span> <span class="token function">install</span> kde-l10n-Chinese glibc-common
<span class="token comment">#设置编码</span>
RUN localedef <span class="token parameter variable">-c</span> <span class="token parameter variable">-f</span> UTF-8 <span class="token parameter variable">-i</span> zh_CN zh_CN.utf8
<span class="token comment">#设置环境变量</span>
ENV <span class="token environment constant">LC_ALL</span> zh_CN.utf8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_3、基于-debian-镜像-2"><a href="#_3、基于-debian-镜像-2" class="header-anchor">#</a> 3、基于 Debian 镜像</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 由于 Debian 镜像中已经包含了tzdata，所以只需添加环境变量TZ即可。</span>
FROM debian:latest

ENV <span class="token environment constant">LANG</span> C.UTF-8
RUN <span class="token function">apt-get</span> update<span class="token punctuation">;</span> <span class="token punctuation">\</span>
    <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> --no-install-recommends fontconfig<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_4、基于-ubuntu-镜像-2"><a href="#_4、基于-ubuntu-镜像-2" class="header-anchor">#</a> 4、基于 Ubuntu 镜像</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>FROM ubuntu:bionic

ENV <span class="token environment constant">LANG</span> C.UTF-8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_6、使用label标注作者、软件版本等元信息"><a href="#_6、使用label标注作者、软件版本等元信息" class="header-anchor">#</a> 6、使用Label标注作者、软件版本等元信息</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>FROM alpine:3.11.5
LABEL <span class="token assign-left variable">Author</span><span class="token operator">=</span>Curiouser <span class="token punctuation">\</span>
      <span class="token assign-left variable">Mail</span><span class="token operator">=</span>****@163.com <span class="token punctuation">\</span>
      <span class="token assign-left variable">PHP</span><span class="token operator">=</span><span class="token number">7.3</span> <span class="token punctuation">\</span>
      <span class="token assign-left variable">Tools</span><span class="token operator">=</span>“git、vim、curl” <span class="token punctuation">\</span>
      <span class="token assign-left variable">Update</span><span class="token operator">=</span><span class="token string">&quot;添加用户组&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_7、指定工作区"><a href="#_7、指定工作区" class="header-anchor">#</a> 7、指定工作区</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>WORKDIR /var/wwww
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_8、run指令显示优化"><a href="#_8、run指令显示优化" class="header-anchor">#</a> 8、RUN指令显示优化</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>RUN <span class="token builtin class-name">set</span> <span class="token parameter variable">-eux</span> <span class="token punctuation">;</span> <span class="token punctuation">\</span>
    <span class="token function">ls</span> <span class="token parameter variable">-al</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_9、使用-url-添加源码"><a href="#_9、使用-url-添加源码" class="header-anchor">#</a> 9、使用 URL 添加源码</h3> <p>如果不采用分阶段构建，对于一些需要在容器内进行编译的项目，最好通过 git 或者 wegt 的方式将源码打入到镜像内，而非采用 ADD 或者 COPY ，因为源码编译完成之后，源码就不需要可以删掉了，而通过 ADD 或者 COPY 添加进去的源码已经用在下一层镜像中了，是删不掉滴啦。</p> <p>也就是说 <code>git &amp; wget source</code> 然后 <code>build</code>，最后 <code>rm -rf source/</code> 这三部放在一条 RUN 指令中，这样就能避免源码添加到镜像中而增大镜像体积啦。</p> <h3 id="_10、使用虚拟编译环境"><a href="#_10、使用虚拟编译环境" class="header-anchor">#</a> 10、使用虚拟编译环境</h3> <p>对于只在编译过程中使用到的依赖，我们可以将这些依赖安装在虚拟环境中，编译完成之后可以一并删除这些依赖，比如 alpine 中可以使用 <code>apk add --no-cache --virtual .build-deps</code>，后面加上需要安装的相关依赖。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>apk add --no-cache --virtual .build-deps gcc libc-dev make perl-dev openssl-dev pcre-dev zlib-dev git
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>构建完成之后可以使用 apk del .build-deps 命令，一并将这些编译依赖全部删除。</p> <p>需要注意的是，.build-deps 后面接的是编译时以来的软件包，并不是所有的编译依赖都可以删除，不要把运行时的依赖包接在后面，最好单独 add 一下。</p> <h3 id="_11、最小化层数"><a href="#_11、最小化层数" class="header-anchor">#</a> 11、最小化层数</h3> <p>docker 在 1.10 以后，只有 <code>RUN、COPY 和 ADD</code> 指令会创建层，其他指令会创建临时的中间镜像，但是不会直接增加构建的镜像大小了。</p> <p>前文提到了建议使用 git 或者 wget 的方式来将文件打入到镜像当中，但如果我们必须要使用 COPY 或者 ADD 指令呢？</p> <p>还是拿 FastDFS 为例：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># centos 7</span>
<span class="token instruction"><span class="token keyword">FROM</span> centos:7</span>
<span class="token comment"># 添加配置文件</span>
<span class="token comment"># add profiles</span>
<span class="token instruction"><span class="token keyword">ADD</span> conf/client.conf /etc/fdfs/</span>
<span class="token instruction"><span class="token keyword">ADD</span> conf/http.conf /etc/fdfs/</span>
<span class="token instruction"><span class="token keyword">ADD</span> conf/mime.types /etc/fdfs/</span>
<span class="token instruction"><span class="token keyword">ADD</span> conf/storage.conf /etc/fdfs/</span>
<span class="token instruction"><span class="token keyword">ADD</span> conf/tracker.conf /etc/fdfs/</span>
<span class="token instruction"><span class="token keyword">ADD</span> fastdfs.sh /home</span>
<span class="token instruction"><span class="token keyword">ADD</span> conf/nginx.conf /etc/fdfs/</span>
<span class="token instruction"><span class="token keyword">ADD</span> conf/mod_fastdfs.conf /etc/fdfs</span>

<span class="token comment"># 添加源文件</span>
<span class="token comment"># add source code</span>
<span class="token instruction"><span class="token keyword">ADD</span> source/libfastcommon.tar.gz /usr/local/src/</span>
<span class="token instruction"><span class="token keyword">ADD</span> source/fastdfs.tar.gz /usr/local/src/</span>
<span class="token instruction"><span class="token keyword">ADD</span> source/fastdfs-nginx-module.tar.gz /usr/local/src/</span>
<span class="token instruction"><span class="token keyword">ADD</span> source/nginx-1.15.4.tar.gz /usr/local/src/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>多个文件需要添加到容器中不同的路径，每个文件使用一条 ADD 指令的话就会增加一层镜像，这样戏曲就多了 12 层镜像 。</p> <p>其实大可不必，我们可以将这些文件全部打包为一个文件为 <code>src.tar.gz</code> 然后通过 ADD 的方式把文件添加到当中去，然后在 RUN 指令后使用 <code>mv</code> 命令把文件移动到指定的位置。这样仅仅一条 ADD 和 RUN 指令取代掉了 12 个 ADD 指令。</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> alpine:3.10</span>
<span class="token instruction"><span class="token keyword">COPY</span> src.tar.gz /usr/local/src.tar.gz</span>
<span class="token instruction"><span class="token keyword">RUN</span> set -xe <span class="token operator">\</span>
    &amp;&amp; apk add --no-cache --virtual .build-deps gcc libc-dev make perl-dev openssl-dev pcre-dev zlib-dev tzdata <span class="token operator">\</span>
    &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime <span class="token operator">\</span>
    &amp;&amp; tar -xvf /usr/local/src.tar.gz -C /usr/local <span class="token operator">\</span>
    &amp;&amp; mv /usr/local/src/conf/fastdfs.sh /home/fastdfs/ <span class="token operator">\</span>
    &amp;&amp; mv /usr/local/src/conf/* /etc/fdfs <span class="token operator">\</span>
    &amp;&amp; chmod +x /home/fastdfs/fastdfs.sh <span class="token operator">\</span>
    &amp;&amp; rm -rf /usr/local/src/* /var/cache/apk/* /tmp/* /var/tmp/* <span class="token variable">$HOME</span>/.cache</span>
<span class="token instruction"><span class="token keyword">VOLUME</span> /var/fdfs</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>其他最小化层数无非就是把构建项目的整个步骤弄成一条 RUN 指令，不过多条命令合并可以使用 <code>&amp;&amp;</code> 或者 <code>;</code> 这两者都可以，不过据我在 docker hub 上的所见所闻，使用 <code>;</code> 的居多，尤其是官方的 Dockerfile。</p></div></div> <div class="page-slot page-slot-bottom"><div class="donation">
  <button>打赏</button>
  <div class="main">
      <div class="pic">
          <img src="http://pic.zzppjj.top/LightPicture/2023/02/cebf13bbcea9264d.jpg" alt="微信">
          <img src="http://pic.zzppjj.top/LightPicture/2023/02/d98d15501306c7c4.jpg" alt="支付宝">
      </div>
  </div>
</div></div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/03/02, 11:17:31</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/669b82/" class="prev">rustdesk远程控制服务部署</a></span> <span class="next"><a href="/pages/217e32/">docker和docker-compose安装</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/a3cd2b/"><div>
            pip更换国内源
            <!----></div></a> <span class="date">07-31</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/df6e29/"><div>
            conda安装和镜像源配置
            <!----></div></a> <span class="date">07-31</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/6cb488/"><div>
            awk常用参数和使用示例
            <!----></div></a> <span class="date">07-24</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/zpj874878956" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="mailto:874878956@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://blog.zzppjj.top/rss.xml" title="订阅" target="_blank" class="iconfont icon-rss"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2024
    <span>| <a href="https://www.foreverblog.cn/" class="d-inline-block text-muted" target="_blank" rel="external nofollow"><img src="/img/964560013b68c2e4.png" alt="点击查看十年之约" style="width:auto;height:11px;"></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><canvas id="vuepress-canvas-cursor"></canvas><!----><div></div><div></div><div></div></div></div>
    <script src="/assets/js/app.73676f20.js" defer></script><script src="/assets/js/4.23144ec8.js" defer></script><script src="/assets/js/1.09d67b9a.js" defer></script><script src="/assets/js/3.fc5194e0.js" defer></script><script src="/assets/js/328.aff8c1bd.js" defer></script><script src="/assets/js/38.33c96ce4.js" defer></script><script src="/assets/js/21.2c073392.js" defer></script>
  </body>
</html>
