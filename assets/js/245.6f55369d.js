(window.webpackJsonp=window.webpackJsonp||[]).push([[245],{597:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"虚拟主机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#虚拟主机"}},[s._v("#")]),s._v(" 虚拟主机")]),s._v(" "),a("p",[s._v("虚拟主机的三种方式：基于端口、IP地址、域名")]),s._v(" "),a("p",[s._v("server {")]),s._v(" "),a("p",[s._v("​ listen 80;")]),s._v(" "),a("p",[s._v("​ server_name "),a("a",{attrs:{href:"http://www.accp.com",target:"_blank",rel:"noopener noreferrer"}},[s._v("www.accp.com"),a("OutboundLink")],1),s._v(";")]),s._v(" "),a("p",[s._v("​ charset utf-8;")]),s._v(" "),a("p",[s._v("​ access_log logs/"),a("a",{attrs:{href:"http://www.accp.com.access.log",target:"_blank",rel:"noopener noreferrer"}},[s._v("www.accp.com.access.log"),a("OutboundLink")],1),s._v(";")]),s._v(" "),a("p",[s._v("​ location / {")]),s._v(" "),a("p",[s._v("​ root /var/www/html/accp;")]),s._v(" "),a("p",[s._v("​ index index.html index.htm;")]),s._v(" "),a("p",[s._v("​ }")]),s._v(" "),a("p",[s._v("​ error_page 500 502 503 504 /50x.html;")]),s._v(" "),a("p",[s._v("​ location = /50x.html {")]),s._v(" "),a("p",[s._v("​ root html;")]),s._v(" "),a("p",[s._v("​ }")]),s._v(" "),a("p",[s._v("}")]),s._v(" "),a("h2",{attrs:{id:"nginx负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx负载均衡"}},[s._v("#")]),s._v(" nginx负载均衡")]),s._v(" "),a("p",[s._v("upstream cluster {")]),s._v(" "),a("p",[s._v("ip_hash; #如果你的系统中没有使用第三方缓存管理工具 ,建议使用此方式")]),s._v(" "),a("p",[s._v("server 192.168.1.210:80 weight=5;")]),s._v(" "),a("p",[s._v("server 192.168.1.211:80 weight=3;")]),s._v(" "),a("p",[s._v("server 192.168.1.212:80 weight=1;")]),s._v(" "),a("p",[s._v("}")]),s._v(" "),a("p",[s._v("upstream dxTreasureIsland_http {\nserver dal05iis39.sl.dx weight=40 max_fails=3 fail_timeout=60s;\nserver iis01.zl.dx:8093 weight=10 max_fails=3 fail_timeout=60s;\n}")]),s._v(" "),a("h2",{attrs:{id:"反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[s._v("#")]),s._v(" 反向代理")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("​ location / {\n​ proxy_pass http://localhost:8000/;\n​ proxy_redirect off;\n​ proxy_set_header Host $http_host;\n​ proxy_set_header X-Real-IP $remote_addr;\n​ proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n​ location / {\n​ proxy_pass http://172.18.184.130:10085;\n​ proxy_set_header Host $host;\n​ proxy_set_header X-Real-IP $remote_addr;\n​ proxy_redirect http:// $scheme://; #以上指令会将后端响应header location内容中的http://替换成用户端协议https://\n​ proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n​ }\n\nlocation / {\n\nproxy_pass http://baidunode;\n\nproxy_set_header X-Forwarded-Proto $scheme;\nproxy_set_header Host $host; #HTTP header 中的 Host 含义为所请求的目的主机名。当 nginx 作为反向代理使用，而后端真实 web 服务器设置有类似 防盗链功能\n\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; #HTTP header 中的 X_Forward_For 表示该条 http 请求是由谁发起的\n\nproxy_set_header X-Real-IP $remote_addr;\n proxy_redirect off;\n\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("p",[s._v("常用的代理")]),s._v(" "),a("div",{staticClass:"language-context line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-context"}},[a("code",[s._v("    location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        proxy_pass         http://localhost:8000/;\n        proxy_set_header   Host             "),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$http_host;\n        proxy_set_header   X-Real-IP        $")]),s._v("remote_addr;\n        proxy_set_header   X-Forwarded-For  "),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $")]),s._v("scheme;\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("proxy_redirect的作用")]),s._v(" "),a("p",[s._v("proxy_redirect 该指令用来修改"),a("strong",[s._v("被代理服务器")]),s._v("返回的"),a("strong",[s._v("响应头中的Location头域和“refresh”头域")]),s._v("。")]),s._v(" "),a("blockquote",[a("ol",[a("li",[a("p",[s._v("proxy_redirect 旧地址 新地址;")])]),s._v(" "),a("li",[a("p",[s._v("proxy_redirect default; #默认配置")])]),s._v(" "),a("li",[a("p",[s._v("proxy_redirect off; #关闭重定向")])])])]),s._v(" "),a("h3",{attrs:{id:"代理oss"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代理oss"}},[s._v("#")]),s._v(" 代理oss")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n server_name test.xxxxxx.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n ssl on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n ssl_certificate /cert/xxxxxx.com/9298143__xxxxxx.com.pem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n ssl_certificate_key /cert/xxxxxx.com/9298143__xxxxxx.com.key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("NULL:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("aNULL:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("MD5:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("ADH:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("RC4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n ssl_protocols TLSv1 TLSv1.1 TLSv1.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n ssl_prefer_server_ciphers on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n proxy_set_header Host test.xxxxxx.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n proxy_pass https://test.xxxxxx.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n proxy_hide_header Content-Disposition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n add_header Content-Disposition "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'inline'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n这里我们使用了 proxy_hide_header Content-Disposition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 来删除从 OSS 接收到的原始 Content-Disposition 头，然后用 add_header Content-Disposition "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'inline'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 添加新的 Content-Disposition 头。将其值设置为 inline 可以让浏览器尝试在线查看文件（如果支持的话）而不是下载它们。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h2",{attrs:{id:"location规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#location规则"}},[s._v("#")]),s._v(" location规则")]),s._v(" "),a("p",[s._v("配置location /wandou可以匹配/wandoudouduo请求，也可以匹配/wandou*/duoduo等等，只要以wandou开头的目录都可以匹配到。而location /wandou/必须精确匹配/wandou/这个目录的请求,不能匹配/wandouduoduo/或/wandou*/duoduo等请求。")]),s._v(" "),a("p",[s._v('第一种：加"/"\nlocation /wddd/ {\nproxy_pass '),a("a",{attrs:{href:"http://127.0.0.1:8080/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://127.0.0.1:8080/"),a("OutboundLink")],1),s._v(';\n}\n测试结果，请求被代理跳转到：http://127.0.0.1:8080/index.html 第二种: 不加"/"\nlocation /wddd/ {'),a("br"),s._v("\nproxy_pass "),a("a",{attrs:{href:"http://127.0.0.1:8080",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://127.0.0.1:8080"),a("OutboundLink")],1),s._v(';\n}\n测试结果，请求被代理跳转到：http://127.0.0.1:8080/wddd/index.html 第三种: 增加目录加"/"\nlocation /wddd/ {'),a("br"),s._v('\nproxy_pass http://127.0.0.1:8080/sun/;\n}\n测试结果，请求被代理跳转到：http://127.0.0.1:8080/sun/index.html 第四种：增加目录不加"/"\nlocation /wddd/ {\nproxy_pass http://127.0.0.1:8080/sun;\n}\n测试结果，请求被代理跳转到：http://127.0.0.1:8080/sun/index.html 总结\nlocation目录后加"/",只能匹配目录，不加“/”不仅可以匹配目录还对目录进行模糊匹配。而proxy_pass无论加不加“/”,代理跳转地址都直接拼接')]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("符号")]),s._v(" "),a("th",[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("~")]),s._v(" "),a("td",[s._v("正则匹配，区分大小写")])]),s._v(" "),a("tr",[a("td",[s._v("~*")]),s._v(" "),a("td",[s._v("正则匹配，不区分大小写")])]),s._v(" "),a("tr",[a("td",[s._v("^~")]),s._v(" "),a("td",[s._v("普通字符匹配，如果该选项匹配，则，只匹配改选项，不再向下匹配其他选项")])]),s._v(" "),a("tr",[a("td",[s._v("=")]),s._v(" "),a("td",[s._v("普通字符匹配，精确匹配")])]),s._v(" "),a("tr",[a("td",[s._v("@")]),s._v(" "),a("td",[s._v("定义一个命名的 location，用于内部定向，例如 error_page，try_files")])])])]),s._v(" "),a("p",[s._v("符号@使用例子")]),s._v(" "),a("div",{staticClass:"language-tsconfig line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-tsconfig"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("listen")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("client_max_body_size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("100M")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("keepalive_timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("root")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("static")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("backend")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("rewrite")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("backend")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("$"),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("try_files")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("uri")]),s._v(" @"),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("proxy_to_app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("try_files")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("uri")]),s._v(" @"),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("proxy_to_app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("location")]),s._v(" @"),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("proxy_to_spp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("proxy_set_header")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("X-Forwarded-Proto")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("scheme")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("proxy_set_header")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("X-Forwarded-For")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("proxy_set_header")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("Host")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("http_host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("proxy_set_header")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("X-Real-IP")]),s._v("        $"),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("proxy_redirect")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("off")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("proxy_pass")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("app_server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("nginx禁止、允许访问某些后缀的文件\nlocation ~* .(ini|cfg|dwt|lbi)$ {"),a("br"),s._v("\ndeny all;"),a("br"),s._v("\n}")]),s._v(" "),a("h2",{attrs:{id:"证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#证书"}},[s._v("#")]),s._v(" 证书")]),s._v(" "),a("p",[s._v("​ ssl_certificate /etc/ssl/private/"),a("em",[s._v(".crt;\n​ ssl_certificate_key /etc/ssl/private/")]),s._v(".key;\n​ ssl_session_timeout 5m;\n​ ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n​ ssl_ciphers HIGH:!ADH:!aNULL:!eNULL:!MD5:!DSS:!DH:!RC4;\n​ ssl_prefer_server_ciphers on;")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server {\n    listen 443;\n    listen 80;\n    server_name m.xxx.com;\n    ssl on;\n    ssl_certificate      /etc/nginx/cert/m.xxx.com/m.goldmanfutures.com_chain.crt;\n    ssl_certificate_key  /etc/nginx/cert/m.xxx.com/m.goldmanfutures.com_key.key;\n    proxy_ssl_session_reuse   off;\n    ssl_session_cache         shared:SSL:1m;\n    ssl_session_timeout       5m;\n    ssl_ciphers               ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;\n    ssl_protocols             TLSv1 TLSv1.1 TLSv1.2;\n    ssl_prefer_server_ciphers on;\n    client_max_body_size 1g;\n    client_body_buffer_size 1m;\n        if ($scheme = http) {\n                rewrite ^(.*)$ https://m.xxx.com$1 permanent;\n        }\n\n\n    index   index.html index.htm index.php;\n    location / {\n        proxy_pass   http://172.31.186.20:10584/;\n        proxy_set_header Host      $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("h2",{attrs:{id:"日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志"}},[s._v("#")]),s._v(" 日志")]),s._v(" "),a("div",{staticClass:"language-context line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-context"}},[a("code",[s._v("​ access_log /var/log/nginx/jenkins.dx.com.access.log;\n​ error_log /var/log/nginx/jenkins.dx.com.errors.log;\n​\n\nlog_format main '"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$remote_addr - $")]),s._v("remote_user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v('$time_local] "$')]),s._v("request\" '\n '"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$status $")]),s._v('body_bytes_sent "'),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$http_referer\" '\n '\"$")]),s._v('http_user_agent" "$http_x_forwarded_for"\';\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"php配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#php配置"}},[s._v("#")]),s._v(" php配置")]),s._v(" "),a("div",{staticClass:"language-context line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-context"}},[a("code",[s._v("​ location ~ "),a("span",{pre:!0,attrs:{class:"token function selector"}},[s._v("\\.")]),s._v("php"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$ {\n​ root /data/erp5/website/erp5.pdvee.com/public;\n​ index index.php;\n​ fastcgi_pass 192.168.14.20:9005;\n​ fastcgi_index index.php;\n​ fastcgi_param SCRIPT_FILENAME $")]),s._v("document_root$fastcgi_script_name;\n​ include fastcgi_params;\n​ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块"}},[s._v("#")]),s._v(" 模块")]),s._v(" "),a("p",[s._v("concat模块：Nginx concat通过合并静态文件来减少http请求数来达到优化前端性能，可以在一定程度上能减少web服务器的压力。")]),s._v(" "),a("div",{staticClass:"language-context line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-context"}},[a("code",[s._v("location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n concat on;\n concat_max_files 100;\n concat_unique off;\n concat_ignore_file_error on;\n if (!-e "),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$request_filename) {\n rewrite ^(.*)$")]),s._v(" /index.php?s=/$1 last;\n break;\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"跳转、重定向"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跳转、重定向"}},[s._v("#")]),s._v(" 跳转、重定向")]),s._v(" "),a("div",{staticClass:"language-context line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-context"}},[a("code",[s._v("​ if ("),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$host ~ ^www"),a("span",{pre:!0,attrs:{class:"token equation-command regex"}},[s._v("\\.")]),s._v("dealextreme.com"),a("span",{pre:!0,attrs:{class:"token equation-command regex"}},[s._v("\\.")]),s._v("com$")]),s._v(") "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n​ rewrite ^(.*)"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$ $")]),s._v("scheme://www.dx.com permanent;\n​ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nif ("),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$scheme = http) {\n            rewrite ^(.*)$")]),s._v(" https://www.dx.com$1 permanent;\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("server {\nlisten 80;\nserver_name "),a("a",{attrs:{href:"http://www.zzppjj.top",target:"_blank",rel:"noopener noreferrer"}},[s._v("www.zzppjj.top"),a("OutboundLink")],1),s._v(" zzppjj.top;")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    location ~* / {\n            rewrite ^(.*)$ https://www.zzppjj.top$1 permanent;\n    }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("}")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server {\n    listen 80;\n    server_name getpro-h5-business.goingf.hk getpro-php-business.goingf.hk;\n\n\n\n    location / {\n        rewrite ^ https://$http_host$request_uri? permanent;    # force redirect http to https\n        return 301 https://$http_host$request_uri;\n    }\n\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("重定向到另外一台服务器示例：（查找目录下是否存在文件，如果不存在转到@new_uploads下，new_uploads对应代理到172.17.0.101上）")]),s._v(" "),a("p",[s._v("location ^~ /uploads/ {\nroot /data/weiwend/weiwang;\ntry_files $uri @new_uploads;\n}")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location @new_uploads {\n    proxy_redirect off;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_pass http://172.17.0.101:80;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("ul",[a("li",[s._v("将 /api/v1/game/data?id= 新网站路径地址映射到 http://gameid.escape.com/api/v1/new_game/ 老网站的 API 上面，给开发提供获取游戏用户信息的接口")])]),s._v(" "),a("p",[s._v("server {\nlisten 80;\nserver_name gameid.escape.com;")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('access_log /var/log/nginx/gameid.nginx.access.log  netdata;\nerror_log  /var/log/nginx/gameid.nginx.error.log   error;\n\nlocation / {\n    return 404;\n}\n\nlocation /api/v1/ {\n    proxy_pass_header Server;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Scheme $scheme;\n    proxy_http_version 1.1;\n    if ($request_uri ~* "/api/v1/game/data\\?id=(.*)") {\n        set $id $1;\n        rewrite .* /api/v1/new_game/$id break;\n        proxy_pass http://gameid.escape.com;\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("}")]),s._v(" "),a("h2",{attrs:{id:"虚拟目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#虚拟目录"}},[s._v("#")]),s._v(" 虚拟目录")]),s._v(" "),a("p",[s._v("​ location /media {\n​ alias /usr/share/nginx/html/media;"),a("br"),s._v("\n​ }")]),s._v(" "),a("h2",{attrs:{id:"nginx跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx跨域"}},[s._v("#")]),s._v(" nginx跨域")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("     #是否允许请求带有验证信息\n     add_header Access-Control-Allow-Credentials true;\n     #允许跨域访问的域名,可以是一个域的列表，也可以是通配符*\n     add_header Access-Control-Allow-Origin  $allow_url;\n     #允许脚本访问的返回头\n     add_header Access-Control-Allow-Headers 'x-requested-with,content-type,Cache-Control,Pragma,Date,x-timestamp';\n     #允许使用的请求方法，以逗号隔开\n     add_header Access-Control-Allow-Methods 'POST,GET,OPTIONS,PUT,DELETE';\n     #允许自定义的头部，以逗号隔开,大小写不敏感\n     add_header Access-Control-Expose-Headers 'WWW-Authenticate,Server-Authorization';\n     #P3P支持跨域cookie操作\n     add_header P3P 'policyref=\"/w3c/p3p.xml\", CP=\"NOI DSP PSAa OUR BUS IND ONL UNI COM NAV INT LOC\"';\n     add_header test  1;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("需求为浏览器访问B的时候要直接显示A的主页，这样对A做一个代理，浏览器的URL还是B并不是重定向到A。")]),s._v(" "),a("p",[s._v("在A的nginx中加入一下内容")]),s._v(" "),a("p",[s._v("location /api/ {")]),s._v(" "),a("p",[s._v("add_header Access-Control-Allow-Origin *;")]),s._v(" "),a("p",[s._v("add_header Access-Control-Allow-Credentials 'true';")]),s._v(" "),a("p",[s._v("add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';")]),s._v(" "),a("p",[s._v("add_header Access-Control-Allow-Headers 'Origin, X-Requested-With, Content-Type, Accept';")]),s._v(" "),a("p",[s._v("proxy_pass "),a("a",{attrs:{href:"http://gateway_proxy/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://gateway_proxy/"),a("OutboundLink")],1),s._v(";")]),s._v(" "),a("h2",{attrs:{id:"php配置-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#php配置-2"}},[s._v("#")]),s._v(" php配置")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        server_name  api.erp.pdvee.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        access_log /var/log/nginx/api.erp.pdvee.com.access.log site_log2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        error_log  /var/log/nginx/api.erp.pdvee.com.errors.log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        proxy_set_header Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_set_header Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_set_header Region "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$geoip_country_code")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_set_header X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        root /data/erp/website/erp.pdvee.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        index index.php index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n      keepalive_timeout 18000s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        client_body_timeout 18000s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        client_header_timeout 18000s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_connect_timeout 18000s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_send_timeout 18000s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_read_timeout 18000s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n    fastcgi_connect_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_send_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_read_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_buffer_size 256k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_buffers "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 256k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_busy_buffers_size 256k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_temp_file_write_size 256k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##")]),s._v("\n    client_max_body_size 2048m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("        \n    client_body_buffer_size 256k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n\n\n        location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        proxy_cache my_cache;")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        proxy_cache_revalidate on;")]),s._v("\n                concat on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                concat_max_files "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                concat_unique off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                concat_ignore_file_error on;")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("-e "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_filename")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            rewrite ^"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ /index.php?s"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" last"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        location ~ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".php$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root /data/website/erp.pdvee.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index index.php"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            fastcgi_pass   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".14.13:9001"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            fastcgi_index  index.php"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            fastcgi_param  SCRIPT_FILENAME  "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$document_root")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$fastcgi_script_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            include        fastcgi_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br")])]),a("p",[s._v("全局变量")]),s._v(" "),a("div",{staticClass:"language-context line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-context"}},[a("code",[a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$bytes_sent             发送给客户端的字节数\n$")]),s._v("connection             连接序列号\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$connection_requests    当前通过连接发出的请求数量\n$")]),s._v("content_length         “Content-Length” 请求头字段\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$content_type           “Content-Type” 请求头字段\n$")]),s._v("cookie_name            cookie名称\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$document_root          当前请求的文档根目录或别名\n$")]),s._v("uri                    请求中的当前URI(不带请求参数，参数位于"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$args)，可以不同于浏览器传递的$")]),s._v("request_uri的值，它可以通过内部重定向，或者使用index指令进行修改，"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$uri不包含主机名，如”/foo/bar.html”。\n$")]),s._v("document_uri           同 "),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$uri\n$")]),s._v("host                   优先级如下：HTTP请求行的主机名>”HOST”请求头字段>符合请求的服务器名\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$hostname               主机名\n$")]),s._v("http_name              匹配任意请求头字段； 变量名中的后半部分“name”可以替换成任意请求头字段，如在配置文件中需要获取http请求头：“Accept-Language”，那么将“－”替换为下划线，大写字母替换为小写，形如："),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$http_accept_language即可。\n$")]),s._v("https                  如果开启了SSL安全模式，值为“on”，否则为空字符串。\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$is_args                如果请求中有参数，值为“?”，否则为空字符串。\n$")]),s._v("limit_rate             用于设置响应的速度限制\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$nginx_version          nginx版本\n$")]),s._v("pid                    工作进程的PID\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$pipe                   如果请求来自管道通信，值为“p”，否则为“.” (1.3.12, 1.2.7)\n$")]),s._v("proxy_protocol_addr    获取代理访问服务器的客户端地址，如果是直接访问，该值为空字符串。\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$realpath_root          当前请求的文档根目录或别名的真实路径，会将所有符号连接转换为真实路径。\n$")]),s._v("msec                   以秒为单位的时间，日志写入时的毫秒分辨率\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$request_length         请求长度（包括请求行，标题和请求主体）\n$")]),s._v("request_method         HTTP请求方法，通常为“GET”或“POST”\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$request_time           处理客户端请求使用的时间;从读取客户端的第一个字节开始计时。\n$")]),s._v("request_uri            这个变量等于包含一些客户端请求参数的原始URI，它无法修改，请查看"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$uri更改或重写URI，不包含主机名，例如：”/cnphp/test.php?arg=freemouse”。\n$")]),s._v("request_time           以毫秒分辨率请求处理时间，以秒为单位; 从客户端读取第一个字节之间的时间并在最后一个字节发送到客户端后进行日志写入\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$status                 响应状态码\n$")]),s._v("time_local             本地时间采用通用日志格式\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$arg_name               请求中的的参数名，即“?”后面的arg_name=arg_value形式的arg_name\n$")]),s._v("args                   请求中的参数值\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$binary_remote_addr     客户端地址的二进制形式, 固定长度为4个字节\n$")]),s._v("body_bytes_sent        传输给客户端的字节数，响应头不计算在内；这个变量和Apache的mod_log_config模块中的“"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("%B”参数保持兼容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$remote_addr            客户端地址\n$")]),s._v("remote_port            客户端端口\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$remote_user            用于HTTP基础认证服务的用户名\n$")]),s._v("request                客户端请求地址\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$request_body           客户端的请求主体，此变量可在location中使用，将请求主体通过proxy_pass, fastcgi_pass, uwsgi_pass, 和 scgi_pass传递给下一级的代理服务器。\n$")]),s._v("request_body_file      将客户端请求主体保存在临时文件中。文件处理结束后，此文件需删除。如果需要之一开启此功能，需要设置client_body_in_file_only。如果将次文件传递给后端的代理服务器，需要禁用request body，即设置proxy_pass_request_body off，fastcgi_pass_request_body off, uwsgi_pass_request_body off, or scgi_pass_request_body off 。\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$request_completion     如果请求成功，值为”OK”，如果请求未完成或者请求不是一个范围请求的最后一部分，则为空。\n$")]),s._v("request_filename       当前连接请求的文件路径，由root或alias指令与URI请求生成。\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$scheme                 请求使用的Web协议, “http” 或 “https”\n$")]),s._v("sent_http_name         可以设置任意http响应头字段； 变量名中的后半部分“name”可以替换成任意响应头字段，如需要设置响应头Content-length，那么将“－”替换为下划线，大写字母替换为小写，形如："),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$sent_http_content_length 4096即可。\n$")]),s._v("server_addr            服务器端地址，需要注意的是：为了避免访问linux系统内核，应将ip地址提前设置在配置文件中。\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$server_name            服务器名，域名\n$")]),s._v("server_port            服务器端口\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$server_protocol        服务器的HTTP版本, 通常为 “HTTP/1.0” 或 “HTTP/1.1”\n$")]),s._v("tcpinfo_rtt, "),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$tcpinfo_rttvar, $")]),s._v("tcpinfo_snd_cwnd, $tcpinfo_rcv_space 客户端TCP连接的具体信息\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br")])]),a("p",[s._v("############")]),s._v(" "),a("div",{staticClass:"language-context line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-context"}},[a("code",[s._v("nginx中"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$host、$")]),s._v("http_host和"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$proxy_host区别\n$")]),s._v("host    不显示端口       浏览器请求的ip，不显示端口\n"),a("span",{pre:!0,attrs:{class:"token equation string"}},[s._v("$http_host 端口存在则显示        浏览器请求的ip和端口号\n$")]),s._v("proxy_host    默认80端口不显示，其它显示    被代理服务的ip和端口号\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"防止域名恶意解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防止域名恶意解析"}},[s._v("#")]),s._v(" 防止域名恶意解析")]),s._v(" "),a("p",[s._v("server {")]),s._v(" "),a("p",[s._v("listen 80 default_server;")]),s._v(" "),a("p",[s._v("server_name _;")]),s._v(" "),a("p",[s._v("return 404;")]),s._v(" "),a("p",[s._v("}")]),s._v(" "),a("p",[s._v("server {\nlisten 443 default_server;\nserver_name _;\nssl on; return 444;\n}")]),s._v(" "),a("p",[s._v("大概解释如下:")]),s._v(" "),a("p",[s._v("default_server：默认域名配置，如果找不到，会自动匹配")]),s._v(" "),a("p",[s._v("server_name _: 无效域名匹配")]),s._v(" "),a("p",[s._v("return 444: 非标准状态码，是Nginx服务器扩展的Http错误状态码，服务器不向客户端返回任何信息，并关闭连接, 断开客户端和服务器的连接，防止恶意软件攻击威胁")]),s._v(" "),a("p",[s._v("三、配置上面到主配置文件后。")]),s._v(" "),a("p",[s._v("重启动nginx ，就会为我们屏蔽恶意访问了。")]),s._v(" "),a("h2",{attrs:{id:"网站置灰"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网站置灰"}},[s._v("#")]),s._v(" 网站置灰")]),s._v(" "),a("div",{staticClass:"language-context line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-context"}},[a("code",[s._v("sub_filter  '</head>'  '<style type=\"text/css\">html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("-webkit-filter: grayscale(.95);"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("</style></head>';\n    sub_filter_once on; \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);