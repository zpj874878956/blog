(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{425:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("原文链接：https://www.cnblogs.com/lvzhenjiang/p/14199445.html")]),s._v(" "),a("h1",{attrs:{id:"ansible入门"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ansible入门"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ansible入门"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("目录")]),s._v(" "),a("ul",[a("li",[s._v("一、Ansible基础概述\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#11--%E4%BB%80%E4%B9%88%E6%98%AFansible",target:"_blank",rel:"noopener noreferrer"}},[s._v("1.1 什么是Ansible"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#12-ansible-%E5%8F%AF%E4%BB%A5%E5%AE%8C%E6%88%90%E5%93%AA%E4%BA%9B%E5%8A%9F%E8%83%BD",target:"_blank",rel:"noopener noreferrer"}},[s._v("1.2 Ansible 可以完成哪些功能"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#13-ansible%E7%89%B9%E7%82%B9",target:"_blank",rel:"noopener noreferrer"}},[s._v("1.3 Ansible特点"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#14-ansible%E7%9A%84%E6%9E%B6%E6%9E%84%E4%B8%AD%E7%9A%84%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9%E3%80%81%E8%A2%AB%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9%E3%80%81inventory%E3%80%81ad-hoc%E3%80%81playbook%E3%80%81%E8%BF%9E%E6%8E%A5%E5%8D%8F%E8%AE%AE%E8%BF%99%E4%BA%9B%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F",target:"_blank",rel:"noopener noreferrer"}},[s._v("1.4 Ansible的架构中的控制节点、被控制节点、inventory、ad-hoc、playbook、连接协议这些是什么？"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("二、Ansible安装配置\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#21-ansible%E5%AE%89%E8%A3%85",target:"_blank",rel:"noopener noreferrer"}},[s._v("2.1 ansible安装"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("三、Ansible inventory\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#31-%E5%9C%BA%E6%99%AF%E4%B8%80%EF%BC%9A%E5%9F%BA%E4%BA%8E%E5%AF%86%E7%A0%81%E8%BF%9E%E6%8E%A5",target:"_blank",rel:"noopener noreferrer"}},[s._v("3.1 场景一：基于密码连接"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#32-%E5%9C%BA%E6%99%AF%E4%BA%8C%EF%BC%9A%E5%9F%BA%E4%BA%8E%E7%A7%98%E9%92%A5%E8%BF%9E%E6%8E%A5",target:"_blank",rel:"noopener noreferrer"}},[s._v("3.2 场景二：基于秘钥连接"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#33-%E5%9C%BA%E6%99%AF%E4%B8%89%EF%BC%9A%E4%B8%BB%E6%9C%BA%E7%BB%84%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F",target:"_blank",rel:"noopener noreferrer"}},[s._v("3.3 场景三：主机组使用方式"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#34-%E5%88%97%E5%87%BA%E6%AF%8F%E4%B8%AA%E4%B8%BB%E6%9C%BA%E7%BB%84%E4%B8%8B%E9%9D%A2%E7%9A%84%E4%B8%BB%E6%9C%BA%E6%83%85%E5%86%B5",target:"_blank",rel:"noopener noreferrer"}},[s._v("3.4 列出每个主机组下面的主机情况"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("四、Ansible ad-hoc\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#41-%E4%BB%80%E4%B9%88%E6%98%AFad-hoc",target:"_blank",rel:"noopener noreferrer"}},[s._v("4.1 什么是ad-hoc"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#42-ad-hocm%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF",target:"_blank",rel:"noopener noreferrer"}},[s._v("4.2 ad-hocm模式的使用场景"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#43-ad-hoc%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8",target:"_blank",rel:"noopener noreferrer"}},[s._v("4.3 ad-hoc模式的命令使用"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#44-%E4%BD%BF%E7%94%A8ad-doc%E6%8C%87%E5%AE%9A%E4%B8%80%E6%AC%A1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%EF%BC%8C%E6%B3%A8%E6%84%8F%E8%A7%82%E5%AF%9F%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E7%9A%84%E9%A2%9C%E8%89%B2",target:"_blank",rel:"noopener noreferrer"}},[s._v("4.4 使用ad-doc指定一次远程命令，注意观察返回结果的颜色"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#45-ad-hoc%E5%B8%B8%E7%94%A8%E7%9A%84%E6%A8%A1%E5%9D%97",target:"_blank",rel:"noopener noreferrer"}},[s._v("4.5 ad-hoc常用的模块"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#46-%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%9C%80%E8%A6%81%E5%85%88%E4%BA%86%E8%A7%A3anisble-doc%E5%B8%AE%E5%8A%A9%E6%89%8B%E5%86%8C",target:"_blank",rel:"noopener noreferrer"}},[s._v("4.6 使用过程中需要先了解anisble-doc帮助手册"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("五、ansibel 模块\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#51-yum%E6%A8%A1%E5%9D%97",target:"_blank",rel:"noopener noreferrer"}},[s._v("5.1 yum模块"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#52-copy%E6%A8%A1%E5%9D%97",target:"_blank",rel:"noopener noreferrer"}},[s._v("5.2 copy模块"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#53-file%E6%A8%A1%E5%9D%97",target:"_blank",rel:"noopener noreferrer"}},[s._v("5.3 file模块"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#54-get_url%E6%A8%A1%E5%9D%97",target:"_blank",rel:"noopener noreferrer"}},[s._v("5.4 get_url模块"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#55-service%E6%A8%A1%E5%9D%97",target:"_blank",rel:"noopener noreferrer"}},[s._v("5.5 service模块"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#56-group%E6%A8%A1%E5%9D%97",target:"_blank",rel:"noopener noreferrer"}},[s._v("5.6 group模块"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#57-user%E6%A8%A1%E5%9D%97",target:"_blank",rel:"noopener noreferrer"}},[s._v("5.7 user模块"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#58-cron%E6%A8%A1%E5%9D%97",target:"_blank",rel:"noopener noreferrer"}},[s._v("5.8 cron模块"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#59-mount",target:"_blank",rel:"noopener noreferrer"}},[s._v("5.9 mount"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#510-firewalld",target:"_blank",rel:"noopener noreferrer"}},[s._v("5.10 firewalld"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("六、Ansible playbook\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#61-%E4%BB%80%E4%B9%88%E6%98%AFplaybook",target:"_blank",rel:"noopener noreferrer"}},[s._v("6.1 什么是playbook"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#62-ansible-playbook%E4%B8%8Ead-hoc%E7%9A%84%E5%85%B3%E7%B3%BB",target:"_blank",rel:"noopener noreferrer"}},[s._v("6.2 Ansible playbook与ad-hoc的关系"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#63-ansible-playbook%E4%B9%A6%E5%86%99%E6%A0%BC%E5%BC%8F",target:"_blank",rel:"noopener noreferrer"}},[s._v("6.3 Ansible playbook书写格式"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("七、变量\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#71-%E5%8F%98%E9%87%8F%E6%A6%82%E8%BF%B0",target:"_blank",rel:"noopener noreferrer"}},[s._v("7.1 变量概述"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#72-%E5%8F%98%E9%87%8F%E5%AE%9A%E4%B9%89",target:"_blank",rel:"noopener noreferrer"}},[s._v("7.2 变量定义"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#73-%E5%8F%98%E9%87%8F%E6%B3%A8%E5%86%8C",target:"_blank",rel:"noopener noreferrer"}},[s._v("7.3 变量注册"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#74-facts%E5%8F%98%E9%87%8F",target:"_blank",rel:"noopener noreferrer"}},[s._v("7.4 facts变量"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("八、Ansible Task 任务控制\n"),a("ul",[a("li",[s._v("8.1 piaybook条件语句\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E6%A0%B9%E6%8D%AE%E4%B8%8D%E5%90%8C%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%EF%BC%8C%E5%AE%89%E8%A3%85%E7%9B%B8%E5%90%8C%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%8C%85",target:"_blank",rel:"noopener noreferrer"}},[s._v("案例一：根据不同操作系统，安装相同的软件包"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A%E4%B8%BA%E6%89%80%E6%9C%89web%E4%B8%BB%E6%9C%BA%E5%90%8D%E7%9A%84%E6%B7%BB%E5%8A%A0nginx%E4%BB%93%E5%BA%93%EF%BC%8C%E5%85%B6%E4%BD%99%E7%9A%84%E9%83%BD%E8%B7%B3%E8%BF%87%E6%B7%BB%E5%8A%A0",target:"_blank",rel:"noopener noreferrer"}},[s._v("案例二：为所有web主机名的添加nginx仓库，其余的都跳过添加"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#%E6%A1%88%E4%BE%8B%E4%B8%89%EF%BC%9A%E6%A0%B9%E6%8D%AE%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9A%84%E7%BB%93%E6%9E%9C%E8%BF%9B%E8%A1%8C%E5%88%A4%E6%96%AD",target:"_blank",rel:"noopener noreferrer"}},[s._v("案例三：根据命令执行的结果进行判断"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("8.2 playbook循环语句\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A-%E4%BD%BF%E7%94%A8%E5%BE%AA%E7%8E%AF%E5%90%AF%E5%8A%A8%E5%A4%9A%E4%B8%AA%E6%9C%8D%E5%8A%A1",target:"_blank",rel:"noopener noreferrer"}},[s._v("案例一： 使用循环启动多个服务"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A-%E4%BD%BF%E7%94%A8%E5%AD%97%E5%85%B8%E6%89%B9%E9%87%8F%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7",target:"_blank",rel:"noopener noreferrer"}},[s._v("案例二： 使用字典批量创建用户"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#%E6%A1%88%E4%BE%8B%E4%B8%89%EF%BC%9A-%E4%BD%BF%E7%94%A8%E5%8F%98%E9%87%8F%E5%AD%97%E5%85%B8%E5%BE%AA%E7%8E%AF%E7%9A%84%E6%96%B9%E5%BC%8F%E6%8B%B7%E8%B4%9D%E6%96%87%E4%BB%B6",target:"_blank",rel:"noopener noreferrer"}},[s._v("案例三： 使用变量字典循环的方式拷贝文件"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("8.3 playbook handlers\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#%E6%A1%88%E4%BE%8B%EF%BC%9Aplaybook%E5%AE%89%E8%A3%85nginx",target:"_blank",rel:"noopener noreferrer"}},[s._v("案例：playbook安装nginx"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("8.4 playbook tag\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#%E6%A1%88%E4%BE%8B%EF%BC%9A",target:"_blank",rel:"noopener noreferrer"}},[s._v("案例："),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("8.5 playbook include\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#%E6%A1%88%E4%BE%8B%EF%BC%9A",target:"_blank",rel:"noopener noreferrer"}},[s._v("案例："),a("OutboundLink")],1)])])]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#86-ignore_errors%E5%BF%BD%E7%95%A5%E9%94%99%E8%AF%AF",target:"_blank",rel:"noopener noreferrer"}},[s._v("8.6 ignore_errors忽略错误"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("8.7 playbook错误处理\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9Atask%E6%89%A7%E8%A1%8C%E5%A4%B1%E8%B4%A5%E5%BC%BA%E5%88%B6%E8%B0%83%E7%94%A8handlers",target:"_blank",rel:"noopener noreferrer"}},[s._v("案例一：task执行失败强制调用handlers"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A-%E5%85%B3%E9%97%ADchange%E7%9A%84%E7%8A%B6%E6%80%81%EF%BC%88%E7%A1%AE%E5%AE%9A%E4%B8%8D%E4%BC%9A%E5%AF%B9%E8%A2%AB%E6%8E%A7%E7%AB%AF%E4%B8%BB%E6%9C%BA%E8%BF%9B%E8%A1%8C%E4%BB%BB%E4%BD%95%E7%9A%84%E4%BF%AE%E6%94%B9%E5%92%8C%E5%8F%98%E6%9B%B4%EF%BC%89",target:"_blank",rel:"noopener noreferrer"}},[s._v("案例二： 关闭change的状态（确定不会对被控端主机进行任何的修改和变更）"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199445.html#%E6%A1%88%E4%BE%8B%E4%B8%89%EF%BC%9A-%E4%BD%BF%E7%94%A8changed_when%E6%A3%80%E6%9F%A5tasksrre%E4%BB%BB%E5%8A%A1%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C",target:"_blank",rel:"noopener noreferrer"}},[s._v("案例三： 使用changed_when检查tasksrre任务返回结果"),a("OutboundLink")],1)])])])])])]),s._v(" "),a("h3",{attrs:{id:"一、ansible基础概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、ansible基础概述"}},[s._v("#")]),s._v(" 一、Ansible基础概述")]),s._v(" "),a("h4",{attrs:{id:"_1-1-什么是ansible"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-什么是ansible"}},[s._v("#")]),s._v(" 1.1 什么是Ansible")]),s._v(" "),a("p",[s._v("Ansible是一个IT自动化的配置管理工具，自动化主要体现在Ansible集成了丰富模块、丰富的功能组件，可以通过一个命令完成一系列的操作。进而减少我们重复性的工作和维护成本，以提高工作效率！")]),s._v(" "),a("h4",{attrs:{id:"_1-2-ansible-可以完成哪些功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-ansible-可以完成哪些功能"}},[s._v("#")]),s._v(" 1.2 Ansible 可以完成哪些功能")]),s._v(" "),a("ul",[a("li",[s._v("批量执行远程命令，可以对N多台主机同时进行命令的执行；")]),s._v(" "),a("li",[s._v("批量配置软件服务，可以进行自动化的方式配置和管理服务；")]),s._v(" "),a("li",[s._v("实现软件开发功能，Jumpserver底层使用ansible来实现的自动化管理；")]),s._v(" "),a("li",[s._v("编排高级的IT任务，Ansible的Playbook是一门编程语言，可以用来描绘一套IT架构；")])]),s._v(" "),a("h4",{attrs:{id:"_1-3-ansible特点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-ansible特点"}},[s._v("#")]),s._v(" 1.3 Ansible特点")]),s._v(" "),a("ul",[a("li",[s._v("容易学习，无代理模式，不像saltstack既要学习客户端与服务端，还要学习客户端与服务端中间通信协议；")]),s._v(" "),a("li",[s._v("操作灵活，体现在Ansible有较多的模块，提供了丰富的功能、playbook则提供类似于编程语言的复杂功能；")]),s._v(" "),a("li",[s._v("简单复用，体现在Ansible一个命令可以完成很多事情；")]),s._v(" "),a("li",[s._v("安全可靠，因为Ansible使用了SSH协议进行通信，既稳定也安全；")]),s._v(" "),a("li",[s._v("移植性高，可以将写好的playbook拷贝任意机器进行执行；")])]),s._v(" "),a("h4",{attrs:{id:"_1-4-ansible的架构中的控制节点、被控制节点、inventory、ad-hoc、playbook、连接协议这些是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-ansible的架构中的控制节点、被控制节点、inventory、ad-hoc、playbook、连接协议这些是什么"}},[s._v("#")]),s._v(" 1.4 Ansible的架构中的控制节点、被控制节点、inventory、ad-hoc、playbook、连接协议这些是什么？")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/04/556c50248b5a7784.jpg",alt:"556c50248b5a7784.jpg"}})]),s._v(" "),a("h3",{attrs:{id:"二、ansible安装配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、ansible安装配置"}},[s._v("#")]),s._v(" 二、Ansible安装配置")]),s._v(" "),a("h4",{attrs:{id:"_2-1-ansible安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-ansible安装"}},[s._v("#")]),s._v(" 2.1 ansible安装")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo\n$ yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ansible "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n$ ansible "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.9")]),s._v(".10\n  config "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /etc/ansible/ansible.cfg\n  configured module search path "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("u"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/root/.ansible/plugins/modules'")]),s._v(", u"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/usr/share/ansible/plugins/modules'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  ansible python module location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /usr/lib/python2.7/site-packages/ansible\n  executable location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /usr/bin/ansible\n  python version "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.7")]),s._v(".5 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default, Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2015")]),s._v(", 02:00:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("GCC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.8")]),s._v(".5 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20150623")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Red Hat "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.8")]),s._v(".5-4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n$ ansible "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("host-pattern"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("option"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n--version: "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible版本信息")]),s._v("\n-v：显示详细信息\n-i：主机清单文件路径，默认是/etc/ansibel/hosts\n-m：使用的模块的名称，默认使用command模块\n-a：使用的模块参数，模块的具体工作\n-k：提示输入ssh密码，而不使用基于ssh的秘钥认证\n-C：模拟执行测试，但不会真的执行\n-T：指定命令的超时时间\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[a("strong",[s._v("ansible配置文件优先级顺序：")])]),s._v(" "),a("ul",[a("li",[s._v("最先查找$ANSIBLE_CONFIG变量；")]),s._v(" "),a("li",[s._v("其次查找当前目录下ansible.cfg")]),s._v(" "),a("li",[s._v("然后查找用户家目录下的.ansible.cfg")]),s._v(" "),a("li",[s._v("最后查找/etc/ansible/ansible.cfg（默认）")])]),s._v(" "),a("h3",{attrs:{id:"三、ansible-inventory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、ansible-inventory"}},[s._v("#")]),s._v(" 三、Ansible inventory")]),s._v(" "),a("p",[a("code",[s._v("Inventory")]),s._v("文件中填写需要被管理主机与主机组信息（逻辑上定义）。默认"),a("code",[s._v("Inventory")]),s._v("文件在"),a("code",[s._v("/etc/ansible/hosts")]),s._v("。当然也可以自定义，然后使用"),a("code",[s._v("-i")]),s._v("指定"),a("code",[s._v("Inventory")]),s._v("文件位置：示例：")]),s._v(" "),a("h4",{attrs:{id:"_3-1-场景一-基于密码连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-场景一-基于密码连接"}},[s._v("#")]),s._v(" 3.1 场景一：基于密码连接")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/ansible/hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方法一")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webservers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.225 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_pass")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.226 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_pass")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方法二")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webservers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nweb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".lzj.com "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_pass")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方法三")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webservers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nweb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".lzj.com\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webservers：vars"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_pass")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h4",{attrs:{id:"_3-2-场景二-基于秘钥连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-场景二-基于秘钥连接"}},[s._v("#")]),s._v(" 3.2 场景二：基于秘钥连接")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ ssh-keygen\n$ ssh-copy-id "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.225\n$ ssh-copy-id "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.226\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" project1/ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" project1/\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" hosts\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.225\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.226\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h4",{attrs:{id:"_3-3-场景三-主机组使用方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-场景三-主机组使用方式"}},[s._v("#")]),s._v(" 3.3 场景三：主机组使用方式")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("lbservers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.221\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.222\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webservers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.223\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.224\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("servers:children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义servers组包含两个子组（lbservers、webservers）")]),s._v("\nlbservers\nwebservers\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h4",{attrs:{id:"_3-4-列出每个主机组下面的主机情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-列出每个主机组下面的主机情况"}},[s._v("#")]),s._v(" 3.4 列出每个主机组下面的主机情况")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ ansible all "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts --list-hosts\n  hosts "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.225\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.226\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts --list-hosts\n  hosts "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.225\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.226\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"四、ansible-ad-hoc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、ansible-ad-hoc"}},[s._v("#")]),s._v(" 四、Ansible ad-hoc")]),s._v(" "),a("h4",{attrs:{id:"_4-1-什么是ad-hoc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-什么是ad-hoc"}},[s._v("#")]),s._v(" 4.1 什么是ad-hoc")]),s._v(" "),a("p",[a("code",[s._v("ad-hoc")]),s._v("就是临时命令，执行完成后就结束，并不会保存！")]),s._v(" "),a("h4",{attrs:{id:"_4-2-ad-hocm模式的使用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-ad-hocm模式的使用场景"}},[s._v("#")]),s._v(" 4.2 ad-hocm模式的使用场景")]),s._v(" "),a("p",[s._v("比如在多台机器上查看某个进程是否启动，或拷贝指定文件到本地，等等！")]),s._v(" "),a("h4",{attrs:{id:"_4-3-ad-hoc模式的命令使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-ad-hoc模式的命令使用"}},[s._v("#")]),s._v(" 4.3 ad-hoc模式的命令使用")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("命令格式")]),s._v(" "),a("th",[s._v("ansible")]),s._v(" "),a("th",[s._v("zpj")]),s._v(" "),a("th",[s._v("-m")]),s._v(" "),a("th",[s._v("command")]),s._v(" "),a("th",[s._v("-a")]),s._v(" "),a("th",[s._v("'df -h'")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("格式说明")]),s._v(" "),a("td",[s._v("命令")]),s._v(" "),a("td",[s._v("主机名称")]),s._v(" "),a("td",[s._v("指定模块")]),s._v(" "),a("td",[s._v("模块名称")]),s._v(" "),a("td",[s._v("模块动作")]),s._v(" "),a("td",[s._v("具体命令")])])])]),s._v(" "),a("h4",{attrs:{id:"_4-4-使用ad-doc指定一次远程命令-注意观察返回结果的颜色"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-使用ad-doc指定一次远程命令-注意观察返回结果的颜色"}},[s._v("#")]),s._v(" 4.4 使用ad-doc指定一次远程命令，注意观察返回结果的颜色")]),s._v(" "),a("ul",[a("li",[s._v("绿色：表示被管理主机没有被修改；")]),s._v(" "),a("li",[s._v("黄色：表示被管理端主机发现变更；")]),s._v(" "),a("li",[s._v("红色：表示出现了故障，注意查看提示；")])]),s._v(" "),a("h4",{attrs:{id:"_4-5-ad-hoc常用的模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-ad-hoc常用的模块"}},[s._v("#")]),s._v(" 4.5 ad-hoc常用的模块")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定shell命令（不支持管道等特殊字符）")]),s._v("\nshell            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行shell命令")]),s._v("\nscripts            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行shell脚本")]),s._v("\nyum_repository    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置yum仓库")]),s._v("\nyum                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装软件")]),s._v("\ncopy            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 变更配置文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 建立目录或文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动、停止服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载设备")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cron")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定时任务")]),s._v("\nfirewalld        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 防火墙")]),s._v("\nget_url            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载软件")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h4",{attrs:{id:"_4-6-使用过程中需要先了解anisble-doc帮助手册"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-使用过程中需要先了解anisble-doc帮助手册"}},[s._v("#")]),s._v(" 4.6 使用过程中需要先了解anisble-doc帮助手册")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ ansible-doc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有模块说明")]),s._v("\n$ ansible-doc copy        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示指定模块方法")]),s._v("\n$ ansible-doc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" copy    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示指定模块参数")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"五、ansibel-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、ansibel-模块"}},[s._v("#")]),s._v(" 五、ansibel 模块")]),s._v(" "),a("h4",{attrs:{id:"_5-1-yum模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-yum模块"}},[s._v("#")]),s._v(" 5.1 yum模块")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例一： 安装当前最新的Apache软件，如果存在则更新")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=httpd state=latest"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例二： 安装当前最新的Apache软件，通过epel安装")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=httpd state=present enablerepo=epel"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例三： 通过公网URL安装rpm软件")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=https://mirrors4.tuna.tsinghua.edu.cn/zabbix/zabbix/4.0/rhel/7/x86_64/zabbix-agent-4.0.0-2.el7.x86_64.rpm state=present"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例四：更新所有的软件包，但排除和kernel相关的")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name="')]),s._v("*"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" state=present exclude="')]),s._v("kernel*"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" -i hosts\n\n# 示例五： 删除Apache软件\n$  ansible web -m yum -a "')]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpd "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v('absent" '),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h4",{attrs:{id:"_5-2-copy模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-copy模块"}},[s._v("#")]),s._v(" 5.2 copy模块")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例一： 将本地的httpd.conf文件Listen 端口修改为9999，然后推送到远程主机")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/Listen 80/Listen 9999/g'")]),s._v(" httpd.conf\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" copy "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src=httpd.conf dest=/etc/httpd/conf/httpd.conf owner=root group=root mode-644"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例二： 将本地的httpd.conf文件Listen端口修改为9988，然后推送到远端，检查远端是否存在上次备份的文件")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/Listen 9999/Listen 9988/g'")]),s._v(" httpd.conf\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" copy "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src=httpd.conf dest=/etc/httpd/conf/httpd.conf owner=root group=root mode=644 backup=yes"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例三： 往远程的主机文件写入内容")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" copy "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"content=123456........ dest=/var/www/html/index.html"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"_5-3-file模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-file模块"}},[s._v("#")]),s._v(" 5.3 file模块")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例一： 创建文件，并设置属主、属组、权限")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path=/var/www/html/t1.html state=touch owner=apache group=apache mode=644"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例二： 创建目录，并设置属主、属组、权限")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path=/var/www/html/dd state=directory owner=apache group=apache mode=755"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例三：递归授权目录的方式")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path=/var/www/html state=directory owner=apache group=apache recurse=yes"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"_5-4-get-url模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-get-url模块"}},[s._v("#")]),s._v(" 5.4 get_url模块")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例一： 下载互联网的软件到本地")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" get_url "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"url=http://192.168.99.181:12138/document/Ansible.docx dest=/root/"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例二： 下载互联网文件并进行mds校验")]),s._v("\n$ md5sum Ansible.docx      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取文件md5值")]),s._v("\n7b1a6fe7af7252005987e16ce64e1e1a  Ansible.docx\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" get_url "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"url=http://192.168.99.181:12138/document/Ansible.docx dest=/root/ checksum=md5:7b1a6fe7af7252005987e16ce64e1e1a"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"_5-5-service模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-service模块"}},[s._v("#")]),s._v(" 5.5 service模块")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例一： 启动httpd服务")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=httpd state=started"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例二： 重载httpd服务")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=httpd state=reloaded"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例三： 重启httpd服务")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=httpd state=restarted"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例四： 停止httpd服务")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=httpd state=stopped"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例五： 启动httpd服务，并加入开机自启")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=httpd state=started enabled=yes"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h4",{attrs:{id:"_5-6-group模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-6-group模块"}},[s._v("#")]),s._v(" 5.6 group模块")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例一： 创建news基本组，指定gid为9999")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" group "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=news gid=9999 state=present"')]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例二： 创建http系统组，指定gid为8888")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" group "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=http gid=8888  state=present\n system=yes"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例三： 删除test基本组")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" group "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=test state=absent"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"_5-7-user模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-7-user模块"}},[s._v("#")]),s._v(" 5.7 user模块")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例一： 创建job用户，uid是1040，主要组是adm")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=job uid=1040 group=adm"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例二： 创建joh用户，登录shell是/sbin/nologin，追加bin、sys两个组")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=joh groups=bin,sys shell=/sbin/nologin"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例三： 创建jsm用户，为其添加123作为登录密码，并创建家目录")]),s._v("\n$ ansible localhost "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" debug "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"msg={{ '123' | password_hash('sha512','salt') }}\"")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取123加密后的字符串")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$6")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$salt")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$jkHSO0tOjmLW0S1NFlw5veSIDRAVsiQQMTrkOKy4xdCCLPNIsHhZkIRlzfzIvKyXeGdOfCBoW1wJZPLyQ9Qx")]),s._v("/1\n\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=jsm password=$6$salt$jkHSO0tOjmLW0S1NFlw5veSIDRAVsiQQMTrkOKy4xdCCLPNIsHhZkIRlzfzIvKyXeGdOfCBoW1wJZPLyQ9Qx/1 create_home=yes'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例四： 移除job用户")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=job state=absent remove=yes"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# remove=yes删除普通用户家目录")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例五： 创建http用户，并为该用户创建2048字节的私钥，存放在~/http/.ssh/id_rsa")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=http generate_ssh_key=yes ssh_key_bits=2048 ssh_key_file=.ssh/id_rsa"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h4",{attrs:{id:"_5-8-cron模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-8-cron模块"}},[s._v("#")]),s._v(" 5.8 cron模块")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例一： 添加定时任务，每分钟执行一次ls")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cron")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"name=job1 job='ls > /dev/null'\"")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例二： 添加定时任务，每天的凌晨2点和凌晨5点执行一次ls")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cron")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"name=job2 job='ls > /dev/null' minute=0 hour=2,5\"")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例三： 关闭定时任务，使定时任务失败")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cron")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"name=job2 job='ls > /dev/null' minute=0 hour=2,5 disabled=yes\"")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"_5-9-mount"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-9-mount"}},[s._v("#")]),s._v(" 5.9 mount")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 环境准备：")]),s._v("\n$ ansible localhost "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=nfs-utils state=present"')]),s._v(" \n$ ansible localhost "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path=/ops state=directory"')]),s._v("\n$ ansible localhost "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" copy "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'content=\"/ops 192.168.100.1/24(rw,sync)\" dest=/etc/exports'")]),s._v("\n$ ansible localhost "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=nfs state=restarted"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例一： 挂载nfs存储到本地的/opt目录，并实现开机自动挂载")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src=192.168.99.181:/ops path=/opt fstype=nfs opts=defaults state=mounted"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例二： 临时卸载nfs的挂载，但不会清理/etc/fstab")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src=192.168.99.181:/ops path=/opt fstype=nfs opts=defaults state=unmounted"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例三： 永久卸载ns的挂载，清理/etc/fstab")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src=192.168.99.181:/ops path=/opt fstype=nfs opts=defaults state=absent"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h4",{attrs:{id:"_5-10-firewalld"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-10-firewalld"}},[s._v("#")]),s._v(" 5.10 firewalld")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例一： 永久放行https的流量，只有重启才生效")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" firewalld "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zone=public service=https permanent=yes state=enabled"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例二： 永久放行8081端口的流量，只有重启才生效")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" firewalld "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zone=public port=8081/tcp permanent=yes state=enabled"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例三： 放行8080-8090的所有的tcp端口流量，临时和永久都生效")]),s._v("\n$ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" firewalld "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zone=public port=8080-8090/tcp immediate=yes permanent=yes state=enabled"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"六、ansible-playbook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、ansible-playbook"}},[s._v("#")]),s._v(" 六、Ansible playbook")]),s._v(" "),a("h4",{attrs:{id:"_6-1-什么是playbook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-什么是playbook"}},[s._v("#")]),s._v(" 6.1 什么是playbook")]),s._v(" "),a("ul",[a("li",[s._v("playbook：定义了一个文本文件，以.yml为后缀结尾；")]),s._v(" "),a("li",[s._v("play：定义的是主机的角色；")]),s._v(" "),a("li",[s._v("task：定义的是具体执行的任务；")])]),s._v(" "),a("p",[s._v("总结：playbook是由一个多个多个play组成，一个play可以包含多个task任务。可以理解为：使用不同的模块来共同完成一件事情！")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("---\n#### 6.2 Ansible playbook与ad-hoc的关系\n")])])]),a("ul",[a("li",[s._v("playbook是对ad-hoc的一种编排方式；")]),s._v(" "),a("li",[s._v("playbook可以持久运行，而ad-hoc只能临时运行；")]),s._v(" "),a("li",[s._v("playbook适合复杂的任务，而ad-hoc适合做快速简单的任务；")]),s._v(" "),a("li",[s._v("playbook能控制任务执行的先后顺序；")])]),s._v(" "),a("h4",{attrs:{id:"_6-3-ansible-playbook书写格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-ansible-playbook书写格式"}},[s._v("#")]),s._v(" 6.3 Ansible playbook书写格式")]),s._v(" "),a("p",[s._v("playbook是由yaml语法书写，结构清晰、可读性强。所以必须掌握yaml基础语法！")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("语法")]),s._v(" "),a("th",[s._v("概述")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("缩进")]),s._v(" "),a("td",[s._v("YAML使用固定的缩进风格表示层级结构，每个缩进由两个空格组成，不能使用ta键")])]),s._v(" "),a("tr",[a("td",[s._v("冒号")]),s._v(" "),a("td",[s._v("以冒号结尾的除外，其他所有冒号后面所有必须有空格")])]),s._v(" "),a("tr",[a("td",[s._v("短横线")]),s._v(" "),a("td",[s._v("表示列表项，使用一个短横杠加一个空格。多个项使用同样的缩进级别作为统一列表")])])])]),s._v(" "),a("h3",{attrs:{id:"七、变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七、变量"}},[s._v("#")]),s._v(" 七、变量")]),s._v(" "),a("h4",{attrs:{id:"_7-1-变量概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-变量概述"}},[s._v("#")]),s._v(" 7.1 变量概述")]),s._v(" "),a("p",[s._v("变量提供了便捷的方式来管理ansible项目中的动态值，比如：nginx-1.12，可能后期会反复的使用这个版本的值，那么如果将此值设置为变量，后续使用和修改都将变得非常方便。这样可以简化项目的创建和维护。")]),s._v(" "),a("p",[s._v("那么在ansible中定义变量分为以下三种方式：")]),s._v(" "),a("ul",[a("li",[s._v("通过命令行进行变量定义；")]),s._v(" "),a("li",[s._v("在play文件中进行定义变量；")]),s._v(" "),a("li",[s._v("通过Inventory在主机组或单个主机中设置变量；")])]),s._v(" "),a("p",[s._v("如果定义的变量出现重复，且造成冲突，怎么办？谁说了算？")]),s._v(" "),a("h4",{attrs:{id:"_7-2-变量定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-变量定义"}},[s._v("#")]),s._v(" 7.2 变量定义")]),s._v(" "),a("p",[s._v("1、在playbook的文件开头通过vars关键字进行变量定义")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("vars")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("web_packages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpd\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ftp_packages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" vsftpd\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' Install Rpm Packages "'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" web_packages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v('" "'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ftp_packages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v('"\n      '),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ web_packages }}"')]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ ftp_packages }}"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" present\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("2、可以在playbook中使用"),a("code",[s._v("vars_files")]),s._v("指定文件作为变量文件，好处就是其他的playbook也可以调用")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1）准备一个变量的文件，建议使用yml格式")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" vars.yml\nweb_packages: httpd\nftp_packages: vsftpd\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2）准备playbook进行调用")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" test.yml\n- hosts: web\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: Install Rpm Packages "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ web_packages }}"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ ftp_packages }}"')]),s._v("\n      yum:\n        name:\n          - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ web_packages }}"')]),s._v("\n          - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ ftp_packages }}"')]),s._v("\n        state: present\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("3、在Inventory主机清单中定义变量，但是注意：主机变量优先级高于主机组变量")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1）在Inventory主机清单中对主机组进行定义变量")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" hosts\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.225\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.226\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web:vars"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("filename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("group_vars\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2）playbook中直接调用变量")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" test.yml\n- hosts: web\n  tasks:\n    - name: Create File\n      file:\n        name: /tmp/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        state: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("4、官方建议是在ansible项目目录中创建两个额外的变量目录，分别是"),a("code",[s._v("host_vars")]),s._v("和"),a("code",[s._v("group_vars")])]),s._v(" "),a("ul",[a("li",[s._v("测试"),a("code",[s._v("group_vars")]),s._v("定义变量方式")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" hosts\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.225\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.226\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1）在当前的项目目录中创建两个变量的目录")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("group,host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("_vars\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2）在group_vars目录中创建一个文件，文件名与Inventory清单中的主机组名称要保持一致")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" group_vars/web\nweb_packages: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\nftp_packages: tree\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3）编写playbook，只需在playbook中使用变量即可")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" test.yml\n- hosts: web\n  tasks:\n    - name: Install Rpm Packages "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ web_packages }}"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ ftp_packages }}"')]),s._v("\n      yum:\n        name:\n          - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ web_packages }}"')]),s._v("\n          - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ ftp_packages }}"')]),s._v("\n        state: present\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[a("strong",[s._v("测试test组能否使用web组定义的变量，无法使用！但是系统提供了特殊的all组，也就是说"),a("code",[s._v("group_vars")]),s._v("目录下创建一个all文件，定义变量对所有的主机都生效！")])]),s._v(" "),a("ul",[a("li",[s._v("测试"),a("code",[s._v("host_vars")]),s._v("定义变量方式")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1）在host_vars目录创建一个文件，文件名与Inventory清单中的主机名称要保持一致，如果是IP地址，则创建相同的IP")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" hosts\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.225\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.226\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2）在host_vars目录中创建文件，给192.168.100.225主机定义变量")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" host_vars/192.168.100.225\nweb_packages: zlib-static\nftp_packages: zmap\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3）转别一个playbook文件调用host主机变量")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" test.yml\n- hosts: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.225\n  tasks:\n    - name: Install Rpm Packages "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ web_packages }}"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ ftp_packages }}"')]),s._v("\n      yum:\n        name:\n          - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ web_packages }}"')]),s._v("\n          - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ ftp_packages }}"')]),s._v("\n        state: present\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("5、通过命令行"),a("code",[s._v("-extra-vars")]),s._v("或"),a("code",[s._v("-e")]),s._v("外置穿餐设定变量")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1）准备playbook文件")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" test.yml\n- hosts: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ host }}"')]),s._v("\n  tasks:\n    - name: Install Rpm Packages "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ web_packages }}"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ ftp_packages }}"')]),s._v("\n      yum:\n        name:\n          - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ web_packages }}"')]),s._v("\n          - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ ftp_packages }}"')]),s._v("\n        state: present\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2）执行playbook时进行变量的传递")]),s._v("\n$ ansible-playbook "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts test.yml "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host=web"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("6、变量的优先级顺序：")]),s._v(" "),a("p",[s._v("命令行变量——>paly中的vars_files——>paly中的vars——>host_vars——>group_vars/all")]),s._v(" "),a("h4",{attrs:{id:"_7-3-变量注册"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-变量注册"}},[s._v("#")]),s._v(" 7.3 变量注册")]),s._v(" "),a("p",[a("code",[s._v("register")]),s._v("关键字可以将某个task任务结果存储至变量中，最后使用debug输出变量内容，可以用于后续排查故障！")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" all\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" system status\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" netstat "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lntp\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("register")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" System_Status\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" System Status\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' msg="'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" System_Status.stdout_lines "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v('"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"_7-4-facts变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-facts变量"}},[s._v("#")]),s._v(" 7.4 facts变量")]),s._v(" "),a("p",[s._v("Ansible facts是在被管理主机上通过ansible自动采集发现的变量。facts包含每台特定的主机信息。比如：被控端主机的主机名、IP地址、系统版本、CPU数量、内存状态、磁盘状态等等。")]),s._v(" "),a("p",[s._v("默认情况的facts变量名都已经预先定义好了，只需要采集被控端的信息，然后传递至facts变量即可！")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" $ ansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" setup "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" facts.txt\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取所有的facts变量")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("facts变量使用场景：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("通过facts变量检查被控端主机硬件CPU信息，从而生成不同的Nginx配置文件；")])]),s._v(" "),a("li",[a("p",[s._v("通过facts变量检查被控端主机名称信息，从而生成不同的zabbix配置文件；")])]),s._v(" "),a("li",[a("p",[s._v("通过facts变量检查被控端主机内存状态信息，从而生成不同的memcached配置文件；")]),s._v(" "),a("p",[s._v("………………")])])]),s._v(" "),a("p",[s._v("1、facts基本用法：比如获取被控端的主机名和IP地址，然后通过debug输出")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" all\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" OutPut variables ansible facts\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("msg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' this default IPv4 address "'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ansible_fqdn "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v('" is "'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ansible_default_ipv4.address "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v('"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("2、facts开启后会影响Ansible主机的性能，如果没有采集被控端主机需求可选择关闭")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gather_facts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" no    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭信息采集")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"八、ansible-task-任务控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#八、ansible-task-任务控制"}},[s._v("#")]),s._v(" 八、Ansible Task 任务控制")]),s._v(" "),a("h4",{attrs:{id:"_8-1-piaybook条件语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-piaybook条件语句"}},[s._v("#")]),s._v(" 8.1 piaybook条件语句")]),s._v(" "),a("p",[s._v("判断在Ansible任务中的使用频率非常高，比如yum模块可以检测软件包是否已经被安装，而在这个过程中我们不用做太多的人工干预。但是也有部分任务需要进行判断。")]),s._v(" "),a("h5",{attrs:{id:"案例一-根据不同操作系统-安装相同的软件包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例一-根据不同操作系统-安装相同的软件包"}},[s._v("#")]),s._v(" 案例一：根据不同操作系统，安装相同的软件包")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Centos Install Httpd\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpd\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" present\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' ( ansible_distribution == "CentOS" )\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h5",{attrs:{id:"案例二-为所有web主机名的添加nginx仓库-其余的都跳过添加"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例二-为所有web主机名的添加nginx仓库-其余的都跳过添加"}},[s._v("#")]),s._v(" 案例二：为所有web主机名的添加nginx仓库，其余的都跳过添加")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" all\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Create YUM Repo\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum_repository")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ansible_nginx\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ansible_test\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("baseurl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//nginx.org/packages/centos/$releasever/$basearch/\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" yes\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gpgcheck")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" no\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' ( ansible_fqdn is match("web'),a("span",{pre:!0,attrs:{class:"token important"}},[s._v('*")')]),s._v(" )\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当然when也可以使用and与or方式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# when： ( ansible_fqdn is match("web*") ) or')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#         ( ansible_fqdn is match("lb*") )')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h5",{attrs:{id:"案例三-根据命令执行的结果进行判断"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例三-根据命令执行的结果进行判断"}},[s._v("#")]),s._v(" 案例三：根据命令执行的结果进行判断")]),s._v(" "),a("p",[s._v("通过register将命令执行结果保存至变量，然后通过when语句进行判断")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" all\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Check Httpd Server\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" systemctl is"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("active httpd\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ignore_errors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" yes        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 忽略错误")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("register")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" check_httpd\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Httpd Restart        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果check_httpd执行命令结果等于0，则重启httpd,否则跳过")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpd\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restarted\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" check_httpd.rc == 0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h4",{attrs:{id:"_8-2-playbook循环语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-playbook循环语句"}},[s._v("#")]),s._v(" 8.2 playbook循环语句")]),s._v(" "),a("p",[s._v("有时候我们写playbook的时候会发现了很多task都要重复引用某个模块，比如一次启动10个服务，或者一个拷贝10个文件。如果安装传统的写法最少要写10次，这样会显得playbook很臃肿。如果使用循环的方式来编写playbokk，这样可以减少重复使用某个模块！")]),s._v(" "),a("h5",{attrs:{id:"案例一-使用循环启动多个服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例一-使用循环启动多个服务"}},[s._v("#")]),s._v(" 案例一： 使用循环启动多个服务")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" all\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service Start\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item }}"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" started\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with_items")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" httpd\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" sshd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h5",{attrs:{id:"案例二-使用字典批量创建用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例二-使用字典批量创建用户"}},[s._v("#")]),s._v(" 案例二： 使用字典批量创建用户")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" all\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Add Users\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.name }}"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{item.group }}"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" present\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with_items")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test01'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bin'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test02'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h5",{attrs:{id:"案例三-使用变量字典循环的方式拷贝文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例三-使用变量字典循环的方式拷贝文件"}},[s._v("#")]),s._v(" 案例三： 使用变量字典循环的方式拷贝文件")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" all\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Copy File\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("copy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.src }}"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.dest }}"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.mode }}"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with_items")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rsync.conf'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/tmp/rsync.conf'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rsync.pass'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/tmp/rsync.pass'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("高级写法(变量套变量)：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" all\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("vars")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /tmp\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Copy File\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("copy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.src }}"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.dest }}"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.mode }}"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with_items")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rsync.conf'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{ Path }}/rsync.conf'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rsync.pass'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{ Path }}/rsync.pass'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h4",{attrs:{id:"_8-3-playbook-handlers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-playbook-handlers"}},[s._v("#")]),s._v(" 8.3 playbook handlers")]),s._v(" "),a("p",[s._v("handlers是一个触发器，也是一个tasks，只不过是一个特殊的tasks，它是需要被tasks触发才会执行。只要配置文件发生变更，则会触发handlers执行重启服务操作，如果配置文件不发生任何变化，则不会重启！\nnotify监控——>通知——>handlers触发")]),s._v(" "),a("h5",{attrs:{id:"案例-playbook安装nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例-playbook安装nginx"}},[s._v("#")]),s._v(" 案例：playbook安装nginx")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Instll Nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" present\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Copy Nignx.conf\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx.conf.j2\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/nginx/nginx.conf\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("notify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Restart Nignx Service\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("handlers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Restart Nignx Service\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restarted\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[a("strong",[s._v("handlers注意事项：")])]),s._v(" "),a("ul",[a("li",[s._v("无论多少个task通知相同的handlers，handlers仅会在所有task结束后执行一次；")]),s._v(" "),a("li",[s._v("只有task发生变化后才会通知handlers，没有改变则不会触发handlers；")]),s._v(" "),a("li",[s._v("不能使用handlers代替task，因为handlers是一个特殊的task；")])]),s._v(" "),a("h4",{attrs:{id:"_8-4-playbook-tag"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-playbook-tag"}},[s._v("#")]),s._v(" 8.4 playbook tag")]),s._v(" "),a("p",[s._v("默认情况下，Ansible在执行一个playbook时，会执行playbook中的定义的所有任务。Ansible的标签（Tags）功能可以给单独任务甚至整个playbook打上tag标签，然后利用tag标签指定要运行的个别任务，或跳过个别的任务！")]),s._v(" "),a("h6",{attrs:{id:"案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例"}},[s._v("#")]),s._v(" 案例：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Instll Nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" present\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" install nginx            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加tag标签")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Copy Nignx.conf\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx.conf.j2\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/nginx/nginx.conf\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("notify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Restart Nignx Service\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Start Nginx \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" started\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" start nginx          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加tag标签")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("handlers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Restart Nignx Service\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restarted\n$ ansible"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("playbook "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i hosts test.yml  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t 'install nginx'\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 仅仅执行playbook中的某个tag标签")]),s._v("\n\n$ $ ansible"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("playbook "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i hosts test.yml  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("skip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tags 'install nginx'\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 跳过playbook中的特定的tag标签")]),s._v("\n\n$ ansible"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("playbook "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i hosts test.yml  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t 'install nginx' "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t 'start nginx'\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定多个tag标签")]),s._v("\n\n$ ansible"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("playbook "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i hosts test.yml  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("skip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tags 'install nginx' "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("skip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tags 'start nginx'\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 跳过多个tag标签")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br")])]),a("h4",{attrs:{id:"_8-5-playbook-include"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-5-playbook-include"}},[s._v("#")]),s._v(" 8.5 playbook include")]),s._v(" "),a("p",[s._v("有时发现大量的playbook内容要重复编写，与tasks之间贡呢需相互调用才能完成各自贡呢。playbook庞大到维护困难，这是就需要使用include！")]),s._v(" "),a("h6",{attrs:{id:"案例-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例-2"}},[s._v("#")]),s._v(" 案例：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" restart_httpd.yml \n- name: Restart Httpd Service\n  service:\n    name: httpd\n    state: restarted\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("A Project的yaml文件：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" A Project command\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' echo "A"\n    '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Restart Httpd\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restart_httpd.yml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("A Project的yaml文件：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" B Project command\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' echo "B"\n    '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Restart Httpd\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restart_httpd.yml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v("高级用法：")])]),s._v(" "),a("p",[s._v("一次执行的多个playbook文件！")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" tasks_total.yml \n- import_playbook: test.yml\n- import_playbook: test01.yml\n\n$ ansible-playbook "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" hosts  tasks_total.yml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"_8-6-ignore-errors忽略错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-6-ignore-errors忽略错误"}},[s._v("#")]),s._v(" 8.6 ignore_errors忽略错误")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Command\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /bin/false\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ignore_errors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" yes\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Create File\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /tmp/file\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" touch\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"_8-7-playbook错误处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-7-playbook错误处理"}},[s._v("#")]),s._v(" 8.7 playbook错误处理")]),s._v(" "),a("p",[s._v("通常情况下，当task失败后，play将会终止，任何在前面已经被tasks notify的handlers都不会被执行。如果在play中设置"),a("code",[s._v("force_handlers")]),s._v("，被通知的handlers就会被强制执行。")]),s._v(" "),a("h5",{attrs:{id:"案例一-task执行失败强制调用handlers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例一-task执行失败强制调用handlers"}},[s._v("#")]),s._v(" 案例一：task执行失败强制调用handlers")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("force_handlers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" yes     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 强制调用handlers")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Touch File\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /tmp/test\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" touch\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("notify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Restart Httpd Service\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Install Packages\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sb\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" present\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("handlers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Restart Httpd Service\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpd\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restarted\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h5",{attrs:{id:"案例二-关闭change的状态-确定不会对被控端主机进行任何的修改和变更"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例二-关闭change的状态-确定不会对被控端主机进行任何的修改和变更"}},[s._v("#")]),s._v(" 案例二： 关闭change的状态（确定不会对被控端主机进行任何的修改和变更）")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Install Httpd Server\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpd\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" present\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service Httpd Started\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpd\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" started\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Check Httpd Server\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ps aux "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" grep httpd\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("register")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" check_httpd\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("changed_when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" OutPut Variables\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("msg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ check_httpd.stdout_lines }}"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h5",{attrs:{id:"案例三-使用changed-when检查tasksrre任务返回结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例三-使用changed-when检查tasksrre任务返回结果"}},[s._v("#")]),s._v(" 案例三： 使用changed_when检查tasksrre任务返回结果")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Configure Nginx Server\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx.conf.j2\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/nginx/nginx.conf\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("notify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Restart Nginx Server\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Check Httpd\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /usr/sbin/nginx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("register")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx_check\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("changed_when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" (nginx_check.stdout.find('successful'))\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Start Httpd Server\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" started\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" yes\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("handlers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Restart Httpd Server\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restarted\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);