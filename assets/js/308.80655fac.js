(window.webpackJsonp=window.webpackJsonp||[]).push([[308],{660:function(a,s,t){"use strict";t.r(s);var n=t(0),e=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h3",{attrs:{id:"loki-日志系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#loki-日志系统"}},[a._v("#")]),a._v(" Loki 日志系统")]),a._v(" "),s("h4",{attrs:{id:"loki-概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#loki-概述"}},[a._v("#")]),a._v(" Loki 概述")]),a._v(" "),s("p",[a._v("Grafana Loki")]),a._v(" "),s("ul",[s("li",[a._v("Loki的第一个稳定版本于2019年11月19日发布")]),a._v(" "),s("li",[a._v("是 Grafana Labs 团队最新的开源项目")]),a._v(" "),s("li",[a._v("是一个水平可扩展，高可用性，多租户的日志聚合系统")])]),a._v(" "),s("p",[a._v("Loki的第一个稳定版本于2019年11月19日发布\n是 Grafana Labs 团队最新的开源项目\n是一个水平可扩展，高可用性，多租户的日志聚合系统\nLoki 特性")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("不对日志进行全文索引（vs ELK技）")])]),a._v(" "),s("li",[s("p",[a._v("通过存储压缩非结构化日志和仅索引元数据，Loki 操作起来会更简单，更省成本")])]),a._v(" "),s("li",[s("p",[a._v("通过使用与 Prometheus 相同的标签记录流对日志进行索引和分组，使得日志的扩展和操作效率更高")])]),a._v(" "),s("li",[s("p",[a._v("特别适合储存 Kubernetes Pod 日志; 诸如 Pod 标签之类的元数据会被自动删除和编入索引")])]),a._v(" "),s("li",[s("p",[a._v("适合中小团队对日志平台的需求")])]),a._v(" "),s("li",[s("p",[a._v("受 Grafana 原生支持")])])]),a._v(" "),s("p",[a._v("Loki 组成")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("loki")]),a._v(" 是主服务器，负责存储日志和处理查询")]),a._v(" "),s("li",[s("code",[a._v("promtail")]),a._v(" 是代理，负责收集日志并将其发送给 loki")]),a._v(" "),s("li",[s("code",[a._v("Grafana")]),a._v(" 用于 UI 展示")])]),a._v(" "),s("h3",{attrs:{id:"安装-loki"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-loki"}},[a._v("#")]),a._v(" 安装 Loki")]),a._v(" "),s("h4",{attrs:{id:"环境说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境说明"}},[a._v("#")]),a._v(" 环境说明")]),a._v(" "),s("p",[a._v("演示环境拓扑")]),a._v(" "),s("ul",[s("li",[a._v("Loki和grafana服务器：192.168.0.11")]),a._v(" "),s("li",[a._v("promtail 日志收集服务器：192.168.0.11，192.168.0.12")]),a._v(" "),s("li",[a._v("使用docker下载并运行镜像")])]),a._v(" "),s("h4",{attrs:{id:"loki-主服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#loki-主服务器"}},[a._v("#")]),a._v(" Loki 主服务器")]),a._v(" "),s("p",[a._v("运行 grafana loki")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ti")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3000")]),a._v(":3000 grafana/grafana:master\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ti")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" loki "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3100")]),a._v(":3100 grafana/loki:2.4.1\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("启动 promtail ，将 promtail 配置文件拷贝到宿主机")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ti")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" promtail grafana/promtail:2.4.1 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-config.file")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/promtail/config.yml\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /data/soft/promtail\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" promtail:/etc/promtail/config.yml /data/soft/promtail/config.yml\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("docker-compose启动")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("version: "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"3"')]),a._v("\n\nnetworks:\n  loki:\n\nservices:\n  loki:\n    image: grafana/loki:2.5.0\n    ports:\n      - "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3100")]),a._v(":3100\n    volumes:\n      - ./config/loki/local-config.yaml:/etc/loki/local-config.yaml\n      - /etc/localtime:/etc/localtime\n    command: "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-config.file")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/loki/local-config.yaml\n    networks:\n      - loki\n\n  promtail:\n    image: grafana/promtail:2.5.0\n    volumes:\n      - ./config/promtail/config.yml:/etc/promtail/config.yml\n      - /var/log:/var/log\n      - /etc/localtime:/etc/localtime\n    command: "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-config.file")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/promtail/config.yml\n    networks:\n      - loki\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br")])]),s("p",[a._v("收集 nginx 日志")]),a._v(" "),s("ul",[s("li",[a._v("修改 promtail 配置文件")]),a._v(" "),s("li",[a._v("url： 指定 Loki 地址")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /data/soft/promtail/config.yml\nserver:\n  http_listen_port: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9080")]),a._v("\n  grpc_listen_port: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n\npositions:\n  filename: /tmp/positions.yaml\n\nclients:\n  - url: http://192.168.0.11:3100/loki/api/v1/push\n\nscrape_configs:\n- job_name: system\n  static_configs:\n  - targets:\n      - localhost\n    labels:\n      job: nginxlogs "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# job 名称")]),a._v("\n      __path__: /var/log/nginx/*log  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 收集日志路径")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br")])]),s("p",[a._v("挂载 nginx 日志文件目录和 promtail 配置文件到容器")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ti")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" promtail "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /var/log/nginx/:/var/log/nginx/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /data/soft/promtail/config.yml:/etc/promtail/config.yml "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\ngrafana/promtail:2.4.1 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-config.file")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/promtail/config.yml\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h4",{attrs:{id:"使用-loki"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-loki"}},[a._v("#")]),a._v(" 使用 Loki")]),a._v(" "),s("p",[a._v("访问 grafana 面板")]),a._v(" "),s("ul",[s("li",[a._v("默认用户名和密码是 admin")]),a._v(" "),s("li",[s("code",[a._v("http://192.168.0.11:3000")])])]),a._v(" "),s("p",[a._v("添加数据源")]),a._v(" "),s("ul",[s("li",[a._v("配置选择 DATA SOURCES")]),a._v(" "),s("li",[a._v("点击 Add data source 添加 Loki")])]),a._v(" "),s("p",[a._v("配置 Loki 地址")]),a._v(" "),s("ul",[s("li",[a._v("url 填写正确地址")]),a._v(" "),s("li",[a._v("点击 Save & test 测试并保存")])]),a._v(" "),s("p",[a._v("使用 Loki")]),a._v(" "),s("ul",[s("li",[a._v("切换到 grafana 左侧区域的 "),s("code",[a._v("Explore")])]),a._v(" "),s("li",[a._v("数据库源选择 Loki")]),a._v(" "),s("li",[a._v("点击 Log browser 选择需要查看的日志")])]),a._v(" "),s("h3",{attrs:{id:"查看日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看日志"}},[a._v("#")]),a._v(" 查看日志")]),a._v(" "),s("h4",{attrs:{id:"loki-选择器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#loki-选择器"}},[a._v("#")]),a._v(" Loki 选择器")]),a._v(" "),s("p",[a._v("查询表达式")]),a._v(" "),s("ul",[s("li",[a._v("对于查询表达式的标签部分，将其包装在花括号中{}")]),a._v(" "),s("li",[a._v("使用键值对的语法来选择标签")]),a._v(" "),s("li",[a._v("多个标签表达式用逗号分隔")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("filename"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/var/log/nginx/pcb.access.log"')]),a._v(",job"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"nginxlogs"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("匹配运算符")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("= 等于")])]),a._v(" "),s("li",[s("p",[a._v("*!= 不相等")])]),a._v(" "),s("li",[s("p",[a._v("=~ 正则表达式匹配")])]),a._v(" "),s("li",[s("p",[a._v("!~ 不匹配正则表达式\n"),s("strong",[a._v("Loki 过滤器")]),a._v(" "),s("strong",[a._v("搜索表达式")])])]),a._v(" "),s("li",[s("p",[a._v("搜索表达式可以只是文本或正则表达式")])]),a._v(" "),s("li",[s("p",[a._v("表达式接受RE2语法")])]),a._v(" "),s("li",[s("p",[a._v("匹配项区分大小写\n"),s("strong",[a._v("过滤器类型")])])]),a._v(" "),s("li",[s("p",[a._v("|= 行包含字符串。")])]),a._v(" "),s("li",[s("p",[a._v("!= 行不包含字符串。")])]),a._v(" "),s("li",[s("p",[a._v("|~ 行匹配正则表达式。")])]),a._v(" "),s("li",[s("p",[a._v("!~ 行与正则表达式不匹配")])])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("filename"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/var/log/nginx/pcb.access.log"')]),a._v(",job"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"nginxlogs"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("~ "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[a._v('\\"')]),a._v("nx_status"),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[a._v('\\"')]),a._v(':200"')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"promtail"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#promtail"}},[a._v("#")]),a._v(" promtail")]),a._v(" "),s("h4",{attrs:{id:"客户端收集日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端收集日志"}},[a._v("#")]),a._v(" 客户端收集日志")]),a._v(" "),s("p",[a._v("将需要收集的日志挂载到 promtail 容器")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("客户端仅启动 promtail 日志收集容器")])]),a._v(" "),s("li",[s("p",[a._v("-v 宿主机日志目录:/var/log/****")])])]),a._v(" "),s("p",[a._v("promtail 配置说明")]),a._v(" "),s("ul",[s("li",[a._v("支持通配符 *, 表示所有，比如 *.log")]),a._v(" "),s("li",[a._v("多个日志目录可以使用 {path1,path2,…pathN} 区分")]),a._v(" "),s("li",[a._v("不同的 job 使用 targets 区分")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v(" - targets:\n      - localhost\n    labels:\n      job: logsname1\n      __path__: /var/log/path1/*log\n\n  - targets:\n      - localhost\n    labels:\n      job: logsname2\n      __path__: /var/log/path2/*log\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("h4",{attrs:{id:"注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[a._v("#")]),a._v(" 注意事项")]),a._v(" "),s("p",[a._v("promtail 报 429 错误")]),a._v(" "),s("ul",[s("li",[a._v("收集的日志太多了，超过了 loki 的限制")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("level")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("warn "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ts")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2021")]),a._v("-12-02T06:27:01.372586524Z "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("caller")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("client.go:349 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("component")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("client "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("host")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.11:3100 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("msg")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"error sending batch, will retry"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("status")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("429")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("error")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("\"server returned HTTP status 429 Too Many Requests (429): entry with timestamp 2021-12-02 06:27:01.316127865 +0000 UTC ignored, reason: 'Per stream rate limit exceeded (limit: 3MB/sec) while attempting to ingest for stream '{filename="),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[a._v('\\"')]),a._v("/var/log/nginx/nginx.log"),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[a._v('\\"')]),a._v(", job="),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[a._v('\\"')]),a._v("nginxlogs"),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[a._v('\\"')]),a._v("}' totaling 1697740B, consider splitting a stream via additional labels or contact your Loki administrator to see if the limt can be increased' for stream: {filename="),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[a._v('\\"')]),a._v("/var/log/nginx/nginx.log"),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[a._v('\\"')]),a._v(", job="),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[a._v('\\"')]),a._v("nginxlogs"),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[a._v('\\"')]),a._v('},"')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("增加 Loki 限制")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("limits_config:\n  enforce_metric_name: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n  reject_old_samples: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n  reject_old_samples_max_age: 168h\n  ingestion_rate_mb: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("40")]),a._v("\n  ingestion_burst_size_mb: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);