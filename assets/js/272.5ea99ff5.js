(window.webpackJsonp=window.webpackJsonp||[]).push([[272],{625:function(s,a,t){"use strict";t.r(a);var e=t(0),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"用fastdfs一步步搭建文件管理系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用fastdfs一步步搭建文件管理系统"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("用FastDFS一步步搭建文件管理系统"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("strong",[s._v("目录")])]),s._v(" "),a("ul",[a("li",[s._v("一、FastDFS介绍\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label0_0",target:"_blank",rel:"noopener noreferrer"}},[s._v("1、简介"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label0_1",target:"_blank",rel:"noopener noreferrer"}},[s._v("2、FastDFS的存储策略"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label0_2",target:"_blank",rel:"noopener noreferrer"}},[s._v("3、FastDFS的上传过程"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label0_3",target:"_blank",rel:"noopener noreferrer"}},[s._v("4、FastDFS的文件同步"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label0_4",target:"_blank",rel:"noopener noreferrer"}},[s._v("5、FastDFS的文件下载"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("二、安装FastDFS环境\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label1_0",target:"_blank",rel:"noopener noreferrer"}},[s._v("0、前言"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label1_1",target:"_blank",rel:"noopener noreferrer"}},[s._v("1、下载安装 libfastcommon"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label1_2",target:"_blank",rel:"noopener noreferrer"}},[s._v("2、下载安装FastDFS"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label1_3",target:"_blank",rel:"noopener noreferrer"}},[s._v("3、配置FastDFS跟踪器(Tracker)"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label1_4",target:"_blank",rel:"noopener noreferrer"}},[s._v("4、配置 FastDFS 存储 (Storage)"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label1_5",target:"_blank",rel:"noopener noreferrer"}},[s._v("5、文件上传测试"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("三、安装Nginx\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label2_0",target:"_blank",rel:"noopener noreferrer"}},[s._v("1、安装nginx所需环境　　"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label2_1",target:"_blank",rel:"noopener noreferrer"}},[s._v("2、安装Nginx"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label2_2",target:"_blank",rel:"noopener noreferrer"}},[s._v("3、访问文件"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("四、FastDFS 配置 Nginx 模块\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label3_0",target:"_blank",rel:"noopener noreferrer"}},[s._v("1、安装配置Nginx模块"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("五、Java客户端\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label4_0",target:"_blank",rel:"noopener noreferrer"}},[s._v("1、首先需要搭建 FastDFS 客户端Java开发环境"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label4_1",target:"_blank",rel:"noopener noreferrer"}},[s._v("2、客户端API"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label4_2",target:"_blank",rel:"noopener noreferrer"}},[s._v("六、权限控制"),a("OutboundLink")],1)])])])]),s._v(" "),a("hr"),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_labelTop",target:"_blank",rel:"noopener noreferrer"}},[s._v("回到顶部"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"一、fastdfs介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、fastdfs介绍"}},[s._v("#")]),s._v(" 一、FastDFS介绍")]),s._v(" "),a("p",[s._v("FastDFS开源地址：https://github.com/happyfish100")]),s._v(" "),a("p",[s._v("参考："),a("a",{attrs:{href:"http://blog.chinaunix.net/uid-20196318-id-4058561.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("分布式文件系统FastDFS设计原理"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("参考："),a("a",{attrs:{href:"http://www.cnblogs.com/Leo_wl/p/6731647.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("FastDFS分布式文件系统"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("个人封装的FastDFS Java API：https://github.com/bojiangzhou/lyyzoo-fastdfs-java")]),s._v(" "),a("h3",{attrs:{id:"_1、简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、简介"}},[s._v("#")]),s._v(" 1、简介")]),s._v(" "),a("p",[s._v("FastDFS 是一个开源的高性能分布式文件系统（DFS）。 它的主要功能包括：文件存储，文件同步和文件访问，以及高容量和负载平衡。主要解决了海量数据存储问题，特别适合以中小文件（建议范围：4KB < file_size <500MB）为载体的在线服务。")]),s._v(" "),a("p",[s._v("FastDFS 系统有三个角色：跟踪服务器(Tracker Server)、存储服务器(Storage Server)和客户端(Client)。")]),s._v(" "),a("p",[a("strong",[s._v("Tracker Server")]),s._v("：跟踪服务器，主要做调度工作，起到均衡的作用；负责管理所有的 storage server和 group，每个 storage 在启动后会连接 Tracker，告知自己所属 group 等信息，并保持周期性心跳。")]),s._v(" "),a("p",[a("strong",[s._v("Storage Server")]),s._v("：存储服务器，主要提供容量和备份服务；以 group 为单位，每个 group 内可以有多台 storage server，数据互为备份。")]),s._v(" "),a("p",[a("strong",[s._v("Client")]),s._v("：客户端，上传下载数据的服务器，也就是我们自己的项目所部署在的服务器。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011144153840-1185141903.png",alt:"img"}})]),s._v(" "),a("h3",{attrs:{id:"_2、fastdfs的存储策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、fastdfs的存储策略"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2、FastDFS的存储策略")])]),s._v(" "),a("p",[s._v("为了支持大容量，存储节点（服务器）采用了分卷（或分组）的组织方式。存储系统由一个或多个卷组成，卷与卷之间的文件是相互独立的，所有卷的文件容量累加就是整个存储系统中的文件容量。一个卷可以由一台或多台存储服务器组成，一个卷下的存储服务器中的文件都是相同的，卷中的多台存储服务器起到了冗余备份和负载均衡的作用。")]),s._v(" "),a("p",[s._v("在卷中增加服务器时，同步已有的文件由系统自动完成，同步完成后，系统自动将新增服务器切换到线上提供服务。当存储空间不足或即将耗尽时，可以动态添加卷。只需要增加一台或多台服务器，并将它们配置为一个新的卷，这样就扩大了存储系统的容量。")]),s._v(" "),a("h3",{attrs:{id:"_3、fastdfs的上传过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、fastdfs的上传过程"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3、FastDFS的上传过程")])]),s._v(" "),a("p",[s._v("FastDFS向使用者提供基本文件访问接口，比如upload、download、append、delete等，以客户端库的方式提供给用户使用。")]),s._v(" "),a("p",[s._v("Storage Server会定期的向Tracker Server发送自己的存储信息。当Tracker Server Cluster中的Tracker Server不止一个时，各个Tracker之间的关系是对等的，所以客户端上传时可以选择任意一个Tracker。")]),s._v(" "),a("p",[s._v("当Tracker收到客户端上传文件的请求时，会为该文件分配一个可以存储文件的group，当选定了group后就要决定给客户端分配group中的哪一个storage server。当分配好storage server后，客户端向storage发送写文件请求，storage将会为文件分配一个数据存储目录。然后为文件分配一个fileid，最后根据以上的信息生成文件名存储文件。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171012121639387-1574147926.png",alt:"img"}})]),s._v(" "),a("h3",{attrs:{id:"_4、fastdfs的文件同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、fastdfs的文件同步"}},[s._v("#")]),s._v(" "),a("strong",[s._v("4、FastDFS的文件同步")])]),s._v(" "),a("p",[s._v("写文件时，客户端将文件写至group内一个storage server即认为写文件成功，storage server写完文件后，会由后台线程将文件同步至同group内其他的storage server。")]),s._v(" "),a("p",[s._v("每个storage写文件后，同时会写一份binlog，binlog里不包含文件数据，只包含文件名等元信息，这份binlog用于后台同步，storage会记录向group内其他storage同步的进度，以便重启后能接上次的进度继续同步；进度以时间戳的方式进行记录，所以最好能保证集群内所有server的时钟保持同步。")]),s._v(" "),a("p",[s._v("storage的同步进度会作为元数据的一部分汇报到tracker上，tracke在选择读storage的时候会以同步进度作为参考。")]),s._v(" "),a("h3",{attrs:{id:"_5、fastdfs的文件下载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、fastdfs的文件下载"}},[s._v("#")]),s._v(" "),a("strong",[s._v("5、FastDFS的文件下载")])]),s._v(" "),a("p",[s._v("客户端uploadfile成功后，会拿到一个storage生成的文件名，接下来客户端根据这个文件名即可访问到该文件。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2015.cnblogs.com/blog/380252/201704/380252-20170415090611017-204910775.png",alt:"img"}})]),s._v(" "),a("p",[s._v("跟upload file一样，在downloadfile时客户端可以选择任意tracker server。tracker发送download请求给某个tracker，必须带上文件名信息，tracke从文件名中解析出文件的group、大小、创建时间等信息，然后为该请求选择一个storage用来服务读请求。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_labelTop",target:"_blank",rel:"noopener noreferrer"}},[s._v("回到顶部"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"二、安装fastdfs环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、安装fastdfs环境"}},[s._v("#")]),s._v(" 二、安装FastDFS环境")]),s._v(" "),a("h3",{attrs:{id:"_0、前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0、前言"}},[s._v("#")]),s._v(" 0、前言")]),s._v(" "),a("p",[s._v("操作环境：CentOS7 X64，以下操作都是单机环境。")]),s._v(" "),a("p",[s._v("我把所有的安装包下载到/softpackages/下，解压到当前目录。")]),s._v(" "),a("p",[s._v("先做一件事，修改hosts，将文件服务器的ip与域名映射(单机TrackerServer环境)，因为后面很多配置里面都需要去配置服务器地址，ip变了，就只需要修改hosts即可。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# vim /etc/hosts\n\n增加如下一行，这是我的IP\n192.168.51.128 file.ljzsg.com\n\n如果要本机访问虚拟机，在C:\\Windows\\System32\\drivers\\etc\\hosts中同样增加一行\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_1、下载安装-libfastcommon"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、下载安装-libfastcommon"}},[s._v("#")]),s._v(" 1、下载安装 libfastcommon")]),s._v(" "),a("p",[s._v("libfastcommon是从 FastDFS 和 FastDHT 中提取出来的公共 C 函数库，基础环境，安装即可 。")]),s._v(" "),a("p",[s._v("① 下载libfastcommon")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# wget https://github.com/happyfish100/libfastcommon/archive/V1.0.7.tar.gz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("② 解压")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# tar -zxvf V1.0.7.tar.gz\n# cd libfastcommon-1.0.7\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("③ 编译、安装")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# ./make.sh\n# ./make.sh install\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("④ libfastcommon.so 安装到了/usr/lib64/libfastcommon.so，但是FastDFS主程序设置的lib目录是/usr/local/lib，所以需要创建软链接。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so\n# ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so\n# ln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so\n# ln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_2、下载安装fastdfs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、下载安装fastdfs"}},[s._v("#")]),s._v(" 2、下载安装FastDFS")]),s._v(" "),a("p",[s._v("① 下载FastDFS")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# wget https://github.com/happyfish100/fastdfs/archive/V5.05.tar.gz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("② 解压")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# tar -zxvf V5.05.tar.gz\n# cd fastdfs-5.05\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("③ 编译、安装")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# ./make.sh\n# ./make.sh install\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("④ 默认安装方式安装后的相应文件与目录\n　　A、服务脚本：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/etc/init.d/fdfs_storaged\n/etc/init.d/fdfs_tracker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("B、配置文件（这三个是作者给的样例配置文件） :")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/etc/fdfs/client.conf.sample\n/etc/fdfs/storage.conf.sample\n/etc/fdfs/tracker.conf.sample\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("C、命令工具在 /usr/bin/ 目录下：")]),s._v(" "),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("fdfs_appender_test\nfdfs_appender_test1\nfdfs_append_file\nfdfs_crc32\nfdfs_delete_file\nfdfs_download_file\nfdfs_file_info\nfdfs_monitor\nfdfs_storaged\nfdfs_test\nfdfs_test1\nfdfs_trackerd\nfdfs_upload_appender\nfdfs_upload_file\nstop.sh\nrestart.sh \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("p",[s._v("⑤ FastDFS 服务脚本设置的 bin 目录是 /usr/local/bin， 但实际命令安装在 /usr/bin/ 下。")]),s._v(" "),a("p",[s._v("两种方式：")]),s._v(" "),a("p",[s._v("》 一是修改FastDFS 服务脚本中相应的命令路径，也就是把 /etc/init.d/fdfs_storaged 和 /etc/init.d/fdfs_tracker 两个脚本中的 /usr/local/bin 修改成 /usr/bin。")]),s._v(" "),a("p",[s._v("# vim fdfs_trackerd\n　　　　使用查找替换命令进统一修改:%s+/usr/local/bin+/usr/bin\n　　　　# vim fdfs_storaged\n　　　　使用查找替换命令进统一修改:%s+/usr/local/bin+/usr/bin")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011104718043-576731412.png",alt:"img"}})]),s._v(" "),a("p",[s._v("》 二是建立 /usr/bin 到 /usr/local/bin 的软链接，我是用这种方式。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# ln -s /usr/bin/fdfs_trackerd   /usr/local/bin\n# ln -s /usr/bin/fdfs_storaged   /usr/local/bin\n# ln -s /usr/bin/stop.sh         /usr/local/bin\n# ln -s /usr/bin/restart.sh      /usr/local/bin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_3、配置fastdfs跟踪器-tracker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、配置fastdfs跟踪器-tracker"}},[s._v("#")]),s._v(" 3、配置FastDFS跟踪器(Tracker)")]),s._v(" "),a("p",[s._v("配置文件详细说明参考："),a("a",{attrs:{href:"http://bbs.chinaunix.net/forum.php?mod=viewthread&tid=1941456&extra=page%3D1%26filter%3Ddigest%26digest%3D1",target:"_blank",rel:"noopener noreferrer"}},[s._v("FastDFS 配置文件详解"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("① 进入 /etc/fdfs，复制 FastDFS 跟踪器样例配置文件 tracker.conf.sample，并重命名为 tracker.conf。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# cd /etc/fdfs\n# cp tracker.conf.sample tracker.conf\n# vim tracker.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("② 编辑tracker.conf ，标红的需要修改下，其它的默认即可。")]),s._v(" "),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 配置文件是否不生效，false 为生效\ndisabled=false\n# 提供服务的端口\nport=22122\n# Tracker 数据和日志目录地址(根目录必须存在,子目录会自动创建)\nbase_path=/ljzsg/fastdfs/tracker\n# HTTP 服务端口\nhttp.server_port=80\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("p",[s._v("③ 创建tracker基础数据目录，即base_path对应的目录")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# mkdir -p /ljzsg/fastdfs/tracker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("④ 防火墙中打开跟踪端口（默认的22122）")]),s._v(" "),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# vim /etc/sysconfig/iptables\n添加如下端口行：\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 22122 -j ACCEPT\n重启防火墙：\n# service iptables restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("p",[s._v("⑤ 启动Tracker")]),s._v(" "),a("p",[s._v("初次成功启动，会在 /ljzsg/fdfsdfs/tracker/ (配置的base_path)下创建 data、logs 两个目录。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("可以用这种方式启动\n# /etc/init.d/fdfs_trackerd start\n\n也可以用这种方式启动，前提是上面创建了软链接，后面都用这种方式\n# service fdfs_trackerd start\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("查看 FastDFS Tracker 是否已成功启动 ，22122端口正在被监听，则算是Tracker服务安装成功。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# netstat -unltp|grep fdfs\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011121344184-1089101646.png",alt:"img"}})]),s._v(" "),a("p",[s._v("关闭Tracker命令：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# service fdfs_trackerd stop\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("⑥ 设置Tracker开机启动")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# chkconfig fdfs_trackerd on\n\n或者：\n# vim /etc/rc.d/rc.local\n加入配置：\n/etc/init.d/fdfs_trackerd start \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("⑦ tracker server 目录及文件结构")]),s._v(" "),a("p",[s._v("Tracker服务启动成功后，会在base_path下创建data、logs两个目录。目录结构如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("${base_path}\n  |__data\n  |   |__storage_groups.dat：存储分组信息\n  |   |__storage_servers.dat：存储服务器列表\n  |__logs\n  |   |__trackerd.log： tracker server 日志文件 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_4、配置-fastdfs-存储-storage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、配置-fastdfs-存储-storage"}},[s._v("#")]),s._v(" 4、配置 FastDFS 存储 (Storage)")]),s._v(" "),a("p",[s._v("① 进入 /etc/fdfs 目录，复制 FastDFS 存储器样例配置文件 storage.conf.sample，并重命名为 storage.conf")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# cd /etc/fdfs\n# cp storage.conf.sample storage.conf# vim storage.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("② 编辑storage.conf")]),s._v(" "),a("p",[s._v("标红的需要修改，其它的默认即可。")]),s._v(" "),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 配置文件是否不生效，false 为生效\ndisabled=false \n\n# 指定此 storage server 所在 组(卷)\ngroup_name=group1\n\n# storage server 服务端口\nport=23000\n\n# 心跳间隔时间，单位为秒 (这里是指主动向 tracker server 发送心跳)\nheart_beat_interval=30\n\n# Storage 数据和日志目录地址(根目录必须存在，子目录会自动生成)\nbase_path=/ljzsg/fastdfs/storage\n\n# 存放文件时 storage server 支持多个路径。这里配置存放文件的基路径数目，通常只配一个目录。\nstore_path_count=1\n\n\n# 逐一配置 store_path_count 个路径，索引号基于 0。\n# 如果不配置 store_path0，那它就和 base_path 对应的路径一样。\nstore_path0=/ljzsg/fastdfs/file\n\n# FastDFS 存储文件时，采用了两级目录。这里配置存放文件的目录个数。 \n# 如果本参数只为 N（如： 256），那么 storage server 在初次运行时，会在 store_path 下自动创建 N * N 个存放文件的子目录。\nsubdir_count_per_path=256\n\n# tracker_server 的列表 ，会主动连接 tracker_server\n# 有多个 tracker server 时，每个 tracker server 写一行\ntracker_server=file.ljzsg.com:22122# 允许系统同步的时间段 (默认是全天) 。一般用于避免高峰同步产生一些问题而设定。sync_start_time=00:00sync_end_time=23:59\n# 访问端口\nhttp.server_port=80\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("p",[s._v("③ 创建Storage基础数据目录，对应base_path目录")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# mkdir -p /ljzsg/fastdfs/storage\n\n# 这是配置的store_path0路径\n# mkdir -p /ljzsg/fastdfs/file\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("④ 防火墙中打开存储器端口（默认的 23000）")]),s._v(" "),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# vim /etc/sysconfig/iptables\n\n添加如下端口行：\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 23000 -j ACCEPT\n\n重启防火墙：\n# service iptables restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011133233777-1903096242.png",alt:"img"}})]),s._v(" "),a("p",[s._v("⑤ 启动 Storage")]),s._v(" "),a("p",[s._v("启动Storage前确保Tracker是启动的。初次启动成功，会在 /ljzsg/fastdfs/storage 目录下创建 data、 logs 两个目录。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("可以用这种方式启动\n# /etc/init.d/fdfs_storaged start\n\n也可以用这种方式，后面都用这种\n# service fdfs_storaged start\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("查看 Storage 是否成功启动，23000 端口正在被监听，就算 Storage 启动成功。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# netstat -unltp|grep fdfs\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011134723387-604894314.png",alt:"img"}})]),s._v(" "),a("p",[s._v("关闭Storage命令：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# service fdfs_storaged stop\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("查看Storage和Tracker是否在通信：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/usr/bin/fdfs_monitor /etc/fdfs/storage.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171016093815615-757608481.png",alt:"img"}})]),s._v(" "),a("p",[s._v("⑥ 设置 Storage 开机启动")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# chkconfig fdfs_storaged on\n或者：\n# vim /etc/rc.d/rc.local\n加入配置：\n/etc/init.d/fdfs_storaged start\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("⑦ Storage 目录")]),s._v(" "),a("p",[s._v("同 Tracker，Storage 启动成功后，在base_path 下创建了data、logs目录，记录着 Storage Server 的信息。")]),s._v(" "),a("p",[s._v("在 store_path0 目录下，创建了N*N个子目录：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011135658074-1715166829.png",alt:"img"}})]),s._v(" "),a("h3",{attrs:{id:"_5、文件上传测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、文件上传测试"}},[s._v("#")]),s._v(" 5、文件上传测试")]),s._v(" "),a("p",[s._v("① 修改 Tracker 服务器中的客户端配置文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# cd /etc/fdfs\n# cp client.conf.sample client.conf\n# vim client.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("修改如下配置即可，其它默认。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# Client 的数据和日志目录\nbase_path=/ljzsg/fastdfs/client\n\n# Tracker端口\ntracker_server=file.ljzsg.com:22122\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("② 上传测试")]),s._v(" "),a("p",[s._v("在linux内部执行如下命令上传 namei.jpeg 图片")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# /usr/bin/fdfs_upload_file /etc/fdfs/client.conf namei.jpeg\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("上传成功后返回文件ID号：group1/M00/00/00/wKgz6lnduTeAMdrcAAEoRmXZPp870.jpeg")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011142634105-1857091563.png",alt:"img"}})]),s._v(" "),a("p",[s._v("返回的文件ID由group、存储目录、两级子目录、fileid、文件后缀名（由客户端指定，主要用于区分文件类型）拼接而成。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011151728965-914197096.png",alt:"img"}})]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_labelTop",target:"_blank",rel:"noopener noreferrer"}},[s._v("回到顶部"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"三、安装nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、安装nginx"}},[s._v("#")]),s._v(" 三、安装Nginx")]),s._v(" "),a("p",[s._v("上面将文件上传成功了，但我们无法下载。因此安装Nginx作为服务器以支持Http方式访问文件。同时，后面安装FastDFS的Nginx模块也需要Nginx环境。")]),s._v(" "),a("p",[s._v("Nginx只需要安装到StorageServer所在的服务器即可，用于访问文件。我这里由于是单机，TrackerServer和StorageServer在一台服务器上。")]),s._v(" "),a("h3",{attrs:{id:"_1、安装nginx所需环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、安装nginx所需环境"}},[s._v("#")]),s._v(" 1、安装nginx所需环境")]),s._v(" "),a("p",[s._v("① gcc 安装")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# yum install gcc-c++\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("② PCRE pcre-devel 安装")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# yum install -y pcre pcre-devel\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("③ zlib 安装")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# yum install -y zlib zlib-devel\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("④ OpenSSL 安装")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# yum install -y openssl openssl-devel\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_2、安装nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、安装nginx"}},[s._v("#")]),s._v(" 2、安装Nginx")]),s._v(" "),a("p",[s._v("① 下载nginx")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# wget -c https://nginx.org/download/nginx-1.12.1.tar.gz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("② 解压")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# tar -zxvf nginx-1.12.1.tar.gz\n# cd nginx-1.12.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("③ 使用默认配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# ./configure\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("④ 编译、安装")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# make\n# make install\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("⑤ 启动nginx")]),s._v(" "),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# cd /usr/local/nginx/sbin/\n# ./nginx \n\n其它命令\n# ./nginx -s stop\n# ./nginx -s quit\n# ./nginx -s reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("p",[s._v("⑥ 设置开机启动")]),s._v(" "),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# vim /etc/rc.local\n\n添加一行：\n/usr/local/nginx/sbin/nginx# 设置执行权限# chmod 755 rc.local\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("p",[s._v("⑦ 查看nginx的版本及模块")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/usr/local/nginx/sbin/nginx -V\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011165300730-1693050013.png",alt:"img"}})]),s._v(" "),a("p",[s._v("⑧ 防火墙中打开Nginx端口（默认的 80）")]),s._v(" "),a("p",[s._v("添加后就能在本机使用80端口访问了。")]),s._v(" "),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# vim /etc/sysconfig/iptables\n\n添加如下端口行：\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT\n\n重启防火墙：\n# service iptables restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011172121746-2118138931.png",alt:"img"}})]),s._v(" "),a("h3",{attrs:{id:"_3、访问文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、访问文件"}},[s._v("#")]),s._v(" 3、访问文件")]),s._v(" "),a("p",[s._v("简单的测试访问文件")]),s._v(" "),a("p",[s._v("① 修改nginx.conf")]),s._v(" "),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# vim /usr/local/nginx/conf/nginx.conf\n\n添加如下行，将 /group1/M00 映射到 /ljzsg/fastdfs/file/data\nlocation /group1/M00 {\n    alias /ljzsg/fastdfs/file/data;\n}# 重启nginx# /usr/local/nginx/sbin/nginx -s reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011180543746-937678567.png",alt:"img"}})]),s._v(" "),a("p",[s._v("② 在浏览器访问之前上传的图片、成功。")]),s._v(" "),a("p",[s._v("http://file.ljzsg.com/group1/M00/00/00/wKgz6lnduTeAMdrcAAEoRmXZPp870.jpeg")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_labelTop",target:"_blank",rel:"noopener noreferrer"}},[s._v("回到顶部"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"四、fastdfs-配置-nginx-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、fastdfs-配置-nginx-模块"}},[s._v("#")]),s._v(" 四、FastDFS 配置 Nginx 模块")]),s._v(" "),a("h3",{attrs:{id:"_1、安装配置nginx模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、安装配置nginx模块"}},[s._v("#")]),s._v(" 1、安装配置Nginx模块")]),s._v(" "),a("p",[s._v("① fastdfs-nginx-module 模块说明")]),s._v(" "),a("p",[s._v("FastDFS 通过 Tracker 服务器，将文件放在 Storage 服务器存储， 但是同组存储服务器之间需要进行文件复制， 有同步延迟的问题。")]),s._v(" "),a("p",[s._v("假设 Tracker 服务器将文件上传到了 192.168.51.128，上传成功后文件 ID已经返回给客户端。")]),s._v(" "),a("p",[s._v("此时 FastDFS 存储集群机制会将这个文件同步到同组存储 192.168.51.129，在文件还没有复制完成的情况下，客户端如果用这个文件 ID 在 192.168.51.129 上取文件,就会出现文件无法访问的错误。")]),s._v(" "),a("p",[s._v("而 fastdfs-nginx-module 可以重定向文件链接到源服务器取文件，避免客户端由于复制延迟导致的文件无法访问错误。")]),s._v(" "),a("p",[s._v("② 下载 fastdfs-nginx-module、解压")]),s._v(" "),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 这里为啥这么长一串呢，因为最新版的master与当前nginx有些版本问题。\n# wget https://github.com/happyfish100/fastdfs-nginx-module/archive/5e5f3566bbfa57418b5506aaefbe107a42c9fcb1.zip\n\n# 解压\n# unzip 5e5f3566bbfa57418b5506aaefbe107a42c9fcb1.zip\n\n# 重命名\n# mv fastdfs-nginx-module-5e5f3566bbfa57418b5506aaefbe107a42c9fcb1  fastdfs-nginx-module-master\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("p",[s._v("③ 配置Nginx")]),s._v(" "),a("p",[s._v("在nginx中添加模块")]),s._v(" "),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 先停掉nginx服务# /usr/local/nginx/sbin/nginx -s stop进入解压包目录\n# cd /softpackages/nginx-1.12.1/\n\n# 添加模块\n# ./configure --add-module=../fastdfs-nginx-module-master/src\n\n重新编译、安装\n# make && make install\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("p",[s._v("④ 查看Nginx的模块")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# /usr/local/nginx/sbin/nginx -V\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("有下面这个就说明添加模块成功")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011224125574-1739252073.png",alt:"img"}})]),s._v(" "),a("p",[s._v("⑤ 复制 fastdfs-nginx-module 源码中的配置文件到/etc/fdfs 目录， 并修改")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# cd /softpackages/fastdfs-nginx-module-master/src\n\n# cp mod_fastdfs.conf /etc/fdfs/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("修改如下配置，其它默认")]),s._v(" "),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 连接超时时间connect_timeout=10\n\n# Tracker Server\ntracker_server=file.ljzsg.com:22122\n# StorageServer 默认端口\nstorage_server_port=23000\n\n# 如果文件ID的uri中包含/group**，则要设置为true\nurl_have_group_name = true\n\n# Storage 配置的store_path0路径，必须和storage.conf中的一致\nstore_path0=/ljzsg/fastdfs/file\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("p",[s._v("⑥ 复制 FastDFS 的部分配置文件到/etc/fdfs 目录")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# cd /softpackages/fastdfs-5.05/conf/\n\n# cp anti-steal.jpg http.conf mime.types /etc/fdfs/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("⑦ 配置nginx，修改nginx.conf")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# vim /usr/local/nginx/conf/nginx.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("修改配置，其它的默认")]),s._v(" "),a("p",[s._v("在80端口下添加fastdfs-nginx模块")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location ~/group([0-9])/M00 {\n    ngx_fastdfs_module;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011184247777-40074297.png",alt:"img"}})]),s._v(" "),a("p",[s._v("注意：")]),s._v(" "),a("p",[s._v("listen 80 端口值是要与 /etc/fdfs/storage.conf 中的 http.server_port=80 (前面改成80了)相对应。如果改成其它端口，则需要统一，同时在防火墙中打开该端口。")]),s._v(" "),a("p",[s._v("location 的配置，如果有多个group则配置location ~/group([0-9])/M00 ，没有则不用配group。")]),s._v(" "),a("p",[s._v("⑧ 在/ljzsg/fastdfs/file 文件存储目录下创建软连接，将其链接到实际存放数据的目录，这一步可以省略。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# ln -s /ljzsg/fastdfs/file/data/ /ljzsg/fastdfs/file/data/M00 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("⑨ 启动nginx")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# /usr/local/nginx/sbin/nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("打印处如下就算配置成功")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011230509512-654301113.png",alt:"img"}})]),s._v(" "),a("p",[s._v("⑩ 在地址栏访问。")]),s._v(" "),a("p",[s._v("能下载文件就算安装成功。注意和第三点中直接使用nginx路由访问不同的是，这里配置 fastdfs-nginx-module 模块，可以重定向文件链接到源服务器取文件。")]),s._v(" "),a("p",[s._v("http://file.ljzsg.com/group1/M00/00/00/wKgz6lnduTeAMdrcAAEoRmXZPp870.jpeg")]),s._v(" "),a("p",[s._v("最终部署结构图(盗的图)：可以按照下面的结构搭建环境。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171012180511480-692747720.png",alt:"img"}})]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/chiangchou/p/fastdfs.html#_labelTop",target:"_blank",rel:"noopener noreferrer"}},[s._v("回到顶部"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"五、java客户端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、java客户端"}},[s._v("#")]),s._v(" 五、Java客户端")]),s._v(" "),a("p",[s._v("前面文件系统平台搭建好了，现在就要写客户端代码在系统中实现上传下载，这里只是简单的测试代码。")]),s._v(" "),a("h3",{attrs:{id:"_1、首先需要搭建-fastdfs-客户端java开发环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、首先需要搭建-fastdfs-客户端java开发环境"}},[s._v("#")]),s._v(" 1、首先需要搭建 FastDFS 客户端Java开发环境")]),s._v(" "),a("p",[s._v("① 项目中使用maven进行依赖管理，可以在pom.xml中引入如下依赖即可：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<dependency>\n   <groupId>net.oschina.zcx7878</groupId>\n   <artifactId>fastdfs-client-java</artifactId>\n   <version>1.27.0.0</version>\n</dependency>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("其它的方式，参考官方文档：https://github.com/happyfish100/fastdfs-client-java")]),s._v(" "),a("p",[s._v("② 引入配置文件")]),s._v(" "),a("p",[s._v("可直接复制包下的 fastdfs-client.properties.sample 或者 fdfs_client.conf.sample，到你的项目中，去掉.sample。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171012112805371-395330483.png",alt:"img"}})]),s._v(" "),a("p",[s._v("我这里直接复制 fastdfs-client.properties.sample 中的配置到项目配置文件 config.properties 中，修改tracker_servers。只需要加载这个配置文件即可")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171012120004199-247798219.png",alt:"img"}})]),s._v(" "),a("h3",{attrs:{id:"_2、客户端api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、客户端api"}},[s._v("#")]),s._v(" 2、客户端API")]),s._v(" "),a("p",[s._v("个人封装的FastDFS Java API以同步到github：https://github.com/bojiangzhou/lyyzoo-fastdfs-java.git")]),s._v(" "),a("h3",{attrs:{id:"六、权限控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、权限控制"}},[s._v("#")]),s._v(" 六、权限控制")]),s._v(" "),a("p",[s._v("前面使用nginx支持http方式访问文件，但所有人都能直接访问这个文件服务器了，所以做一下权限控制。")]),s._v(" "),a("p",[s._v("FastDFS的权限控制是在服务端开启token验证，客户端根据文件名、当前unix时间戳、秘钥获取token，在地址中带上token参数即可通过http方式访问文件。")]),s._v(" "),a("p",[s._v("① 服务端开启token验证")]),s._v(" "),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("修改http.conf\n# vim /etc/fdfs/http.conf\n\n设置为true表示开启token验证\nhttp.anti_steal.check_token=true设置token失效的时间单位为秒(s)http.anti_steal.token_ttl=1800\n密钥，跟客户端配置文件的fastdfs.http_secret_key保持一致\nhttp.anti_steal.secret_key=FASTDFS1234567890\n\n如果token检查失败，返回的页面\nhttp.anti_steal.token_check_fail=/ljzsg/fastdfs/page/403.html\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("p",[s._v("记得重启服务。")]),s._v(" "),a("p",[s._v("② 配置客户端")]),s._v(" "),a("p",[s._v("客户端只需要设置如下两个参数即可，两边的密钥保持一致。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# token 防盗链功能\nfastdfs.http_anti_steal_token=true\n# 密钥\nfastdfs.http_secret_key=FASTDFS1234567890\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("③ 客户端生成token")]),s._v(" "),a("p",[s._v("访问文件需要带上生成的token以及unix时间戳，所以返回的token是token和时间戳的拼接。")]),s._v(" "),a("p",[s._v("之后，将token拼接在地址后即可访问：file.ljzsg.com/group1/M00/00/00/wKgzgFnkaXqAIfXyAAEoRmXZPp878.jpeg?token=078d370098b03e9020b82c829c205e1f&ts=1508141521")]),s._v(" "),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(' 1     /**\n 2      * 获取访问服务器的token，拼接到地址后面\n 3      *\n 4      * @param filepath 文件路径 group1/M00/00/00/wKgzgFnkTPyAIAUGAAEoRmXZPp876.jpeg\n 5      * @param httpSecretKey 密钥\n 6      * @return 返回token，如： token=078d370098b03e9020b82c829c205e1f&ts=1508141521\n 7      */\n 8     public static String getToken(String filepath, String httpSecretKey){\n 9         // unix seconds\n10         int ts = (int) Instant.now().getEpochSecond();\n11         // token\n12         String token = "null";\n13         try {\n14             token = ProtoCommon.getToken(getFilename(filepath), ts, httpSecretKey);\n15         } catch (UnsupportedEncodingException e) {\n16             e.printStackTrace();\n17         } catch (NoSuchAlgorithmException e) {\n18             e.printStackTrace();\n19         } catch (MyException e) {\n20             e.printStackTrace();\n21         }\n22 \n23         StringBuilder sb = new StringBuilder();\n24         sb.append("token=").append(token);\n25         sb.append("&ts=").append(ts);\n26 \n27         return sb.toString();\n28     }\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),s._v("](javascript:void(0)😉")]),s._v(" "),a("p",[s._v("④ 注意事项")]),s._v(" "),a("p",[s._v("如果生成的token验证无法通过，请进行如下两项检查：\n　　A. 确认调用token生成函数(ProtoCommon.getToken)，传递的文件ID中没有包含group name。传递的文件ID格式形如：M00/00/00/wKgzgFnkTPyAIAUGAAEoRmXZPp876.jpeg")]),s._v(" "),a("p",[s._v("B. 确认服务器时间基本是一致的，注意服务器时间不能相差太多，不要相差到分钟级别。")]),s._v(" "),a("p",[s._v("⑤ 对比下发现，如果系统文件隐私性较高，可以直接通过fastdfs-client提供的API去访问即可，不用再配置Nginx走http访问。配置Nginx的主要目的是为了快速访问服务器的文件(如图片)，如果还要加权限验证，则需要客户端生成token，其实已经没有多大意义。")]),s._v(" "),a("p",[s._v("关键是，这里我没找到FastDFS如何对部分资源加token验证，部分开放。有知道的还请留言。")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("OK，以上就是单机中使用FastDFS搭建文件系统并上传下载的过程。")]),s._v(" "),a("p",[s._v("完！！！")]),s._v(" "),a("p",[s._v("原文链接：https://www.cnblogs.com/chiangchou/p/fastdfs.html")])])}),[],!1,null,null,null);a.default=n.exports}}]);