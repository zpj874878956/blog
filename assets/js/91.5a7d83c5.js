(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{447:function(s,a,e){"use strict";e.r(a);var n=e(0),t=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"_1、新建命名空间-在该命名空间创建一个pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、新建命名空间-在该命名空间创建一个pod"}},[s._v("#")]),s._v(" 1、新建命名空间，在该命名空间创建一个pod")]),s._v(" "),a("p",[s._v("命名空间名称：saas")]),s._v(" "),a("p",[s._v("pod名称：pod-01")]),s._v(" "),a("p",[s._v("镜像：nginx")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-01\n  namespace: saas\nspec:\n  containers:\n  - name: nginx\n    image: nginx:latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"_2、创建一个deployment-并暴露service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、创建一个deployment-并暴露service"}},[s._v("#")]),s._v(" 2、创建一个deployment，并暴露service")]),s._v(" "),a("p",[s._v("名称：web")]),s._v(" "),a("p",[s._v("镜像：nginx")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl create deployment web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\nkubectl expose deploymnet web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --target-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_3、列出命名空间下指定标签pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、列出命名空间下指定标签pod"}},[s._v("#")]),s._v(" 3、列出命名空间下指定标签pod")]),s._v(" "),a("p",[s._v("命名空间名称：kube-system")]),s._v(" "),a("p",[s._v("标签：k8s-app=kube-dns")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl get pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" kube-system "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" k8s-app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kube-dns\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_4、查看pod日志-并将日志中error的行记录到指定文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、查看pod日志-并将日志中error的行记录到指定文件"}},[s._v("#")]),s._v(" 4、查看pod日志，并将日志中error的行记录到指定文件")]),s._v(" "),a("p",[s._v("pod名称：web")]),s._v(" "),a("p",[s._v("文件：/opt/web-log")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl logs web "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" gerp error "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /opt/web-log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_5、-查看指定标签使用cpu最高的pod-并记录到到指定文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、-查看指定标签使用cpu最高的pod-并记录到到指定文件"}},[s._v("#")]),s._v(" 5、 查看指定标签使用cpu最高的pod，并记录到到指定文件")]),s._v(" "),a("p",[s._v("标签：app=web")]),s._v(" "),a("p",[s._v("文件：/opt/cpu")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("web --sort-by"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cpu"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/opt/cpu\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_6、在节点上配置kubelet托管启动一个pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、在节点上配置kubelet托管启动一个pod"}},[s._v("#")]),s._v(" 6、在节点上配置kubelet托管启动一个pod")]),s._v(" "),a("p",[s._v("节点：k8s-node1")]),s._v(" "),a("p",[s._v("pod名称：web")]),s._v(" "),a("p",[s._v("镜像：nginx")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("apiVersion: v1\nkind: pod\nmetadata:\n  name: web\n  namespace: default\n  labels:\n    app: myapp\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"_7、向pod中添加一个init容器-init容器创建一个空文件-如果该空文件没有被检测到-pod就退出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、向pod中添加一个init容器-init容器创建一个空文件-如果该空文件没有被检测到-pod就退出"}},[s._v("#")]),s._v(" 7、向pod中添加一个init容器，init容器创建一个空文件，如果该空文件没有被检测到，pod就退出")]),s._v(" "),a("p",[s._v("pod名称：web")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\nspec:\n  containers:\n  - name: main-container\n    image: your-main-container-image\n    readinessProbe:\n      exec:\n        command:\n        - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n        - "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v("\n        - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[ -f /path/to/empty/file ]"')]),s._v("\n      initialDelaySeconds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n      periodSeconds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n  initContainers:\n  - name: init-container\n    image: your-init-container-image\n    command: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"touch /path/to/empty/file"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其他 Pod 配置")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h3",{attrs:{id:"_8、创建一个deployment-副本数-3-然后滚动更新镜像-版本-并记录这个更新记录-最后再回滚到上一个版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8、创建一个deployment-副本数-3-然后滚动更新镜像-版本-并记录这个更新记录-最后再回滚到上一个版本"}},[s._v("#")]),s._v(" 8、创建一个deployment 副本数 3，然后滚动更新镜像 版本，并记录这个更新记录，最后再回滚到上一个版本")]),s._v(" "),a("p",[s._v("名称：nginx")]),s._v(" "),a("p",[s._v("镜像版本：1.16")]),s._v(" "),a("p",[s._v("更新镜像版本：1.17")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl create deployment web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx:1.16\nkubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image deployment web "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nginx")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx:1.17 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--record")]),s._v("\nkubectl rollout "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" deply web "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看版本记录")]),s._v("\nkubectl rollout undo deployment web "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#回滚到上一个版本")]),s._v("\nkubectl rollout undo deployment web --to-revision"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#也可以回滚到指定版本")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_9、给web-deployment扩容副本数为3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9、给web-deployment扩容副本数为3"}},[s._v("#")]),s._v(" 9、给web deployment扩容副本数为3")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl scale deployment web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replicas")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_10、创建一个pod-其中运行着nginx、redis、-memcached、consul-4个容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10、创建一个pod-其中运行着nginx、redis、-memcached、consul-4个容器"}},[s._v("#")]),s._v(" 10、创建一个pod，其中运行着nginx、redis、 memcached、consul 4个容器")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Nginx 容器配置")]),s._v("\n  - name: redis\n    image: redis\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis 容器配置")]),s._v("\n  - name: memcached\n    image: memcached\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Memcached 容器配置")]),s._v("\n  - name: consul\n    image: consul\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Consul 容器配置")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h3",{attrs:{id:"_11、生成一个deployment-yaml文件保存-到-opt-deploy-yaml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11、生成一个deployment-yaml文件保存-到-opt-deploy-yaml"}},[s._v("#")]),s._v(" 11、生成一个deployment yaml文件保存 到/opt/deploy.yaml")]),s._v(" "),a("p",[s._v("名称：web")]),s._v(" "),a("p",[s._v("标签：app_env_stage=dev")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl create deployment web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx:1.20.2 --dry-run"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("client "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" deploymnet.yaml\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" deplyment.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: web\n  name: web\nspec:\n  replicas: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  selector:\n    matchLabels:\n      app: dev\n  template:\n    metadata:\n      labels:\n        app: dev\n    spec:\n      containers:\n      - image: nginx:1.20.2\n        name: nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h3",{attrs:{id:"_12、创建一个pod-分配到指定标签node上"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12、创建一个pod-分配到指定标签node上"}},[s._v("#")]),s._v(" 12、创建一个pod，分配到指定标签node上")]),s._v(" "),a("p",[s._v("pod名称：web")]),s._v(" "),a("p",[s._v("镜像：nginx")]),s._v(" "),a("p",[s._v("node标签：disk=ssd")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: web\nspec:\n  container:\n  - name: nginx\n    image: nginx:1.20.2\n  nodeSelector:\n    disk: ssd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"_13、确保在每个节点上运行一个pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13、确保在每个节点上运行一个pod"}},[s._v("#")]),s._v(" 13、确保在每个节点上运行一个pod")]),s._v(" "),a("p",[s._v("名称：filebeat")]),s._v(" "),a("p",[s._v("镜像：elastic/filebeat：7.12.1")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("apiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: filebeat\n  namespace: kube-system\nspec:\n  selector:\n    matchLabels:\n      app: filebeat\n  template:\n    metadata:\n      labels:\n        app: filebeat\n   spec:\n      containers:\n      - name: filebeat\n        image: docker.elastic.co/beats/filebeat:7.12.1\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Filebeat 容器配置")]),s._v("\n        volumeMounts:\n        - name: config\n          mountPath: /etc/filebeat\n          readOnly: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n      volumes:\n      - name: config\n        configMap:\n          name: filebeat-config\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h3",{attrs:{id:"_14、查看集群中状态为ready的node数量-不包含被打-了-nodeschedule污点的节点-并将结果写-到-opt-node-txt"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14、查看集群中状态为ready的node数量-不包含被打-了-nodeschedule污点的节点-并将结果写-到-opt-node-txt"}},[s._v("#")]),s._v(" 14、查看集群中状态为ready的node数量，不包含被打 了 NodeSchedule污点的节点，并将结果写 到/opt/node.txt")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl describe "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get nodes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" Ready"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $1}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" Taint"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-vc")]),s._v("\nNoSchedule "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /opt/node.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_15、设置成node不能调度-并使已被调度的pod重新调度"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_15、设置成node不能调度-并使已被调度的pod重新调度"}},[s._v("#")]),s._v(" 15、设置成node不能调度，并使已被调度的pod重新调度")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl cordon node1\nkubectl drain node1 --ignore-daemonsets\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_16、给一个pod创建service-并可以通过clusterip访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16、给一个pod创建service-并可以通过clusterip访问"}},[s._v("#")]),s._v(" 16、给一个pod创建service，并可以通过ClusterIP访问")]),s._v(" "),a("p",[s._v("名称：web-service")]),s._v(" "),a("p",[s._v("pod名称：web-pod")]),s._v(" "),a("p",[s._v("容器端口：80")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl expose pod web-pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --target-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("web-service "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NodePort\n\nkubectl get svc web-service\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" CLUSTER-IP\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_17、-任意名称创建deployment和service-然后使用-busybox容器nslookup解析service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_17、-任意名称创建deployment和service-然后使用-busybox容器nslookup解析service"}},[s._v("#")]),s._v(" 17、 任意名称创建deployment和service，然后使用 busybox容器nslookup解析service")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl create deployment nginx-dns "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\nkubectl expose deploymnet nginx-dns "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx-dns "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\nkubectl run bs-dns "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("busybox:1.28.4 busybox "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36000")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" bs-dns "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--nslookup")]),s._v(" nginx-dns\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_18、列出命名空间下某个service关联的所有pod-并将-pod名称写到-opt-pod-txt文件中-使用标签筛选"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_18、列出命名空间下某个service关联的所有pod-并将-pod名称写到-opt-pod-txt文件中-使用标签筛选"}},[s._v("#")]),s._v(" 18、列出命名空间下某个service关联的所有pod，并将 pod名称写到/opt/pod.txt文件中（使用标签筛选）")]),s._v(" "),a("p",[s._v("命名空间：default")]),s._v(" "),a("p",[s._v("service名称：web")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" yaml\nkubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /opt/pod.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_19、创建一个secret-并创建2个pod-pod1挂载该-secret-路径为-etc-foo-pod2使用环境变量引用该-secret-该变量的环境变量名为abc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_19、创建一个secret-并创建2个pod-pod1挂载该-secret-路径为-etc-foo-pod2使用环境变量引用该-secret-该变量的环境变量名为abc"}},[s._v("#")]),s._v(" 19、创建一个secret，并创建2个pod，pod1挂载该 secret，路径为/etc/foo，pod2使用环境变量引用该 secret，该变量的环境变量名为ABC")]),s._v(" "),a("p",[s._v("secret名称：mysecret")]),s._v(" "),a("p",[s._v("pod1名称：pod-volume-secret")]),s._v(" "),a("p",[s._v("pod2名称：pod-env-secret")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("创建一个 Secret，将其保存为 YAML 文件，例如 my-secret.yaml，并指定需要保密的数据：\napiVersion: v1\nkind: Secret\nmetadata:\n  name: my-secret\ndata:\n  username: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Base64编码的用户名"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  password: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Base64编码的密码"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkubectl create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" my-secret.yaml\n创建 Pod1，并将 Secret 挂载到 /etc/foo 路径：\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod1\nspec:\n  containers:\n  - name: my-container\n    image: your-image\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其他容器配置")]),s._v("\n    volumeMounts:\n    - name: secret-volume\n      mountPath: /etc/foo\n  volumes:\n  - name: secret-volume\n    secret:\n      secretName: my-secret\n\n创建 Pod2，并使用环境变量引用 Secret 中的值：\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod2\nspec:\n  containers:\n  - name: my-container\n    image: your-image\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其他容器配置")]),s._v("\n    env:\n    - name: ABC\n      valueFrom:\n        secretKeyRef:\n          name: my-secret\n          key: username\n\n分别保存 Pod1 和 Pod2 的 YAML 配置为 pod1.yaml 和 pod2.yaml 文件，并使用以下命令创建这两个 Pod：\n\nkubectl create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" pod1.yaml\nkubectl create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" pod2.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br")])]),a("h3",{attrs:{id:"_20、-创建一个pod使用pv自动供给"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_20、-创建一个pod使用pv自动供给"}},[s._v("#")]),s._v(" 20、 创建一个Pod使用PV自动供给")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\nspec:\n  containers:\n    - name: my-container\n      image: your-image\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其他容器配置")]),s._v("\n      volumeMounts:\n        - name: my-pvc-volume\n          mountPath: /data\n  volumes:\n    - name: my-pvc-volume\n      persistentVolumeClaim:\n        claimName: my-pvc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h3",{attrs:{id:"_21、创建一个pod并挂载数据卷-不可以用持久卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_21、创建一个pod并挂载数据卷-不可以用持久卷"}},[s._v("#")]),s._v(" 21、创建一个pod并挂载数据卷，不可以用持久卷")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\nspec:\n  containers:\n    - name: my-container\n      image: your-image\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其他容器配置")]),s._v("\n      volumeMounts:\n        - name: data-volume\n          mountPath: /data\n  volumes:\n    - name: data-volume\n      emptyDir: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"_22、将pv按照名称、容量排序-并保存到-opt-pv文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_22、将pv按照名称、容量排序-并保存到-opt-pv文件"}},[s._v("#")]),s._v(" 22、将pv按照名称、容量排序，并保存到/opt/pv文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pv")]),s._v(" --sort-by"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".metadata.name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /opt/pv\nkubectl get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pv")]),s._v(" --sort-by"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".spec.capacity.storage "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /opt/pv\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_23、etcd数据库备份与恢复-kubeadm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_23、etcd数据库备份与恢复-kubeadm"}},[s._v("#")]),s._v(" 23、Etcd数据库备份与恢复（kubeadm）")]),s._v(" "),a("p",[a("strong",[s._v("备份")]),s._v(" ETCDCTL_API=3 etcdctl --endpoints="),a("a",{attrs:{href:"https://127.0.0.1:2379",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://127.0.0.1:2379"),a("OutboundLink")],1),a("br"),s._v("\n--cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key"),a("br"),s._v("\nsnapshot save snap.db")]),s._v(" "),a("p",[a("strong",[s._v("还原")])]),s._v(" "),a("p",[s._v("先暂停kube-apiserver和etcd容器")]),s._v(" "),a("p",[s._v("mv /etc/kubernetes/manifests /etc/kubernetes/manifests.bak")]),s._v(" "),a("p",[s._v("ETCDCTL_API=3 etcdctl snapshot restore snap.db --data-dir=/var/lib/etcd")]),s._v(" "),a("p",[s._v("启动kube-apiserver和etcd容器")]),s._v(" "),a("p",[s._v("mv /etc/kubernetes/manifests.bak /etc/kubernetes/manifests")]),s._v(" "),a("h3",{attrs:{id:"_24、升级管理节点kubelet-kubectl-组件由1-18-升级为-1-19-工作节点不升级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_24、升级管理节点kubelet-kubectl-组件由1-18-升级为-1-19-工作节点不升级"}},[s._v("#")]),s._v(" 24、升级管理节点kubelet ,kubectl 组件由1.18 升级为 1.19 ，工作节点不升级")]),s._v(" "),a("p",[s._v("1、查找最新版本号\nyum list --showduplicates kubeadm --disableexcludes=kubernetes\n2、升级kubeadm\nyum install -y kubeadm-1.19.3-0 --disableexcludes=kubernetes\n3、驱逐node上的pod，且不可调度\nkubectl drain k8s-master --ignore-daemonsets\n4、检查集群是否可以升级，并获取可以升级的版本\nkubeadm upgrade plan\n5、执行升级\nkubeadm upgrade apply v1.19.3\n6、取消不可调度\nkubectl uncordon k8s-master\n7、升级kubelet和kubectl\nyum install -y kubelet-1.19.3-0 kubectl-1.19.3-0 --disableexcludes=kubernetes\n8、重启kubelet\nsystemctl daemon-reload\nsystemctl restart kubelet\n9、验证\nkubectl get node")]),s._v(" "),a("h3",{attrs:{id:"_25、创建一个ingress"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_25、创建一个ingress"}},[s._v("#")]),s._v(" 25、创建一个ingress")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: my-ingress\n  annotations:\n    nginx.ingress.kubernetes.io/rewrite-target: /\nspec:\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - path: /foo\n            pathType: Prefix\n            backend:\n              service:\n                name: foo-service\n                port:\n                  number: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n          - path: /bar\n            pathType: Prefix\n            backend:\n              service:\n                name: bar-service\n                port:\n                  number: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("h3",{attrs:{id:"_26、pod创建一个边车容器读取业务容器日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_26、pod创建一个边车容器读取业务容器日志"}},[s._v("#")]),s._v(" 26、Pod创建一个边车容器读取业务容器日志")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: log-counter\nspec:\n  containers:\n  - name: web\n    image: busybox\n    command: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"for i in '),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(";do echo "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v(' >> /var/log/access.log;sleep\n    1;done"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    volumeMounts:\n      - name: varlog\n        mountPath: /var/log\n  - name: log\n    image: busybox\n    command: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tail -f /var/log/access.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    volumeMounts:\n      - name: varlog\n        mountPath: /var/log\n  volumes:\n  - name: varlog\n    emptyDir: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h3",{attrs:{id:"_27、创建一个clusterrole-关联到一个服务账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_27、创建一个clusterrole-关联到一个服务账号"}},[s._v("#")]),s._v(" 27、创建一个clusterrole，关联到一个服务账号")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建用户")]),s._v("\n$ kubectl create serviceaccount dashboard-admin "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" kube-system\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户授权")]),s._v("\n$ kubectl create clusterrolebinding dashboard-admin "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--clusterrole")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cluster-admin --\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("serviceaccount")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kube-system:dashboard-admin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_28、default命名空间下所有pod可以互相访问-也可以-访问其他命名空间pod-但其他命名空间不能访问default-命名空间pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_28、default命名空间下所有pod可以互相访问-也可以-访问其他命名空间pod-但其他命名空间不能访问default-命名空间pod"}},[s._v("#")]),s._v(" 28、default命名空间下所有pod可以互相访问，也可以 访问其他命名空间Pod，但其他命名空间不能访问default 命名空间Pod")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: deny-from-other-namespaces\n  namespace: default\nspec:\n  podSelector: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  policyTypes:\n  - Ingress\n    ingress:\n  - from:\n    - podSelector: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\npodSelector: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("：default命名空间下所有Pod\nfrom.podSelector: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 如果未配置具体的规则，默认不允许\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);