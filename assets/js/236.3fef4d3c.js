(window.webpackJsonp=window.webpackJsonp||[]).push([[236],{590:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"关于rsyslog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于rsyslog"}},[s._v("#")]),s._v(" 关于rsyslog")]),s._v(" "),a("blockquote",[a("p",[s._v("rsyslog是比syslog功能更强大的日志记录系统，可以将日志输出到文件，数据库和其它程序。Centos 7.x默认的rsyslog版本是8.x。\n    "),a("strong",[s._v("rsyslog")]),s._v(" 是一个快速处理收集系统日志的程序，提供了高性能、安全功能和模块化设计。rsyslog 是syslog 的升级版，它将多种来源输入输出转换结果到目的地，并可定制和过滤、筛选。据官网介绍，现在可以处理100万条信息。"),a("br"),s._v("\n特性："),a("br"),s._v("\n       1、可以直接将日志写入到数据库。"),a("br"),s._v("\n       2、日志队列（内存队列和磁盘队列）。"),a("br"),s._v("\n       3、灵活的模板机制，可以得到多种输出格式。"),a("br"),s._v("\n       4、插件式结构，多种多样的输入、输出模块。"),a("br"),s._v("\n       5、可以把日志存放在Mysql ，PostgreSQL，Oracle等数据库中")])]),s._v(" "),a("h1",{attrs:{id:"系统环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统环境"}},[s._v("#")]),s._v(" 系统环境")]),s._v(" "),a("p",[a("strong",[s._v("server端")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZbp13gj9fz5t0mxux5nfyZ ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/redhat-release ")]),s._v("\nAlibaba Cloud Linux release "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Soaring Falcon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZbp13gj9fz5t0mxux5nfyZ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("-05-29"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rsyslogd -v")]),s._v("\nrsyslogd  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.2102")]),s._v(".0-15.1.al8 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("aka "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021.02")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" compiled with:\n        PLATFORM:                               x86_64-koji-linux-gnu\n        PLATFORM "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lsb_release -d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n        FEATURE_REGEXP:                         Yes\n        GSSAPI Kerberos "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" support:              Yes\n        FEATURE_DEBUG "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("debug build, slow code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": No\n        32bit Atomic operations supported:      Yes\n        64bit Atomic operations supported:      Yes\n        memory allocator:                       system default\n        Runtime Instrumentation "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("slow code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":    No\n        uuid support:                           Yes\n        systemd support:                        Yes\n        Config file:                            /etc/rsyslog.conf\n        PID file:                               /var/run/rsyslogd.pid\n        Number of Bits "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" RainerScript integers: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[a("strong",[s._v("client端")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@cvm-3jvysn225i225 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/redhat-release ")]),s._v("\nCentOS Linux release "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.8")]),s._v(".2003 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@cvm-3jvysn225i225 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rsyslogd -v")]),s._v("\nrsyslogd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.24")]),s._v(".0-57.el7_9.3, compiled with:\n        PLATFORM:                               x86_64-redhat-linux-gnu\n        PLATFORM "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lsb_release -d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n        FEATURE_REGEXP:                         Yes\n        GSSAPI Kerberos "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" support:              Yes\n        FEATURE_DEBUG "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("debug build, slow code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": No\n        32bit Atomic operations supported:      Yes\n        64bit Atomic operations supported:      Yes\n        memory allocator:                       system default\n        Runtime Instrumentation "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("slow code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":    No\n        uuid support:                           Yes\n        Number of Bits "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" RainerScript integers: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n\nSee http://www.rsyslog.com "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" information.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h1",{attrs:{id:"客户端的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端的配置"}},[s._v("#")]),s._v(" 客户端的配置")]),s._v(" "),a("p",[s._v("rsyslog.conf")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ModLoad")]),s._v(" imuxsock "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# provides support for local system logging (e.g. via logger command)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ModLoad")]),s._v(" imjournal "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# provides access to the systemd journal")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ModLoad")]),s._v(" imklog "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# reads kernel messages (the same are read from journald)")]),s._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("load"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"imfile"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PollingInterval")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WorkDirectory")]),s._v(" /var/lib/rsyslog\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ActionFileDefaultTemplate")]),s._v(" RSYSLOG_TraditionalFileFormat\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IncludeConfig")]),s._v(" /etc/rsyslog.d/*.conf\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OmitLocalLogging")]),s._v(" on\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IMJournalStateFile")]),s._v(" imjournal.state\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" HEAD\n*.info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("mail.none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("authpriv.none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("cron.none                /var/log/messages\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n*.info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("mail.none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("authpriv.none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("cron.none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("local1.none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("local2.none                /var/log/messages\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 66a4eec5bf87769080cf8996acaf2b6e4bfe4840\nauthpriv.*                                              /var/log/secure\nmail.*                                                  -/var/log/maillog\ncron.*                                                  /var/log/cron\n*.emerg                                                 :omusrmsg:*\nuucp,news.crit                                          /var/log/spooler\nlocal0.*                                                /var/log/boot.log\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" HEAD\nruleset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remoteLogging"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\naction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"omfwd"')]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Target")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"114.55.113.57"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n*.debug                                                 /var/log/rsyslog_debug.log\nruleset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remoteLogging"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\naction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"omfwd"')]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Target")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"114.55.118.57"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 66a4eec5bf87769080cf8996acaf2b6e4bfe4840\n       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"514"')]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Protocol")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tcp"')]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queue.type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LinkedList"')]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queue.filename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app-queue"')]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("action.resumeRetryCount")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-1"')]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queue.size")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10000"')]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queue.dequeuebatchsize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queue.maxdiskspace")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1g"')]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queue.saveonshutdown")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])]),a("p",[s._v("app.conf")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"imfile"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("File")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/nginx/logs/*.log"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" HEAD\n      "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Tag")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app1"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Tag")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-app1"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 66a4eec5bf87769080cf8996acaf2b6e4bfe4840\n      "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Facility")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local1"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PersistStateInterval")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Ruleset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remoteLogging"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("reopenOnTruncate")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ninput"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"imfile"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("File")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/apps/artalk/data/*.log"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" HEAD\n      "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Tag")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app2"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Tag")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"artalk-app2"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 66a4eec5bf87769080cf8996acaf2b6e4bfe4840\n      "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Ruleset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remoteLogging"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PersistStateInterval")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("reopenOnTruncate")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Facility")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local2"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" HEAD\nlocal1.* @@114.55.115.57:514\nlocal2.* @@114.55.115.57:514\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nlocal1.* @@114.55.118.57:514\nlocal2.* @@114.55.118.57:514\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 66a4eec5bf87769080cf8996acaf2b6e4bfe4840\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("h1",{attrs:{id:"服务端配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端配置"}},[s._v("#")]),s._v(" 服务端配置")]),s._v(" "),a("p",[s._v("rsyslog.conf")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("load"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"imuxsock"')]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# provides support for local system logging (e.g. via logger command)")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SysSock.Use")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"off"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Turn off message reception via local log socket; ")]),s._v("\n                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# local messages are retrieved through imjournal now.")]),s._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("load"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"imjournal"')]),s._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# provides access to the systemd journal")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("StateFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"imjournal.state"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# File to store the position in the journal")]),s._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("load"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"imtcp"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# needs to be done just once")]),s._v("\ninput"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"imtcp"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"514"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nglobal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("workDirectory"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/rsyslog"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("load"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"builtin:omfile"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Template")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RSYSLOG_TraditionalFileFormat"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ninclude"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/rsyslog.d/*.conf"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"optional"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" HEAD\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$template")]),s._v(" RemoteLogs,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/logs/%FROMHOST-IP%/%'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$YEAR")]),s._v("%-%"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MONTH")]),s._v("%-%"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DAY")]),s._v('%/%PROGRAMNAME%.log"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$fromhost")]),s._v("-ip "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'127.0.0.1'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v(" stop\n*.*  ?RemoteLogs\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("logs\n└── 103.152.133.13\n    ├── 2024-05-27\n    │   ├── app1.log\n    │   └── app2.log\n    ├── 2024-05-28\n    │   ├── app1.log\n    │   └── app2.log\n    └── 2024-05-29\n        ├── app1.log\n        └── app2.log\n")])])]),a("p",[s._v('=======\n$FileCreateMode 0644\n$DirCreateMode 0755\n$FileOwner devops\n$FileGroup devops\n$Umask 0022\n$PrivDropToUser root\n$PrivDropToGroup root\n$template NginxLogFile,"/data/logs/nginx/%$YEAR%-%$MONTH%-%$DAY%/%FROMHOST-IP%/%PROGRAMNAME%.log"\n$template ArtalkLogFile,"/data/logs/artalk/%$YEAR%-%$MONTH%-%$DAY%/%FROMHOST-IP%/%PROGRAMNAME%.log"\n:syslogtag,contains,"nginx" ?NginxLogFile\n& stop\n:syslogtag,contains,"artalk" ?ArtalkLogFile\n& stop\n'),a("em",[s._v(".info;mail.none;authpriv.none;cron.none                /var/log/messages\nauthpriv.")]),s._v("                                              /var/log/secure\nmail.*                                                  -/var/log/maillog\ncron.*                                                  /var/log/cron\n"),a("em",[s._v(".emerg                                                 :omusrmsg:")]),s._v("\nuucp,news.crit                                          /var/log/spooler\nlocal7.*                                                /var/log/boot.log")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\n收集的日志目录展示\n\n```bash\nlogs\n├── artalk\n│   └── 2024-06-05\n│       └── 103.152.133.13\n│           └── artalk-app2.log\n└── nginx\n    └── 2024-06-05\n        └── 103.152.133.13\n            └── nginx-app1.log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("blockquote",[a("blockquote",[a("blockquote",[a("blockquote",[a("blockquote",[a("blockquote",[a("blockquote",[a("p",[s._v("66a4eec5bf87769080cf8996acaf2b6e4bfe4840")])])])])])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);