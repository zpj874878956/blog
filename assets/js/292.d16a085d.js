(window.webpackJsonp=window.webpackJsonp||[]).push([[292],{644:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("记录下postgresql 12.3部署过程。")]),s._v(" "),a("h3",{attrs:{id:"安装postgresql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装postgresql"}},[s._v("#")]),s._v(" 安装postgresql")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装基础依赖")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo\nyum clean all "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" yum makecache fast\nyum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" systemd-devel bash-completion bash-completion-extras "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n               wxBase pgagent_11 gcc "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" perl-ExtUtils-Embed readline-devel "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n               zlib-devel pam-devel libxml2-devel libxslt-devel openldap-devel "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n               openssl-devel tcl-devel python-devel openssh-clients\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 内核优化")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注: kernel.shmmax的值取决于你的系统配置，我机器是16G内存，故设置为13958643712 B（13G）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/sysctl.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\nkernel.shmmax = 13958643712\nkernel.shmall = 4194304\nkernel.shmmni = 4096\nfs.file-max = 7672460\nnet.ipv4.ip_local_port_range = 1024 65000\nnet.core.rmem_default = 1048576\nnet.core.rmem_max = 4194304\nnet.core.wmem_default = 262144\nnet.core.wmem_max = 1048576\nkernel.sem = 50100 64128000 50100 1280\nEOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大可打开文件数及进程数等")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/security/limits.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n*               soft    nofile          65536\n*               hard    nofile          65536\n*               soft    nproc           65536\n*               hard    nproc           65536\n*               soft    memlock         unlimited\n*               hard    memlock         unlimited\nEOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建数据库运行用户及数据存放目录")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" postgres\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Y51KEBzU "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--stdin")]),s._v(" postgres\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /apps/usr/postgres/data\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装pgsql")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://mirrors.tuna.tsinghua.edu.cn/postgresql/source/v12.3/postgresql-12.3.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" https://mirrors.tuna.tsinghua.edu.cn/postgresql/source/v12.3/postgresql-12.3.tar.gz.md5 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" md5sum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tmp_dir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("mktemp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxf postgresql-12.3.tar.gz "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${tmp_dir}")]),s._v(" --strip-components"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${tmp_dir}")]),s._v("\n./configure "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/apps/usr/postgres "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --with-pgport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5432")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --with-systemd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --with-perl "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --with-tcl "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --with-python "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --with-openssl "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --with-pam "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --with-libxml "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --with-libxslt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --enable-thread-safety "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --with-wal-blocksize"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --with-blocksize"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\ngmake world "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" gmake install-world\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/profile "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EOF"\nexport PGPORT=5432\nexport PGDATA=/apps/usr/postgres/data\nexport PGHOME=/apps/usr/postgres\nexport PATH=$PGHOME/bin:$PATH\nexport LD_LIBRARY_PATH=$PGHOME/lib:$LD_LIBRARY_PATH\nexport MANPATH=$PGHOME/share/man:$MANPATH\nexport LANG=en_US.utf8\nEOF')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" postgres /apps/usr/postgres\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看sql版本")]),s._v("\n$ psql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\npsql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("PostgreSQL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])]),a("h3",{attrs:{id:"切换至postgres用户初始化数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#切换至postgres用户初始化数据库"}},[s._v("#")]),s._v(" 切换至postgres用户初始化数据库")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" - postgres\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置postgresql默认用户密码，使用openssl指令生成密码文件")]),s._v("\nopenssl rand "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-base64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cut")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("-15 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /home/postgres/.psqlpasswd\ninitdb "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" /apps/usr/postgres/data/ "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--pwfile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/postgres/.psqlpasswd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v(" md5\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --pwfile: 指定密码文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -A: 指定登录验证方式，默认为trust，表示无需密码即可登录到数据库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注：data目录可以不存在，但绝对不允许其目录下有数据，这样将会初始化失败。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("注: 若想添加为系统服务，使用systemctl指令来控制服务的启停，可以参考"),a("a",{attrs:{href:"https://www.postgresql.org/docs/12/server-start.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),a("OutboundLink")],1),s._v("。如下（个人觉得没必要配置）：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PostgreSQL database server\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Documentation")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("man:postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("notify\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("User")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("postgres\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/pgsql/bin/postgres "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" /usr/local/pgsql/data  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意这里替换为你的实际路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecReload")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/kill "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-HUP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MAINPID")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KillMode")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mixed\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KillSignal")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SIGINT\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TimeoutSec")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"启动前配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动前配置"}},[s._v("#")]),s._v(" 启动前配置")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /apps/usr/postgres/data\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" postgresql.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(",.bak"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 备份默认配置文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /apps/usr/postgres/data/postgresql.conf   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置文件如下")]),s._v("\n\nlisten_addresses "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# *表示监听所有地址")]),s._v("\nport "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5432")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听端口")]),s._v("\nmax_connections "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定最大连接数")]),s._v("\ntcp_keepalives_idle "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\ntcp_keepalives_interval "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\ntcp_keepalives_count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nshared_buffers "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 1GB   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置共享内存缓冲区的内存量，建议值为系统总内存的25％")]),s._v("\ntemp_buffers "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 80MB    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置用于每个数据库会话中的临时缓冲区的最大内存量")]),s._v("\nmax_files_per_process "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置允许每个服务器子进程同时打开的文件的最大数量。不能大于ulimt -n的数值")]),s._v("\nbgwriter_delay "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 100ms \nbgwriter_lru_maxpages "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nbgwriter_flush_after "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nsynchronous_commit "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" off\nwal_level "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" replica\narchive_mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" on\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以下路径替换为实际备份路径")]),s._v("\narchive_command "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test ! -f /apps/usr/postgres/backup/incre/%f && cp %p /apps/usr/postgres/backup/incre/%f'")]),s._v("\nfull_page_writes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" on\nwal_buffers "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v("\nwal_writer_delay "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 100ms\nwal_writer_flush_after "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 256kB\ncheckpoint_timeout "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 30min\nmax_wal_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 5GB\nmin_wal_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 1GB\nlog_destination "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'stderr'")]),s._v("\nlogging_collector "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" on\nlog_directory "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'logs'")]),s._v("\nlog_filename "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'postgresql-%Y-%m-%d_%H.log'")]),s._v("\nlog_file_mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 0640\nlog_rotation_age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 1d \nlog_rotation_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 100MB\nlog_truncate_on_rotation "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" off\nlog_min_messages "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" notice\nlog_min_error_statement "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" notice\nlog_min_duration_statement "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 3s\nlog_checkpoints "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" on\nlog_connections "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" on\nlog_error_verbosity "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" verbose\nlog_line_prefix "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%m '")]),s._v("\nlog_timezone "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'PRC'")]),s._v("\ntrack_activities "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" on\nlog_autovacuum_min_duration "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 3s \nautovacuum_max_workers "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nautovacuum_naptime "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 45s\nautovacuum_vacuum_scale_factor "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(" \nautovacuum_analyze_scale_factor "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("\nautovacuum_freeze_max_age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1600000000")]),s._v(" \nautovacuum_multixact_freeze_max_age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1600000000")]),s._v("\nvacuum_freeze_table_age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500000000")]),s._v("\nvacuum_multixact_freeze_table_age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500000000")]),s._v("\ndatestyle "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'iso, mdy'")]),s._v("\ntimezone "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'PRC'")]),s._v("\nlc_messages "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'en_US.utf8'")]),s._v("\nlc_monetary "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'en_US.utf8'")]),s._v("\nlc_numeric "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'en_US.utf8'")]),s._v("\nlc_time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'en_US.utf8'")]),s._v("\ndefault_text_search_config "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pg_catalog.english'")]),s._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /apps/usr/postgres/data/pg_hba.conf   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加访问权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("    all             all             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".20.5/24           md5\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br")])]),a("p",[s._v("关于配置文件的优化，可以参考"),a("a",{attrs:{href:"https://www.postgresql.org/docs/12/config-setting.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ pg_ctl start     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动数据库")]),s._v("\n$ ss "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-lnput")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5432")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确定端口在监听")]),s._v("\ntcp    LISTEN     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("       *:5432                  *:*                   users:"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"postgres"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31928")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\ntcp    LISTEN     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("      :::5432                 :::*                   users:"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"postgres"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31928")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问测试")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ~/.psqlpasswd     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看密码")]),s._v("\nS1w4ktZhUV\n$ psql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\nPassword "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user postgres:      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入查看到的密码")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("postgres")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# \\l    # 查看所有库")]),s._v("\n                                 List of databases\n   Name    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  Owner   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Encoding "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  Collate   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   Ctype    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   Access privileges   \n-----------+----------+----------+------------+------------+-----------------------\n postgres  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" postgres "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" UTF8     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" en_US.utf8 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" en_US.utf8 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" \n template0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" postgres "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" UTF8     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" en_US.utf8 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" en_US.utf8 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("c/postgres          +\n           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("postgres")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CTc/postgres\n template1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" postgres "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" UTF8     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" en_US.utf8 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" en_US.utf8 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("c/postgres          +\n           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("postgres")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CTc/postgres\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" rows"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h3",{attrs:{id:"调整linux大页面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调整linux大页面"}},[s._v("#")]),s._v(" 调整linux大页面")]),s._v(" "),a("p",[s._v("使用大的页面可以减少使用大量连续的内存块时的开销，尤其是当使用较大的shared_buffers值时。要在PostgreSQL中使用此功能，需要一个带有CONFIG_HUGETLBFS=y和的内核CONFIG_HUGETLB_PAGE=y。还必须调整内核设置vm.nr_hugepages。如果要估计所需的大页面数，请在未启用大页面的情况下启动PostgreSQL，然后进行一下操作:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pg_pid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v(" $PGDATA/postmaster.pid"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ pmap "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${pg_pid}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/rw-s/ && /zero/ {print $2}'")]),s._v("\n1140976K\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" ^Hugepagesize /proc/meminfo\nHugepagesize:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" kB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("计算: 1140976 / 2048 约等于 558 ，那么内核参数应配置如下:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vm.nr_hugepages=558"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/sysctl.conf \n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" Huge /proc/meminfo   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证大页面分配情况")]),s._v("\nAnonHugePages:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("61440")]),s._v(" kB\nHugePages_Total:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("558")]),s._v("\nHugePages_Free:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("558")]),s._v("\nHugePages_Rsvd:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nHugePages_Surp:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nHugepagesize:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" kB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("如果机器上的其他程序也需要大页面，则较大的设置将是适当的。")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("原文链接："),a("a",{attrs:{href:"https://lvjianzhao.gitee.io/lvjianzhao/posts/f5fe0ae1/",target:"_blank",rel:"noopener noreferrer"}},[s._v("pgsql实现免密登录 | Ray"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);