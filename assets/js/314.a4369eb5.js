(window.webpackJsonp=window.webpackJsonp||[]).push([[314],{667:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h3",{attrs:{id:"什么是ldap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是ldap"}},[t._v("#")]),t._v(" 什么是ldap")]),t._v(" "),a("p",[a("strong",[t._v("LDAP是轻量目录访问协议")]),t._v("，英文全称是"),a("strong",[t._v("Lightweight Directory Access Protocol")]),t._v("，一般都简称为LDAP。按照我们对文件目录的理解，ldap可以看成一个文件系统，类似目录和文件树。")]),t._v(" "),a("h3",{attrs:{id:"ldap的软件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ldap的软件"}},[t._v("#")]),t._v(" ldap的软件")]),t._v(" "),a("p",[t._v("ldap并不是一款软件，而是一个协议。")]),t._v(" "),a("p",[t._v("现在市场上有关LDAP的产品已有很多，各大软件公司都在他们的产品中集成了LDAP服务，如Microsoft的ActiveDirectory、Lotus的Domino Directory、IBM的WebSphere中也集成了LDAP服务。LDAP的开源实现是OpenLDAP，它比商业产品一点也不差，而且源码开放。")]),t._v(" "),a("p",[a("strong",[t._v("OpenLDAP")]),t._v(" 是最常用的目录服务之一，它是一个由开源社区及志愿者开发和管理的一个开源项目，"),a("strong",[t._v("提供了目录服务的所有功能，包括目录搜索、身份认证、安全通道、过滤器")]),t._v("等等。大多数的 Linux 发行版里面都带有 OpenLDAP 的安装包。OpenLDAP 服务默认使用非加密的 TCP/IP 协议来接收服务的请求，并将查询结果传回到客户端。由于大多数目录服务都是用于系统的安全认证部分比如：用户登录和身份验证，所以它也支持使用基于 SSL/TLS 的加密协议来保证数据传送的保密性和完整性。OpenLDAP 是使用 OpenSSL 来实现 SSL/TLS 加密通信的。")]),t._v(" "),a("h3",{attrs:{id:"ldap的信息模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ldap的信息模型"}},[t._v("#")]),t._v(" ldap的信息模型")]),t._v(" "),a("p",[t._v("【重要部分】")]),t._v(" "),a("p",[t._v('LDAP的信息模型是建立在"条目"（entries）的基础上。一个条目是一些属性的集合，并且具有一个'),a("strong",[t._v('全局唯一的"可区分名称"D')]),t._v('N，一个条目可以通过DN来引用。每一个条目的属性具有一个类型和一个或者多个值。类型通常是容易记忆的名称，比如"cn"是通用名称（common name） ，或者"mail"是电子邮件地址。条目的值的语法取决于属性类型。比如，cn属性可能具有一个值"Babs Jensen" 。一个mail属性可能包含"bbs@kevin.com" 。一个jpegphoto属性可能包含一幅JPEG（二进制）格式的图片。')]),t._v(" "),a("p",[a("strong",[t._v("LDAP的objectClass")])]),t._v(" "),a("p",[t._v("LDAP通过属性objectClass来控制哪一个属性必须出现或允许出现在一个条目中，它的值决定了该条目必须遵守的模式"),a("br"),t._v("\n规则。可以理解为关系数据库的表结构。接下来会用到的objectClass有")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("objectClass")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("olcGlobal")]),t._v(" "),a("td",[t._v("全局配置文件类型， 主要是cn=config.ldif 的配置项")])]),t._v(" "),a("tr",[a("td",[t._v("top")]),t._v(" "),a("td",[t._v("顶层的对象")])]),t._v(" "),a("tr",[a("td",[t._v("organization")]),t._v(" "),a("td",[t._v("组织，比如公司名称，顶层的对象")])]),t._v(" "),a("tr",[a("td",[t._v("organizationalUnit")]),t._v(" "),a("td",[t._v("重要， 一个目录节点，通常是group，或者部门这样的含义")])]),t._v(" "),a("tr",[a("td",[t._v("inetOrgPerson")]),t._v(" "),a("td",[t._v("重要， 我们真正的用户节点类型，person类型， 叶子节点")])]),t._v(" "),a("tr",[a("td",[t._v("groupOfNames")]),t._v(" "),a("td",[t._v("重要， 分组的group类型，标记一个group节点")])]),t._v(" "),a("tr",[a("td",[t._v("olcModuleList")]),t._v(" "),a("td",[t._v("配置模块的对象")])])])]),t._v(" "),a("p",[a("strong",[t._v("LDAP常用关键字列表")])]),t._v(" "),a("p",[t._v("ldap的entry是由各种字段构成，可以理解为关系数据库的字段。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("关键字")]),t._v(" "),a("th",[t._v("英文全称")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("dc")]),t._v(" "),a("td",[t._v("Domain Component")]),t._v(" "),a("td",[t._v("域名的部分，其格式是将完整的域名分成几部分，如域名为example.com变成dc=example,dc=com")])]),t._v(" "),a("tr",[a("td",[t._v("uid")]),t._v(" "),a("td",[t._v("User Id")]),t._v(" "),a("td",[t._v("用户ID，如“tom”")])]),t._v(" "),a("tr",[a("td",[t._v("ou")]),t._v(" "),a("td",[t._v("Organization Unit")]),t._v(" "),a("td",[t._v("组织单位，类似于Linux文件系统中的子目录，它是一个容器对象，组织单位可以包含其他各种对象（包括其他组织单元），如“market”")])]),t._v(" "),a("tr",[a("td",[t._v("cn")]),t._v(" "),a("td",[t._v("Common Name")]),t._v(" "),a("td",[t._v("公共名称，如“Thomas Johansson”")])]),t._v(" "),a("tr",[a("td",[t._v("sn")]),t._v(" "),a("td",[t._v("Surname")]),t._v(" "),a("td",[t._v("姓，如“Johansson”")])]),t._v(" "),a("tr",[a("td",[t._v("dn")]),t._v(" "),a("td",[t._v("Distinguished Name")]),t._v(" "),a("td",[t._v("惟一辨别名，类似于Linux文件系统中的绝对路径，每个对象都有一个惟一的名称，如“uid= tom,ou=market,dc=example,dc=com”，在一个目录树中DN总是惟一的")])]),t._v(" "),a("tr",[a("td",[t._v("rdn")]),t._v(" "),a("td",[t._v("Relative dn")]),t._v(" "),a("td",[t._v("相对辨别名，类似于文件系统中的相对路径，它是与目录树结构无关的部分，如“uid=tom”或“cn= Thomas Johansson”")])]),t._v(" "),a("tr",[a("td",[t._v("c")]),t._v(" "),a("td",[t._v("Country")]),t._v(" "),a("td",[t._v("国家，如“CN”或“US”等。")])]),t._v(" "),a("tr",[a("td",[t._v("o")]),t._v(" "),a("td",[t._v("Organization")]),t._v(" "),a("td",[t._v("组织名，如“Example, Inc.”")])])])]),t._v(" "),a("p",[t._v("这里，我们把dn当做用户唯一主键， cn是common name,应该等同于用户名，因为用户名必须唯一，通常为邮箱前缀"),a("br"),t._v("\n，比如ryan.miao. sn作为姓氏， uid作为用户id。通常用户id也是唯一的。所以在使用ldap做认证的时候，"),a("br"),t._v("\n大概逻辑如下：")]),t._v(" "),a("ul",[a("li",[t._v("配置ldap host, admin, admin pass")]),t._v(" "),a("li",[t._v("用户登录时传递username")]),t._v(" "),a("li",[t._v("读取配置的ldap信息，查询cn或者uid等于username的数据")]),t._v(" "),a("li",[t._v("取出第一个记录， 获得dn， 根据dn和password再次去ldap服务器认证。即我们必须保证cn或uid是全局唯一的，"),a("br"),t._v("\n认证通常需要进行两次。原因就在于dn没办法根据用户名计算出来。")])]),t._v(" "),a("p",[t._v("一个ldap用户组织可能是这样的：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/05/5f94e33412256cdc.png",alt:"5f94e33412256cdc.png"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/05/2fbc00ddd2f18cd7.jpg",alt:"2fbc00ddd2f18cd7.jpg"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/05/ee22e4946a2c7ea6.png",alt:"ee22e4946a2c7ea6.png"}})]),t._v(" "),a("h3",{attrs:{id:"ldap使用docker-compose安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ldap使用docker-compose安装"}},[t._v("#")]),t._v(" ldap使用docker compose安装")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("version: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),t._v("\nservices:\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.安装openldap")]),t._v("\n  openldap:\n    container_name: openldap\n    image: docker.mirrors.sjtug.sjtu.edu.cn/osixia/openldap:1.4.0\n    restart: always\n    environment:\n      LDAP_ORGANISATION: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9quant openldap"')]),t._v("\n      LDAP_DOMAIN: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9quant.com"')]),t._v("\n      LDAP_ADMIN_PASSWORD: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123456"')]),t._v("\n      LDAP_CONFIG_PASSWORD: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123456"')]),t._v("\n    volumes:\n      - /data/openldap/data:/var/lib/ldap\n      - /data/openldap/slapd.d:/etc/ldap/slapd.d\n    ports:\n      - "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'389:389'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.安装phpldapadmin")]),t._v("\n  phpldapadmin:\n    container_name: phpldapadmin\n    image: docker.mirrors.sjtug.sjtu.edu.cn/osixia/phpldapadmin:0.9.0\n    restart: always\n    environment:\n      PHPLDAPADMIN_HTTPS: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n      PHPLDAPADMIN_LDAP_HOSTS: openldap\n    ports:\n      - "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'30004:80'")]),t._v("\n    depends_on:\n      - openldap\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);