(window.webpackJsonp=window.webpackJsonp||[]).push([[362],{715:function(s,a,t){"use strict";t.r(a);var e=t(0),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("Prometheus 是一个开源监控系统，通过设置警报规则来实现对指标变化的监控。要在 Prometheus 中设置一个表达式值变动 50% 触发告警，你需要创建一个 alert 规则。")]),s._v(" "),a("p",[s._v("假设你要监控的指标是 "),a("code",[s._v("example_metric")]),s._v("，可以使用以下方法创建告警规则：")]),s._v(" "),a("ol",[a("li",[s._v("首先，在 Prometheus 的配置文件（通常是 "),a("code",[s._v("prometheus.yml")]),s._v("）中，为 alert 规则创建一个规则文件的路径。例如：")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule_files")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alert_rules.yml"')]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("接下来，在 "),a("code",[s._v("alert_rules.yml")]),s._v(" 文件中定义告警规则。这里我们需要用到 "),a("code",[s._v("abs")]),s._v(" 和 "),a("code",[s._v("rate")]),s._v(" 函数，以便计算指标值的变动百分比：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("groups:\n- name: example_alerts\n  rules:\n  - alert: ExampleMetricChange\n    expr: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n      abs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("example_metric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" - rate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("example_metric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" / rate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("example_metric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),s._v("\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n      summary: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Example metric changed more than 50% in the last 5 minutes"')]),s._v("\n      description: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Example metric has changed by more than 50% in the last 5 minutes (current value: {{ '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$value")]),s._v(' }})."')]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("在这个示例中，我们使用了 "),a("code",[s._v("rate")]),s._v(" 函数来计算 "),a("code",[s._v("example_metric")]),s._v(" 在 5 分钟和 10 分钟滚动窗口内的变化速率。然后我们计算了这两个速率之间的差值，并将其除以 10 分钟内的速率来计算百分比变化。最后，我们使用 "),a("code",[s._v("abs")]),s._v(" 函数确保结果是一个正数。")]),s._v(" "),a("p",[s._v("如果表达式值变动超过 50%，则告警将在 5 分钟内持续触发。告警的标签和注释可以根据需要进行修改。")]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("保存并重新加载 Prometheus 配置，以使更改生效。")])]),s._v(" "),a("p",[s._v("现在，当 "),a("code",[s._v("example_metric")]),s._v(" 的值在 5 分钟内变动超过 50% 时，Prometheus 将触发一个告警。你可以根据需要配置告警的接收器，例如使用 Alertmanager。")])])}),[],!1,null,null,null);a.default=n.exports}}]);