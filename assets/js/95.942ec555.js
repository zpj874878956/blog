(window.webpackJsonp=window.webpackJsonp||[]).push([[95],{448:function(a,s,e){"use strict";e.r(s);var t=e(0),r=Object(t.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h3",{attrs:{id:"一、harbor开启支持helm-chart"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、harbor开启支持helm-chart"}},[a._v("#")]),a._v(" 一、harbor开启支持helm chart")]),a._v(" "),s("p",[a._v("1、修改harbor配置文件")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" harbor.yml\nchart:\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Change the value of absolute_url to enabled can enable absolute url in chart")]),a._v("\n  absolute_url: enabled\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("2、停止harbor服务")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" stop\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("3、注入配置")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost harbor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ./prepare ")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("4、安装chartmuseum")]),a._v(" "),s("p",[a._v("在执行install.sh安装脚本时，通过--with-chartmuseum参数安装chart插件。")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost harbor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ./install.sh  --with-notary --with-trivy --with-chartmuseum")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("5、验证")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/06/edcee6f2922e01f0.jpg",alt:"edcee6f2922e01f0.jpg"}})]),a._v(" "),s("h3",{attrs:{id:"二、添加harbor作为chart仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、添加harbor作为chart仓库"}},[a._v("#")]),a._v(" 二、添加harbor作为chart仓库")]),a._v(" "),s("p",[a._v("添加的命令")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@k8s-master01 repo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# helm repo add --username=admin --password=xxxxxxxx 1quant_harbor https://xxxxx:8443/chartrepo/library")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("查看验证")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("[root@k8s-master01 ~]# helm repo list\nNAME            URL                                                   \n1quant_harbor   https://xxxx:8443/chartrepo/library           \naliyun          https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts\n")])])]),s("p",[a._v("三、推送和拉取chart")]),a._v(" "),s("p",[a._v("Helm 要想推送 Chart 到 Helm 仓库，需要提前安装上传插件：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("helm plugin "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" https://github.com/chartmuseum/helm-push\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#或者离线安装")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /root/.local/share/helm/plugins/helm-push\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" helm-push_0.9.0_linux_amd64.tar.gz /root/.local/share/helm/plugins/helm-push\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" zxvf /root/.local/share/helm/plugins/helm-push/helm-push_0.9.0_linux_amd64.tar.gz\nhelm plugin list "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[a._v("创建项目并推送chart到harbor")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 然后创建一个测试的 Chart 进行推送测试：")]),a._v("\nhelm create hello-helm\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 打包chart，将chart打包成tgz格式")]),a._v("\nhelm package hello-helm\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#推送")]),a._v("\nhelm cm-push hello-helm-0.1.0.tgz "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("admin "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("xxxxx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#拉取")]),a._v("\nhelm pull "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("admin "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("xxxx 1quant_harbor/hello-helm\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装")]),a._v("\nhelm "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" test-helm "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("admin "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("xxxxx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.1")]),a._v(".0 1quant_harbor/hello-helm\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br")])]),s("p",[a._v("注意事项")]),a._v(" "),s("p",[a._v("在 Harbor 2.0 版本中，存储库仓库是不支持直接更新索引文件的。相比于传统的 Helm Chart 仓库，Harbor 更专注于容器镜像的存储和分发，因此在 Harbor 中并没有直接支持索引文件的更新功能。")]),a._v(" "),s("p",[a._v("如果你需要更新存储在 Harbor 中的 Helm Chart，可以通过以下方式来实现：")]),a._v(" "),s("ol",[s("li",[s("p",[s("strong",[a._v("重新上传 Helm Chart")]),a._v(": 首先，你需要在本地重新构建或修改 Helm Chart，并生成一个新的 "),s("code",[a._v(".tgz")]),a._v(" 文件。然后，使用 "),s("code",[a._v("helm push")]),a._v(" 命令将新的 Helm Chart 上传到 Harbor 中。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("helm push mychart-1.0.0.tgz my-repo\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("其中，"),s("code",[a._v("mychart-1.0.0.tgz")]),a._v(" 是新生成的 Helm Chart 文件，"),s("code",[a._v("my-repo")]),a._v(" 是你在 Helm 中配置的 Harbor 存储库名称。")])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("更新存储库")]),a._v(": 上传新的 Helm Chart 后，你需要更新 Helm 存储库的索引文件。在本地执行以下命令：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("helm repo update\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("这将从存储库中下载最新的索引文件，以使 Helm 可以获取到最新的可用 Chart。")])])]),a._v(" "),s("p",[a._v("需要注意的是，由于 Harbor 主要用于容器镜像管理，而不是传统的 Helm Chart 仓库，因此在更新 Helm Chart 时需要手动重新上传并更新索引文件。")])])}),[],!1,null,null,null);s.default=r.exports}}]);