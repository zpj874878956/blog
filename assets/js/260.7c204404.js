(window.webpackJsonp=window.webpackJsonp||[]).push([[260],{614:function(s,n,a){"use strict";a.r(n);var e=a(0),r=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"代理服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代理服务器"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("代理服务器")]),s._v(" "),n("p",[s._v("：Proxy Server ，用于代替一个主机与其它主机进行通信。")]),s._v(" "),n("ul",[n("li",[s._v("工作在会话层，代理应用层的消息。")]),s._v(" "),n("li",[s._v("按协议分类：\n"),n("ul",[n("li",[s._v("SSH 代理")]),s._v(" "),n("li",[s._v("FTP 代理")]),s._v(" "),n("li",[s._v("HTTP 代理")]),s._v(" "),n("li",[s._v("HTTPS 代理")]),s._v(" "),n("li",[s._v("SOCKS 代理：全称为 SOCKetS ，工作在应用层与传输层之间，比 HTTP 代理更底层、更快。\n"),n("ul",[n("li",[s._v("SOCKS4 只支持 TCP 连接，而 SOCKS5 还支持 UDP 连接、密码认证。")]),s._v(" "),n("li",[s._v("FTP、HTTP、SOCKS 代理都是明文通信，而 SSH、HTTPS、shadowsocks 代理是加密通信。")])])])])]),s._v(" "),n("li",[s._v("按代理反向分类：\n"),n("ul",[n("li",[s._v("正向代理 ：侧重于代替客户端，向服务器发出访问请求。")]),s._v(" "),n("li",[s._v("反向代理 ：侧重于代替服务器，接收客户端的访问请求。")])])]),s._v(" "),n("li",[s._v("用途：\n"),n("ul",[n("li",[s._v("可以使客户端访问到某些代理服务器才能访问的网络，像 VPN 的功能。")]),s._v(" "),n("li",[s._v("可以担任防火墙，过滤客户端发送、接收的数据。")]),s._v(" "),n("li",[s._v("可以动态更改将客户端的流量转发到哪个服务器，比如实现负载均衡。")]),s._v(" "),n("li",[s._v("可以隔离服务器与客户端，使得服务器不知道客户端的真实 IP 、客户端不知道服务器的真实 IP 。")])])]),s._v(" "),n("li",[s._v("缺点：\n"),n("ul",[n("li",[s._v("客户端的通信数据都要经过代理服务器，可能被监听、篡改。")])])])]),s._v(" "),n("h3",{attrs:{id:"squid"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#squid"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#squid",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("Squid")]),s._v(" "),n("p",[s._v("：一个代理服务器，采用 C++ 开发。")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://www.squid-cache.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网(opens new window)"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("支持 FTP、HTTP、HTTPS 代理协议。")]),s._v(" "),n("li",[s._v("常用作简单的 HTTP 正向代理服务器。")]),s._v(" "),n("li",[s._v("也可用于反向代理，缓存 HTTP 服务器的响应报文，但比 Nginx 的功能少。")])]),s._v(" "),n("h4",{attrs:{id:"部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E9%83%A8%E7%BD%B2",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("部署")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("用 yum 安装：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("yum install squid\nsystemctl start squid\nsystemctl enable squid\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("或者用 docker-compose 部署：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("version: '3'\n\nservices:\n  squid:\n    container_name: squid\n    image: sameersbn/squid:3.5.27-2\n    restart: unless-stopped\n    ports:\n      - 3128:3128\n    volumes:\n      - ./conf:/etc/squid/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])])])]),s._v(" "),n("h4",{attrs:{id:"配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("配置")]),s._v(" "),n("p",[s._v("用 yum 安装 Squid 时，开启正向代理的步骤：")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("编辑配置文件 "),n("code",[s._v("/etc/squid/squid.conf")]),s._v(" ：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("http_port 3128\n\n# 定义一个 acl 组，名为 local_ip ，指向源 IP 为 10.0.0.1/24 的流量\n# acl local_ip src 10.0.0.1/24\n\n# 定义一个 acl 组，用密码文件进行身份认证\nauth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwd\nacl auth_user proxy_auth REQUIRED\n\n# 允许指定 acl 组的流量\n# http_access allow local_ip\nhttp_access allow auth_user\n# 禁止剩下的所有流量\nhttp_access deny all\n\n# 不缓存所有响应报文\ncache deny all\n\n# 默认会在 HTTP 请求 Headers 中加入 X-Forwarded-For ，声明客户端的真实 IP 。这里删除该 Header\nforwarded_for delete\n\n# 记录访问日志\naccess_log /var/log/squid/access.log squid\n# 每隔 30 天翻转一次日志\nlogfile_rotate 30\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("生成密码文件：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("yum install httpd-tools\nhtpasswd -cb /etc/squid/passwd leo ******\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("测试使用该代理：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("systemctl restart squid\ncurl -x http://leo:******@127.0.0.1:3128 cip.cc\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])])]),s._v(" "),n("h3",{attrs:{id:"socks5"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#socks5"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#socks5",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("SOCKS5")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("用 docker-compose 部署一个 SOCKS5 服务器：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("version: '3'\n\nservices:\n  socks5:\n    container_name: socks5\n    image: serjs/go-socks5-proxy\n    restart: unless-stopped\n    environment:\n      PROXY_USER: root\n      PROXY_PASSWORD: ******\n    ports:\n      - 1080:1080\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("ul",[n("li",[s._v("该镜像采用 Golang 开发，详见"),n("a",{attrs:{href:"https://github.com/serjs/socks5-server",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档 (opens new window)"),n("OutboundLink")],1),s._v("。")])])])]),s._v(" "),n("h3",{attrs:{id:"shadowsocks"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#shadowsocks"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#shadowsocks",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("Shadowsocks")]),s._v(" "),n("p",[s._v("：一种基于 SOCKS5 协议的代理协议，简称为 ss ，常用于实现 VPN 。")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://shadowsocks.org/guide/what-is-shadowsocks.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档(opens new window)"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("支持设置密码、加密传输数据。")]),s._v(" "),n("li",[s._v("原理：\n"),n("ol",[n("li",[s._v("在一台主机上运行 ss 服务器。")]),s._v(" "),n("li",[s._v("在本机运行 ss 客户端，将本机的流量发送到 ss 服务器，被它代理转发。")])])]),s._v(" "),n("li",[s._v("ShadowsocksR ：简称为 SSR ，是 shadowsocks 的分叉项目。")])]),s._v(" "),n("h4",{attrs:{id:"shadowsocks-libev"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#shadowsocks-libev"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#shadowsocks-libev",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("Shadowsocks-libev")]),s._v(" "),n("p",[s._v("：一个 ss 代理服务器软件。")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("于 2015 年发布，采用 C 语言开发，于 2020 年停止更新。")])]),s._v(" "),n("li",[n("p",[s._v("支持 AEAD Cipher 加密算法。")])]),s._v(" "),n("li",[n("p",[s._v("支持 Obfs 混淆，可以将 ss 流量伪装成 http 流量。")])]),s._v(" "),n("li",[n("p",[s._v("用 Docker 部署服务器：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker run -d --name shadowsocks \\\n        --restart unless-stopped \\\n        -p 8388:8388 \\\n        shadowsocks/shadowsocks-libev:v3.3.5 \\\n        ss-server -s 0.0.0.0 -k ****** -m aes-256-gcm\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("服务器的命令：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ss-server               # 启动服务器\n        -c config.json  # 使用指定的配置文件\n        -s 0.0.0.0      # 设置服务器监听的 IP\n        -p 8388         # 设置服务器监听的端口\n        -k ******       # 设置服务器的认证密码\n        -m aes-256-gcm  # 设置服务器的加密方式\n        -v              # 显示详细日志\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])])])]),s._v(" "),n("h4",{attrs:{id:"shadowsocks-rust"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#shadowsocks-rust"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#shadowsocks-rust",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("Shadowsocks-rust")]),s._v(" "),n("p",[s._v("：一个 ss 代理服务器软件。")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("用 Docker 部署服务器：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker run -d --name ssserver-rust \\\n        --restart unless-stopped \\\n        -p 8388:8388 \\\n        -v /root/shadowsocks-rust/config.json:/etc/shadowsocks-rust/config.json \\\n        ghcr.io/shadowsocks/ssserver-rust:v1.14.3\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("配置文件示例：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('{\n    "server": "0.0.0.0",\n    "server_port": 8388,\n    "password": "******",\n    "method": "chacha20-ietf-poly1305",\n    "fast_open": false\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])])])]),s._v(" "),n("h4",{attrs:{id:"客户端"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#客户端"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E5%AE%A2%E6%88%B7%E7%AB%AF",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("客户端")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/shadowsocks/shadowsocks-windows/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("Windows 版 ss 客户端 (opens new window)"),n("OutboundLink")],1),s._v("：")]),s._v(" "),n("ul",[n("li",[s._v("运行 ss 客户端之后，它会连接到 ss 服务器，同时在本机监听一个代理端口。")]),s._v(" "),n("li",[s._v("本机的进程可以通过 HTTP、Socket 代理协议，将数据发送到该代理端口，然后 ss 客户端会将这些数据转发到 ss 服务器，实现正向代理。")]),s._v(" "),n("li",[s._v("也可以开启 ss 客户端的全局模式，代理本机的所有流量。")])]),s._v(" "),n("p",[s._v("Linux 版 ss 客户端 ：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("它是一个命令行工具，功能较少，不能连接多个 ss 服务器，在本机提供的代理端口只支持 Socket 协议。")])]),s._v(" "),n("li",[n("p",[s._v("部署示例：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 安装\npip3 install shadowsocks\n\n# 编辑配置文件\ncat > ss.json <<EOF{    "server": "10.0.0.1",    "server_port": 8388,    "local_address": "127.0.0.1",    "local_port": 8388,    "password": "******",    "timeout": 5,    "method": "aes-256-cfb"}EOF\n\n# 启动客户端\nsslocal -c ss.json -d start\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("一个 sslocal 客户端只能连接一个 ss 服务器。")])]),s._v(" "),n("li",[n("p",[s._v("可以再运行代理服务器 privoxy ，监听一个 HTTP 代理端口，将该端口的流量转发到 Socket 代理端口。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 安装\nyum install -y privoxy\nsystemctl start privoxy\nsystemctl enable privoxy\n\n# 编辑配置文件\nsed '/listen-address  127.0.0.1:8118/d' /etc/privoxy/config -i\ncat >> /etc/privoxy/config <<EOFlisten-address  0.0.0.0:8118# 将 HTTP 请求转发到该代理forward-socks5  /   127.0.0.1:8388 .# 第一个字段为 url_pattern ，取值为 / 则匹配所有 HTTP 请求# 第二、三个字段为代理、父级代理，取值为 . 则表示忽略# 不代理这些 HTTP 请求forward         10.*.*.*/      .forward         127.*.*.*/     .forward         172.16.*.*/    .forward         192.168.*.*/   .EOF\n\n# 重启\nsystemctl restart privoxy\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("试用该代理：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("curl -x 127.0.0.1:8118 google.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])]),s._v(" "),n("h3",{attrs:{id:"v2ray"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#v2ray"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#v2ray",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("V2Ray")]),s._v(" "),n("p",[s._v("：一个代理服务器，比 ss 的功能更多。")]),s._v(" "),n("ul",[n("li",[n("p",[n("a",{attrs:{href:"https://github.com/v2fly/v2ray-core",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub(opens new window)"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[s._v("于 2019 年发布，采用 Goalng 语言开发。是 Project V 社区研发的主要软件，后来改名为 v2fly 。")])]),s._v(" "),n("li",[n("p",[s._v("V2Ray 服务器的流量分为两个方向：")]),s._v(" "),n("ul",[n("li",[s._v("inbounds ：入站流量，即客户端发送到 V2Ray 的流量。\n"),n("ul",[n("li",[s._v("客户端可使用 V2Ray 原创的 VMess 代理协议，也兼容 HTTP、Shadowsocks 等代理协议。")])])]),s._v(" "),n("li",[s._v("outbounds ：出站流量，即 V2Ray 将客户端的流量转发到某个网站。")])])]),s._v(" "),n("li",[n("p",[s._v("用 Docker 部署服务器：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker run -d --name v2fly \\\n        --restart unless-stopped \\\n        -v /root/v2fly/config.json:/etc/v2fly/config.json \\\n        -p 80:80 \\\n        v2fly/v2fly-core:v5.1.0 \\\n        run -c /etc/v2fly/config.json\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("配置文件示例：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('{\n  "inbounds": [{\n    "port": 80,\n    "protocol": "vmess",\n    "settings": {\n      // 只允许这些 id 的客户端连接\n      "clients": [{ "id": "******" }]\n    }\n  }],\n  "outbounds": [{\n    "protocol": "freedom",\n    "settings": {}\n  }]\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("在 Windows 上常用的客户端软件是 "),n("a",{attrs:{href:"https://github.com/2dust/v2rayN",target:"_blank",rel:"noopener noreferrer"}},[s._v("v2rayN (opens new window)"),n("OutboundLink")],1),s._v("。")])])]),s._v(" "),n("h3",{attrs:{id:"trojan"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#trojan"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#trojan",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("Trojan")]),s._v(" "),n("p",[s._v("：一个代理服务器。能加密通信，并伪装成互联网常见的 HTTPS 流量。")]),s._v(" "),n("ul",[n("li",[s._v("于 2019 年发布，采用 C++ 语言开发。")])]),s._v(" "),n("h2",{attrs:{id:"代理客户端"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代理客户端"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E4%BB%A3%E7%90%86%E5%AE%A2%E6%88%B7%E7%AB%AF",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("代理客户端")]),s._v(" "),n("ul",[n("li",[s._v("有的程序不支持使用代理，有的程序只支持使用 HTTP 等简单的代理协议。因此建议安装一个专用的代理客户端，通过两种方式代理其它程序的流量：\n"),n("ul",[n("li",[s._v("透明代理（Transparent proxy）：\n"),n("ul",[n("li",[s._v("拦截其它程序发出的流量，转发到代理服务器。其它程序不会感知到代理，不需要主动使用代理。")])])]),s._v(" "),n("li",[s._v("转换代理协议：\n"),n("ul",[n("li",[s._v("通过某种代理协议连接到代理服务器，再在本机监听一个采用 HTTP 等简单代理协议的端口，将该端口收到的流量转发到代理服务器。")]),s._v(" "),n("li",[s._v("此时，具有代理功能的程序，一般都能通过该端口使用代理。但没有代理功能的程序，依然不能使用代理。")])])])])])]),s._v(" "),n("h3",{attrs:{id:"proxifier"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#proxifier"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#proxifier",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("Proxifier")]),s._v(" "),n("p",[s._v("：一个 GUI 工具，用作代理客户端，收费。")]),s._v(" "),n("ul",[n("li",[s._v("特点：\n"),n("ul",[n("li",[s._v("支持 Windows、MacOS 系统，不支持 Linux 。")]),s._v(" "),n("li",[s._v("支持 HTTP、HTTPS、SOCKS4、SOCKS5 代理协议。")]),s._v(" "),n("li",[s._v("支持透明代理。原理如下：\n"),n("ul",[n("li",[s._v("Windows 系统上，一般程序需要调用 Winsock API 进行 Socket 通信。")]),s._v(" "),n("li",[s._v("Winsock 提供了 LSP（Layered Service Provider） 功能：允许程序自定义一个 LSP DLL 库，在一般程序调用 Winsock API 时被加载，从而可以劫持其流量。")])])]),s._v(" "),n("li",[s._v("支持灵活的代理规则：将某个程序发向某 IP:Port 的 TCP 包，转发到某个代理服务器。支持通配符。")]),s._v(" "),n("li",[s._v("支持用多个代理服务器组成代理链。")])])]),s._v(" "),n("li",[s._v("用法：\n"),n("ol",[n("li",[s._v("安装 Proxifier 并启动。")]),s._v(" "),n("li",[s._v("添加代理服务器。")]),s._v(" "),n("li",[s._v("添加代理规则。")]),s._v(" "),n("li",[s._v("保持 Proxifier 运行，即可代理本机程序的流量。")])])])]),s._v(" "),n("h3",{attrs:{id:"proxychains"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#proxychains"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#proxychains",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("ProxyChains")]),s._v(" "),n("p",[s._v("：一个 Unix 系统的命令行工具，采用 C 语言开发，用作代理客户端。")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/rofl0r/proxychains-ng",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub(opens new window)"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("支持透明代理。原理如下：\n"),n("ol",[n("li",[s._v("声明环境变量 LD_PRELOAD ，让程序在导入 DLL 库时，优先导入 libproxychains4.so 库。")]),s._v(" "),n("li",[s._v("在 libproxychains4.so 库中，重写关于 Socket 通信的函数，将程序发出的 TCP 流量转发到代理服务器。")])])]),s._v(" "),n("li",[s._v("缺点：\n"),n("ul",[n("li",[s._v("只能代理 TCP 流量，不支持 UDP、ICMP 。")]),s._v(" "),n("li",[s._v("只能代理指定的程序，不能代理系统所有进程。")]),s._v(" "),n("li",[s._v("只能代理采用动态链接库的程序。\n"),n("ul",[n("li",[s._v("Chrome 浏览器在沙盒中运行网页，也不会被代理。")])])])])])]),s._v(" "),n("p",[s._v("用法：")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("安装：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("wget https://github.com/rofl0r/proxychains-ng/archive/refs/tags/v4.14.tar.gz\ntar -zxvf v4.14.tar.gz\ncd proxychains-ng-4.14\n./configure --prefix=/usr --sysconfdir=/etc\nmake\nmake install\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("编辑配置文件 /etc/proxychains.conf ，示例：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("quiet_mode          # 安静模式，运行时不输出过程信息\ndynamic_chain       # 自动选用 ProxyList 中可用的代理，且按顺序\nproxy_dns           # 将 DNS 请求也代理\n\n# 取消代理发向指定 IP 的数据包\nlocalnet 127.0.0.0/255.0.0.0\nlocalnet 10.0.0.0/255.0.0.0\nlocalnet 172.16.0.0/255.240.0.0\nlocalnet 192.168.0.0/255.255.0.0\n\n# 发送数据包时，修改目标 IP:Port\ndnat 1.1.1.1:80  1.1.1.2:443\ndnat 1.1.1.1:443 1.1.1.2\ndnat 1.1.1.1     1.1.1.2\n\n# 声明一组代理服务器，支持 HTTP、SOCKS4、SOCKS5 代理协议，支持设置账号密码\n[ProxyList]\nhttp    127.0.0.1   3128\nsocks5  127.0.0.1   1080  root  ******\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("执行命令：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("proxychains4 curl cip.cc  # 在代理下执行一条命令\nproxychains4 bash         # 创建一个 shell ，在其中执行的命令都采用代理\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])])]),s._v(" "),n("h3",{attrs:{id:"redsocks"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redsocks"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#redsocks",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("redsocks")]),s._v(" "),n("p",[s._v("：一个 Linux 系统的命令行工具，采用 C 语言开发，用作代理客户端。")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/darkk/redsocks",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub(opens new window)"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("支持透明代理。原理如下：\n"),n("ol",[n("li",[s._v("redsocks 连接到代理服务器，并在本机监听一个端口，将该端口收到的流量转发到代理服务器。")]),s._v(" "),n("li",[s._v("用户手动配置 iptables 防火墙规则，将本机发出的 TCP 流量重定向到 redsocks 端口。")])])]),s._v(" "),n("li",[s._v("缺点：\n"),n("ul",[n("li",[s._v("需要手动配置 iptables 规则，比较麻烦。")]),s._v(" "),n("li",[s._v("有些程序可能无视 iptables 规则。")])])])]),s._v(" "),n("p",[s._v("用法：")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("用 apt 安装：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("apt install redsocks\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("或者手动编译后安装：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("git clone https://github.com/darkk/redsocks\ncd redsocks\nmake\ncp redsocks /usr/bin/redsocks\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("编辑配置文件 /etc/redsocks.conf ，示例：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('base {\n   log_debug  = off;\n   log_info   = on;\n   log        = stderr;    # 日志的保存位置，可改为 "file:/var/log/redsocks.log" 文件\n   daemon     = on;\n   redirector = iptables;\n}\n\nredsocks {\n   // 在本机监听的端口\n   local_ip   = 127.0.0.1;\n   local_port = 12345;\n\n   // 要连接的代理服务器\n   ip       = 10.0.0.1;\n   port     = 1080;\n   type     = socks5;\n   login    = <username>;\n   password = <password>;\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("ul",[n("li",[s._v("可以定义多个 redsocks{} 代理配置。")])])]),s._v(" "),n("li",[n("p",[s._v("用 systemctl 保持运行：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("systemctl restart redsocks\nsystemctl enable  redsocks\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("或者手动启动：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("redsocks -c /etc/redsocks.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("添加 iptables 规则：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("iptables -t nat -A OUTPUT -p tcp -d 192.168.1.0/24 -j REDIRECT --to-ports 12345   # 编辑 nat 表，将本机发出的某些流量重定向 REDSOCKS 端口\niptables -t nat -L OUTPUT   # 查看 iptables 规则\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("系统重启时会重置 iptables 规则。因此建议将配置 iptables 的命令保存为一个 shell 脚本，每次系统重启时执行它。")])])]),s._v(" "),n("h3",{attrs:{id:"clash"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#clash"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#clash",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("Clash")]),s._v(" "),n("p",[s._v("：一个通用的代理客户端，采用 Golang 开发。")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/Fndroid/clash_for_windows_pkg",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub(opens new window)"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("支持 HTTP、SOCKS、Shadowsocks、Vmess 等多种代理协议。")]),s._v(" "),n("li",[s._v("支持 Linux、MacOS、Windows、Android 系统。")]),s._v(" "),n("li",[s._v("在 Linux 系统上支持透明代理。\n"),n("ul",[n("li",[s._v("原理与 redsocks 类似，需要手动配置 iptables 规则。")])])])]),s._v(" "),n("h2",{attrs:{id:"反向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("反向代理")]),s._v(" "),n("p",[s._v("实现反向代理的常见工具：")]),s._v(" "),n("ul",[n("li",[s._v("LVS")]),s._v(" "),n("li",[s._v("F5\n"),n("ul",[n("li",[s._v("：一个通过硬件实现负载均衡的服务器，基于 BIG-IP 协议。")])])]),s._v(" "),n("li",[s._v("HAProxy\n"),n("ul",[n("li",[s._v("：一个反向代理服务器，可以实现第四层的 TCP 代理、第七层的 HTTP 代理。")])])]),s._v(" "),n("li",[s._v("Nginx\n"),n("ul",[n("li",[s._v("：一个反向代理服务器，可以实现第四层的 TCP 代理、第七层的 HTTP 代理。")])])]),s._v(" "),n("li",[s._v("frp")])]),s._v(" "),n("h3",{attrs:{id:"lvs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lvs"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#lvs",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("LVS")]),s._v(" "),n("p",[s._v("：Linux 虚拟服务器（Linux Virtual Server），是 Linux 的一个内核模块，通过转发 TCP/UDP 数据包，实现第四层的反向代理。")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("LVS 工作在内核态，比 Nginx 等用户态代理的性能更高。")])]),s._v(" "),n("li",[n("p",[s._v("原理：")]),s._v(" "),n("ul",[n("li",[s._v("创建一些 IPVS（IP Virtual Server）作为负载均衡器。\n"),n("ul",[n("li",[s._v("每个 IPVS 绑定一个 Virtual IP ，称为 VIP 。")]),s._v(" "),n("li",[s._v("每个 IPVS 负责将将访问 VIP 的 TCP、UDP 流量反向代理到某些后端的 Real Server IP ，称为 RIP 。")])])]),s._v(" "),n("li",[s._v("配置 iptables 规则，将访问 VIP 的流量交给 IPVS 处理。")])])]),s._v(" "),n("li",[n("p",[s._v("有多种反向代理模式：")]),s._v(" "),n("ul",[n("li",[s._v("NAT 模式\n"),n("ul",[n("li",[s._v("：转发请求报文给后端时进行 DNAT ，转发响应报文给客户端时进行 SNAT ，实现透明代理。")])])]),s._v(" "),n("li",[s._v("TUN 模式\n"),n("ul",[n("li",[s._v("：将客户端的请求报文通过 IP 隧道（Tunnel）转发给后端，而后端直接返回响应报文给客户端。")]),s._v(" "),n("li",[s._v("比 NAT 模式的速度更快。")])])]),s._v(" "),n("li",[s._v("DR 模式\n"),n("ul",[n("li",[s._v("：通过改写请求报文的目标 MAC 地址，将它转发给后端。而后端直接返回响应报文给客户端。")]),s._v(" "),n("li",[s._v("比 TUN 模式的速度更快，但需要后端有一个独立的网卡。")])])])])]),s._v(" "),n("li",[n("p",[s._v("支持多种负载均衡算法：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("rr    # round robin（轮询），将请求报文轮流转发给各个后端，使得每个后端收到的请求数差不多相等。这是默认策略\nwrr   # weight round robin（加权轮询），给每个后端设置权重，权重更大的后端，更大概率收到请求\n\nsh    # source hashing ，计算请求报文的源 IP 的哈希值，将哈希值相同的请求转发给同一个后端\ndh    # destination hashing ，计算报文的目标 IP 的哈希值\n\nlc    # least connection（最少连接），监控每个后端的当前 TCP 连接数，将请求转发给连接数最少的后端\nwlc   # weight least connection（加权的 lc ）\n\nlblc  # locality based least connections（基于局部的最少连接），记录每个请求的目标 IP 上一次使用的后端，作为转发规则，如果目标后端负载过大，则采用 lc 算法\nlblcr # locality based least connections with replication（带复制的 lblc ），记录每个请求的目标 IP 使用的一组后端，采用 lc 从组中选出一个后端\n\nsed   # shortest expected delay ，监控每个后端的平均响应耗时，将请求转发给耗时最短的后端\nnq    # never queue ，优先将请求转发给当前连接数为 0 的后端，如果不存在这样的后端，则采用 sed 算法\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])])])]),s._v(" "),n("h3",{attrs:{id:"frp"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#frp"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#frp",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("frp")]),s._v(" "),n("p",[s._v("：一个命令行工具，提供了反向代理、内网穿透的功能。")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/fatedier/frp",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub(opens new window)"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("采用 Golang 开发。")]),s._v(" "),n("li",[s._v("支持 TCP、UDP、HTTP、HTTPS 等多种代理协议。")]),s._v(" "),n("li",[s._v("采用 C/S 架构工作。\n"),n("ul",[n("li",[s._v("frps ：服务器，部署在任一主机上，不需访问外部，只需被 frpc、用户访问。\n"),n("ul",[n("li",[s._v("frps 所在主机通常拥有一个固定的外网 IP ，供外网用户访问。")]),s._v(" "),n("li",[s._v("用户向 frps 发送网络包时，会先被 frps 转发到 frpc ，再被 frpc 转发到内网服务。")])])]),s._v(" "),n("li",[s._v("frpc ：客户端，部署在任一主机上，不需被外部访问，只需访问到 frps、内网服务。")])])])]),s._v(" "),n("p",[s._v("例：")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("登录一台主机，下载 frp 的发行版，编辑配置文件 frps.ini ：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[common]\nbind_port = 7000        # 让 frps 监听一个端口，供 frpc 访问，用于它们内部通信\ntoken = xxxxxx          # 用于 frpc 与 frps 之间的认证\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("启动服务器：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("./frps -c frps.ini\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("或者用 docker-compose 部署：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("version: '3'\n\nservices:\n frps:\n   container_name: frps\n   image: snowdreamtech/frps:0.37.0\n   restart: unless-stopped\n   ports:\n     - 7000:7000\n   volumes:\n     - ./frps.ini:/etc/frp/frps.ini\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("登录另一个主机，编辑配置文件 frpc.ini ：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[common]\nserver_addr = 1.1.1.1   # frps 的地址\nserver_port = 7000\ntoken = xxxxxx\n\n# 定义一个反向代理，名称自定义\n[proxy1]\ntype = tcp                  # 代理的类型\nlocal_ip = 10.0.0.1\nlocal_port = 80-90,443\nremote_port = 80-90,443     # 让 frps 监听 remote_port 端口，供用户访问，并将该端口收到的网络包转发到 local_ip:local_port\n# bandwidth_limit = 1MB     # 限制带宽，默认无限制\n# use_compression = false   # frpc 与 frps 之间通信时，是否压缩\n# use_encryption = false    # frpc 与 frps 之间通信时，是否加密\n\n# 可以定义多个反向代理\n[proxy2]\n...\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("启动客户端：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("./frpc -c frpc.ini\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("或者用 docker-compose 部署：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("version: '3'\n\nservices:\n frpc:\n   container_name: frpc\n   image: snowdreamtech/frpc:0.37.0\n   restart: unless-stopped\n   volumes:\n     - ./frpc.ini:/etc/frp/frpc.ini\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("让用户访问 frps 的反向代理端口：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("curl 1.1.1.1:10080\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"vpn"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vpn"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#vpn",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),n("OutboundLink")],1),s._v("VPN")]),s._v(" "),n("p",[s._v("：虚拟私有网络（Virtual Private Network），指由公网上的几台主机组成一个虚拟的私有网络。")]),s._v(" "),n("ul",[n("li",[s._v("常用于实现正向代理。比如某个机房的各个服务器不暴露到公网，但机房的网关暴露到公网，用户可通过公网连接该网关，从而访问该机房的内网服务器。")]),s._v(" "),n("li",[s._v("VPN 软件与代理软件类似，不过通常会转发客户端整个主机的流量、加密通信内容，而代理软件不一定提供这些功能。")])]),s._v(" "),n("p",[s._v("原文链接："),n("a",{attrs:{href:"https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("网络代理 | LeoHsiao's Notes"),n("OutboundLink")],1)])])}),[],!1,null,null,null);n.default=r.exports}}]);