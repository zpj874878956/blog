(window.webpackJsonp=window.webpackJsonp||[]).push([[274],{627:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("学习ceph第一天，记录下ceph集群部署过程")]),s._v(" "),a("p",[s._v("参考文档：")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.ceph.com/en/nautilus/start/quick-ceph-deploy/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/hukey/p/11899710.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ceph基本概念、原理、架构介绍"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://younger.blog.csdn.net/article/details/76794987?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&dist_request_id=323f4364-d540-40a7-819a-78546df68a40&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control",target:"_blank",rel:"noopener noreferrer"}},[s._v("【分析】Ceph系统架构与基本概念"),a("OutboundLink")],1)])]),s._v(" "),a("h3",{attrs:{id:"ceph简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ceph简介"}},[s._v("#")]),s._v(" ceph简介")]),s._v(" "),a("h4",{attrs:{id:"ceph架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ceph架构"}},[s._v("#")]),s._v(" ceph架构")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/03/60bf4e01f6c60c66.png",alt:""}})]),s._v(" "),a("h4",{attrs:{id:"ceph-支持三种接口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ceph-支持三种接口"}},[s._v("#")]),s._v(" Ceph 支持三种接口")]),s._v(" "),a("blockquote",[a("ul",[a("li",[s._v("Object：有原生的API，而且也兼容 Swift 和 S3 的 API")]),s._v(" "),a("li",[s._v("Block：支持精简配置、快照、克隆")]),s._v(" "),a("li",[s._v("File：Posix 接口，支持快照")])])]),s._v(" "),a("h4",{attrs:{id:"ceph主要特点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ceph主要特点"}},[s._v("#")]),s._v(" ceph主要特点")]),s._v(" "),a("blockquote",[a("ul",[a("li",[s._v("统一存储")]),s._v(" "),a("li",[s._v("无任何单点故障")]),s._v(" "),a("li",[s._v("数据多份冗余")]),s._v(" "),a("li",[s._v("存储容量可扩展")]),s._v(" "),a("li",[s._v("自动容错及故障自愈")])])]),s._v(" "),a("h4",{attrs:{id:"ceph核心组件及其作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ceph核心组件及其作用"}},[s._v("#")]),s._v(" ceph核心组件及其作用")]),s._v(" "),a("blockquote",[a("p",[s._v("在Ceph存储集群中，包含了三大角色组件，他们在Ceph存储集群中表现为3个守护进程，分别是Ceph OSD、Monitor、Managers。当然还有其他的功能组件，但是最主要的是这三个。")]),s._v(" "),a("ul",[a("li",[s._v("Ceph OSD： Ceph的OSD（Object Storage Device）守护进程。主要功能包括：存储数据、副本数据处理、数据恢复、数据回补、平衡数据分布，并将数据相关的一些监控信息提供给Ceph Moniter,以便Ceph Moniter来检查其他OSD的心跳状态。一个Ceph OSD存储集群，要求至少两个Ceph OSD,才能有效的保存两份数据。注意，这里的两个Ceph OSD是指运行在两台物理服务器上，并不是在一台物理服务器上运行两个Ceph OSD的守护进程。通常，冗余和高可用性至少需要3个Ceph OSD。")]),s._v(" "),a("li",[s._v("Monitor： Ceph的Monitor守护进程，主要功能是维护集群状态的表组，这个表组中包含了多张表，其中有Moniter map、OSD map、PG(Placement Group) map、CRUSH map。 这些映射是Ceph守护进程之间相互协调的关键簇状态。 监视器还负责管理守护进程和客户端之间的身份验证。 通常需要至少三个监视器来实现冗余和高可用性。")]),s._v(" "),a("li",[s._v("Managers： Ceph的Managers（Ceph Manager），守护进程（ceph-mgr）负责跟踪运行时间指标和Ceph群集的当前状态，包括存储利用率，当前性能指标和系统负载。 Ceph Manager守护程序还托管基于python的插件来管理和公开Ceph集群信息，包括基于Web的仪表板和REST API。 通常，至少有两名Manager需要高可用性。")]),s._v(" "),a("li",[s._v("MDS： Ceph的MDS（Metadata Server）守护进程，主要保存的是Ceph文件系统的元数据。注意，对于Ceph的块设备和Ceph对象存储都不需要Ceph MDS守护进程。Ceph MDS为基于POSIX文件系统的用户提供了一些基础命令的执行，比如ls、find等，这样可以很大程度降低Ceph存储集群的压力。")])])]),s._v(" "),a("h4",{attrs:{id:"ceph应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ceph应用场景"}},[s._v("#")]),s._v(" ceph应用场景")]),s._v(" "),a("blockquote",[a("p",[s._v("Ceph的应用场景主要由它的架构确定，Ceph提供对象存储、块存储和文件存储，主要由以下4种应用场景：")]),s._v(" "),a("ul",[a("li",[s._v("LIBRADOS应用： 通俗的说，Librados提供了应用程序对RADOS的直接访问，目前Librados已经提供了对C、C++、Java、Python、Ruby和PHP的支持。它支持单个单项的原子操作，如同时更新数据和属性、CAS操作，同时有对象粒度的快照操作。它的实现是基于RADOS的插件API，也就是在RADOS上运行的封装库。")]),s._v(" "),a("li",[s._v("RADOSGW应用： 这类应用基于Librados之上，增加了HTTP协议，提供RESTful接口并且兼容S3、Swfit接口。RADOSGW将Ceph集群作为分布式对象存储，对外提供服务。")]),s._v(" "),a("li",[s._v("RBD应用： 这类应用也是基于Librados之上的，细分为下面两种应用场景。\n"),a("ul",[a("li",[s._v("第一种应用场景为虚拟机提供块设备。通过Librbd可以创建一个块设备（Container），然后通过QEMU/KVM附加到VM上。通过Container和VM的解耦，使得块设备可以被绑定到不同的VM上。")]),s._v(" "),a("li",[s._v("第二种应用场景为主机提供块设备。这种场景是传统意义上的理解的块存储。")]),s._v(" "),a("li",[s._v("以上两种方式都是将一个虚拟的块设备分片存储在RADOS中，都会利用数据条带化提高数据并行传输，都支持块设备的快照、COW（Copy-On-Write）克隆。最重要的是RBD还支持Live migration。")])])]),s._v(" "),a("li",[s._v("CephFS（Ceph文件系统）应用： 这类应用是基于RADOS实现的PB级分布式文件系统，其中引入MDS（Meta Date Server）,它主要为兼容POSIX文件系统提供元数据，比如文件目录和文件元数据。同时MDS会将元数据存储在RADOS中，这样元数据本身也达到了并行化，可以大大加快文件操作的速度。MDS本身不为Client提供数据文件，只为Client提供对元数据的操作。当Client打开一个文件时，会查询并更新MDS相应的元数据（如文件包括的对象信息），然后再根据提供的对象信息直接从RADOS中得到文件数据。")])])]),s._v(" "),a("h3",{attrs:{id:"环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[s._v("#")]),s._v(" 环境准备")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("OS")]),s._v(" "),a("th",[s._v("hostname")]),s._v(" "),a("th",[s._v("ip")]),s._v(" "),a("th",[s._v("roles")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("Centos 7.5")]),s._v(" "),a("td",[s._v("pod4-core-20-10")]),s._v(" "),a("td",[s._v("192.168.20.10 / 192.168.30.10")]),s._v(" "),a("td",[s._v("ceph-deploy、monitor、Managers、rgw、mds")])]),s._v(" "),a("tr",[a("td",[s._v("Centos 7.5")]),s._v(" "),a("td",[s._v("pod4-core-20-5")]),s._v(" "),a("td",[s._v("192.168.20.5 / 192.168.30.5")]),s._v(" "),a("td",[s._v("monitor、Managers、rgw、mds")])]),s._v(" "),a("tr",[a("td",[s._v("Centos 7.5")]),s._v(" "),a("td",[s._v("pod4-core-20-6")]),s._v(" "),a("td",[s._v("192.168.20.6 / 192.168.30.6")]),s._v(" "),a("td",[s._v("monitor、Managers、rgw、mds")])])])]),s._v(" "),a("p",[s._v("注：每个节点有两块硬盘、两块网卡以便测试，使用"),a("code",[s._v("ceph-deploy")]),s._v("工具部署ceph存储。")]),s._v(" "),a("h3",{attrs:{id:"系统初始化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统初始化"}},[s._v("#")]),s._v(" 系统初始化")]),s._v(" "),a("p",[s._v("系统初始化这一小节的所有操作，没有特别注明的，均需在所有节点上执行。")]),s._v(" "),a("h4",{attrs:{id:"关闭防火墙及selinux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭防火墙及selinux"}},[s._v("#")]),s._v(" 关闭防火墙及selinux")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关防火墙")]),s._v("\n$ systemctl stop firewalld "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl disable firewalld\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关selinux")]),s._v("\nsetenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#^SELINUX=.*#SELINUX=disabled#g'")]),s._v(" /etc/selinux/config\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#^SELINUX=.*#SELINUX=disabled#g'")]),s._v(" /etc/sysconfig/selinux\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"修改主机名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改主机名"}},[s._v("#")]),s._v(" 修改主机名")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 HOSTNAME 替换为你实际主机名")]),s._v("\n$ hostnamectl set-hostname "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("HOSTNAME")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有节点执行刷新生效")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"配置hosts解析记录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置hosts解析记录"}},[s._v("#")]),s._v(" 配置hosts解析记录")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" EOF192.168.20.10 pod4-core-20-10192.168.20.5 pod4-core-20-5192.168.20.6 pod4-core-20-6EOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"调整内核参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调整内核参数"}},[s._v("#")]),s._v(" 调整内核参数")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/sysctl.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" EOFkernel.sysrq "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 0kernel.core_uses_pid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 1fs.file-max"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("655360kernel.msgmnb "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 65536kernel.msgmax "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 65536kernel.shmmax "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 68719476736kernel.shmall "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 4294967296kernel.pid_max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 655360net.ipv4.tcp_tw_reuse "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 1net.ipv4.tcp_tw_recycle "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 0net.ipv4.tcp_max_tw_buckets "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 262144net.ipv4.tcp_fin_timeout "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 30net.ipv4.tcp_timestamps "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 0net.ipv4.tcp_sack "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 1net.ipv4.tcp_window_scaling "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 1net.ipv4.tcp_ecn "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 0net.ipv4.tcp_keepalive_time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 600net.ipv4.tcp_keepalive_intvl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 30net.ipv4.tcp_keepalive_probes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 3net.ipv4.tcp_max_orphans "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 655360net.ipv4.tcp_max_syn_backlog "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 262144net.ipv4.tcp_mem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v(" 262144net.ipv4.udp_mem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v(" 262144net.ipv4.tcp_rmem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("87380")]),s._v(" 16777216net.ipv4.tcp_wmem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v(" 16777216net.ipv4.ip_local_port_range "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" 65535net.ipv4.route.gc_timeout "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止icmp重定向报文net.ipv4.conf.all.accept_redirects = 0# 禁止icmp源路由net.ipv4.conf.all.accept_source_route = 0net.core.somaxconn = 65535net.core.rmem_default = 8388608net.core.wmem_default = 8388608net.core.rmem_max = 16777216net.core.wmem_max = 16777216net.core.netdev_max_backlog = 262144vm.swappiness = 3vm.overcommit_memory = 1vm.max_map_count = 262144EOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 刷新生效")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"调整最大可打开文件数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调整最大可打开文件数"}},[s._v("#")]),s._v(" 调整最大可打开文件数")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /etc/security/limits.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(",.bak"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/security/limits.conf  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" EOF*                -       nofile          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("650000")]),s._v("*                -       memlock         unlimited*                -       stack           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("655360")]),s._v("*                -       nproc           unlimitedEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v("执行此操作后，需要重新打开终端，才可生效。")])]),s._v(" "),a("h4",{attrs:{id:"配置ntp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置ntp"}},[s._v("#")]),s._v(" 配置ntp")]),s._v(" "),a("h5",{attrs:{id:"配置ntp服务端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置ntp服务端"}},[s._v("#")]),s._v(" 配置ntp服务端")]),s._v(" "),a("p",[s._v("在pod4-core-20-10上执行这些步骤。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装软件包")]),s._v("\n$ yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" chrony\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑配置文件")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /etc/chrony.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(",.bak"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/chrony.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" EOFbindcmdaddress "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0server ntp.aliyun.com iburstallow "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".20.0/24driftfile /var/lib/chrony/driftmakestep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" 3rtcsynclogdir /var/log/chronyEOF\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动chronyd")]),s._v("\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" chronyd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl restart chronyd \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h5",{attrs:{id:"其他节点同步控制节点时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他节点同步控制节点时间"}},[s._v("#")]),s._v(" 其他节点同步控制节点时间")]),s._v(" "),a("p",[s._v("在其他所有节点执行此操作。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装软件包")]),s._v("\n$ yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" chrony\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑配置文件")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /etc/chrony.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(",.bak"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/chrony.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" EOFserver pod4-core-20-10 iburstdriftfile /var/lib/chrony/driftmakestep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" 3rtcsynclogdir /var/log/chronyEOF\n$ systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" chronyd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl restart chronyd \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最好先手动测试下，可以同步时间")]),s._v("\n$ yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ntp\n$ ntpdate "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".20.10\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h4",{attrs:{id:"配置yum源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置yum源"}},[s._v("#")]),s._v(" 配置yum源")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更换为阿里云源")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /etc/yum.repos.d/bak\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /etc/yum.repos.d/*.repo /etc/yum.repos.d/bak/\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo\nyum clean all "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" yum makecache fast\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置ceph-nautilus源")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/ceph.repo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EOF"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ceph-norch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ceph-norchbaseurl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/noarch/enabled"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1gpgcheck"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ceph-x86_64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ceph-x86_64 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("baseurl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/enabled"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1gpgcheck"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("0EOF\nyum clean all\nyum makecache fast\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("接下来的操作，如果没有特殊说明，均在 "),a("code",[s._v("pod4-core-20-10")]),s._v("节点执行。")]),s._v(" "),a("h4",{attrs:{id:"安装基础工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装基础工具"}},[s._v("#")]),s._v(" 安装基础工具")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" python-setuptools ceph-deploy\n\n$ ceph-deploy "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确保ceph-deploy版本为2.0.1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v(".1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"配置免密登录到其他节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置免密登录到其他节点"}},[s._v("#")]),s._v(" 配置免密登录到其他节点")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ssh-keygen "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" rsa "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-q")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" ssh-copy-id pod4-core-20-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据提示输入相应密码")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"部署ceph集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署ceph集群"}},[s._v("#")]),s._v(" 部署ceph集群")]),s._v(" "),a("p",[s._v("接下来的操作，如果没有特殊说明，均在 "),a("code",[s._v("pod4-core-20-10")]),s._v("节点执行。")]),s._v(" "),a("h4",{attrs:{id:"部署admin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署admin"}},[s._v("#")]),s._v(" 部署admin")]),s._v(" "),a("p",[s._v("创建一个Ceph Monitor和三个Ceph OSD守护进程的Ceph存储集群。集群达到状态后，通过添加第四个Ceph OSD守护程序，一个元数据服务器和两个以上的Ceph Monitors对其进行扩展。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" my-cluster "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" my-cluster\n$ ceph-deploy new --public-network "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".20.0/24 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --cluster-network "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".30.0/24 pod4-core-20-10\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --public-network：对外网络，用于客户端访问")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --cluster-network：集群内部信息同步网络")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod4-core-20-10：将此节点设置为Monitor节点")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("上述命令执行后，输出如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/03/e42e959aaee0873b.png",alt:""}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 命令执行成功后，会生成配置文件、日志文件、秘钥文件")]),s._v("\nceph.conf  ceph-deploy-ceph.log  ceph.mon.keyring\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ceph.conf        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成的配置文件内容如下")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果有错误之处，可以根据自己实际情况修改")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nfsid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\npublic_network "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".20.0/24\ncluster_network "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".30.0/24\nmon_initial_members "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pod4-core-20-10\nmon_host "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".20.10\nauth_cluster_required "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cephx\nauth_service_required "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cephx\nauth_client_required "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cephx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h5",{attrs:{id:"安装ceph软件包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装ceph软件包"}},[s._v("#")]),s._v(" 安装ceph软件包")]),s._v(" "),a("p",[s._v("仅安装ceph软件包此操作在所有节点执行")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不要使用官方提供的 ceph-deploy install 命令进行安装，它会自己再配置yum源，安装较慢")]),s._v("\n$ yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ceph ceph-mon ceph-mgr ceph-radosgw ceph-mds\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h5",{attrs:{id:"初始化monitor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化monitor"}},[s._v("#")]),s._v(" 初始化monitor")]),s._v(" "),a("p",[s._v("接下来的操作，如果没有特殊说明，均在 "),a("code",[s._v("pod4-core-20-10")]),s._v("节点执行。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ceph-deploy mon create-initial\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"拷贝admin的秘钥文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拷贝admin的秘钥文件"}},[s._v("#")]),s._v(" 拷贝admin的秘钥文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# admin后面指定ceph集群中的所有节点")]),s._v("\n$ ceph-deploy admin pod4-core-20-10 pod4-core-20-5 pod4-core-20-6\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h5",{attrs:{id:"确认集群状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#确认集群状态"}},[s._v("#")]),s._v(" 确认集群状态")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ceph "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v("\n  cluster:\n    id:     634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\n    health: HEALTH_OK\n\n  services:\n    mon: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" daemons, quorum pod4-core-20-10 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age 2m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 包含一个monitor")]),s._v("\n    mgr: no daemons active\n    osd: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" osds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" up, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n\n  data:\n    pools:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" pools, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" pgs\n    objects: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" objects, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B\n    usage:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B used, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B avail\n    pgs:     \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h4",{attrs:{id:"部署manager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署manager"}},[s._v("#")]),s._v(" 部署manager")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将manager守护程序部署在 pod4-core-20-10")]),s._v("\n$ ceph-deploy mgr create pod4-core-20-10\n\n\n$ ceph "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看集群状态")]),s._v("\n  cluster:\n    id:     634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\n    health: HEALTH_WARN\n            OSD count "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" osd_pool_default_size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n\n  services:\n    mon: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" daemons, quorum pod4-core-20-10 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age 8m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    mgr: pod4-core-20-10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("active, since 41s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新增一个manager节点")]),s._v("\n    osd: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" osds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" up, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n\n  data:\n    pools:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" pools, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" pgs\n    objects: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" objects, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B\n    usage:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B used, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B avail\n    pgs:  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h4",{attrs:{id:"创建三个osd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建三个osd"}},[s._v("#")]),s._v(" 创建三个OSD")]),s._v(" "),a("p",[s._v("每个机器至少需要一块全新硬盘，确保没有被格式化过。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ceph-deploy osd create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--data")]),s._v(" /dev/sdb pod4-core-20-10\nceph-deploy osd create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--data")]),s._v(" /dev/sdb pod4-core-20-5\nceph-deploy osd create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--data")]),s._v(" /dev/sdb pod4-core-20-6\n\n$ ceph "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看集群状态")]),s._v("\n  cluster:\n    id:     634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\n    health: HEALTH_OK\n\n  services:\n    mon: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" daemons, quorum pod4-core-20-10 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age 14m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    mgr: pod4-core-20-10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("active, since 6m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    osd: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" osds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 30s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 30s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 包含了三个osd")]),s._v("\n\n  data:\n    pools:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" pools, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" pgs\n    objects: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" objects, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B\n    usage:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(" GiB used, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("57")]),s._v(" GiB / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" GiB avail\n    pgs:     \n\n\n$ ceph osd tree       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看osd详细信息")]),s._v("\nID CLASS WEIGHT  TYPE NAME                STATUS REWEIGHT PRI-AFF \n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.05846")]),s._v(" root default                                     \n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-3")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01949")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" pod4-core-20-10                         \n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   hdd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01949")]),s._v("         osd.0                up  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00000")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-5")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01949")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" pod4-core-20-5                          \n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   hdd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01949")]),s._v("         osd.1                up  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00000")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-7")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01949")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" pod4-core-20-6                          \n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   hdd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01949")]),s._v("         osd.2                up  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00000")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("h3",{attrs:{id:"ceph集群扩容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ceph集群扩容"}},[s._v("#")]),s._v(" ceph集群扩容")]),s._v(" "),a("h4",{attrs:{id:"扩容monitor节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩容monitor节点"}},[s._v("#")]),s._v(" 扩容monitor节点")]),s._v(" "),a("p",[s._v("一个Ceph存储集群至少需要一个Ceph Monitor和Ceph Manager才能运行。为了获得高可用性，Ceph存储群集通常运行多个Ceph Monitor，这样可以避免单点故障。")]),s._v(" "),a("p",[s._v("Ceph使用Paxos算法，节点数量最好是奇数（即，大于N / 2，其中N是Monitor的数量）才能形成仲裁。尽管这不是必需的。")]),s._v(" "),a("h5",{attrs:{id:"扩容第一个monitor节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩容第一个monitor节点"}},[s._v("#")]),s._v(" 扩容第一个monitor节点")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加 pod4-core-20-5为monitor节点")]),s._v("\n$ ceph-deploy mon "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" pod4-core-20-5\n\n$ ceph quorum_status "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--format")]),s._v(" json-pretty  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查仲裁状态")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"election_epoch"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"quorum"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"quorum_names"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加入仲裁的节点")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pod4-core-20-10"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pod4-core-20-5"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"quorum_leader_name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pod4-core-20-10"')]),s._v(",      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前leader")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"quorum_age"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("210")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"monmap"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"epoch"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fsid"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"634fc0a4-d2bd-4f14-af6b-421ecbb89ba6"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"modified"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2021-02-21 15:46:00.889286"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"created"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2021-02-21 15:21:30.739161"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"min_mon_release"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"min_mon_release_name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nautilus"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"features"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"persistent"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kraken"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"luminous"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mimic"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"osdmap-prune"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nautilus"')]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"optional"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mons"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rank"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pod4-core-20-10"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"public_addrs"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"addrvec"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v2"')]),s._v(",\n                            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"addr"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.20.10:3300"')]),s._v(",\n                            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nonce"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1"')]),s._v(",\n                            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"addr"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.20.10:6789"')]),s._v(",\n                            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nonce"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"addr"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.20.10:6789/0"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"public_addr"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.20.10:6789/0"')]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rank"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pod4-core-20-5"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"public_addrs"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"addrvec"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v2"')]),s._v(",\n                            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"addr"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.20.5:3300"')]),s._v(",\n                            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nonce"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1"')]),s._v(",\n                            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"addr"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.20.5:6789"')]),s._v(",\n                            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nonce"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"addr"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.20.5:6789/0"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"public_addr"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.20.5:6789/0"')]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br")])]),a("h5",{attrs:{id:"扩容第二个monitor节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩容第二个monitor节点"}},[s._v("#")]),s._v(" 扩容第二个monitor节点")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加 pod4-core-20-6为monitor节点")]),s._v("\n$ ceph-deploy mon "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" pod4-core-20-6\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确认三个节点加入仲裁")]),s._v("\n$ ceph quorum_status "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--format")]),s._v(" json-pretty\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"election_epoch"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"quorum"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"quorum_names"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pod4-core-20-10"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pod4-core-20-5"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pod4-core-20-6"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"quorum_leader_name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pod4-core-20-10"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"quorum_age"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(",\n\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 省略部分输出")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h4",{attrs:{id:"检查ceph集群状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查ceph集群状态"}},[s._v("#")]),s._v(" 检查ceph集群状态")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ceph "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v("\n  cluster:\n    id:     634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\n    health: HEALTH_OK\n\n  services:     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#确保有三个monitor")]),s._v("\n    mon: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" daemons, quorum pod4-core-20-10,pod4-core-20-5,pod4-core-20-6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age 64s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    mgr: pod4-core-20-10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("active, since 25m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    osd: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" osds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 19m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 19m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  data:\n    pools:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" pools, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" pgs\n    objects: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" objects, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B\n    usage:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(" GiB used, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("57")]),s._v(" GiB / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" GiB avail\n    pgs: \n\n$ ceph mon "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stat")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 也可以单独查看monitor状态")]),s._v("\ne3: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" mons at "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("pod4-core-20-10"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("v2:192.168.20.10:3300/0,v1:192.168.20.10:6789/0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\npod4-core-20-5"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("v2:192.168.20.5:3300/0,v1:192.168.20.5:6789/0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\npod4-core-20-6"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("v2:192.168.20.6:3300/0,v1:192.168.20.6:6789/0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(", \nelection epoch "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(", leader "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" pod4-core-20-10, quorum "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,1")]),s._v(",2 \npod4-core-20-10,pod4-core-20-5,pod4-core-20-6\n\n$ ceph mon dump     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dump查看monitor状态")]),s._v("\ndumped monmap epoch "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nepoch "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nfsid 634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\nlast_changed "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-02-21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":53:36.055686\ncreated "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-02-21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":21:30.739161\nmin_mon_release "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nautilus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("v2:192.168.20.10:3300/0,v1:192.168.20.10:6789/0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" mon.pod4-core-20-10\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("v2:192.168.20.5:3300/0,v1:192.168.20.5:6789/0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" mon.pod4-core-20-5\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("v2:192.168.20.6:3300/0,v1:192.168.20.6:6789/0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" mon.pod4-core-20-6\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("h4",{attrs:{id:"扩容manager节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩容manager节点"}},[s._v("#")]),s._v(" 扩容manager节点")]),s._v(" "),a("p",[s._v("Ceph Manager守护进程以 active/standby 模式运行。当前active节点宕机后，处于standby状态的会自动提升为active节点。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将pod4-core-20-5、pod4-core-20-6添加到manager集群")]),s._v("\n$ ceph-deploy mgr create pod4-core-20-5 pod4-core-20-6\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加成功后，确认集群状态")]),s._v("\n$ ceph "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v("      \n  cluster:\n    id:     634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\n    health: HEALTH_OK\n\n  services:\n    mon: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" daemons, quorum pod4-core-20-10,pod4-core-20-5,pod4-core-20-6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age 8m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    mgr: pod4-core-20-10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("active, since 32m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", standbys: pod4-core-20-5, pod4-core-20-6\n    osd: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" osds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 26m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 26m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  data:\n    pools:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" pools, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" pgs\n    objects: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" objects, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B\n    usage:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(" GiB used, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("57")]),s._v(" GiB / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" GiB avail\n    pgs:     \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("至此，ceph集群部署完成。")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("原文链接：")]),s._v(" "),a("p",[s._v("https://lvjianzhao.gitee.io/lvjianzhao/posts/6010b413/?highlight=ceph")]),s._v(" "),a("blockquote")])}),[],!1,null,null,null);a.default=e.exports}}]);