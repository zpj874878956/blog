(window.webpackJsonp=window.webpackJsonp||[]).push([[283],{637:function(s,a,t){"use strict";t.r(a);var e=t(0),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"ç®€ä»‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç®€ä»‹"}},[s._v("#")]),s._v(" ç®€ä»‹")]),s._v(" "),a("blockquote",[a("p",[s._v("MHAï¼ˆMaster High Availabilityï¼‰ç›®å‰åœ¨MySQLé«˜å¯ç”¨æ–¹é¢æ˜¯ä¸€ä¸ªç›¸å¯¹æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒç”±æ—¥æœ¬DeNAå…¬å¸youshimatonï¼ˆç°å°±èŒäºFacebookå…¬å¸ï¼‰å¼€å‘ï¼Œæ˜¯ä¸€å¥—ä¼˜ç§€çš„ä½œä¸ºMySQLé«˜å¯ç”¨æ€§ç¯å¢ƒä¸‹æ•…éšœåˆ‡æ¢å’Œä¸»ä»æå‡çš„é«˜å¯ç”¨è½¯ä»¶ã€‚åœ¨MySQLæ•…éšœåˆ‡æ¢è¿‡ç¨‹ä¸­ï¼ŒMHAèƒ½åšåˆ°åœ¨0~30ç§’ä¹‹å†…è‡ªåŠ¨å®Œæˆæ•°æ®åº“çš„æ•…éšœåˆ‡æ¢æ“ä½œï¼Œå¹¶ä¸”åœ¨è¿›è¡Œæ•…éšœåˆ‡æ¢çš„è¿‡ç¨‹ä¸­ï¼ŒMHAèƒ½åœ¨æœ€å¤§ç¨‹åº¦ä¸Šä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä»¥è¾¾åˆ°çœŸæ­£æ„ä¹‰ä¸Šçš„é«˜å¯ç”¨ã€‚")]),s._v(" "),a("p",[s._v("è¯¥è½¯ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šMHA Managerï¼ˆç®¡ç†èŠ‚ç‚¹ï¼‰å’ŒMHA Nodeï¼ˆæ•°æ®èŠ‚ç‚¹ï¼‰ã€‚MHA Managerå¯ä»¥å•ç‹¬éƒ¨ç½²åœ¨ä¸€å°ç‹¬ç«‹çš„æœºå™¨ä¸Šç®¡ç†å¤šä¸ªmaster-slaveé›†ç¾¤ï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨ä¸€å°slaveèŠ‚ç‚¹ä¸Šã€‚MHA Nodeè¿è¡Œåœ¨æ¯å°MySQLæœåŠ¡å™¨ä¸Šï¼ŒMHA Managerä¼šå®šæ—¶æ¢æµ‹é›†ç¾¤ä¸­çš„masterèŠ‚ç‚¹ï¼Œå½“masterå‡ºç°æ•…éšœæ—¶ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨å°†æœ€æ–°æ•°æ®çš„slaveæå‡ä¸ºæ–°çš„masterï¼Œç„¶åå°†æ‰€æœ‰å…¶ä»–çš„slaveé‡æ–°æŒ‡å‘æ–°çš„masterã€‚æ•´ä¸ªæ•…éšœè½¬ç§»è¿‡ç¨‹å¯¹åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜ã€‚")]),s._v(" "),a("p",[s._v("åœ¨MHAè‡ªåŠ¨æ•…éšœåˆ‡æ¢è¿‡ç¨‹ä¸­ï¼ŒMHAè¯•å›¾ä»å®•æœºçš„ä¸»æœåŠ¡å™¨ä¸Šä¿å­˜äºŒè¿›åˆ¶æ—¥å¿—ï¼Œæœ€å¤§ç¨‹åº¦çš„ä¿è¯æ•°æ®çš„ä¸ä¸¢å¤±ï¼Œä½†è¿™å¹¶ä¸æ€»æ˜¯å¯è¡Œçš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸»æœåŠ¡å™¨ç¡¬ä»¶æ•…éšœæˆ–æ— æ³•é€šè¿‡sshè®¿é—®ï¼ŒMHAæ²¡æ³•ä¿å­˜äºŒè¿›åˆ¶æ—¥å¿—ï¼Œåªè¿›è¡Œæ•…éšœè½¬ç§»è€Œä¸¢å¤±äº†æœ€æ–°çš„æ•°æ®ã€‚ä½¿ç”¨MySQL 5.5çš„åŠåŒæ­¥å¤åˆ¶ï¼Œå¯ä»¥å¤§å¤§é™ä½æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚MHAå¯ä»¥ä¸åŠåŒæ­¥å¤åˆ¶ç»“åˆèµ·æ¥ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªslaveå·²ç»æ”¶åˆ°äº†æœ€æ–°çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼ŒMHAå¯ä»¥å°†æœ€æ–°çš„äºŒè¿›åˆ¶æ—¥å¿—åº”ç”¨äºå…¶ä»–æ‰€æœ‰çš„slaveæœåŠ¡å™¨ä¸Šï¼Œå› æ­¤å¯ä»¥ä¿è¯æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ä¸€è‡´æ€§ã€‚")]),s._v(" "),a("p",[s._v("ç›®å‰MHAä¸»è¦æ”¯æŒä¸€ä¸»å¤šä»çš„æ¶æ„ï¼Œè¦æ­å»ºMHA,è¦æ±‚ä¸€ä¸ªå¤åˆ¶é›†ç¾¤ä¸­å¿…é¡»æœ€å°‘æœ‰ä¸‰å°æ•°æ®åº“æœåŠ¡å™¨ï¼Œä¸€ä¸»äºŒä»ï¼Œå³ä¸€å°å……å½“masterï¼Œä¸€å°å……å½“å¤‡ç”¨masterï¼Œå¦å¤–ä¸€å°å……å½“ä»åº“ï¼Œå› ä¸ºè‡³å°‘éœ€è¦ä¸‰å°æœåŠ¡å™¨ï¼Œå‡ºäºæœºå™¨æˆæœ¬çš„è€ƒè™‘ï¼Œæ·˜å®ä¹Ÿåœ¨è¯¥åŸºç¡€ä¸Šè¿›è¡Œäº†æ”¹é€ ï¼Œç›®å‰æ·˜å®TMHAå·²ç»æ”¯æŒä¸€ä¸»ä¸€ä»ã€‚MHA é€‚åˆä»»ä½•å­˜å‚¨å¼•æ“, åªè¦èƒ½ä¸»ä»å¤åˆ¶çš„å­˜å‚¨å¼•æ“å®ƒéƒ½æ”¯æŒï¼Œä¸é™äºæ”¯æŒäº‹ç‰©çš„ innodb å¼•æ“ã€‚")])]),s._v(" "),a("p",[s._v("å®˜æ–¹ä»‹ç»ï¼šhttps://code.google.com/p/mysql-master-ha/")]),s._v(" "),a("p",[s._v("å›¾01å±•ç¤ºäº†å¦‚ä½•é€šè¿‡MHA Managerç®¡ç†å¤šç»„ä¸»ä»å¤åˆ¶ã€‚å¯ä»¥å°†MHAå·¥ä½œåŸç†æ€»ç»“ä¸ºå¦‚ä¸‹")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/08/7a66da406f7e6fb9.png",alt:"7a66da406f7e6fb9.png"}})]),s._v(" "),a("p",[s._v("ï¼ˆ1ï¼‰ä»å®•æœºå´©æºƒçš„masterä¿å­˜äºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼ˆbinlog eventsï¼‰;")]),s._v(" "),a("p",[s._v("ï¼ˆ2ï¼‰è¯†åˆ«å«æœ‰æœ€æ–°æ›´æ–°çš„slaveï¼›")]),s._v(" "),a("p",[s._v("ï¼ˆ3ï¼‰åº”ç”¨å·®å¼‚çš„ä¸­ç»§æ—¥å¿—ï¼ˆrelay logï¼‰åˆ°å…¶ä»–çš„slaveï¼›")]),s._v(" "),a("p",[s._v("ï¼ˆ4ï¼‰åº”ç”¨ä»masterä¿å­˜çš„äºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼ˆbinlog eventsï¼‰ï¼›")]),s._v(" "),a("p",[s._v("ï¼ˆ5ï¼‰æå‡ä¸€ä¸ªslaveä¸ºæ–°çš„masterï¼›")]),s._v(" "),a("p",[s._v("ï¼ˆ6ï¼‰ä½¿å…¶ä»–çš„slaveè¿æ¥æ–°çš„masterè¿›è¡Œå¤åˆ¶ï¼›")]),s._v(" "),a("p",[s._v("MHAè½¯ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼ŒManagerå·¥å…·åŒ…å’ŒNodeå·¥å…·åŒ…ï¼Œå…·ä½“çš„è¯´æ˜å¦‚ä¸‹ã€‚")]),s._v(" "),a("p",[s._v("Managerå·¥å…·åŒ…ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªå·¥å…·ï¼š")]),s._v(" "),a("p",[s._v("masterha_check_ssh æ£€æŸ¥MHAçš„SSHé…ç½®çŠ¶å†µ")]),s._v(" "),a("p",[s._v("masterha_check_repl æ£€æŸ¥MySQLå¤åˆ¶çŠ¶å†µ")]),s._v(" "),a("p",[s._v("masterha_manger å¯åŠ¨MHA")]),s._v(" "),a("p",[s._v("masterha_check_status æ£€æµ‹å½“å‰MHAè¿è¡ŒçŠ¶æ€")]),s._v(" "),a("p",[s._v("masterha_master_monitor æ£€æµ‹masteræ˜¯å¦å®•æœº")]),s._v(" "),a("p",[s._v("masterha_master_switch æ§åˆ¶æ•…éšœè½¬ç§»ï¼ˆè‡ªåŠ¨æˆ–è€…æ‰‹åŠ¨ï¼‰")]),s._v(" "),a("p",[s._v("masterha_conf_host æ·»åŠ æˆ–åˆ é™¤é…ç½®çš„serverä¿¡æ¯")]),s._v(" "),a("p",[s._v("Nodeå·¥å…·åŒ…ï¼ˆè¿™äº›å·¥å…·é€šå¸¸ç”±MHA Managerçš„è„šæœ¬è§¦å‘ï¼Œæ— éœ€äººä¸ºæ“ä½œï¼‰ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªå·¥å…·ï¼š")]),s._v(" "),a("p",[s._v("save_binary_logs ä¿å­˜å’Œå¤åˆ¶masterçš„äºŒè¿›åˆ¶æ—¥å¿—")]),s._v(" "),a("p",[s._v("apply_diff_relay_logs è¯†åˆ«å·®å¼‚çš„ä¸­ç»§æ—¥å¿—äº‹ä»¶å¹¶å°†å…¶å·®å¼‚çš„äº‹ä»¶åº”ç”¨äºå…¶ä»–çš„slave")]),s._v(" "),a("p",[s._v("filter_mysqlbinlog å»é™¤ä¸å¿…è¦çš„ROLLBACKäº‹ä»¶ï¼ˆMHAå·²ä¸å†ä½¿ç”¨è¿™ä¸ªå·¥å…·ï¼‰")]),s._v(" "),a("p",[s._v("purge_relay_logs æ¸…é™¤ä¸­ç»§æ—¥å¿—ï¼ˆä¸ä¼šé˜»å¡SQLçº¿ç¨‹ï¼‰")]),s._v(" "),a("p",[s._v("æ³¨æ„ï¼š")]),s._v(" "),a("p",[s._v("ä¸ºäº†å°½å¯èƒ½çš„å‡å°‘ä¸»åº“ç¡¬ä»¶æŸåå®•æœºé€ æˆçš„æ•°æ®ä¸¢å¤±ï¼Œå› æ­¤åœ¨é…ç½®MHAçš„åŒæ—¶å»ºè®®é…ç½®æˆMySQL 5.5çš„åŠåŒæ­¥å¤åˆ¶ã€‚å…³äºåŠåŒæ­¥å¤åˆ¶åŸç†å„ä½è‡ªå·±è¿›è¡ŒæŸ¥é˜…ã€‚ï¼ˆä¸æ˜¯å¿…é¡»ï¼‰")]),s._v(" "),a("h1",{attrs:{id:"_1-éƒ¨ç½²mha"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-éƒ¨ç½²mha"}},[s._v("#")]),s._v(" 1.éƒ¨ç½²MHA")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥éƒ¨ç½²MHAï¼Œå…·ä½“çš„æ­å»ºç¯å¢ƒå¦‚ä¸‹ï¼ˆæ‰€æœ‰æ“ä½œç³»ç»Ÿå‡ä¸ºCentOS7.4 64bitï¼‰ï¼š")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("ipåœ°å€")]),s._v(" "),a("th",[s._v("ä¸»æœºå")]),s._v(" "),a("th",[s._v("è§’è‰²")]),s._v(" "),a("th",[s._v("è½¯ä»¶")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("10.10.10.67")]),s._v(" "),a("td",[s._v("host67.cn")]),s._v(" "),a("td",[s._v("manager")]),s._v(" "),a("td",[s._v("mha4mysql-managerã€mha4mysql-node")])]),s._v(" "),a("tr",[a("td",[s._v("10.10.10.68")]),s._v(" "),a("td",[s._v("host68.cn")]),s._v(" "),a("td",[s._v("master")]),s._v(" "),a("td",[s._v("mha4mysql-node")])]),s._v(" "),a("tr",[a("td",[s._v("10.10.10.69")]),s._v(" "),a("td",[s._v("host69.cn")]),s._v(" "),a("td",[s._v("Slave1,Candicate master")]),s._v(" "),a("td",[s._v("mha4mysql-node")])]),s._v(" "),a("tr",[a("td",[s._v("10.10.10.70")]),s._v(" "),a("td",[s._v("host70.cn")]),s._v(" "),a("td",[s._v("Slave2")]),s._v(" "),a("td",[s._v("mha4mysql-node")])])])]),s._v(" "),a("p",[s._v("å…¶ä¸­masterå¯¹å¤–æä¾›å†™æœåŠ¡ï¼Œå¤‡é€‰Candicate masterï¼ˆå®é™…ä¸ºslave1ï¼‰æä¾›è¯»æœåŠ¡ï¼Œslave2ä¹Ÿæä¾›è¯»æœåŠ¡ï¼Œä¸€æ—¦masterå®•æœºï¼Œå°†ä¼šæŠŠå¤‡é€‰masteræå‡ä¸ºæ–°çš„masterï¼ŒslaveæŒ‡å‘æ–°çš„master")]),s._v(" "),a("p",[s._v("ï¼ˆ1ï¼‰åœ¨æ‰€æœ‰èŠ‚ç‚¹å®‰è£…MHA nodeæ‰€éœ€çš„perlæ¨¡å—ï¼ˆDBD:mysqlï¼‰ï¼Œå®‰è£…è„šæœ¬å¦‚ä¸‹ï¼š")]),s._v(" "),a("p",[s._v("å…ˆè¦å®‰è£…epelæºï¼Œ")]),s._v(" "),a("p",[s._v("Centos6å®‰è£…æºï¼šrpm -ivh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm")]),s._v(" "),a("p",[s._v("Centos7å®‰è£…æºï¼šrpm â€“ivh http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-10.noarch.rpm")]),s._v(" "),a("p",[s._v("ä»¥ä¸‹è®¾ç½®ä¸ºCentOS6æ“ä½œ")]),s._v(" "),a("p",[s._v("[epel]")]),s._v(" "),a("p",[s._v("name=Extra Packages for Enterprise Linux 6 - $basearch")]),s._v(" "),a("p",[s._v("baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch #å°†æ³¨é‡Šçš„#å»æ‰")]),s._v(" "),a("p",[s._v("#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&arch=$basearch#å‰é¢åŠ ä¸Š#")]),s._v(" "),a("p",[s._v("yum clean all")]),s._v(" "),a("p",[s._v("yum list")]),s._v(" "),a("p",[s._v("ä½¿ç”¨yumå®‰è£…")]),s._v(" "),a("p",[s._v("å…¨éƒ¨ä¾èµ–")]),s._v(" "),a("p",[s._v("yum -y install perl-DBD-MySQL perl-Config-Tiny perl-Log-Dispatch perl-Parallel-ForkManager --skip-broken")]),s._v(" "),a("p",[s._v("ï¼ˆ2ï¼‰ä¸Šä¼ MHAç›¸å…³åŒ…ï¼Œåœ¨æ‰€æœ‰çš„èŠ‚ç‚¹å®‰è£…mha-nodeï¼š")]),s._v(" "),a("p",[s._v("rpm -ivh mha4mysql-node-0.54-0.el6.noarch.rpm")]),s._v(" "),a("p",[s._v("å®‰è£…å®Œæˆåä¼šåœ¨/usr/bin/ç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹è„šæœ¬æ–‡ä»¶ï¼š")]),s._v(" "),a("p",[s._v("[root@host67 bin]# pwd")]),s._v(" "),a("p",[s._v("/usr/bin/")]),s._v(" "),a("p",[s._v("[root@host67 bin]# ll app* filter* purge* save*")]),s._v(" "),a("p",[s._v("-r-xr-xr-x 1 root root 15498 Apr 20 10:05 apply_diff_relay_logs")]),s._v(" "),a("p",[s._v("-r-xr-xr-x 1 root root 4807 Apr 20 10:05 filter_mysqlbinlog")]),s._v(" "),a("p",[s._v("-r-xr-xr-x 1 root root 7401 Apr 20 10:05 purge_relay_logs")]),s._v(" "),a("p",[s._v("-r-xr-xr-x 1 root root 7263 Apr 20 10:05 save_binary_logs")]),s._v(" "),a("h1",{attrs:{id:"_2-å®‰è£…mha-manager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-å®‰è£…mha-manager"}},[s._v("#")]),s._v(" 2.å®‰è£…MHA Manager")]),s._v(" "),a("p",[s._v("MHA Managerä¸­ä¸»è¦åŒ…æ‹¬äº†å‡ ä¸ªç®¡ç†å‘˜çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¾‹å¦‚master_mangerï¼Œmaster_master_switchç­‰ã€‚MHA Mangerä¹Ÿä¾èµ–äºperlæ¨¡å—ï¼Œå…·ä½“å¦‚ä¸‹ï¼š")]),s._v(" "),a("p",[s._v("ï¼ˆ1ï¼‰å®‰è£…MHA Nodeè½¯ä»¶åŒ…ä¹‹å‰éœ€è¦å®‰è£…ä¾èµ–ã€‚æˆ‘è¿™é‡Œä½¿ç”¨yumå®Œæˆï¼Œé¦–å…ˆepelæºè¦å®‰è£…ã€‚æ³¨æ„ï¼šåˆšæ‰æˆ‘ä»¬å·²ç»é…ç½®epelæºã€‚")]),s._v(" "),a("p",[s._v("ï¼ˆ2ï¼‰å®‰è£…MHA Managerã€‚é¦–å…ˆå®‰è£…MHA Mangerä¾èµ–çš„perlæ¨¡å—ï¼ˆæˆ‘è¿™é‡Œä½¿ç”¨yumå®‰è£…ï¼‰ï¼š")]),s._v(" "),a("p",[s._v("yum install perl-DBD-MySQL perl-Config-Tiny perl-Log-Dispatch perl-Parallel-ForkManager perl-Time-HiRes perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker perl-CPAN -y")]),s._v(" "),a("p",[s._v("å®‰è£…MHA Managerè½¯ä»¶åŒ…ï¼š")]),s._v(" "),a("p",[s._v("[root@host67 ~]# rpm -ivh mha4mysql-manager-0.55-0.el6.noarch.rpm")]),s._v(" "),a("p",[s._v("å®‰è£…å®Œæˆåä¼šåœ¨/usr/binç›®å½•ä¸‹é¢ç”Ÿæˆä»¥ä¸‹è„šæœ¬æ–‡ä»¶ï¼Œå‰é¢å·²ç»è¯´è¿‡è¿™äº›è„šæœ¬çš„ä½œç”¨ï¼Œè¿™é‡Œä¸å†é‡å¤")]),s._v(" "),a("p",[s._v("[root@host67 ~]# ll /usr/bin/mast*")]),s._v(" "),a("p",[s._v("-rwxr-xr-x 1 root root 1995 12æœˆ 13 2012 /usr/bin/masterha_check_repl")]),s._v(" "),a("p",[s._v("-rwxr-xr-x 1 root root 1779 12æœˆ 13 2012 /usr/bin/masterha_check_ssh")]),s._v(" "),a("p",[s._v("-rwxr-xr-x 1 root root 1865 12æœˆ 13 2012 /usr/bin/masterha_check_status")]),s._v(" "),a("p",[s._v("-rwxr-xr-x 1 root root 3201 12æœˆ 13 2012 /usr/bin/masterha_conf_host")]),s._v(" "),a("p",[s._v("-rwxr-xr-x 1 root root 2517 12æœˆ 13 2012 /usr/bin/masterha_manager")]),s._v(" "),a("p",[s._v("-rwxr-xr-x 1 root root 2165 12æœˆ 13 2012 /usr/bin/masterha_master_monitor")]),s._v(" "),a("p",[s._v("-rwxr-xr-x 1 root root 2373 12æœˆ 13 2012 /usr/bin/masterha_master_switch")]),s._v(" "),a("p",[s._v("-rwxr-xr-x 1 root root 3879 12æœˆ 13 2012 /usr/bin/masterha_secondary_check")]),s._v(" "),a("p",[s._v("-rwxr-xr-x 1 root root 1739 12æœˆ 13 2012 /usr/bin/masterha_stop")]),s._v(" "),a("h1",{attrs:{id:"_3-é…ç½®æ‰€æœ‰ä¸»æœºç›¸äº’sshç™»å½•æ— å¯†ç éªŒè¯-ä½¿ç”¨keyç™»å½•-å·¥ä½œä¸­å¸¸ç”¨-ã€‚ä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„-ä¸èƒ½ç¦æ­¢-password-ç™»é™†-å¦åˆ™ä¼šå‡ºç°é”™è¯¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-é…ç½®æ‰€æœ‰ä¸»æœºç›¸äº’sshç™»å½•æ— å¯†ç éªŒè¯-ä½¿ç”¨keyç™»å½•-å·¥ä½œä¸­å¸¸ç”¨-ã€‚ä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„-ä¸èƒ½ç¦æ­¢-password-ç™»é™†-å¦åˆ™ä¼šå‡ºç°é”™è¯¯"}},[s._v("#")]),s._v(" 3.é…ç½®æ‰€æœ‰ä¸»æœºç›¸äº’SSHç™»å½•æ— å¯†ç éªŒè¯ï¼ˆä½¿ç”¨keyç™»å½•ï¼Œå·¥ä½œä¸­å¸¸ç”¨ï¼‰ã€‚ä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šä¸èƒ½ç¦æ­¢ password ç™»é™†ï¼Œå¦åˆ™ä¼šå‡ºç°é”™è¯¯")]),s._v(" "),a("p",[s._v("sshå…å¯†ç ç™»å½•")]),s._v(" "),a("p",[s._v("[root@host67 ~]# ssh-keygen -t rsa")]),s._v(" "),a("p",[s._v("Generating public/private rsa key pair.")]),s._v(" "),a("p",[s._v("Enter file in which to save the key (/root/.ssh/id_rsa): å›è½¦")]),s._v(" "),a("p",[s._v("Enter passphrase (empty for no passphrase): å›è½¦")]),s._v(" "),a("p",[s._v("Enter same passphrase again: å›è½¦")]),s._v(" "),a("p",[s._v("Your identification has been saved in /root/.ssh/id_rsa.")]),s._v(" "),a("p",[s._v("Your public key has been saved in /root/.ssh/id_rsa.pub.")]),s._v(" "),a("p",[s._v("The key fingerprint is:")]),s._v(" "),a("p",[s._v("e1:9f:7e:15:f1ğŸ‡©ğŸ‡ª07:d3:33:03:cc:3d:36:0c:96:26 root@host67.cn")]),s._v(" "),a("p",[s._v("The key's randomart image is:")]),s._v(" "),a("p",[s._v("+--[ RSA 2048]----+")]),s._v(" "),a("p",[s._v("| oo= |")]),s._v(" "),a("p",[s._v("| E."),a("em",[s._v(".")]),s._v(" |")]),s._v(" "),a("p",[s._v("| . o o+o|")]),s._v(" "),a("p",[s._v("| . . ++o|")]),s._v(" "),a("p",[s._v("| S ==|")]),s._v(" "),a("p",[s._v("| . . . +|")]),s._v(" "),a("p",[s._v("| o . .|")]),s._v(" "),a("p",[s._v("| . . |")]),s._v(" "),a("p",[s._v("| .. |")]),s._v(" "),a("p",[s._v("+-----------------+")]),s._v(" "),a("p",[s._v("[root@host67 ~]# ssh-copy-id 10.10.10.68")]),s._v(" "),a("p",[s._v("[root@host67 ~]# ssh-copy-id 10.10.10.69")]),s._v(" "),a("p",[s._v("[root@host67 ~]# ssh-copy-id 10.10.10.70")]),s._v(" "),a("p",[s._v("å…¶ä»–ä¸»æœºé‡å¤ä¸Šé¢æ“ä½œã€‚")]),s._v(" "),a("h1",{attrs:{id:"_4-æ­å»ºä¸»ä»å¤åˆ¶ç¯å¢ƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-æ­å»ºä¸»ä»å¤åˆ¶ç¯å¢ƒ"}},[s._v("#")]),s._v(" 4.æ­å»ºä¸»ä»å¤åˆ¶ç¯å¢ƒ")]),s._v(" "),a("p",[s._v("æ³¨æ„ï¼šbinlog-do-db å’Œ replicate-ignore-db è®¾ç½®å¿…é¡»ç›¸åŒã€‚ MHA åœ¨å¯åŠ¨æ—¶å€™ä¼šæ£€æµ‹è¿‡æ»¤è§„åˆ™ï¼Œå¦‚æœè¿‡æ»¤è§„åˆ™ä¸åŒï¼ŒMHA ä¸å¯åŠ¨ç›‘æ§å’Œæ•…éšœè½¬ç§»ã€‚")]),s._v(" "),a("p",[s._v("ï¼ˆ1ï¼‰åœ¨host68é…ç½®ä¸»æ•°æ®åº“æœåŠ¡å™¨")]),s._v(" "),a("p",[s._v("åˆ›å»ºéœ€è¦åŒæ­¥çš„æ•°æ®åº“ï¼š")]),s._v(" "),a("p",[s._v("mysql> create database HA;")]),s._v(" "),a("p",[s._v("mysql> use HA;")]),s._v(" "),a("p",[s._v("mysql> create table test(id int,name varchar(20));")]),s._v(" "),a("p",[s._v("service mysqld stop")]),s._v(" "),a("p",[s._v("é…ç½®my.cnf:")]),s._v(" "),a("p",[s._v("vim /etc/my.cnf")]),s._v(" "),a("p",[s._v("log-bin=mysql-bin-master #å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—")]),s._v(" "),a("p",[s._v("server-id=1 #æœ¬æœºæ•°æ®åº“ID æ ‡ç¤º")]),s._v(" "),a("p",[s._v("binlog-do-db=HA #å¯ä»¥è¢«ä»æœåŠ¡å™¨å¤åˆ¶çš„åº“ã€‚äºŒè¿›åˆ¶éœ€è¦åŒæ­¥çš„æ•°æ®åº“å")]),s._v(" "),a("p",[s._v("binlog-ignore-db=mysql #ä¸å¯ä»¥è¢«ä»æœåŠ¡å™¨å¤åˆ¶çš„åº“")]),s._v(" "),a("p",[s._v("validate-password=off")]),s._v(" "),a("p",[s._v("é‡å¯mysql:")]),s._v(" "),a("p",[s._v("systemctl restart mysqld")]),s._v(" "),a("p",[s._v("æˆæƒï¼š")]),s._v(" "),a("p",[s._v("mysql> grant replication slave on "),a("em",[s._v(".")]),s._v(" to repl@'10.10.10.%' identified by '123456';")]),s._v(" "),a("p",[s._v("mysql> flush privileges;")]),s._v(" "),a("p",[s._v("æŸ¥çœ‹çŠ¶æ€ä¿¡æ¯ï¼š")]),s._v(" "),a("p",[s._v("mysql> show master status;")]),s._v(" "),a("p",[s._v("å¯¼å‡ºæ•°æ®åº“åˆ°ä»æœåŠ¡å™¨(2ä¸ªä»)")]),s._v(" "),a("p",[s._v("mysqldump -uroot -p123456 â€“B HA >HA.sql")]),s._v(" "),a("p",[s._v("scp HA.sql 10.10.10.65:/root")]),s._v(" "),a("p",[s._v("scp HA.sql 10.10.10.66:/root")]),s._v(" "),a("p",[s._v("ï¼ˆ2ï¼‰åœ¨host69å¯¼å…¥æ•°æ®åº“å¹¶é…ç½®ä»æœåŠ¡ï¼š")]),s._v(" "),a("p",[s._v("[root@host69 ~]# mysql -uroot -p123456 <HA.sql")]),s._v(" "),a("p",[s._v("é…ç½®my.cnf:")]),s._v(" "),a("p",[s._v("vim /etc/my.cnf")]),s._v(" "),a("p",[s._v("log-bin=mysql-slave1 #å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—")]),s._v(" "),a("p",[s._v("server-id=2 #æœ¬æœºæ•°æ®åº“ID æ ‡ç¤º")]),s._v(" "),a("p",[s._v("binlog-do-db=HA #å¯ä»¥è¢«ä»æœåŠ¡å™¨å¤åˆ¶çš„åº“ã€‚äºŒè¿›åˆ¶éœ€è¦åŒæ­¥çš„æ•°æ®åº“å")]),s._v(" "),a("p",[s._v("binlog-ignore-db=mysql #ä¸å¯ä»¥è¢«ä»æœåŠ¡å™¨å¤åˆ¶çš„åº“")]),s._v(" "),a("p",[s._v("log_slave_updates=1 #åªæœ‰å¼€å¯log_slave_updatesï¼Œä»åº“binlogæ‰ä¼šè®°å½•ä¸»åº“åŒæ­¥çš„æ“ä½œæ—¥å¿—")]),s._v(" "),a("p",[s._v("validate-password=off")]),s._v(" "),a("p",[s._v("[root@host69 ~]# systemctl restart mysqld é‡å¯mysql")]),s._v(" "),a("p",[s._v("mysql> grant replication slave on "),a("em",[s._v(".")]),s._v(" to 'repl'@'10.10.10.%' identified by '123456';")]),s._v(" "),a("p",[s._v("mysql> flush privileges;")]),s._v(" "),a("p",[s._v("å»ºç«‹ä¸»ä»å…³ç³»")]),s._v(" "),a("p",[s._v("mysql> stop slave;")]),s._v(" "),a("p",[s._v("mysql> change master to master_host='10.10.10.68',master_user='repl',master_password='123456';")]),s._v(" "),a("p",[s._v("ï¼ˆ3ï¼‰åœ¨host70å¯¼å…¥æ•°æ®åº“å¹¶é…ç½®ä»æœåŠ¡ï¼š")]),s._v(" "),a("p",[s._v("[root@host70 ~]# mysql -uroot -p123456 <HA.sql")]),s._v(" "),a("p",[s._v("é…ç½®my.cnf:")]),s._v(" "),a("p",[s._v("vim /etc/my.cnf")]),s._v(" "),a("p",[s._v("log-bin=mysql-slave2 #å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—")]),s._v(" "),a("p",[s._v("server-id=3 #æœ¬æœºæ•°æ®åº“ID æ ‡ç¤º")]),s._v(" "),a("p",[s._v("binlog-do-db=HA #å¯ä»¥è¢«ä»æœåŠ¡å™¨å¤åˆ¶çš„åº“ã€‚äºŒè¿›åˆ¶éœ€è¦åŒæ­¥çš„æ•°æ®åº“å")]),s._v(" "),a("p",[s._v("binlog-ignore-db=mysql #ä¸å¯ä»¥è¢«ä»æœåŠ¡å™¨å¤åˆ¶çš„åº“")]),s._v(" "),a("p",[s._v("log_slave_updates=1 #åªæœ‰å¼€å¯log_slave_updatesï¼Œä»åº“binlogæ‰ä¼šè®°å½•ä¸»åº“åŒæ­¥çš„æ“ä½œæ—¥å¿—")]),s._v(" "),a("p",[s._v("validate-password=off")]),s._v(" "),a("p",[s._v("[root@host70 ~]# systemctl restart mysqld é‡å¯mysql")]),s._v(" "),a("p",[s._v("mysql> grant replication slave on "),a("em",[s._v(".")]),s._v(" to 'repl'@'10.10.10.%' identified by '123456';")]),s._v(" "),a("p",[s._v("mysql> flush privileges;")]),s._v(" "),a("p",[s._v("å»ºç«‹ä¸»ä»å…³ç³»")]),s._v(" "),a("p",[s._v("mysql> stop slave;")]),s._v(" "),a("p",[s._v("mysql> change master to master_host='10.10.10.68',master_user='repl',master_password='123456';")]),s._v(" "),a("p",[s._v("ï¼ˆ4ï¼‰ä¸¤å°slaveæœåŠ¡å™¨è®¾ç½®read_onlyï¼ˆä»åº“å¯¹å¤–æä¾›è¯»æœåŠ¡ï¼Œåªæ‰€ä»¥æ²¡æœ‰å†™è¿›é…ç½®æ–‡ä»¶ï¼Œæ˜¯å› ä¸ºslaveéšæ—¶ä¼šæå‡ä¸ºmasterï¼‰")]),s._v(" "),a("p",[s._v("[root@host69~]# mysql -uroot -p123456 -e 'set global read_only=1'")]),s._v(" "),a("p",[s._v("[root@host70 ~]# mysql -uroot -p123456 -e 'set global read_only=1'")]),s._v(" "),a("p",[s._v("ï¼ˆ5ï¼‰åˆ›å»ºç›‘æ§ç”¨æˆ·ï¼ˆåœ¨ä¸»ä»ä¸Šéƒ½æ‰§è¡Œï¼‰ï¼š")]),s._v(" "),a("p",[s._v("mysql> grant all privileges on "),a("em",[s._v(".")]),s._v(" to 'root'@'10.10.10.%' identified by '123456';")]),s._v(" "),a("p",[s._v("mysql> flush privileges;")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œæ•´ä¸ªé›†ç¾¤ç¯å¢ƒå·²ç»æ­å»ºå®Œæ¯•ï¼Œå‰©ä¸‹çš„å°±æ˜¯é…ç½®MHAè½¯ä»¶äº†ã€‚")]),s._v(" "),a("h1",{attrs:{id:"_5-é…ç½®mha"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-é…ç½®mha"}},[s._v("#")]),s._v(" 5.é…ç½®MHA")]),s._v(" "),a("p",[s._v("ï¼ˆ1ï¼‰åˆ›å»ºMHAçš„å·¥ä½œç›®å½•ï¼Œå¹¶ä¸”åˆ›å»ºç›¸å…³é…ç½®æ–‡ä»¶ï¼ˆåœ¨è½¯ä»¶åŒ…è§£å‹åçš„ç›®å½•é‡Œé¢æœ‰æ ·ä¾‹é…ç½®æ–‡ä»¶ï¼‰ã€‚")]),s._v(" "),a("p",[s._v("[root@ host67 ~]# mkdir -p /etc/masterha")]),s._v(" "),a("p",[s._v("[root@ host67 ~]# mkdir -p /var/log/masterha/app1")]),s._v(" "),a("p",[s._v("[root@ host67 ~]# vim /etc/masterha/app1.cnf")]),s._v(" "),a("p",[s._v("ä¿®æ”¹app1.cnfé…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹åçš„æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼ˆæ³¨æ„ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„æ³¨é‡Šéœ€è¦å»æ‰ï¼Œæˆ‘è¿™é‡Œæ˜¯ä¸ºäº†è§£é‡Šæ¸…æ¥šï¼‰ï¼š")]),s._v(" "),a("p",[s._v("[server default]")]),s._v(" "),a("p",[s._v("manager_workdir=/var/log/masterha/app1 //è®¾ç½®managerçš„å·¥ä½œç›®å½•")]),s._v(" "),a("p",[s._v("manager_log=/var/log/masterha/app1/manager.log //è®¾ç½®managerçš„æ—¥å¿—")]),s._v(" "),a("p",[s._v("master_binlog_dir=/data/mysql //è®¾ç½®master ä¿å­˜binlogçš„ä½ç½®ï¼Œä»¥ä¾¿MHAå¯ä»¥æ‰¾åˆ°masterçš„æ—¥å¿—ï¼Œæˆ‘è¿™é‡Œçš„ä¹Ÿå°±æ˜¯mysqlçš„æ•°æ®ç›®å½•")]),s._v(" "),a("p",[s._v("master_ip_failover_script= /usr/local/bin/master_ip_failover //è®¾ç½®è‡ªåŠ¨failoveræ—¶å€™çš„åˆ‡æ¢è„šæœ¬")]),s._v(" "),a("p",[s._v("master_ip_online_change_script= /usr/local/bin/master_ip_online_change //è®¾ç½®æ‰‹åŠ¨åˆ‡æ¢æ—¶å€™çš„åˆ‡æ¢è„šæœ¬")]),s._v(" "),a("p",[s._v("password=123456 //è®¾ç½®mysqlä¸­rootç”¨æˆ·çš„å¯†ç ï¼Œè¿™ä¸ªå¯†ç æ˜¯å‰æ–‡ä¸­åˆ›å»ºç›‘æ§ç”¨æˆ·çš„é‚£ä¸ªå¯†ç ")]),s._v(" "),a("p",[s._v("user=root è®¾ç½®ç›‘æ§ç”¨æˆ·root")]),s._v(" "),a("p",[s._v("ping_interval=1 //è®¾ç½®ç›‘æ§ä¸»åº“ï¼Œå‘é€pingåŒ…çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤æ˜¯3ç§’ï¼Œå°è¯•ä¸‰æ¬¡æ²¡æœ‰å›åº”çš„æ—¶å€™è‡ªåŠ¨è¿›è¡Œrailover")]),s._v(" "),a("p",[s._v("remote_workdir=/tmp //è®¾ç½®è¿œç«¯mysqlåœ¨å‘ç”Ÿåˆ‡æ¢æ—¶binlogçš„ä¿å­˜ä½ç½®")]),s._v(" "),a("p",[s._v("repl_password=123456 //è®¾ç½®å¤åˆ¶ç”¨æˆ·çš„å¯†ç ")]),s._v(" "),a("p",[s._v("repl_user=repl //è®¾ç½®å¤åˆ¶ç¯å¢ƒä¸­çš„å¤åˆ¶ç”¨æˆ·å")]),s._v(" "),a("p",[s._v("report_script=/usr/local/send_report //è®¾ç½®å‘ç”Ÿåˆ‡æ¢åå‘é€çš„æŠ¥è­¦çš„è„šæœ¬")]),s._v(" "),a("p",[s._v('shutdown_script="" //è®¾ç½®æ•…éšœå‘ç”Ÿåå…³é—­æ•…éšœä¸»æœºè„šæœ¬ï¼ˆè¯¥è„šæœ¬çš„ä¸»è¦ä½œç”¨æ˜¯å…³é—­ä¸»æœºæ”¾åœ¨å‘ç”Ÿè„‘è£‚,è¿™é‡Œæ²¡æœ‰ä½¿ç”¨ï¼‰')]),s._v(" "),a("p",[s._v("ssh_user=root //è®¾ç½®sshçš„ç™»å½•ç”¨æˆ·å")]),s._v(" "),a("p",[s._v("[server1]")]),s._v(" "),a("p",[s._v("hostname=10.10.10.68")]),s._v(" "),a("p",[s._v("port=3306")]),s._v(" "),a("p",[s._v("[server2]")]),s._v(" "),a("p",[s._v("hostname=10.10.10.69")]),s._v(" "),a("p",[s._v("port=3306")]),s._v(" "),a("p",[s._v("candidate_master=1 #è®¾ç½®ä¸ºå€™é€‰masterï¼Œå¦‚æœè®¾ç½®è¯¥å‚æ•°ä»¥åï¼Œå‘ç”Ÿä¸»ä»åˆ‡æ¢ä»¥åå°†ä¼šå°†æ­¤ä»åº“æå‡ä¸ºä¸»åº“ï¼Œå³ä½¿è¿™ä¸ªä¸»åº“ä¸æ˜¯é›†ç¾¤ä¸­äº‹ä»¶æœ€æ–°çš„slave")]),s._v(" "),a("p",[s._v("check_repl_delay=0 #é»˜è®¤æƒ…å†µä¸‹å¦‚æœä¸€ä¸ªslaveè½åmaster 100Mçš„relay logsçš„è¯ï¼ŒMHAå°†ä¸ä¼šé€‰æ‹©è¯¥slaveä½œä¸ºä¸€ä¸ªæ–°çš„masterï¼Œå› ä¸ºå¯¹äºè¿™ä¸ªslaveçš„æ¢å¤éœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œé€šè¿‡è®¾ç½®check_repl_delay=0,MHAè§¦å‘åˆ‡æ¢åœ¨é€‰æ‹©ä¸€ä¸ªæ–°çš„masterçš„æ—¶å€™å°†ä¼šå¿½ç•¥å¤åˆ¶å»¶æ—¶ï¼Œè¿™ä¸ªå‚æ•°å¯¹äºè®¾ç½®äº†candidate_master=1çš„ä¸»æœºéå¸¸æœ‰ç”¨ï¼Œå› ä¸ºè¿™ä¸ªå€™é€‰ä¸»åœ¨åˆ‡æ¢çš„è¿‡ç¨‹ä¸­ä¸€å®šæ˜¯æ–°çš„master")]),s._v(" "),a("p",[s._v("[server3]")]),s._v(" "),a("p",[s._v("hostname=10.10.10.70")]),s._v(" "),a("p",[s._v("port=3306")]),s._v(" "),a("p",[s._v("ï¼ˆ2ï¼‰è®¾ç½®relay logçš„æ¸…é™¤æ–¹å¼ï¼ˆåœ¨æ¯ä¸ªslaveèŠ‚ç‚¹ä¸Šï¼‰ï¼š")]),s._v(" "),a("p",[s._v("[root@host69 ~]# mysql -uroot -p123456 -e 'set global relay_log_purge=0'")]),s._v(" "),a("p",[s._v("[root@host70 ~]# mysql -uroot -p123456 -e 'set global relay_log_purge=0'")]),s._v(" "),a("p",[s._v("æ³¨æ„ï¼š")]),s._v(" "),a("p",[s._v("MHAåœ¨å‘ç”Ÿåˆ‡æ¢çš„è¿‡ç¨‹ä¸­ï¼Œä»åº“çš„æ¢å¤è¿‡ç¨‹ä¸­ä¾èµ–äºrelay logçš„ç›¸å…³ä¿¡æ¯ï¼Œæ‰€ä»¥è¿™é‡Œè¦å°†relay logçš„è‡ªåŠ¨æ¸…é™¤è®¾ç½®ä¸ºOFFï¼Œé‡‡ç”¨æ‰‹åŠ¨æ¸…é™¤relay logçš„æ–¹å¼ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä»æœåŠ¡å™¨ä¸Šçš„ä¸­ç»§æ—¥å¿—ä¼šåœ¨SQLçº¿ç¨‹æ‰§è¡Œå®Œæ¯•åè¢«è‡ªåŠ¨åˆ é™¤ã€‚ä½†æ˜¯åœ¨MHAç¯å¢ƒä¸­ï¼Œè¿™äº›ä¸­ç»§æ—¥å¿—åœ¨æ¢å¤å…¶ä»–ä»æœåŠ¡å™¨æ—¶å¯èƒ½ä¼šè¢«ç”¨åˆ°ï¼Œå› æ­¤éœ€è¦ç¦ç”¨ä¸­ç»§æ—¥å¿—çš„è‡ªåŠ¨åˆ é™¤åŠŸèƒ½ã€‚å®šæœŸæ¸…é™¤ä¸­ç»§æ—¥å¿—éœ€è¦è€ƒè™‘åˆ°å¤åˆ¶å»¶æ—¶çš„é—®é¢˜ã€‚åœ¨ext3çš„æ–‡ä»¶ç³»ç»Ÿä¸‹ï¼Œåˆ é™¤å¤§çš„æ–‡ä»¶éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œä¼šå¯¼è‡´ä¸¥é‡çš„å¤åˆ¶å»¶æ—¶ã€‚ä¸ºäº†é¿å…å¤åˆ¶å»¶æ—¶ï¼Œéœ€è¦æš‚æ—¶ä¸ºä¸­ç»§æ—¥å¿—åˆ›å»ºç¡¬é“¾æ¥ï¼Œå› ä¸ºåœ¨Linuxç³»ç»Ÿä¸­é€šè¿‡ç¡¬é“¾æ¥åˆ é™¤å¤§æ–‡ä»¶é€Ÿåº¦ä¼šå¾ˆå¿«ã€‚ï¼ˆåœ¨mysqlæ•°æ®åº“ä¸­ï¼Œåˆ é™¤å¤§è¡¨æ—¶ï¼Œé€šå¸¸ä¹Ÿé‡‡ç”¨å»ºç«‹ç¡¬é“¾æ¥çš„æ–¹å¼ï¼‰")]),s._v(" "),a("p",[s._v("ï¼ˆ3ï¼‰æ£€æŸ¥SSHé…ç½®")]),s._v(" "),a("p",[s._v("æ£€æŸ¥MHA Mangeråˆ°æ‰€æœ‰MHA Nodeçš„SSHè¿æ¥çŠ¶æ€ï¼š")]),s._v(" "),a("p",[s._v("[root@host67~]# masterha_check_ssh --conf=/etc/masterha/app1.cnf")]),s._v(" "),a("p",[s._v("ï¼ˆ4ï¼‰æ£€æŸ¥æ•´ä¸ªå¤åˆ¶ç¯å¢ƒçŠ¶å†µã€‚")]),s._v(" "),a("p",[s._v("é€šè¿‡masterha_check_replè„šæœ¬æŸ¥çœ‹æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€")]),s._v(" "),a("p",[s._v("[root@ host67 ~]# masterha_check_repl --conf=/etc/masterha/app1.cnf")]),s._v(" "),a("p",[s._v("MySQL Replication Health is NOT OK! å¦‚æœæç¤ºè¿™ä¸ªä¸okï¼Œè¯´æ˜æœ‰é—®é¢˜")]),s._v(" "),a("p",[s._v("MySQL Replication Health is OK. æ˜¾ç¤ºOk ï¼Œæ­£å¸¸ï¼")]),s._v(" "),a("p",[s._v("ï¼ˆ5ï¼‰æ£€æŸ¥MHA Managerçš„çŠ¶æ€ï¼š")]),s._v(" "),a("p",[s._v("é€šè¿‡master_check_statusè„šæœ¬æŸ¥çœ‹Managerçš„çŠ¶æ€ï¼š")]),s._v(" "),a("p",[s._v("[root@host67 ~]# masterha_check_status --conf=/etc/masterha/app1.cnf")]),s._v(" "),a("p",[s._v("app1 is stopped(2:NOT_RUNNING).")]),s._v(" "),a("p",[s._v('æ³¨æ„ï¼šå¦‚æœæ­£å¸¸ï¼Œä¼šæ˜¾ç¤º"PING_OK"ï¼Œå¦åˆ™ä¼šæ˜¾ç¤º"NOT_RUNNING"ï¼Œè¿™ä»£è¡¨MHAç›‘æ§æ²¡æœ‰å¼€å¯ã€‚')]),s._v(" "),a("p",[s._v("ï¼ˆ6ï¼‰å¼€å¯MHA Managerç›‘æ§")]),s._v(" "),a("p",[s._v("[root@ host67 ~]# nohup masterha_manager --conf=/etc/masterha/app1.cnf --remove_dead_master_conf --ignore_last_failover < /dev/null > /var/log/masterha/app1/manager.log 2>&1 &")]),s._v(" "),a("p",[s._v("[1] 30867")]),s._v(" "),a("p",[s._v("å¯åŠ¨å‚æ•°ä»‹ç»ï¼š")]),s._v(" "),a("p",[s._v("--remove_dead_master_conf è¯¥å‚æ•°ä»£è¡¨å½“å‘ç”Ÿä¸»ä»åˆ‡æ¢åï¼Œè€çš„ä¸»åº“çš„ipå°†ä¼šä»é…ç½®æ–‡ä»¶ä¸­ç§»é™¤ã€‚")]),s._v(" "),a("p",[s._v("--manger_log æ—¥å¿—å­˜æ”¾ä½ç½®")]),s._v(" "),a("p",[s._v("--ignore_last_failover åœ¨ç¼ºçœæƒ…å†µä¸‹ï¼Œå¦‚æœMHAæ£€æµ‹åˆ°è¿ç»­å‘ç”Ÿå®•æœºï¼Œä¸”ä¸¤æ¬¡å®•æœºé—´éš”ä¸è¶³8å°æ—¶çš„è¯ï¼Œåˆ™ä¸ä¼šè¿›è¡ŒFailoverï¼Œä¹‹æ‰€ä»¥è¿™æ ·é™åˆ¶æ˜¯ä¸ºäº†é¿å…ping-pongæ•ˆåº”ã€‚è¯¥å‚æ•°ä»£è¡¨å¿½ç•¥ä¸Šæ¬¡MHAè§¦å‘åˆ‡æ¢äº§ç”Ÿçš„æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒMHAå‘ç”Ÿåˆ‡æ¢åä¼šåœ¨æ—¥å¿—ç›®å½•ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æˆ‘è®¾ç½®çš„/dataäº§ç”Ÿapp1.failover.completeæ–‡ä»¶ï¼Œä¸‹æ¬¡å†æ¬¡åˆ‡æ¢çš„æ—¶å€™å¦‚æœå‘ç°è¯¥ç›®å½•ä¸‹å­˜åœ¨è¯¥æ–‡ä»¶å°†ä¸å…è®¸è§¦å‘åˆ‡æ¢ï¼Œé™¤éåœ¨ç¬¬ä¸€æ¬¡åˆ‡æ¢åæ”¶åˆ°åˆ é™¤è¯¥æ–‡ä»¶ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œè®¾ç½®ä¸º--ignore_last_failoverã€‚")]),s._v(" "),a("p",[s._v("æŸ¥çœ‹MHA Managerç›‘æ§æ˜¯å¦æ­£å¸¸ï¼š")]),s._v(" "),a("p",[s._v("[root@ host67 ~]# masterha_check_status --conf=/etc/masterha/app1.cnf")]),s._v(" "),a("p",[s._v("app1 (pid:20386) is running(0:PING_OK), master:10.10.10.64")]),s._v(" "),a("p",[s._v("å¯ä»¥çœ‹è§å·²ç»åœ¨ç›‘æ§äº†ï¼Œè€Œä¸”masterçš„ä¸»æœºä¸º10.10.10.64")]),s._v(" "),a("p",[s._v("ï¼ˆ7ï¼‰æŸ¥çœ‹å¯åŠ¨æ—¥å¿—")]),s._v(" "),a("p",[s._v("[root@host67 ~]# tail -n20 /var/log/masterha/app1/manager.log")]),s._v(" "),a("p",[s._v("â€¦â€¦â€¦â€¦â€¦â€¦..")]),s._v(" "),a("p",[s._v("â€¦â€¦â€¦â€¦â€¦â€¦â€¦")]),s._v(" "),a("p",[s._v("Sun Apr 20 19:12:01 2014 - [info] Ping(SELECT) succeeded, waiting until MySQL doesn't respond..")]),s._v(" "),a("p",[s._v('å…¶ä¸­"Ping(SELECT) succeeded, waiting until MySQL doesn\'t respond.."è¯´æ˜æ•´ä¸ªç³»ç»Ÿå·²ç»å¼€å§‹ç›‘æ§äº†ã€‚')]),s._v(" "),a("p",[s._v("ï¼ˆ8ï¼‰å…³é—­MHA Manageç›‘æ§")]),s._v(" "),a("p",[s._v("å…³é—­å¾ˆç®€å•ï¼Œä½¿ç”¨masterha_stopå‘½ä»¤å®Œæˆã€‚")]),s._v(" "),a("p",[s._v("[root@host67~]# masterha_stop --conf=/etc/masterha/app1.conf")]),s._v(" "),a("p",[s._v("Stopped app1 successfully.")]),s._v(" "),a("p",[s._v("[1]+ Exit 1 nohup masterha_manager --conf=/etc/masterha/app1.cnf --remove_dead_master_conf --ignore_last_failover --manager_log=/data/mamanager.log")]),s._v(" "),a("p",[s._v("ï¼ˆ9ï¼‰æ¨¡æ‹Ÿæ•…éšœ")]),s._v(" "),a("p",[s._v("[root@host67 ~]# tail -f /var/log/masterha/app1/manager.log æ‰“å¼€æ–°çª—å£è§‚å¯Ÿæ—¥å¿—")]),s._v(" "),a("p",[s._v("[root@host68~]# service mysqld stop æ¨¡æ‹Ÿä¸»åº“æŒ‚æ‰")]),s._v(" "),a("p",[s._v("çœ‹æ—¥å¿—æ˜¯å¦åˆ‡æ¢masteræˆåŠŸ")]),s._v(" "),a("p",[s._v("From:")]),s._v(" "),a("p",[s._v("10.10.10.68 (current master)")]),s._v(" "),a("p",[s._v("+--10.10.10.69")]),s._v(" "),a("p",[s._v("+--10.10.10.70")]),s._v(" "),a("p",[s._v("To:")]),s._v(" "),a("p",[s._v("10.10.10.69 (new master)")]),s._v(" "),a("p",[s._v("+--10.10.10.70")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info]")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] * Phase 3.3: New Master Diff Log Generation Phase..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info]")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] This server has all relay logs. No need to generate diff files from the latest slave.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info]")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] * Phase 3.4: Master Log Apply Phase..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info]")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] *NOTICE: If any error happens from this phase, manual recovery is needed.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] Starting recovery on 10.10.10.69(10.10.10.69:3306)..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] This server has all relay logs. Waiting all logs to be applied..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] done.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] All relay logs were successfully applied.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] Getting new master's binlog name and position..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] mysql-slave1.000001:598")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] All other slaves should start replication from here. Statement should be: CHANGE MASTER TO MASTER_HOST='10.10.10.69', MASTER_PORT=3306, MASTER_LOG_FILE='mysql-slave1.000001', MASTER_LOG_POS=598, MASTER_USER='repl', MASTER_PASSWORD='xxx';")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [warning] master_ip_failover_script is not set. Skipping taking over new master ip address.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] Setting read_only=0 on 10.10.10.69(10.10.10.69:3306)..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] ok.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] ** Finished master recovery successfully.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] * Phase 3: Master Recovery Phase completed.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info]")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] * Phase 4: Slaves Recovery Phase..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info]")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] * Phase 4.1: Starting Parallel Slave Diff Log Generation Phase..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info]")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] -- Slave diff file generation on host 10.10.10.70(10.10.10.70:3306) started, pid: 2923. Check tmp log /etc/masterha/app1/10.10.10.70_3306_20171009220233.log if it takes time..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:37 2017 - [info]")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:37 2017 - [info] Log messages from 10.10.10.70 ...")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:37 2017 - [info]")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:36 2017 - [info] This server has all relay logs. No need to generate diff files from the latest slave.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:37 2017 - [info] End of log messages from 10.10.10.70.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:37 2017 - [info] -- 10.10.10.70(10.10.10.70:3306) has the latest relay log events.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:37 2017 - [info] Generating relay diff files from the latest slave succeeded.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:37 2017 - [info]")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:37 2017 - [info] * Phase 4.2: Starting Parallel Slave Log Apply Phase..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:37 2017 - [info]")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:37 2017 - [info] -- Slave recovery on host 10.10.10.70(10.10.10.70:3306) started, pid: 2925. Check tmp log /etc/masterha/app1/10.10.10.70_3306_20171009220233.log if it takes time..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info]")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info] Log messages from 10.10.10.70 ...")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info]")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:37 2017 - [info] Starting recovery on 10.10.10.70(10.10.10.70:3306)..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:37 2017 - [info] This server has all relay logs. Waiting all logs to be applied..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:37 2017 - [info] done.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:37 2017 - [info] All relay logs were successfully applied.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:37 2017 - [info] Resetting slave 10.10.10.70(10.10.10.70:3306) and starting replication from the new master 10.10.10.69(10.10.10.69:3306)..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info] Executed CHANGE MASTER.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info] Slave started.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info] End of log messages from 10.10.10.70.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info] -- Slave recovery on host 10.10.10.70(10.10.10.70:3306) succeeded.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info] All new slave servers recovered successfully.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info]")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info] * Phase 5: New master cleanup phase..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info]")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info] Resetting slave info on the new master..")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info] 10.10.10.69: Resetting slave info succeeded.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info] Master failover to 10.10.10.69(10.10.10.69:3306) completed successfully.")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info] Deleted server1 entry from /etc/masterha/app1.conf .")]),s._v(" "),a("p",[s._v("Mon Oct 9 22:02:38 2017 - [info]")]),s._v(" "),a("p",[s._v("----- Failover Report -----")]),s._v(" "),a("p",[s._v("app1: MySQL Master failover 10.10.10.68 to 10.10.10.69 succeeded")]),s._v(" "),a("p",[s._v("Master 10.10.10.68 is down!")]),s._v(" "),a("p",[s._v("Check MHA Manager logs at host67.cn:/var/log/masterha/app1/manager.log for details.")]),s._v(" "),a("p",[s._v("Started automated(non-interactive) failover.")]),s._v(" "),a("p",[s._v("The latest slave 10.10.10.69(10.10.10.69:3306) has all relay logs for recovery.")]),s._v(" "),a("p",[s._v("Selected 10.10.10.69 as a new master.")]),s._v(" "),a("p",[s._v("10.10.10.69: OK: Applying all logs succeeded.")]),s._v(" "),a("p",[s._v("10.10.10.70: This host has the latest relay log events.")]),s._v(" "),a("p",[s._v("Generating relay diff files from the latest slave succeeded.")]),s._v(" "),a("p",[s._v("10.10.10.70: OK: Applying all logs succeeded. Slave started, replicating from 10.10.10.69.")]),s._v(" "),a("p",[s._v("10.10.10.69: Resetting slave info succeeded.")]),s._v(" "),a("p",[s._v("Master failover to 10.10.10.69(10.10.10.69:3306) completed successfully.")]),s._v(" "),a("p",[s._v("æˆ‘ä»¬ä»æ—¥å¿—ä¸Šå¯ä»¥çœ‹åˆ°æ•…éšœåˆ‡æ¢æˆåŠŸï¼Œæ­å–œä½ äº†.æ–°çš„masteræ˜¯host69.")]),s._v(" "),a("p",[s._v("ç™»é™†ä»æœåŠ¡å™¨host70æŸ¥çœ‹show slave status\\Gæ˜¯å¦æˆåŠŸåˆ‡æ¢")]),s._v(" "),a("p",[s._v("æ€»ç»“ï¼š")]),s._v(" "),a("p",[s._v("ç›®å‰é«˜å¯ç”¨æ–¹æ¡ˆå¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šå®ç°æ•°æ®åº“çš„é«˜å¯ç”¨ï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ¡ˆheartbeat+drbdï¼ŒClusterã€MGRç­‰ã€‚è¿™äº›é«˜å¯ç”¨è½¯ä»¶å„æœ‰ä¼˜åŠ£ã€‚åœ¨è¿›è¡Œé«˜å¯ç”¨æ–¹æ¡ˆé€‰æ‹©æ—¶ï¼Œä¸»è¦æ˜¯çœ‹ä¸šåŠ¡è¿˜æœ‰å¯¹æ•°æ®ä¸€è‡´æ€§æ–¹é¢çš„è¦æ±‚ã€‚")]),s._v(" "),a("hr"),s._v(" "),a("h1",{attrs:{id:"ç›¸å…³é…ç½®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç›¸å…³é…ç½®"}},[s._v("#")]),s._v(" ç›¸å…³é…ç½®")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("/etc/masterha/app1.cnf é…ç½®æ–‡ä»¶å¤‡ä»½\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("server default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("manager_workdir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/masterha/app1\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("manager_log")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/masterha/app1/manager.log\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("master_binlog_dir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ping_interval")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("remote_workdir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("repl_user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("repl\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("repl_password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ssh_user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("server1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("hostname")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.68\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("server2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("hostname")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.69\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("candidate_master")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("check_repl_delay")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("server3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("hostname")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.70\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("p",[s._v("æ‰©å±•ï¼š")]),s._v(" "),a("p",[s._v("å…³äºé…ç½®VIPé…åˆMHAä½¿ç”¨")]),s._v(" "),a("p",[s._v("vipé…ç½®å¯ä»¥é‡‡ç”¨ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§é€šè¿‡keepalivedçš„æ–¹å¼ç®¡ç†è™šæ‹Ÿipçš„æµ®åŠ¨ï¼›å¦å¤–ä¸€ç§é€šè¿‡è„šæœ¬æ–¹å¼å¯åŠ¨è™šæ‹Ÿipçš„æ–¹å¼ï¼ˆå³ä¸éœ€è¦keepalivedæˆ–è€…heartbeatç±»ä¼¼çš„è½¯ä»¶ï¼‰ã€‚")]),s._v(" "),a("p",[s._v("å…³äºkeepalivedæ–¹å¼æˆ‘è¿™é‡Œä¸è®²äº†ï¼Œå› ä¸ºä¸ºäº†é˜²æ­¢è„‘è£‚å‘ç”Ÿï¼Œæ¨èç”Ÿäº§ç¯å¢ƒé‡‡ç”¨è„šæœ¬çš„æ–¹å¼æ¥ç®¡ç†è™šæ‹Ÿipï¼Œè€Œä¸æ˜¯ä½¿ç”¨keepalivedæ¥å®Œæˆã€‚è‡ªè¡Œè„‘è¡¥ç™¾åº¦æˆ–è€…å‚è€ƒhttp://www.cnblogs.com/gomysql/p/3675429.html")]),s._v(" "),a("p",[s._v("ä¸‹é¢æ˜¯é€šè¿‡è„šæœ¬çš„æ–¹å¼ç®¡ç†VIPã€‚è¿™é‡Œæ˜¯ä¿®æ”¹/usr/local/bin/master_ip_failoverï¼Œä¿®æ”¹å®Œæˆåå†…å®¹å¦‚ä¸‹ï¼Œè€Œä¸”å¦‚æœä½¿ç”¨è„šæœ¬ç®¡ç†vipçš„è¯ï¼Œéœ€è¦æ‰‹åŠ¨åœ¨masteræœåŠ¡å™¨ä¸Šç»‘å®šä¸€ä¸ªvip")]),s._v(" "),a("p",[s._v("ç¼–å†™è„šæœ¬/usr/ /bin/master_ip_failoverï¼Œè¦ä¼šperlè„šæœ¬è¯­è¨€ï¼ˆä¸»åº“ä¸Šæ“ä½œï¼Œxuegod68ï¼‰ã€‚")]),s._v(" "),a("p",[s._v("åœ¨MHA Managerä¿®æ”¹è„šæœ¬ä¿®æ”¹åçš„å†…å®¹å¦‚ä¸‹ï¼ˆå‚è€ƒèµ„æ–™æ¯”è¾ƒå°‘ï¼‰ï¼š")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/env perl")]),s._v("\n\nuse strict"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nuse warnings FATAL "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'all'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nuse Getopt::Long"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmy "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$command")]),s._v(",          "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ssh_user")]),s._v(",        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$orig_master_host")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$orig_master_ip")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$orig_master_port")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$new_master_host")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$new_master_ip")]),s._v(",    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$new_master_port")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmy "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.0.88'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmy "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ssh_start_vip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/init.d/keepalived start"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmy "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ssh_stop_vip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/init.d/keepalived stop"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nGetOptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'command=s'")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$command")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ssh_user=s'")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ssh_user")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'orig_master_host=s'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$orig_master_host")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'orig_master_ip=s'")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$orig_master_ip")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'orig_master_port=i'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$orig_master_port")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'new_master_host=s'")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$new_master_host")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'new_master_ip=s'")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$new_master_ip")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'new_master_port=i'")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$new_master_port")]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nsub main "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    print "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("IN SCRIPT TEST===="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ssh_stop_vip")]),s._v("=="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ssh_start_vip")]),s._v("==="),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$command")]),s._v(" eq "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stop"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$command")]),s._v(" eq "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stopssh"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n        my "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$exit_code")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("eval")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            print "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Disabling the VIP on old master: '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$orig_master_host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("stop_vip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$exit_code")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            warn "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Got Error: '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$exit_code")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$exit_code")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    elsif "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$command")]),s._v(" eq "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n        my "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$exit_code")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("eval")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            print "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Enabling the VIP - '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vip")]),s._v(" on the new master - "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$new_master_host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("start_vip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$exit_code")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            warn "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$exit_code")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$exit_code")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    elsif "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$command")]),s._v(" eq "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"status"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        print "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Checking the Status of the script.. OK '),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#`ssh $ssh_user\\@cluster1 \\" $ssh_start_vip \\"`;')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("usage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A simple system call that enable the VIP on the new master")]),s._v("\nsub "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("start_vip")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" $ssh_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("@$new_master_host "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v('" $ssh_start_vip '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A simple system call that disable the VIP on the old_master")]),s._v("\nsub "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("stop_vip")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" $ssh_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("@$orig_master_host "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v('" $ssh_stop_vip '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nsub usage "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    print\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Usage: master_ip_failover --command=start|stop|stopssh|status --orig_master_host=host --orig_master_ip=ip --orig_master_port=port --new_master_host=host --new_master_ip=ip --new_master_port=port'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br")])]),a("hr"),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/gomysql/p/3675429.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("å‚è€ƒé“¾æ¥"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);