(window.webpackJsonp=window.webpackJsonp||[]).push([[353],{706:function(s,a,t){"use strict";t.r(a);var r=t(0),e=Object(r.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"_1、准备环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、准备环境"}},[s._v("#")]),s._v(" 1、准备环境")]),s._v(" "),a("p",[s._v("zabbix-prxoy是一个代理服务器，它收集监控到的数据，先存放数据库，然后再传送到zabbix-server；所以代理需要一个单独的数据库")]),s._v(" "),a("p",[s._v("zabbix-prxoy的作用：")]),s._v(" "),a("p",[s._v("1、当监控设备过多时，用于分担zabbix-server监控压力")]),s._v(" "),a("p",[s._v("2、针对不同的网络环境，可以组成分布式监控")]),s._v(" "),a("p",[s._v("环境：已安装MySQL 5.7.31")]),s._v(" "),a("p",[s._v("zabbix5.0 ：https://cdn.zabbix.com/zabbix/sources/stable/5.0/zabbix-5.0.2.tar.gz")]),s._v(" "),a("h2",{attrs:{id:"_2、开始安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、开始安装"}},[s._v("#")]),s._v(" 2、开始安装")]),s._v(" "),a("h3",{attrs:{id:"添加zabbix用户用于运行zabbix服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加zabbix用户用于运行zabbix服务"}},[s._v("#")]),s._v(" 添加zabbix用户用于运行zabbix服务")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@swarm-node2 local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# useradd -s /sbin/nologin zabbix　")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"安装依赖包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖包"}},[s._v("#")]),s._v(" 安装依赖包")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" unixODBC-devel net-snmp-devel libevent-devel libxml2-devel libcurl-devel "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"解压源码包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解压源码包"}},[s._v("#")]),s._v(" 解压源码包")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@swarm-node2 local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar -zxf zabbix-5.0.2.tar.gz")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"编译参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译参数"}},[s._v("#")]),s._v(" 编译参数")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./configure "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/zabbix-proxy --enable-proxy --with-mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/mysql/bin/mysql_config --with-net-snmp --with-libcurl --with-libxml2 --with-unixodbc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("--prefix=/usr/local/zabbix-proxy        # 编译安装路径")]),s._v(" "),a("p",[s._v("--enable-prxoy　　　　　　　　　 # 启动proxy端")]),s._v(" "),a("p",[s._v("--with-mysql=/usr/local/mysql/bin/mysql_config    #编译连接mysql相关依赖包，并指定mysql_config的路径")]),s._v(" "),a("p",[s._v("--with-net-snmp　　　　　　　　　#启动snmp相关，用于snmp监控设备")]),s._v(" "),a("p",[s._v("--with-libcurl　　　　　　　　　　 #启动curl相关")]),s._v(" "),a("p",[s._v("--with-libxml2　　　　　　　　　　#启动xml相关")]),s._v(" "),a("p",[s._v("--with-unixodbc　　　　　　　　　#启动odbc相关用于监控数据库")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/03/e44061ad1ce81c4d.png",alt:""}})]),s._v(" "),a("p",[s._v("确认无误后就开始make && make install")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@swarm-node2 zabbix-5.0.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# make && make install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"初始化数据库信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化数据库信息"}},[s._v("#")]),s._v(" 初始化数据库信息")]),s._v(" "),a("p",[s._v("数据库文件在zabbix-5.0.2/database/mysql 中")]),s._v(" "),a("p",[s._v("proxy只需要导入schema.sql即可")]),s._v(" "),a("h4",{attrs:{id:"登录数据库创建zabbix-proxy库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录数据库创建zabbix-proxy库"}},[s._v("#")]),s._v(" 登录数据库创建zabbix-proxy库")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" create database proxy character "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" UTF8 collate utf8_bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row affected "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show databases"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+--------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Database           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" information_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" performance_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" proxy              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sys                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h4",{attrs:{id:"导入数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导入数据"}},[s._v("#")]),s._v(" 导入数据")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("mysql> \nmysql> use proxy;\nDatabase changed\nmysql> source /usr/local/zabbix-5.0.2/database/mysql/schema.sql;\n")])])]),a("h4",{attrs:{id:"配置zabbix-proxy-conf配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置zabbix-proxy-conf配置文件"}},[s._v("#")]),s._v(" 配置zabbix_proxy.conf配置文件")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/03/ae40aa97ab64937c.png",alt:""}})]),s._v(" "),a("h4",{attrs:{id:"修改以下信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改以下信息"}},[s._v("#")]),s._v(" 修改以下信息")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Server")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".137.128                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定zabbix-server的ip地址")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DBHost")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("localhost　　　　　　　　　　　　　"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#以下都是数据库信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DBName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("proxy\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DBUser")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DBPassword")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(".com\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DBSocket")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/mysql/mysql.sock\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DBPort")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"启动zabbix-proxy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动zabbix-proxy"}},[s._v("#")]),s._v(" 启动zabbix-proxy")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@swarm-node2 zabbix-proxy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /usr/local/zabbix-proxy/sbin/zabbix_proxy -c /usr/local/zabbix-proxy/etc/zabbix_proxy.conf")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"启动报错提示找不到mysql相关lib文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动报错提示找不到mysql相关lib文件"}},[s._v("#")]),s._v(" 启动报错提示找不到mysql相关lib文件")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/03/53a3bb47268939cd.png",alt:""}})]),s._v(" "),a("h4",{attrs:{id:"将mysql-lib目录添加到lib环境变量中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将mysql-lib目录添加到lib环境变量中"}},[s._v("#")]),s._v(" 将mysql lib目录添加到lib环境变量中")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@swarm-node2 zabbix-proxy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo '/usr/local/mysql/lib/' > /etc/ld.so.conf.d/mysql.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@swarm-node2 zabbix-proxy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ldconfig -v")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"再次启动zabbix-proxy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#再次启动zabbix-proxy"}},[s._v("#")]),s._v(" 再次启动zabbix-proxy")]),s._v(" "),a("p",[s._v("启动成功")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/03/903b1dda859c96fe.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"打开zabbix-server页面-选择配置-》agent代理程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打开zabbix-server页面-选择配置-》agent代理程序"}},[s._v("#")]),s._v(" 打开zabbix-server页面，选择配置---》agent代理程序")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/03/4f26c48cff9bf3d6.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"选择创建代理程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选择创建代理程序"}},[s._v("#")]),s._v(" 选择创建代理程序")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/03/1a0028eeefbcfa65.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"填写相关信息-保存即可"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#填写相关信息-保存即可"}},[s._v("#")]),s._v(" 填写相关信息，保存即可")]),s._v(" "),a("p",[s._v("agent代理程序名称：为zabbix-proxy配置文件中的Hostname")]),s._v(" "),a("p",[s._v("系统代理程序模式：选择主动式")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/03/ec4ade9ccf436080.png",alt:""}})]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("原文链接："),a("a",{attrs:{href:"https://www.cnblogs.com/chenppp/p/13423918.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("CentOS-7 编译安装zabbix5.0（proxy端） - cchenppp - 博客园"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);