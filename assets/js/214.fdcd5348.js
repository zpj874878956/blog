(window.webpackJsonp=window.webpackJsonp||[]).push([[214],{566:function(t,s,v){"use strict";v.r(s);var p=v(0),_=Object(p.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"rsync服务实现推送-拉取"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rsync服务实现推送-拉取"}},[t._v("#")]),t._v(" rsync服务实现推送，拉取")]),t._v(" "),s("p",[t._v("https://www.csdn.net/tags/OtTacg3sMzk5Mi1ibG9n.html")]),t._v(" "),s("p",[s("strong",[t._v("1.简介")])]),t._v(" "),s("p",[t._v("rsync是一款远程数据同步工具，一个Rsync server能够同时备份多个客户端数据，需要scp，ssh，daemon的支持，默认端口为873。")]),t._v(" "),s("p",[t._v("rsync + crond 可以实现数据定时同步，rsync + inotify可以实现数据的实时同步。")]),t._v(" "),s("p",[t._v("工作中的Rsync服务最好以只读方式提供要备份的数据，避免造成误操作。")]),t._v(" "),s("p",[s("em",[s("strong",[t._v("*2.实验环境介绍*")])])]),t._v(" "),s("p",[t._v("两台CentOS6.3 x64  测试机，一台server，一台client。系统已经默认安装了rsync软件。")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M02/8A/01/wKioL1gkBdaDE-dQAAAE5R3eKYo767.png",alt:"img"}})]),t._v(" "),s("p",[s("em",[s("strong",[t._v("*3.Rsync命令格式及命令参数*")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M00/8A/05/wKiom1gkBdaBFVmoAAAEEauWqYY331.png",alt:"img"}})]),t._v(" "),s("p",[t._v("参数介绍：")]),t._v(" "),s("p",[t._v("-a   归档模式，表示以归档方式传输文件，并保持所有文件属性")]),t._v(" "),s("p",[t._v("-v   详细模式输出")]),t._v(" "),s("p",[t._v("-z   对备份的文件在传输时进行压缩处理")]),t._v(" "),s("p",[t._v("--delete   无差异同步")]),t._v(" "),s("p",[s("em",[s("strong",[t._v("*4.Rsync的三种工作模式*")])])]),t._v(" "),s("p",[t._v("1）本地的拷贝和删除")]),t._v(" "),s("p",[t._v("# rsync avz /etc/hosts /tmp  将文件hosts拷贝到/tmp目录中。与cp命令相似，但区别在rsync可以自己比较两个文件，实现增量备份")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M02/8A/05/wKiom1gkBdaCu9GFAAAENpjOZwk289.png",alt:"img"}})]),t._v(" "),s("p",[t._v("# rsync avz delete /tmp/ /opt/    /tmp/目录为空，加上 --delete参数，相当于 rm 命令")]),t._v(" "),s("p",[t._v("--delete可以理解为：本地有远端有，本地没有删除远端有的")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M00/8A/01/wKioL1gkBdfBqcSQAAAEeSjaT88079.png",alt:"img"}})]),t._v(" "),s("p",[t._v("2）remote shell")]),t._v(" "),s("p",[t._v('rsync远程"推"和"拉"')]),t._v(" "),s("p",[t._v("（推）# rsync avzP e 'ssh p 22' /tmp/ root@192.168.87.138:/tmp/aaa")]),t._v(" "),s("p",[t._v("把本地的 /tmp/ 目录中的文件复制到192.168.87.138的 /tmp/aaa 目录下，通过22端口")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M02/8A/01/wKioL1gkBdfgv6I3AAAGCVg3uT4163.png",alt:"img"}})]),t._v(" "),s("p",[t._v("（拉）# rsync avzP e 'ssh p 22' root@192.168.87.138:/tmp/ /tmp")]),t._v(" "),s("p",[t._v("把192.168.87.138的 /tmp/ 目录文件复制到本地的 /tmp 目录中")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M00/8A/05/wKiom1gkBdfRu9JBAAAF6tIHihM264.png",alt:"img"}})]),t._v(" "),s("p",[s("strong",[t._v("# rsync -avzP -e 'ssh -p 22' /tmp*"),s("em",[t._v("/*")]),t._v(" root@192.168.87.133:/tmp")])]),t._v(" "),s("p",[s("strong",[t._v("# rsync -avzP -e 'ssh -p 22' root@192.168.87.133:/tmp*"),s("em",[t._v("/*")]),t._v(" /tmp")])]),t._v(" "),s("p",[s("strong",[t._v("标红的斜杠，有这个就是推送指定文件夹的全部内容，没有这个就是推送整个目录")])]),t._v(" "),s("p",[t._v("3）daemon   （配置Rsync服务端步骤）")]),t._v(" "),s("p",[t._v("首先确认系统中安装了rsync版本及其版本号")]),t._v(" "),s("p",[t._v("# rsync --version查看当前rsync版本")]),t._v(" "),s("p",[t._v("# rpm qa rsync")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M00/8A/01/wKioL1gkBdfzI5MAAAAfMXva_mk381.png",alt:"img"}})]),t._v(" "),s("p",[t._v("rsync的配置文件默认不存在，需要手工创建。路径为 /etc/rsyncd.conf")]),t._v(" "),s("p",[t._v("编辑 /etc/rsyncd.conf 文件，内容如下。复制粘贴保存退出即可。")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M01/8A/05/wKiom1gkBdfyZRnNAAAEUhEq4iU490.png",alt:"img"}})]),t._v(" "),s("p",[t._v("#Rsync server")]),t._v(" "),s("p",[t._v("#yuci")]),t._v(" "),s("p",[t._v("uid = rsync")]),t._v(" "),s("p",[t._v("gid = rsync")]),t._v(" "),s("p",[t._v("use chroot = no")]),t._v(" "),s("p",[t._v("max connections = 2000")]),t._v(" "),s("p",[t._v("timeout = 600")]),t._v(" "),s("p",[t._v("pid file = /var/run/rsyncd.pid")]),t._v(" "),s("p",[t._v("lock file = /var/run/rsync.lock")]),t._v(" "),s("p",[t._v("log file = /var/log/rsyncd.log")]),t._v(" "),s("p",[t._v("ignore errors")]),t._v(" "),s("p",[t._v("read only = false")]),t._v(" "),s("p",[t._v("list = false")]),t._v(" "),s("p",[t._v("hosts allow = 192.168.0.0/24")]),t._v(" "),s("p",[t._v("hosts deny = 0.0.0.0/32")]),t._v(" "),s("p",[t._v("auth users = rsync_backup")]),t._v(" "),s("p",[t._v("secrets file = /etc/rsync.password")]),t._v(" "),s("p",[t._v("###################################")]),t._v(" "),s("p",[t._v("[backup]")]),t._v(" "),s("p",[t._v("comment = www by yuci")]),t._v(" "),s("p",[t._v("path = /backup")]),t._v(" "),s("p",[t._v("创建rsync用户及共享的目录 /backup（创建完后检查一下，养成好习惯）")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M01/8A/01/wKioL1gkBdjzcbjKAAAM4CSuIcI314.png",alt:"img"}})]),t._v(" "),s("p",[t._v("如上编辑的文件，secrets file = /etc/rsync.password 为密码文件，可以实现两台机器互信。因为是密码所以需要更改权限。")]),t._v(" "),s("p",[t._v('rsync_backup 是上面配置文件的 auth users = rsync_backup  "123456"为连接时需要验证的密码')]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M01/8A/05/wKiom1gkBdjD35w0AAAKUNSr_A8689.png",alt:"img"}})]),t._v(" "),s("p",[t._v("# rsync --daemon   启动rsync服务")]),t._v(" "),s("p",[t._v("# netstat lntup | grep rsync   查看rsync是否正常运行在873端口")]),t._v(" "),s("p",[t._v("# ps ef | grep rsync")]),t._v(" "),s("p",[t._v('# echo "rsync --daemon" >> /etc/rc.local    加入开机自启动')]),t._v(" "),s("p",[t._v("# cat /etc/rc.local")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M01/8A/01/wKioL1gkBdjzn-nSAAAIrYeLOGo175.png",alt:"img"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M02/8A/05/wKiom1gkBdjy_DqPAAAHzZg6JvE349.png",alt:"img"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M02/8A/05/wKiom1gkBdnSIG1-AAASzQvpjwU577.png",alt:"img"}})]),t._v(" "),s("p",[t._v("到此为止，服务器端的配置已经完成。接下来配置客户端")]),t._v(" "),s("p",[t._v('# echo "123456" >> /etc/rsync.password')]),t._v(" "),s("p",[t._v("只需要密码即可，因为在连接命令中已经有了 rsync_backup用户")]),t._v(" "),s("p",[t._v("# chmod 600 /etc/rsync.password")]),t._v(" "),s("p",[t._v("跟服务器的密码文件相同，需要修改权限")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M02/8A/01/wKioL1gkBdmwQdYDAAAIMT79i0I947.png",alt:"img"}})]),t._v(" "),s("p",[t._v("客户端只需要这简单的两步就可以了。")]),t._v(" "),s("p",[s("em",[s("strong",[t._v("*5.测试环境搭建是否成功*")])])]),t._v(" "),s("p",[t._v("现在要将客户端的 /tmp/ 目录中的文件，推送到服务端的 /backup 目录中，将 /backup 目录清空，在 /tmp/ 目录中随便创建几个文件")]),t._v(" "),s("p",[t._v("没有报错推送成功，下图选中的backup是要对应 /etc/rsyncd.conf 中的模块命令")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M02/8A/01/wKioL1gkBdmBNVCUAAAR1mwLce0510.png",alt:"img"}})]),t._v(" "),s("p",[t._v("与上图的 ::backup 对应")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M00/8A/05/wKiom1gkBdmDlzuxAAAJfLW17Hc554.png",alt:"img"}})]),t._v(" "),s("p",[t._v("回到服务器端检查，测试成功")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://s3.51cto.com/wyfs02/M00/8A/05/wKiom1gkBdmwYMjTAAAE0_uB2wo600.png",alt:"img"}})]),t._v(" "),s("p",[t._v("本文转自  mlwzby  51CTO博客，原文链接:http://blog.51cto.com/aby028/1871433")])])}),[],!1,null,null,null);s.default=_.exports}}]);