(window.webpackJsonp=window.webpackJsonp||[]).push([[268],{621:function(s,a,t){"use strict";t.r(a);var e=t(0),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"_1、只允许某用户从指定-ip-地址登陆"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、只允许某用户从指定-ip-地址登陆"}},[s._v("#")]),s._v(" 1、只允许某用户从指定 IP 地址登陆")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sed -i '$a AllowUsers CR@192.168.1.12 root@192.168.1.12' /etc/ssh/sshd_config ;\\\nsystemctl restart sshd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_2、设置-ssh-空闲超时退出时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、设置-ssh-空闲超时退出时间"}},[s._v("#")]),s._v(" 2、设置 SSH 空闲超时退出时间")]),s._v(" "),a("p",[a("code",[s._v("/etc/ssh/sshd_config")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#ClientAliveInterval 0\n#ClientAliveCountMax 3\n修改成\nClientAliveInterval 30    #（每30秒往客户端发送会话请求，保持连接）\nClientAliveCountMax 3     #（去掉注释即可，3表示重连3次失败后，重启SSH会话）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("code",[s._v("systemctl restart sshd")])]),s._v(" "),a("h2",{attrs:{id:"_3、-限制登陆访问尝试的验证次数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、-限制登陆访问尝试的验证次数"}},[s._v("#")]),s._v(" 3、 限制登陆访问尝试的验证次数")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("MaxAuthTries 20\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_4、允许-root-用户登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、允许-root-用户登录"}},[s._v("#")]),s._v(" 4、允许 root 用户登录")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sed -i 's/PermitRootLogin no/PermitRootLogin yes/g'  /etc/ssh/sshd_config ;\\\nsystemctl restart sshd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_5、设置登录方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、设置登录方式"}},[s._v("#")]),s._v(" 5、设置登录方式")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# AuthorizedKeysFile   .ssh/authorized_keys   //公钥公钥认证文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PubkeyAuthentication yes   //可以使用公钥登录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PasswordAuthentication no  //不允许使用密码登录")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_6、禁止使用空白密码用户访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、禁止使用空白密码用户访问"}},[s._v("#")]),s._v(" 6、禁止使用空白密码用户访问")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("PermitEmptyPasswords no\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_7、ssh-登录事件通知至-ntfy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、ssh-登录事件通知至-ntfy"}},[s._v("#")]),s._v(" 7、SSH 登录事件通知至 ntfy")]),s._v(" "),a("p",[s._v("/etc/pam.d/sshd")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("session optional pam_exec.so /usr/local/bin/ntfy-ssh-login.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ntfy-ssh-login.sh")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TOPIC_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://test.curiouser.top:18070/ssh-notify\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PAM_TYPE}")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"open_session"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" tags:warning "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" prio:high "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SSH login to '),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(": "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PAM_USER}")]),s._v(" from "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PAM_RHOST}")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TOPIC_URL}")]),s._v('"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("部署私有的 ntfy")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ntfy_server:\n  image: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'binwiederhier/ntfy'")]),s._v("\n  restart: always\n  container_name: ntfy_server\n  command: serve "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--config")]),s._v(" /etc/ntfy/server.yml --cache-file /var/cache/ntfy/cache.db --listen-http :18070\n  ports:\n    - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'18070:18070'")]),s._v("\n  volumes:\n    - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/data/ntfy/data:/var/cache/ntfy'")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/data/ntfy/config:/etc/ntfy'")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/data/ntfy/data:/var/lib/ntfy/'")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("hr"),s._v(" "),a("p",[s._v("原文链接：")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.gaoyufu.cn/pages/c08a50/#_1%E3%80%81%E5%8F%AA%E5%85%81%E8%AE%B8%E6%9F%90%E7%94%A8%E6%88%B7%E4%BB%8E%E6%8C%87%E5%AE%9Aip%E5%9C%B0%E5%9D%80%E7%99%BB%E9%99%86",target:"_blank",rel:"noopener noreferrer"}},[s._v("ssh安全 | Gaoyufu 's blog"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);