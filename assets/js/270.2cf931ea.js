(window.webpackJsonp=window.webpackJsonp||[]).push([[270],{623:function(s,a,e){"use strict";e.r(a);var t=e(0),r=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("blockquote",[a("p",[s._v("OSSEC是一款开源的基于主机的入侵检测系统，可以简称为HIDS。它具备日志分析，文件完整性检查，策略监控，rootkit检测，实时报警以及联动响应等功能。它支持多种操作系统：Linux、Windows、MacOS、Solaris、HP-UX、AIX。属于企业安全之利器。")])]),s._v(" "),a("p",[s._v("详细的介绍和文档可以参考官网网站：")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://www.ossec.net/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://www.ossec.net/"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"一、搭建环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、搭建环境"}},[s._v("#")]),s._v(" 一、搭建环境")]),s._v(" "),a("p",[s._v("参看文章：")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://www.ossec.net/docs/manual/installation/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v(" ossec官方安装文档"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/zlslch/p/8512757.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("全网最详细的最新稳定OSSEC搭建部署（ossec-server（CentOS7.X）和ossec-agent（CentOS7.X）"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("系统：Centos7")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("计算机")]),s._v(" "),a("th",[s._v("ip")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("ossec-server")]),s._v(" "),a("td",[s._v("172.16.30.23")])]),s._v(" "),a("tr",[a("td",[s._v("ossec-agent")]),s._v(" "),a("td",[s._v("172.16.30.24")])])])]),s._v(" "),a("p",[s._v("安装软件及版本：")]),s._v(" "),a("p",[s._v("ossec3.0")]),s._v(" "),a("p",[s._v("mariadb5.5.6")]),s._v(" "),a("p",[s._v("安装方式：")]),s._v(" "),a("p",[s._v("ossec-server: 服务端使用docker安装")]),s._v(" "),a("p",[s._v("ossec-agent：客户端使用yum安装")]),s._v(" "),a("p",[s._v("数据库：安装在ossec-server服务端")]),s._v(" "),a("h2",{attrs:{id:"二、搭建流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、搭建流程"}},[s._v("#")]),s._v(" 二、搭建流程")]),s._v(" "),a("h3",{attrs:{id:"_1、安装前环境准备-服务器和客户端都需要操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、安装前环境准备-服务器和客户端都需要操作"}},[s._v("#")]),s._v(" 1、安装前环境准备（服务器和客户端都需要操作）")]),s._v(" "),a("h4",{attrs:{id:"关闭selinux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭selinux"}},[s._v("#")]),s._v(" 关闭selinux")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("setenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#enforcing#disabled#g'")]),s._v(" /etc/selinux/config\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"关闭防火墙"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭防火墙"}},[s._v("#")]),s._v(" 关闭防火墙")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl stop firewalld.service \nsystemctl disable firewalld.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_2、数据库安装和ossec数据库配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、数据库安装和ossec数据库配置"}},[s._v("#")]),s._v(" 2、数据库安装和ossec数据库配置")]),s._v(" "),a("h4",{attrs:{id:"在ossec服务端安装数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在ossec服务端安装数据库"}},[s._v("#")]),s._v(" 在ossec服务端安装数据库")]),s._v(" "),a("h5",{attrs:{id:"使用yum安装mariadb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用yum安装mariadb"}},[s._v("#")]),s._v(" 使用yum安装mariadb")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" mariadb-server mariadb mariadb-devel\n\nsystemctl start mariadb\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" mariadb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h5",{attrs:{id:"初始化mariadb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化mariadb"}},[s._v("#")]),s._v(" 初始化mariadb")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("mysql_secure_installation\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置root，密码root（自行修改）")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"创建ossec的数据库及授权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建ossec的数据库及授权"}},[s._v("#")]),s._v(" 创建ossec的数据库及授权")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-uroot")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-proot")]),s._v(" \n\ncreate database ossec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\ngrant all on ossec.* to ossec@localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#授权")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" ossec@localhost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ossec'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#给ossec帐号创建密码")]),s._v("\n\nflush privileges"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h5",{attrs:{id:"添加ossec数据库表结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加ossec数据库表结构"}},[s._v("#")]),s._v(" 添加ossec数据库表结构")]),s._v(" "),a("p",[s._v("下载ossec二进制文件，主要使用其中mysql.schema文件，ossec-hids-3.0.0.tar.gz的下载地址：")]),s._v(" "),a("p",[s._v("ossec官网下载地址：https://github.com/ossec/ossec-hids/archive/3.0.0.tar.gzhttps://github.com/ossec/ossec-hids/archive/3.0.0.tar.gz")]),s._v(" "),a("p",[s._v("ossec-hids-3.0.0.tar.gz百度云下载地址：链接："),a("a",{attrs:{href:"https://pan.baidu.com/s/1gG1DbgQhfOPbE8ISej0yHA",target:"_blank",rel:"noopener noreferrer"}},[s._v("百度网盘 请输入提取码"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("密码：38r8")]),s._v(" "),a("p",[s._v("下载ossec-hids-3.0.0.tar.gz后进行操作：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/src\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxf ossec-hids-3.0.0.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ossec-hids-3.0.0\n\nmysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-uossec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" ossec "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" ./src/os_dbd/mysql.schema\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ossec表结构添加完成")]),s._v(" "),a("h2",{attrs:{id:"_3、ossec-server服务端安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、ossec-server服务端安装"}},[s._v("#")]),s._v(" 3、ossec-server服务端安装")]),s._v(" "),a("h3",{attrs:{id:"使用docker安装ossec服务端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用docker安装ossec服务端"}},[s._v("#")]),s._v(" 使用docker安装ossec服务端")]),s._v(" "),a("p",[s._v("参考："),a("a",{attrs:{href:"http://blog.51cto.com/bestlope/1977059",target:"_blank",rel:"noopener noreferrer"}},[s._v("Centos7系统下Docker ce的安装及镜像加速_51CTO博客_centos7 安装docker"),a("OutboundLink")],1)]),s._v(" "),a("h4",{attrs:{id:"docker安装完成后-使用以下命令安装ossec-sever的安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker安装完成后-使用以下命令安装ossec-sever的安装"}},[s._v("#")]),s._v(" docker安装完成后，使用以下命令安装ossec-sever的安装：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" ossec-server "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1514")]),s._v(":1514/udp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1515")]),s._v(":1515"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SYSLOG_FORWADING_ENABLED")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SYSLOG_FORWARDING_SERVER_IP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".30.23"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /var/ossec/data:/var/ossec/data xetusoss/ossec-server\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("docker命令解释：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("--name：该docker容器命名为ossec-server\n\n-d：后台运行\n\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1514")]),s._v(":1514/udp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1515")]),s._v(":1515 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 映射宿主机和docker容器端口号\n\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SYSLOG_FORWADING_ENABLED")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SYSLOG_FORWARDING_SERVER_IP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".30.23 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /var/ossec/data:/var/ossec/data "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 挂载容器路径\n\nxetusoss/ossec-server ： 使用镜像仓库地址\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h4",{attrs:{id:"docker容器启动成功后-进入ossec-sever容器操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker容器启动成功后-进入ossec-sever容器操作"}},[s._v("#")]),s._v(" docker容器启动成功后，进入ossec-sever容器操作:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("dokcer "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入docker容器的命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" ossec-server "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"在docker容器对ossec-server服务端进行配置操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在docker容器对ossec-server服务端进行配置操作"}},[s._v("#")]),s._v(" 在docker容器对ossec-server服务端进行配置操作：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加ossec对数据库的支持")]),s._v("\n/var/ossec/bin/ossec-control "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" database\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给ossec.conf文件授权")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" u+w /var/ossec/etc/ossec.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑ossec.conf文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /var/ossec/data/etc/ossec.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 在ossec.conf添加MySQL配置：")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("database_output"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("hostname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".30.2"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("/hostname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("ossec"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("ossec"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("database"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("ossec"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/database"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/database_output"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 在ossec.conf添加ip网段配置   ")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("remote"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("connection"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("syslog"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/connection"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("allowed-ips"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".0.0/1"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v("<")]),s._v("/allowed-ips"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/remote"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 添加邮件信息")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("global"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("email_notification"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("no"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/email_notification"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("email_to"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("ser365@qq.com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/email_to"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("smtp_server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("smtp.your_domain.com."),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/smtp_server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("email_from"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("ossecm@ossec.your_domain.com."),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/email_from"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/global"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("h4",{attrs:{id:"在服务端添加代理端主机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在服务端添加代理端主机"}},[s._v("#")]),s._v(" 在服务端添加代理端主机：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在ossec-server的docker环境里")]),s._v("\n/var/ossec/bin/manage_agents\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在出现的选择中选A，添加agent，分别给填写：")]),s._v("\nossec-agent    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#自己取的名字")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".30.22   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#agent服务器的IP")]),s._v("\n022            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#自己规定的ID")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"在服务端获取代理端的key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在服务端获取代理端的key"}},[s._v("#")]),s._v(" 在服务端获取代理端的key")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在ossec-server的docker环境里")]),s._v("\n/var/ossec/bin/manage_agents`\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在出现的选择中选E,在随后的提示里输入ID号：022，")]),s._v("\n就能得到ID为022的agent主机的KEY\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"启动ossec服务端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动ossec服务端"}},[s._v("#")]),s._v(" 启动ossec服务端")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在ossec-server的docker环境里")]),s._v("\n/var/ossec/bin/ossec-control start\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_4、oss-agent客户端安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、oss-agent客户端安装"}},[s._v("#")]),s._v(" 4、oss-agent客户端安装")]),s._v(" "),a("h4",{attrs:{id:"使用yum安装ossec-agent"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用yum安装ossec-agent"}},[s._v("#")]),s._v(" 使用yum安装ossec-agent")]),s._v(" "),a("p",[s._v("ossec-agent是使用yum安装，在要监控的agent服务器中操作：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-q")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" - https://updates.atomicorp.com/installers/atomic "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ossec-hids ossec-hids-client\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"配置ossec-agent配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置ossec-agent配置文件"}},[s._v("#")]),s._v(" 配置ossec-agent配置文件")]),s._v(" "),a("p",[s._v("配置ossec-agent的配置文件，我们需要删除ossec-agent.conf的配置信息，因为这与ossec-server服务器上的配置重复了，不处理会在启动出现报错。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /var/ossec/etc/ossec-agent.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将ossec-agent.conf文件里的内容删减到只剩：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("-- OSSEC example config --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ossec_config"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("server-ip"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".30.2"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("/server-ip"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/ossec_config"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h4",{attrs:{id:"在agent添加key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在agent添加key"}},[s._v("#")]),s._v(" 在agent添加key")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("/var/ossec/bin/manage_agents\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入I，将ID022的agent机器的KEY加入")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"启动ossec-agent客户端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动ossec-agent客户端"}},[s._v("#")]),s._v(" 启动ossec-agent客户端")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("/var/ossec/bin/ossec-control start\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"三、ossec的server和agent连接查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、ossec的server和agent连接查看"}},[s._v("#")]),s._v(" 三、ossec的server和agent连接查看")]),s._v(" "),a("h3",{attrs:{id:"查看ossec连接情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看ossec连接情况"}},[s._v("#")]),s._v(" 查看ossec连接情况")]),s._v(" "),a("p",[s._v("在ossec服务端，查看agent的连接情况")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在ossec-serverdocker环境里")]),s._v("\n/var/ossec/bin/agent_control "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\nOSSEC HIDS agent_control. List of available agents:\n   ID: 000, Name: cacee8d64533 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", IP: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1, Active/Local\n   ID: 001, Name: DEFAULT_LOCAL_AGENT, IP: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1, Never connected\n   ID: 022, Name: ossec-agent22, IP: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".30.22, Active\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示ID:022的活动状态为Active，即为连接成功在活动中")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);