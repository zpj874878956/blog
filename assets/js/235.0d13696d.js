(window.webpackJsonp=window.webpackJsonp||[]).push([[235],{587:function(s,a,n){"use strict";n.r(a);var t=n(0),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"rsyslog配置文件模块介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rsyslog配置文件模块介绍"}},[s._v("#")]),s._v(" rsyslog配置文件模块介绍")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("modules，模块，配置加载的模块，如：ModLoad imudp.so配置加载UDP传输模块")])]),s._v(" "),a("li",[a("p",[s._v("global directives，全局配置，配置ryslog守护进程的全局属性，比如主信息队列大小（MainMessageQueueSize）")])]),s._v(" "),a("li",[a("p",[s._v("rules，规则（选择器+动作），每个规则行由两部分组成，selector部分和action部分，这两部分由一个或多个空格或tab分隔，selector部分指定源和日志等级，action部分指定对应的操作")])]),s._v(" "),a("li",[a("p",[s._v("模板（templates）")])]),s._v(" "),a("li",[a("p",[s._v("输出（outputs）")])])]),s._v(" "),a("h3",{attrs:{id:"常用的modules"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用的modules"}},[s._v("#")]),s._v(" 常用的modules")]),s._v(" "),a("p",[s._v("imudp，传统方式的UDP传输，有损耗")]),s._v(" "),a("p",[s._v("imtcp，基于TCP明文的传输，只在特定情况下丢失信息，并被广泛使用")]),s._v(" "),a("p",[s._v("imrelp，RELP传输，不会丢失信息，但只在rsyslogd 3.15.0及以上版本中可用")]),s._v(" "),a("h3",{attrs:{id:"规则-rules"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#规则-rules"}},[s._v("#")]),s._v(" 规则（rules）")]),s._v(" "),a("p",[s._v("规则的选择器（selectors）"),a("br"),s._v("\nselector也由两部分组成，设施和优先级，由点号.分隔。第一部分为消息源或称为日志设施，第二部分为日志级别。多个选择器用;分隔，如：*.info;mail.none。")]),s._v(" "),a("p",[a("strong",[s._v("日志设施有")]),s._v("：")]),s._v(" "),a("p",[s._v("facility可以理解为日志的来源或设备或选择条件，目前常用的facility有以下几种")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("               auth                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证相关的")]),s._v("\n\n               authpriv                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#权限，授权相关的")]),s._v("\n\n               "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cron")]),s._v("                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#任务计划相关的")]),s._v("\n\n               daemon                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#守护进程相关的")]),s._v("\n\n               kern                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#内核相关的")]),s._v("\n\n               "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("lpr")]),s._v("                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#打印相关的")]),s._v("\n\n               mail                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#邮件相关的")]),s._v("\n\n               mark                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#标记相关的")]),s._v("\n\n               news                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新闻相关的")]),s._v("\n\n               security                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安全相关的，与auth类似")]),s._v("\n\n               syslog                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#syslog自己的")]),s._v("\n\n               user                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#用户相关的")]),s._v("\n\n               uucp                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#unix to unix cp相关的")]),s._v("\n\n               local0到local7          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#用户自定义使用")]),s._v("\n\n               *                                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#*表示所有的facility")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("p",[a("strong",[s._v("日志级别有(从低到高)")]),s._v("：")]),s._v(" "),a("p",[s._v("注：级别越低记录的越详细")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("debug：程序或系统的调试信息，通常只在调试一个程序时使用。\ninfo：正常的系统消息，比如骚扰报告，带宽数据等，不需要处理。\nnotice： 不是错误情况，也不需要立即处理,不影响正常的功能，需要提醒用户的重要事件。\nwarning： 警告信息，不是错误，比如系统磁盘使用了85%等,可能影响系统功能，需要提醒用户的重要事件。\nerr：错误，不是非常紧急，在一定时间内修复即可。\ncrit：比较严重的，如硬盘错误，备用连接丢失。\nalert：必须马上处理的，如系统数据库被破坏，ISP连接丢失。\nemerg：紧急情况，会导致系统不可用的,需要立即通知技术人员。\n*   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表示所有的日志级别")]),s._v("\nnone "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#跟*相反，表示什么也没有")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[a("strong",[s._v("action（动作）日志记录的位置")])]),s._v(" "),a("p",[s._v("系统上的绝对路径 #普通文件 如：/var/log/XXX")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#管道 通过管道送给其他的命令出来")]),s._v("\n\n        终端                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#终端 如：/dev/console")]),s._v("\n\n        @host                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#远程主机  如@10.1.1.1")]),s._v("\n\n        用户                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#系统用户 如:root")]),s._v("\n\n        *                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#登录到系统上的所有用户，一般emerg级别的日志是这样定义的")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("strong",[s._v("日志设施的配置：")])]),s._v(" "),a("p",[s._v(". 代表比后面还要高的消息等级都会记录下来"),a("br"),s._v("\n.= 代表只有后面的这个消息等级会被记录下来"),a("br"),s._v("\n.! 代表除了后面的这个消息等级,其他的都会被记录下来，对于多个选择器可以用;分隔。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("                mail.info  /var/log/mail.log   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表示将mail相关的，级别为info及info以上级别的信息记录到/var/log/mail.log文件中 ")]),s._v("\n\n                auth."),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("info  @10.1.1.1            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表示将auth相关的，级别为info的信息记录到10.1.1.1主机上去，前提是10.1.1.1要能接收其主机发来的日志信息")]),s._v("\n\n                user."),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v("error                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表示记录user相关的，不包括error级别的信息")]),s._v("\n\n                 user.！error                           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表示user.error相反")]),s._v("\n\n                *.info                                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表示记录所有的日志信息的info级别")]),s._v("\n\n                mail.*                                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表示记录所有mail相关的所有级别的信息")]),s._v("\n\n                *.*                                           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表示记录所有的日志信息的所有的日志级别")]),s._v("\n\n                cron.info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("mail.info                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多个日志来源可以用“ ; ”隔开")]),s._v("\n\n                cron,mail.info                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#与cron.info;mail.info        是一个意思")]),s._v("\n\n                mail.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("mail."),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v("info                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表示记录mail相关的所有级别的信息，但是不包括info级别的信息")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[a("strong",[s._v("动作 （action）")]),a("br"),s._v("\naction是规则描述的一部分，位于选择器的后面，规则用于处理消息。总的来说，消息内容被写到一种日志文件上，但也可以执行其他动作，比如写到数据库表中或转发到其他主机。")]),s._v(" "),a("p",[s._v("在前面的实例中的是写到本地文件中的")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The authpriv file has restricted access.")]),s._v("\nauthpriv.*                                              /var/log/secure\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("也可以写到mysql数据库中")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# modules, 要将日志写到mysql中需要加载ommysql模块")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ModLoad")]),s._v(" ommysql \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rule, send to mysql")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#*.*       :ommysql:database-server,database-name,database-userid,database-password")]),s._v("\n*.*       :ommysql:127.0.0.1,Syslog,syslogwriter,topsecret\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("action的配置：")]),s._v(" "),a("ul",[a("li",[s._v("保存到文件，"),a("code",[s._v("cron.* -/var/log/cron.log")]),s._v("如果路径前有-则表示每次输出日志时不同步（fsync）指定日志文件。 文件路径既可以是静态文件也可以是动态文件。动态文件由模板前加 ? 定义。")])]),s._v(" "),a("ul",[a("li",[s._v("通过网络发送日志 格式如下： @[()]:[] @ 表示使用 UDP 协议。@@ 表示使用 TCP 协议。 可以为： z 表示使用 zlib 压缩，NUMBER 表示压缩级别。多个选项 使用 , 分隔。 例如： . @192.168.0.1 # 使用 UDP 发送日志到 192.168.0.1 .@@example.com:18 # 使用 TCP 发送到 “example.com” 的 18 端口 . @(z9)[2001::1] # 使用 UDP 发送消息到 2001::1，启用 zlib 9 级压缩")])]),s._v(" "),a("ul",[a("li",[s._v("cron.* ~ 丢弃所有信息，即该配置之后的动作不会看到该日志。 随 rsyslog 版本不同，如果有如下警告信息，则将 ~ 修改为 stop。")])]),s._v(" "),a("h3",{attrs:{id:"模板-templates"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模板-templates"}},[s._v("#")]),s._v(" 模板（templates）")]),s._v(" "),a("p",[s._v("模板允许你指定日志信息的格式，也可用于生成动态文件名，或在规则中使用。其定义如下所示，其中TEMPLATE_NAME是模板的名字,PROPERTY是rsyslog本身支持的一些属性参数。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$template")]),s._v(" TEMPLATE_NAME,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text %PROPERTY% more text"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTION"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("使用例子：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$template")]),s._v(" DynamicFile,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/log/test_logs/%timegenerated%-test.log"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$template")]),s._v(" DailyPerHostLogs,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/log/syslog/%'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$YEAR")]),s._v("%/%"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MONTH")]),s._v("%/%"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DAY")]),s._v('%/%HOSTNAME%/messages.log"')]),s._v("\n\n*.info ?DailyPerHostLogs\n*.* ?DynamicFile\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("在模板中我们用到的properties可以参考"),a("a",{attrs:{href:"https://www.rsyslog.com/doc/master/configuration/properties.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档说明"),a("OutboundLink")],1),s._v("，例子中用到的"),a("code",[s._v("timegenerate")]),s._v("d是指接收到消息时的时间戳。")]),s._v(" "),a("h3",{attrs:{id:"输出-outputs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#输出-outputs"}},[s._v("#")]),s._v(" 输出（outputs）")]),s._v(" "),a("p",[s._v("输出频道为用户可能想要的输出类型提供了保护，在规则中使用前要先定义.其定义如下所示，其中NAME指定输出频道的名称，FILE_NAME指定输出文件，MAX_SIZE指定日志文件的大小，单位是bytes, ACTION指定日志文件到达MAX_SIZE时的操作。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$outchannel")]),s._v(" NAME, FILE_NAME, MAX_SIZE, ACTION\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在规则中使用输出频道按照如下的格式：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("selectors :omfile:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("例子：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$outchannel")]),s._v(" log_rotation, /var/log/test_log.log, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("104857600")]),s._v(", /home/joe/log_rotation_script\n\n*.* :omfile:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$log_rotation")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[s._v("配置的验证")])]),s._v(" "),a("p",[s._v("通过下面命令可以校验配置文件是否配置正确：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" rsyslogd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /etc/rsyslog.conf "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-N4")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("其中 -N后面的数值代表rsyslog启动时-c 后指定的版本。")]),s._v(" "),a("p",[s._v("通过下面命令可以手动发送日志信息：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("logger "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" local0.info "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"日志文件rotating-滚动日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志文件rotating-滚动日志"}},[s._v("#")]),s._v(" 日志文件Rotating（滚动日志）")]),s._v(" "),a("p",[s._v("随着日志文件越来越大，这不仅会带来性能问题，同时对日志的管理也非常棘手。 当一个日志文件被rotated，会创建一个新的日志文件，同时旧的日志文件会被重命名。这些文件在一段时间内被保留，一旦产生一定数量的旧的日志，系统就会删除一部分旧的日志。")]),s._v(" "),a("h3",{attrs:{id:"logrotate配置文件实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logrotate配置文件实例"}},[s._v("#")]),s._v(" logrotate配置文件实例")]),s._v(" "),a("p",[s._v("logrotate是通过cron任务调用的，在安装的时候就自动创建了，所以通过ps命令看不到logrotate，可查看定时任务调用："),a("code",[s._v("cat /etc/cron.daily/logrotate")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh")]),s._v("\n\n/usr/sbin/logrotate /etc/logrotate.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EXITVALUE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$EXITVALUE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    /usr/bin/logger "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("logrotate")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ALERT exited abnormally with ['),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$EXITVALUE")]),s._v(']"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("cron.daily下的文件执行都是通过/etc/crontab配置的：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" * * * root run-parts /etc/cron.daily "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定时执行cron.daily")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("logrotate的配置文件为/etc/logrotate.conf，下面给一个例子：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# see "man logrotate" for details')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rotate log files weekly")]),s._v("\nweekly           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每周滚动一次")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# keep 4 weeks worth of backlogs")]),s._v("\nrotate "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#只保留4个切割版本文件，超过后清除 ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# create new (empty) log files after rotating old ones")]),s._v("\ncreate             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#滚动完之后创建一个空的新的文件")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# uncomment this if you want your log files compressed")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#compress")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# packages drop log rotation information into this directory")]),s._v("\ninclude /etc/logrotate.d            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#包括/etc/logrotate.d 下的文件，手动添加可直接添加到此目录")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# no packages own wtmp, or btmp -- we'll rotate them here")]),s._v("\n/var/log/syslog\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    rotate "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#保留7份旧的日志")]),s._v("\n    daily\n    missingok\n    notifempty\n    delaycompress\n    compress\n    postrotate\n        invoke-rc.d rsyslog reload "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null\n    endscript\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n/var/log/cron.log\n/var/log/debug\n/var/log/messages\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    rotate "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n    weekly\n    missingok\n    notifempty\n    compress\n    delaycompress\n    sharedscripts\n    postrotate\n        invoke-rc.d rsyslog reload "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null\n    endscript\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# system-specific logs may be configured here")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://so.csdn.net/so/search?q=syslog&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[s._v("syslog"),a("OutboundLink")],1),s._v("的日志文件每天被rotated，保留7份旧的日志。其他的日志文件每周进行一次rotate，并保留4份旧的日志。")]),s._v(" "),a("h3",{attrs:{id:"logrotate配置项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logrotate配置项"}},[s._v("#")]),s._v(" logrotate配置项")]),s._v(" "),a("p",[s._v("我们可以通过man logrotate来获取所有的参数和详细描述。这里列出一部分:")]),s._v(" "),a("p",[s._v("daily 指定转储周期为每天\nweekly 指定转储周期为每周\nmonthly 指定转储周期为每月\ncompress 通过gzip 压缩转储以后的日志\nnocompress 不需要压缩时，用这个参数\ncopytruncate 用于还在打开中的日志文件，把当前日志备份并截断\nnocopytruncate 备份日志文件但是不截断\nmissingok 如果文件不存在，继续下一个文件，不报异常\nnomissingok 如果文件不存在，报异常（默认配置）\ncreate mode(文件权限) owner(拥有者) group(组) 转储文件，使用指定的文件模式创建新的日志文件\nnocreate 不建立新的日志文件\ndelaycompress 和 compress 一起使用时，转储的日志文件到下一次转储时才压缩\nnodelaycompress 覆盖 delaycompress 选项，转储同时压缩。\nerrors address 转储时的错误信息发送到指定的Email 地址\nifempty 即使是空文件也转储，(logrotate 的缺省选项)\nnotifempty 如果是空文件的话，不转储\nmail address 把转储的日志文件发送到指定的E-mail 地址\nnomail 转储时不发送日志文件\nolddir directory 转储后的日志文件放入指定的目录，必须和当前日志文件在同一个文件系统\nnoolddir 转储后的日志文件和当前日志文件放在同一个目录下\nprerotate/endscript 在转储以前需要执行的命令可以放入这个对，这两个关键字必须单独成行\npostrotate/endscript 在转储以后需要执行的命令可以放入这个对，这两个关键字必须单独成行\nrotate count 指定日志文件删除之前转储的次数，0 指没有备份，5 指保留5 个备份\ntabootext [+] LIST 让logrotate 不转储指定扩展名的文件，缺省的扩展名是：.rpm-orig, .rpmsave, v, 和 ~\nsize SIZE 当日志文件到达指定的大小时才转储，Size 可以指定 bytes (缺省)以及KB (sizek)或者MB (sizem)")]),s._v(" "),a("hr"),s._v(" "),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/weixin_38924500/article/details/114408537",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文链接"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);