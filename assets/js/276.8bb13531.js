(window.webpackJsonp=window.webpackJsonp||[]).push([[276],{629:function(e,r,p){"use strict";p.r(r);var l=p(0),v=Object(l.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("p",[e._v("如果配合 DHCP 服务或实现更多功能。")]),e._v(" "),r("p",[e._v("☼ NAT 转发软路由")]),e._v(" "),r("p",[e._v("开启 NAT 转发之后，只要本机可以上网，不论是单网卡还是多网卡，局域网内的其他机器可以将默认网关设置为已开启 NAT 转发的服务器 IP ，即可实现上网。")]),e._v(" "),r("p",[e._v("开启 NAT 转发 firewall-cmd --permanent --zone=public --add-masquerade # 开放 DNS 使用的 53 端口，UDP # 必须，否则其他机器无法进行域名解析 firewall-cmd --zone=public --add-port=80/tcp --permanent # 检查是否允许 NAT 转发 firewall-cmd --query-masquerade # 禁止防火墙 NAT 转发 firewall-cmd --remove-masquerade")]),e._v(" "),r("p",[e._v("☼ 端口转发")]),e._v(" "),r("p",[e._v("端口转发可以将指定地址访问指定的端口时，将流量转发至指定地址的指定端口。转发的目的如果不指定 ip 的话就默认为本机，如果指定了 ip 却没指定端口，则默认使用来源端口。")]),e._v(" "),r("p",[e._v("将80端口的流量转发至8080 firewall-cmd --add-forward-port=port=80:proto=tcp:toport=8080 # 将80端口的流量转发至192.168.0.1 firewall-cmd --add-forward-port=proto=80:proto=tcp:toaddr=192.168.0.1 # 将80端口的流量转发至192.168.0.1的8080端口 firewall-cmd --add-forward-port=proto=80:proto=tcp:toaddr=192.168.0.1:toport=8080")]),e._v(" "),r("p",[e._v("1、限制IP地址访问")]),e._v(" "),r("p",[e._v("（1）比如限制IP为192.168.0.200的地址禁止访问80端口即禁止访问机器")]),e._v(" "),r("p",[e._v('firewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.200" port protocol="tcp" port="80" reject"')]),e._v(" "),r("p",[e._v("（2）重新载入一下防火墙设置，使设置生效")]),e._v(" "),r("p",[e._v("firewall-cmd --reload")]),e._v(" "),r("p",[e._v("（3）查看已经设置的规则")]),e._v(" "),r("p",[e._v("firewall-cmd --zone=public --list-rich-rules")]),e._v(" "),r("p",[e._v("2、解除IP地址限制")]),e._v(" "),r("p",[e._v("（1）解除刚才被限制的192.168.0.200")]),e._v(" "),r("p",[e._v('firewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.200" port protocol="tcp" port="80" accept"')]),e._v(" "),r("p",[e._v("（2）重新载入一下防火墙设置，使设置生效")]),e._v(" "),r("p",[e._v("firewall-cmd --reload")]),e._v(" "),r("p",[e._v("（3）再查看规则设置发现已经没有192.168.0.200的限制了")]),e._v(" "),r("p",[e._v("firewall-cmd --zone=public --list-rich-rules")]),e._v(" "),r("p",[e._v("如设置未生效，可尝试直接编辑规则文件，删掉原来的设置规则，重新载入一下防火墙即可")]),e._v(" "),r("p",[e._v("vi /etc/firewalld/zones/public.xml")]),e._v(" "),r("p",[e._v("限制IP地址段")]),e._v(" "),r("p",[e._v("（1）如我们需要限制10.0.0.0-10.0.0.255这一整个段的IP，禁止他们访问")]),e._v(" "),r("p",[e._v('firewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="10.0.0.0/24" port protocol="tcp" port="80" reject"')]),e._v(" "),r("p",[e._v("其中10.0.0.0/24表示为从10.0.0.0这个IP开始，24代表子网掩码为255.255.255.0，共包含256个地址，即从0-255共256个IP，即正好限制了这一整段的IP地址，具体的设置规则可参考下表")]),e._v(" "),r("p",[e._v("重新载入一下防火墙设置，使设置生效")]),e._v(" "),r("p",[e._v("firewall-cmd --reload")]),e._v(" "),r("p",[e._v("（3）查看规则，确认是否生效")]),e._v(" "),r("p",[e._v("firewall-cmd --zone=public --list-rich-rules")]),e._v(" "),r("p",[e._v("（4）同理，打开限制为")]),e._v(" "),r("p",[e._v('firewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="10.0.0.0/24" port protocol="tcp" port="80" accept"')]),e._v(" "),r("p",[e._v("firewall-cmd --reload")]),e._v(" "),r("p",[e._v("#查看所有的防火墙策略（即显示/etc/firewalld/zones/下的所有策略）")]),e._v(" "),r("p",[e._v("firewall-cmd --list-all-zones")]),e._v(" "),r("p",[e._v("#允许http服务(对应服务策略目录：/usr/lib/firewalld/services/)")]),e._v(" "),r("p",[e._v("firewall-cmd --permanent --add-service=http")]),e._v(" "),r("p",[e._v("#关闭http服务(对应服务策略目录：/usr/lib/firewalld/services/)")]),e._v(" "),r("p",[e._v("firewall-cmd --permanent --remove-service=http")]),e._v(" "),r("p",[e._v("将接口添加到区域，默认接口都在public")]),e._v(" "),r("p",[e._v("firewall-cmd --zone=public --add-interface=eth0\n永久生效再加上 --permanent 然后reload防火墙")]),e._v(" "),r("p",[e._v("设置默认接口区域")]),e._v(" "),r("p",[e._v("firewall-cmd --set-default-zone=public\n立即生效无需重启\nfirewall-cmd --reload")]),e._v(" "),r("p",[e._v("查看防火墙端口开启状态")]),e._v(" "),r("p",[e._v("firewall-cmd --list-ports")]),e._v(" "),r("p",[e._v("添加")]),e._v(" "),r("p",[e._v("firewall-cmd --zone=public --add-port=80/tcp --permanent")]),e._v(" "),r("p",[e._v("删除")]),e._v(" "),r("p",[e._v("firewall-cmd --zone=public --remove-port=80/tcp --permanent")])])}),[],!1,null,null,null);r.default=v.exports}}]);