(window.webpackJsonp=window.webpackJsonp||[]).push([[326],{679:function(s,a,e){"use strict";e.r(a);var n=e(0),t=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[s._v("#")]),s._v(" 介绍")]),s._v(" "),a("p",[s._v("网盘是一种存储、备份、分享文件的便捷方式，在近十年得到了长足发展。许多公司都在自家产品的生态圈里加入了云存储的功能，例如苹果的 iCloud 和微软的 OneDrive，它们的侧重点是本地文件的备份和同步。而百度网盘和已经凉掉的 360 网盘，则注重于文件分享和离线下载。只可惜很多网盘服务商和迅雷这样的下载工具都有会员制度，并对非会员进行了下载限速，这对免费用户很不友好。那么，有没有办法集合这些网盘服务的优点呢？答案是存在的，那就是自行部署私有云服务。无论是一台树莓派，还是一个 VPS 主机，都可以轻松地搭建支持离线下载、方便进行同步和分享的私有云。")]),s._v(" "),a("p",[s._v("目前几种主流的私有云服务包括："),a("a",{attrs:{href:"https://www.seafile.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Seafile"),a("OutboundLink")],1),s._v("，"),a("a",{attrs:{href:"https://pydio.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Pydio"),a("OutboundLink")],1),s._v("，"),a("a",{attrs:{href:"https://owncloud.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ownCloud"),a("OutboundLink")],1),s._v(" 和 "),a("a",{attrs:{href:"https://nextcloud.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nextcloud"),a("OutboundLink")],1),s._v("。这些服务都各有特色。SeaFile 面向的是企业网盘，基于 Python 开发。Pydio 新推出的 Cells 由 Go 语言重写，提供面向团队的文件共享服务，但是在社区支持上有所欠缺。而 ownCloud 和 Nextcloud 则是基于 PHP 的开源项目，Nextcloud 是由原来的 ownCloud 团队成员独立出来开发的，它们有很多相似之处，但 Nextcloud 在许多方面都更胜一筹（例如移动端的支持）。"),a("br"),s._v("\n经过笔者自己的测试，不管是搭建个人使用还是团队协作用的私有云服务，Nextcloud 的功能基本上都可以击败其他的竞争对手。这篇文章也将主要介绍 Nextcloud，其它服务的搭建方式可以在它们各自的官网上找到。")]),s._v(" "),a("h2",{attrs:{id:"安装-nextcloud"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-nextcloud"}},[s._v("#")]),s._v(" 安装 Nextcloud")]),s._v(" "),a("p",[s._v("笔者几年前安装过一次 Nextcloud，当时还需要手工配置 PHP 和 MySQL 的环境，步骤有些繁琐。现在，Nextcloud 已经提供了一键安装的 "),a("a",{attrs:{href:"https://github.com/nextcloud/docker",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker 镜像"),a("OutboundLink")],1),s._v("，可以让我们在几分钟内搭建起一个 Nextcloud 服务。使用方法是，创建一个 "),a("code",[s._v("docker-compose.yml")]),s._v(" 文件，并填入以下内容：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("version: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2'")]),s._v("\n\nvolumes:\n  nextcloud:\n  db:\n\nservices:\n  db:\n    image: mariadb:10.6\n    restart: always\n    command: --transaction-isolation"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("READ-COMMITTED --log-bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("binlog --binlog-format"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ROW\n    volumes:\n      - db:/var/lib/mysql\n    environment:\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_DATABASE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nextcloud\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_USER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nextcloud\n\n  app:\n    image: nextcloud\n    restart: always\n    ports:\n      - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":80\n    links:\n      - db\n    volumes:\n      - nextcloud:/var/www/html\n    environment:\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_DATABASE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nextcloud\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_USER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nextcloud\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("db\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("p",[s._v("其中，需要设置 "),a("code",[s._v("MYSQL_ROOT_PASSWORD")]),s._v(" 和两个相同的 "),a("code",[s._v("MYSQL_PASSWORD")]),s._v("，使 Nextcloud 可以连接数据库。然后，运行以下命令：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("完成后，访问 "),a("code",[s._v("http://localhost:8080")]),s._v(" 就可以看到 Nextcloud 的页面了。在初次登录时，需要设置管理员账号和密码，然后就可以开始使用了。")]),s._v(" "),a("h2",{attrs:{id:"配置-cloudflare-tunnel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-cloudflare-tunnel"}},[s._v("#")]),s._v(" 配置 Cloudflare Tunnel")]),s._v(" "),a("p",[s._v("如果服务器有公网 IP，那么配置好防火墙就可以直接访问 Nextcloud 了。但是，如果服务器没有公网 IP，那么就需要进行内网穿透。下文将介绍使用 Cloudflare 的 Tunnel 服务来实现内网穿透的方法。")]),s._v(" "),a("p",[s._v("首先，需要注册 Cloudflare 账号，并将域名托管在 Cloudflare 上。随后，在 Cloudflare 的控制面板中点击 Zero Trust，并在侧栏目录中选择 Access 下的 Tunnels。在这个页面中，就可以创建一个新的 Tunnel。在 Tunnel 的设置页面中，可以根据你的操作系统选择安装的命令。以 Debian 系为例，命令类似")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--output")]),s._v(" cloudflared.deb https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" dpkg "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" cloudflared.deb\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" cloudflared "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("完成后，就可以在 Public hostnames 面板中设置公网访问的域名了。将域名设置为你的一个子域名，并将添加的 Service 设置为 "),a("code",[s._v("http://localhost:8080")]),s._v(" 即可。这样，我们就可以在外网访问 Nextcloud 了。")]),s._v(" "),a("hr"),s._v(" "),a("p",[a("a",{attrs:{href:"https://zhangshuqiao.org/2023-04/%E9%83%A8%E7%BD%B2Nextcloud%E7%BD%91%E7%9B%98%E6%9C%8D%E5%8A%A1/",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文链接"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=t.exports}}]);