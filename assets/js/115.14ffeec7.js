(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{468:function(s,a,t){"use strict";t.r(a);var e=t(0),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("es可以使用二进制、docker、k8s、rpm方式部署，此处以rpm方式为例。相较于二进制部署，省去了繁琐的用户创建、证书生成、密码设置、启动脚本配置等操作，简化部署流程，可以将更多的精力用于es的使用而不是部署上面。如果资源有限，想体验elk相关功能，可参考文档：https://www.cuiliangblog.cn/detail/section/117075458，后续也会发布docker模式下elk自定义日志采集文章。")]),s._v(" "),a("h1",{attrs:{id:"系统环境设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统环境设置"}},[s._v("#")]),s._v(" 系统环境设置")]),s._v(" "),a("blockquote",[a("p",[s._v("以下操作在所有主机执行")])]),s._v(" "),a("h2",{attrs:{id:"修改主机名添加hosts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改主机名添加hosts"}},[s._v("#")]),s._v(" 修改主机名添加hosts")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# hostnamectl set-hostname es-master")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/hosts ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.130 es-fleet1\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.131 es-fleet2\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.132 es-master\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.133 es-hot1\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.134 es-hot2\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.135 es-hot3\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.136 es-warm1\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.137 es-warm2\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.138 es-cold\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"关闭防火墙和selinux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭防火墙和selinux"}},[s._v("#")]),s._v(" 关闭防火墙和selinux")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl stop firewalld.service\nsystemctl  disable firewalld\nsetenforce  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/enforcing/disabled/g'")]),s._v(" /etc/selinux/config\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SELINUX")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /etc/selinux/config\ngetenforce\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"配置时间同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置时间同步"}},[s._v("#")]),s._v(" 配置时间同步")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("dnf "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" chrony\nsystemctl  start chronyd\nsystemctl  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" chronyd\ntimedatectl set-timezone Asia/Shanghai\nchronyc sourcestats "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("也可以在内网环境其中一台主机启动chronyd服务，其他主机配置chronyd服务地址，参考文档：https://www.cuiliangblog.cn/detail/section/31516177")]),s._v(" "),a("h2",{attrs:{id:"系统参数优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统参数优化"}},[s._v("#")]),s._v(" 系统参数优化")]),s._v(" "),a("h3",{attrs:{id:"修改文件描述符数目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改文件描述符数目"}},[s._v("#")]),s._v(" 修改文件描述符数目")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("修改原因")])])]),s._v(" "),a("p",[s._v("原因1： Elasticsearch 在节点和 HTTP 客户端之间进行通信也使用了大量的套接字（sockets）。 所有这一切都需要足够的文件描述符。"),a("br"),s._v("\n原因2：linux系统对每个用户、进程、或整个系统的可打开文件描述符数量都有一个限制，一般默认为1024。这对一个小的 Elasticsearch 节点来说实在是太低了，更不用说一个处理数以百计索引的节点。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("设置环境变量")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改环境变量文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/profile\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("ulimit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使配置生效")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[a("strong",[s._v("修改limits.conf配置文件")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改limits.conf配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/security/limits.conf\n* soft nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n* hard nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[a("strong",[s._v("验证")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ulimit -n")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"修改虚拟内存数大小"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改虚拟内存数大小"}},[s._v("#")]),s._v(" 修改虚拟内存数大小")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("修改原因")])])]),s._v(" "),a("p",[s._v("Elasticsearch 对各种文件混合使用了 NioFs（ 非阻塞文件系统）和 MMapFs （ 内存映射文件系统）。"),a("br"),s._v("\n请确保配置的"),a("strong",[s._v("最大映射数量")]),s._v("，以便有足够的虚拟内存可用于 mmapped 文件")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("临时设置")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sysctl -w vm.max_map_count=262144")]),s._v("\nvm.max_map_count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[a("strong",[s._v("永久设置")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/sysctl.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\nvm.max_map_count=262144\nEOF")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sysctl -p ")]),s._v("\nvm.max_map_count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"关闭swap分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭swap分区"}},[s._v("#")]),s._v(" 关闭swap分区")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("修改原因")])])]),s._v(" "),a("p",[s._v("关闭 Swap 分区可以提高服务器的性能，因为 Swap 分区通常会在物理内存不足时被使用，这会导致额外的 I/O 操作和延迟。 当系统使用物理内存满足所有应用程序的需求时，关闭 Swap 分区可以避免这种情况的发生。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("设置")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("swapoff "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/ swap / s/^\\(.*\\)$/#\\1/g'")]),s._v(" /etc/fstab \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"数据盘挂载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据盘挂载"}},[s._v("#")]),s._v(" 数据盘挂载")]),s._v(" "),a("p",[s._v("将数据盘格式化后挂载至/data目录。")]),s._v(" "),a("p",[s._v("具体参考文章：https://www.cuiliangblog.cn/detail/section/31508181")]),s._v(" "),a("h1",{attrs:{id:"es部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#es部署"}},[s._v("#")]),s._v(" ES部署")]),s._v(" "),a("blockquote",[a("p",[s._v("以下操作除非特殊说明，所有节点均操作。")])]),s._v(" "),a("h2",{attrs:{id:"下载rpm包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载rpm包"}},[s._v("#")]),s._v(" 下载rpm包")]),s._v(" "),a("p",[s._v("国内下载地址：https://elasticsearch.cn/download/"),a("br"),s._v("\n官网下载地址：https://www.elastic.co/cn/downloads/past-releases#elasticsearch")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.8.2-x86_64.rpm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"安装elasticsearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装elasticsearch"}},[s._v("#")]),s._v(" 安装elasticsearch")]),s._v(" "),a("p",[s._v("安装 Elasticsearch 时，默认情况下会启用和配置安全功能。 安装 Elasticsearch 时，会自动进行以下配置：")]),s._v(" "),a("ul",[a("li",[s._v("启用身份验证和授权，并生成超级用户elastic的密码。")]),s._v(" "),a("li",[s._v("启用TLS 的证书和密钥，为传输层和 HTTP 层加密生成的。")])]),s._v(" "),a("p",[s._v("密码、证书和密钥将会显示在终端。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ivh elasticsearch-8.8.2-x86_64.rpm ")]),s._v("\nwarning: elasticsearch-8.8.2-x86_64.rpm: Header V4 RSA/SHA512 Signature, key ID d88e42b4: NOKEY\nVerifying"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("################################# [100%]")]),s._v("\nPreparing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("################################# [100%]")]),s._v("\nCreating elasticsearch group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". OK\nCreating elasticsearch user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". OK\nUpdating / installing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":elasticsearch-0:8.8.2-1          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("################################# [100%]")]),s._v("\n--------------------------- Security autoconfiguration information ------------------------------\n\nAuthentication and authorization are enabled.\nTLS "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the transport and HTTP layers is enabled and configured.\n\nThe generated password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the elastic built-in superuser is "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" enu7CEdICqQ5oXp5U0BC\n\nIf this "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" should "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" an existing cluster, you can reconfigure this with\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/usr/share/elasticsearch/bin/elasticsearch-reconfigure-node --enrollment-token <token-here>'")]),s._v("\nafter creating an enrollment token on your existing cluster.\n\nYou can complete the following actions at any time:\n\nReset the password of the elastic built-in superuser with \n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\nGenerate an enrollment token "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Kibana instances with \n "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\nGenerate an enrollment token "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Elasticsearch nodes with \n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s node'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n-------------------------------------------------------------------------------------------------\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### NOT starting on installation, please execute the following statements to configure elasticsearch service to start automatically using systemd")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" elasticsearch.service\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### You can start elasticsearch service by executing")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start elasticsearch.service\n/usr/lib/tmpfiles.d/elasticsearch.conf:1: Line references path below legacy directory /var/run/, updating /var/run/elasticsearch → /run/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" please update the tmpfiles.d/ drop-in "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" accordingly.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("p",[s._v("设置为开机自启动")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable elasticsearch.service")]),s._v("\nCreated symlink /etc/systemd/system/multi-user.target.wants/elasticsearch.service → /usr/lib/systemd/system/elasticsearch.service.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"创建数据与日志目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建数据与日志目录"}},[s._v("#")]),s._v(" 创建数据与日志目录")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /data/es-log /data/es-data")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chown -R elasticsearch:elasticsearch /data")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"修改jvm配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改jvm配置"}},[s._v("#")]),s._v(" 修改jvm配置")]),s._v(" "),a("p",[s._v("实际生产环境中计算公式："),a("strong",[s._v("min（机器内存的一半，32GB内存）")]),s._v("。也就是说：取机器环境内存的一半和32GB内存之间的小值，jvm配置如下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat > /etc/elasticsearch/jvm.options.d/es.options << EOF")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xms2g")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xmx2g")]),s._v("\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"修改es配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改es配置"}},[s._v("#")]),s._v(" 修改es配置")]),s._v(" "),a("blockquote",[a("p",[s._v("修改es配置时，先拷贝默认配置文件到其他目录下，使用默认配置文件加入集群后，再替换新的配置文件启动es服务，从es8开始需要使用token注册集群才能正常启动。"),a("br"),s._v("\n在配置master节点时，先不要设置node.roles，因为在集群初始化过程中需要写入集群元数据索引，如果集群节点为master无法写入数据，集群状态为red，无法生成token，其他节点无法加入集群。")])]),s._v(" "),a("p",[a("strong",[s._v("配置文件说明")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("配置项")]),s._v(" "),a("th",[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("cluster.name")]),s._v(" "),a("td",[s._v("集群名称，唯一确定一个集群。")])]),s._v(" "),a("tr",[a("td",[s._v("cluster.initial_master_nodes")]),s._v(" "),a("td",[s._v("用于初始化第一次时选举 master 节点，填写 node name或者node ip")])]),s._v(" "),a("tr",[a("td",[s._v("node.name")]),s._v(" "),a("td",[s._v("节点名称，一个集群中的节点名称是唯一固定的，不同节点不能同名。")])]),s._v(" "),a("tr",[a("td",[s._v("node.master")]),s._v(" "),a("td",[s._v("主节点属性值")])]),s._v(" "),a("tr",[a("td",[s._v("node.data")]),s._v(" "),a("td",[s._v("数据节点属性值")])]),s._v(" "),a("tr",[a("td",[s._v("network.host")]),s._v(" "),a("td",[s._v("本节点的ip，或0.0.0.0")])]),s._v(" "),a("tr",[a("td",[s._v("http.port")]),s._v(" "),a("td",[s._v("本节点的http端口")])]),s._v(" "),a("tr",[a("td",[s._v("transport.port")]),s._v(" "),a("td",[s._v("集群之间通信的端口，若不指定默认：9300")])]),s._v(" "),a("tr",[a("td",[s._v("path.logs")]),s._v(" "),a("td",[s._v("修改日志目录")])]),s._v(" "),a("tr",[a("td",[s._v("path.data")]),s._v(" "),a("td",[s._v("修改数据目录")])]),s._v(" "),a("tr",[a("td",[s._v("discovery.seed_hosts")]),s._v(" "),a("td",[s._v("节点发现需要配置一些种子节点，与7.X之前老版本：disvoery.zen.ping.unicast.hosts类似，一般配置集群中的全部节点")])])])]),s._v(" "),a("p",[a("strong",[s._v("master节点配置")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/elasticsearch/elasticsearch.yml")]),s._v("\ncluster.name: es-cluster\nnode.name: es-master\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node.roles: [ master, ingest ] # 先不设置集群角色，待集群全部加入后再设置")]),s._v("\npath.data: /data/es-data\npath.logs: /data/es-log\nnetwork.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.100 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# master节点IP,或0.0.0.0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 填写集群ip或主机名列表")]),s._v("\ndiscovery.seed_hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-master"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-hot1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-hot2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-hot2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-warm1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-warm2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-cold"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nxpack.security.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nxpack.security.enrollment.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nxpack.security.http.ssl:\n  enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  keystore.path: certs/http.p12\nxpack.security.transport.ssl:\n  enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  verification_mode: certificate\n  keystore.path: certs/transport.p12\n  truststore.path: certs/transport.p12\n\ncluster.initial_master_nodes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-master"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# master节点IP或主机名")]),s._v("\nhttp.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("启动master节点服务并生成token")]),s._v(" "),a("blockquote",[a("p",[s._v("以下操作在es-master节点执行")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start elasticsearch")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("生成集群注册token")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s node")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("eyJ2ZXIiOiI4LjguMiIsImFkciI6WyIxOTIuMTY4LjguNTo5MjAwIl0sImZnciI6IjdmMTlkZjk5OGQ1NTRjOTJlY2I1MDVkYjZkYWUwOTU0ZDc0ZjNjNDdlZjU2Yjc4YjQ2YjY1NjYyNTU4Yjk4OGMiLCJrZXkiOiIxSG5iZDRrQmRoRkRQY2VFY0xLcjpMeTVQZ3dlZVNtT1BYTnZWS0hqWG53In0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"其他节点加入集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他节点加入集群"}},[s._v("#")]),s._v(" 其他节点加入集群")]),s._v(" "),a("blockquote",[a("p",[s._v("以下操作在其他剩余节点执行")])]),s._v(" "),a("p",[s._v("使用默认配置文件执行加入集群，token为上面master节点生成的")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-hot1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /usr/share/elasticsearch/bin/elasticsearch-reconfigure-node --enrollment-token eyJ2ZXIiOiI4LjguMiIsImFkciI6WyIxOTIuMTY4LjguNTo5MjAwIl0sImZnciI6IjdmMTlkZjk5OGQ1NTRjOTJlY2I1MDVkYjZkYWUwOTU0ZDc0ZjNjNDdlZjU2Yjc4YjQ2YjY1NjYyNTU4Yjk4OGMiLCJrZXkiOiIxSG5iZDRrQmRoRkRQY2VFY0xLcjpMeTVQZ3dlZVNtT1BYTnZWS0hqWG53In0=")]),s._v("\n\nThis "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" will be reconfigured to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" an existing cluster, using the enrollment token that you provided.\nThis operation will overwrite the existing configuration. Specifically: \n  - Security auto configuration will be removed from elasticsearch.yml\n  - The "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" config directory will be removed\n  - Security auto configuration related secure settings will be removed from the elasticsearch.keystore\nDo you want to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("continue")]),s._v(" with the reconfiguration process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/N"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("y\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("上述操作一定要使用es默认配置文件执行，待reconfigure-node完成后，再修改节点yml配置文件"),a("br"),s._v(" "),a("strong",[s._v("hot节点配置")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-hot1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/elasticsearch/elasticsearch.yml")]),s._v("\ncluster.name: es-cluster\nnode.name: es-hot1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改节点名称")]),s._v("\nnode.roles: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" data_content, data_hot "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\npath.data: /data/es-data\npath.logs: /data/es-log\nnetwork.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.133 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改节点ip，或0.0.0.0")]),s._v("\ndiscovery.seed_hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-master"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-hot1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-hot2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-hot2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-warm1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-warm2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-cold"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nxpack.security.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nxpack.security.enrollment.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nxpack.security.http.ssl:\n  enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  keystore.path: certs/http.p12\nxpack.security.transport.ssl:\n  enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  verification_mode: certificate\n  keystore.path: certs/transport.p12\n  truststore.path: certs/transport.p12\n\ncluster.initial_master_nodes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-master"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nhttp.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[a("strong",[s._v("warm节点配置")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-warm1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/elasticsearch/elasticsearch.yml")]),s._v("\ncluster.name: es-cluster\nnode.name: es-warm1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改节点名称")]),s._v("\nnode.roles: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" data_content, data_warm "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\npath.data: /data/es-data\npath.logs: /data/es-log\nnetwork.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.136 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改节点ip，或0.0.0.0")]),s._v("\ndiscovery.seed_hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-master"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-hot1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-hot2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-hot2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-warm1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-warm2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-cold"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nxpack.security.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nxpack.security.enrollment.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nxpack.security.http.ssl:\n  enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  keystore.path: certs/http.p12\nxpack.security.transport.ssl:\n  enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  verification_mode: certificate\n  keystore.path: certs/transport.p12\n  truststore.path: certs/transport.p12\n\ncluster.initial_master_nodes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-master"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nhttp.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[a("strong",[s._v("cold节点配置")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-cold ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/elasticsearch/elasticsearch.yml")]),s._v("\ncluster.name: es-cluster\nnode.name: es-cold\nnode.roles: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" data_content, data_cold "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\npath.data: /data/es-data\npath.logs: /data/es-log\nnetwork.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.138 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或0.0.0.0")]),s._v("\ndiscovery.seed_hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-master"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-hot1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-hot2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-hot2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-warm1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-warm2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-cold"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nxpack.security.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nxpack.security.enrollment.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nxpack.security.http.ssl:\n  enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  keystore.path: certs/http.p12\nxpack.security.transport.ssl:\n  enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  verification_mode: certificate\n  keystore.path: certs/transport.p12\n  truststore.path: certs/transport.p12\n\ncluster.initial_master_nodes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.10.100"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nhttp.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("启动es服务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-hot1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start elasticsearch")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("剩余节点依次重复执行上述操作。")]),s._v(" "),a("h2",{attrs:{id:"重置elastic用户密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重置elastic用户密码"}},[s._v("#")]),s._v(" 重置elastic用户密码")]),s._v(" "),a("blockquote",[a("p",[s._v("以下操作在master节点执行")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic")]),s._v("\nThis tool will reset the password of the "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("elastic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" user to an autogenerated value.\nThe password will be printed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the console.\nPlease confirm that you would like to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("continue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/N"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("y\nPassword "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("elastic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" user successfully reset.\nNew value: _21FDs+tGRRSaxg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("q"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("4P\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"修改master节点属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改master节点属性"}},[s._v("#")]),s._v(" 修改master节点属性")]),s._v(" "),a("p",[s._v("由于在集群初始化过程中，master节点写入了集群元数据索引，需要先将元数据迁移至其他数据节点。我们可以使用cluster.routing.allocation.exclude._ip，将指定节点ip上面的分片分配到其他节点上。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# curl -X PUT -H \'content-type:application/json\' -d \'{"transient":{"cluster.routing.allocation.exclude._ip":"192.168.10.132"}}\' --cacert /etc/elasticsearch/certs/http_ca.crt https://elastic:_21FDs+tGRRSaxg=q=4P@127.0.0.1:9200/_cluster/settings')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"acknowledged"')]),s._v(":true,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"persistent"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"transient"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"routing"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"allocation"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exclude"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_ip"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.10.132"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("等待分片迁移完成后，查看分片信息验证，保证master节点无分片数据")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl --cacert /etc/elasticsearch/certs/http_ca.crt https://elastic:_21FDs+tGRRSaxg=q=4P@127.0.0.1:9200/_cat/shards?")]),s._v("\nvindex       shard prirep state   docs  store "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v("\n.security-7 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     p      STARTED    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(".4kb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.134 es-hot2\n.security-7 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     r      STARTED    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(".4kb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.133 es-hot1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("修改es配置，重启es服务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/elasticsearch/elasticsearch.yml ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定节点角色")]),s._v("\nnode.roles: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" master, ingest "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart elasticsearch")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"访问验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问验证"}},[s._v("#")]),s._v(" 访问验证")]),s._v(" "),a("p",[s._v("查看集群状态")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl --cacert /etc/elasticsearch/certs/http_ca.crt https://elastic:_21FDs+tGRRSaxg=q=4P@127.0.0.1:9200/_cat/health?")]),s._v("\nvepoch      timestamp cluster    status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1689561374")]),s._v(" 02:36:14  es-cluster green           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                  -                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("%\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("查看节点状态")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl --cacert /etc/elasticsearch/certs/http_ca.crt https://elastic:_21FDs+tGRRSaxg=q=4P@127.0.0.1:9200/_cat/nodes?v")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v("             heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.132           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.29")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.96")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.56")]),s._v(" im        *      es-master\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.135            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.39")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.20")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.15")]),s._v(" hs        -      es-hot3\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.134           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.07")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.08")]),s._v(" hs        -      es-hot2\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.133           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.87")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.52")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.26")]),s._v(" hs        -      es-hot1\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.138           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.09")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.63")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.45")]),s._v(" cs        -      es-cold\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.136           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.05")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.07")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.12")]),s._v(" sw        -      es-warm1\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.137           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.07")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.15")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.26")]),s._v(" sw        -      es-warm2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h1",{attrs:{id:"kibana安装配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kibana安装配置"}},[s._v("#")]),s._v(" kibana安装配置")]),s._v(" "),a("blockquote",[a("p",[s._v("以下操作在es-master节点执行")])]),s._v(" "),a("h2",{attrs:{id:"下载安装rpm包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载安装rpm包"}},[s._v("#")]),s._v(" 下载安装rpm包")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://artifacts.elastic.co/downloads/kibana/kibana-8.8.2-x86_64.rpm")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ivh kibana-8.8.2-x86_64.rpm")]),s._v("\nwarning: kibana-8.8.2-x86_64.rpm: Header V4 RSA/SHA512 Signature, key ID d88e42b4: NOKEY\nVerifying"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("################################# [100%]")]),s._v("\nPreparing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("################################# [100%]")]),s._v("\nUpdating / installing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":kibana-8.8.2-1                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("################################# [100%]")]),s._v("\nCreating kibana group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". OK\nCreating kibana user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". OK\nCreated Kibana keystore "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /etc/kibana/kibana.keystore\n/usr/lib/tmpfiles.d/elasticsearch.conf:1: Line references path below legacy directory /var/run/, updating /var/run/elasticsearch → /run/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" please update the tmpfiles.d/ drop-in "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" accordingly.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"为kibana生成注册令牌"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为kibana生成注册令牌"}},[s._v("#")]),s._v(" 为Kibana生成注册令牌")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("eyJ2ZXIiOiI4LjguMiIsImFkciI6WyIxOTIuMTY4LjguNTo5MjAwIl0sImZnciI6IjdmMTlkZjk5OGQ1NTRjOTJlY2I1MDVkYjZkYWUwOTU0ZDc0ZjNjNDdlZjU2Yjc4YjQ2YjY1NjYyNTU4Yjk4OGMiLCJrZXkiOiJ2TEgtZDRrQllLU1JQelFQSXBGVTpwVzZEUmtTV1NJMmg4QmVlMjdpMkFRIn0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"kibana注册集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kibana注册集群"}},[s._v("#")]),s._v(" kibana注册集群")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /usr/share/kibana/bin/kibana-setup --enrollment-token eyJ2ZXIiOiI4LjguMiIsImFkciI6WyIxOTIuMTY4LjguNTo5MjAwIl0sImZnciI6IjdmMTlkZjk5OGQ1NTRjOTJlY2I1MDVkYjZkYWUwOTU0ZDc0ZjNjNDdlZjU2Yjc4YjQ2YjY1NjYyNTU4Yjk4OGMiLCJrZXkiOiJ2TEgtZDRrQllLU1JQelFQSXBGVTpwVzZEUmtTV1NJMmg4QmVlMjdpMkFRIn0=")]),s._v("\n\n✔ Kibana configured successfully.\n\nTo start Kibana run:\n  bin/kibana\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"修改kibana配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改kibana配置"}},[s._v("#")]),s._v(" 修改kibana配置")]),s._v(" "),a("p",[s._v("从es8开始，kibana使用token注册连接es，kibana通过解析token可以获取到es的地址用户名和密码信息，因此在kibana配置文件中无需设置es地址与账号密码信息。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/kibana/kibana.yml")]),s._v("\nserver.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5601")]),s._v("\nserver.host: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kibana中文界面")]),s._v("\ni18n.locale: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zh-CN"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"启动服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动服务"}},[s._v("#")]),s._v(" 启动服务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable kibana")]),s._v("\nCreated symlink /etc/systemd/system/multi-user.target.wants/kibana.service → /usr/lib/systemd/system/kibana.service.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start kibana")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"访问验证-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问验证-2"}},[s._v("#")]),s._v(" 访问验证")]),s._v(" "),a("ul",[a("li",[s._v("登录kibana http://192.168.10.132:5601，用户名为elasic，密码为上述步骤中重置的elastic用户密码")])]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2024/03/66d82828b71d5373.jpg",alt:"66d82828b71d5373.jpg"}})]),s._v(" "),a("h2",{attrs:{id:"导入样例数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导入样例数据"}},[s._v("#")]),s._v(" 导入样例数据")]),s._v(" "),a("p",[s._v("登录进kibana后，我们选择使用样例数据")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2024/03/0300ac13d5a05efb.jpg",alt:"0300ac13d5a05efb.jpg"}})]),s._v(" "),a("p",[s._v("然后导入kibana提供的样例数据")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2024/03/d4e13c64e754a967.jpg",alt:"d4e13c64e754a967.jpg"}})]),s._v(" "),a("h2",{attrs:{id:"monitor异常处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#monitor异常处理"}},[s._v("#")]),s._v(" monitor异常处理")]),s._v(" "),a("p",[s._v("访问kibana的monitor时，会提示以下报错。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2024/03/d143d39125f43da4.jpg",alt:"d143d39125f43da4.jpg"}})]),s._v(" "),a("p",[s._v("修改kibana配置并重启。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/kibana/kibana.yml")]),s._v("\nmonitoring.ui.ccs.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@es-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart kibana")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("访问monitor页面验证")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2024/03/0aaeaee4988c749b.jpg",alt:"0aaeaee4988c749b.jpg"}})]),s._v(" "),a("h1",{attrs:{id:"官方文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#官方文档"}},[s._v("#")]),s._v(" 官方文档")]),s._v(" "),a("p",[s._v("rpm安装es服务：https://www.elastic.co/guide/en/elasticsearch/reference/current/rpm.html"),a("br"),s._v("\nes配置文件："),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Important Elasticsearch configuration | Elasticsearch Guide [8.12] | Elastic"),a("OutboundLink")],1),a("br"),s._v("\nes节点角色配置："),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#node-roles",target:"_blank",rel:"noopener noreferrer"}},[s._v("Node | Elasticsearch Guide [8.12] | Elastic"),a("OutboundLink")],1),a("br"),s._v("\njvm配置："),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/advanced-configuration.html#set-jvm-options",target:"_blank",rel:"noopener noreferrer"}},[s._v("Advanced configuration | Elasticsearch Guide [8.12] | Elastic"),a("OutboundLink")],1),a("br"),s._v("\nkibana配置文件："),a("a",{attrs:{href:"https://www.elastic.co/guide/en/kibana/current/settings.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Configure Kibana | Kibana Guide [8.12] | Elastic"),a("OutboundLink")],1)]),s._v(" "),a("hr"),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.cuiliangblog.cn/detail/article/59",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文链接"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);