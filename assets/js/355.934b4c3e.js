(window.webpackJsonp=window.webpackJsonp||[]).push([[355],{708:function(t,a,s){"use strict";s.r(a);var r=s(0),e=Object(r.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"zabbix-5-0-监控日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zabbix-5-0-监控日志"}},[t._v("#")]),t._v(" zabbix 5.0 监控日志")]),t._v(" "),a("p",[t._v("除了灵活的使用自定义监控项的方式，这里使用zabbix自带的日志监控。本文使用的是zabbix-5.0版本")]),t._v(" "),a("h1",{attrs:{id:"使用条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用条件"}},[t._v("#")]),t._v(" 使用条件")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("项目")]),t._v(" "),a("th",[t._v("要求")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("zabbix_agent")]),t._v(" "),a("td",[t._v("配置主动式参数")])]),t._v(" "),a("tr",[a("td",[t._v("时间同步")]),t._v(" "),a("td",[t._v("zabbix_server和zabbix_agent")])]),t._v(" "),a("tr",[a("td",[t._v("监控项类型")]),t._v(" "),a("td",[t._v("zabbix客户端(主动式)")])]),t._v(" "),a("tr",[a("td",[t._v("被监控日志文件")]),t._v(" "),a("td",[t._v("zabbix用户需要可读权限")])])])]),t._v(" "),a("p",[t._v("注意点：")]),t._v(" "),a("p",[t._v("其中，zabbix_agent.conf内关于zabbix客户端(主动式)的配置有以下2个")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("ServerActive=192.168.1.101 #填写zabbix_server的地址")])]),t._v(" "),a("li",[a("p",[t._v("Hostname=Zabbix server #填写本机主机名，要求一套监控系统内唯一，且要和web端配置的主机名一项保持一致。建议填写zabbix_agent的ip地址")])])]),t._v(" "),a("p",[t._v("日志文件的权限问题，可以用这条测试")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" zabbix "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /usr/local/nginx/logs/access.log\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h1",{attrs:{id:"监控项说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监控项说明"}},[t._v("#")]),t._v(" 监控项说明")]),t._v(" "),a("h2",{attrs:{id:"内置的监控项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内置的监控项"}},[t._v("#")]),t._v(" 内置的监控项")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v(" log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("file,"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("regexp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("encoding"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("maxlines"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("output"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("maxdelay"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n日志文件监控。返回日志，是一条记录一行日志内容\nlog.count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("fil,"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("regexp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("encoding"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("maxproclines"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("maxdelay"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n监控日志文件行数统计。返回整数\nlogrt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("file_regexp,"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("regexp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("encoding"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("maxlines"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("output"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("maxdelay"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\t\n日志文件监控与轮转服务。返回日志\nlogrt.count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("file_regexp,"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("regexp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("encoding"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("maxproclines"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("maxdelay"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\t\n日志文件监视中匹配行的计数与日志轮换支持。 返回整型\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("h2",{attrs:{id:"参数说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数说明"}},[t._v("#")]),t._v(" 参数说明")]),t._v(" "),a("ol",[a("li",[t._v("file或file_regexp")])]),t._v(" "),a("p",[t._v("日志文件所在的路径或者绝对路径名，后者可以使用正则匹配分割日志，比如/usr/local/nginx/logs/access.log*")]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("regexp")])]),t._v(" "),a("p",[t._v("匹配正则表达式，可以使用关键词，比如ERROR")]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("encoding")])]),t._v(" "),a("p",[t._v("在Linux/unix系统下默认编码为UTF-8，在Windows系统下默认编码为ANSI")]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("maxlines")])]),t._v(" "),a("p",[t._v("每次给zabbix-server或者zabbix-Proxy发送的日志的最大行数，此参数会高于zabbix-agent.conf中的MaxLinesPerSecond参数值，通过此参数，可以控制一次发送的日志的数据条数，如果发送次数过多，可能会对zabbix-agnet的负载和I/O有很大的影响")]),t._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[t._v("mode")])]),t._v(" "),a("ul",[a("li",[t._v("all")])]),t._v(" "),a("p",[t._v("为默认参数，表示匹配所有的日志，包括以前存的日志也会进行匹配")]),t._v(" "),a("ul",[a("li",[t._v("skip")])]),t._v(" "),a("p",[t._v("表示跳过已存在的日志数据，只有新的日志才会进行匹配，一般使用此项")]),t._v(" "),a("ol",{attrs:{start:"6"}},[a("li",[t._v("output")])]),t._v(" "),a("p",[t._v("表示匹配输出的正则表达式，\\1~\\9表示返回的匹配的第几个字符串，\\0表示返回匹配的全部字符串，全部输出为默认值")]),t._v(" "),a("ol",{attrs:{start:"7"}},[a("li",[t._v("maxdelay")])]),t._v(" "),a("p",[t._v("以秒为单位的最大延迟，用于忽略老的日志数据，及时获取当前的日志数据。(4.0+)当处理日志过多，在更新周期内达到maxlines的发送上限，但还有日志未发送时，会导致大量堆积，在严重的情况下，会造成日志处理速度跟不上，使用此参数忽略过期的日志发送0是默认值，永远不会忽略日志文件行输入可以是浮点数(float)>0.0,忽略较旧的行，以获得在maxdelay秒内分析最新行，会丢弃在规定时间内的无法发送的数据")]),t._v(" "),a("ol",{attrs:{start:"8"}},[a("li",[t._v("options")])]),t._v(" "),a("p",[t._v("日志轮询、切割方式(4.0+)rotate，日志轮询、切割，默认值copytruncate，先拷贝文件，然后清空日志的轮询方式，copytruncate不能与maxdelay一起使用，如使用此参数，maxdelay必须为0或者未指定[size=12.0000pt]")]),t._v(" "),a("h1",{attrs:{id:"使用实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用实例"}},[t._v("#")]),t._v(" 使用实例")]),t._v(" "),a("h2",{attrs:{id:"新建监控项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新建监控项"}},[t._v("#")]),t._v(" 新建监控项")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/03/833fefba2747e586.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("logrt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("/tmp/error.log,"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"error"')]),t._v(",,,,skip,,"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 表示监控的日志文件为/tmp/error.log，正则匹配关键词error，模式选择跳过旧日志，不使用的其他参数需要留空")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h2",{attrs:{id:"查看最新数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看最新数据"}},[t._v("#")]),t._v(" 查看最新数据")]),t._v(" "),a("p",[t._v("通过echo模拟日志写入，之后根据【更新间隔】时间的不同，可以在【监控】–【最新数据】内看到模拟的报错信息")]),t._v(" "),a("h2",{attrs:{id:"新建触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新建触发器"}},[t._v("#")]),t._v(" 新建触发器")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.100:logrt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("/tmp/error.log,"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"error"')]),t._v(",,,skip,,,"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(".str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nand\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.100:logrt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("/tmp/error.log,"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"error"')]),t._v(",,,skip,,,"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(".nodata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("60s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 实测这样的表达式可以实现，日志内出现error关键词即告警，在60秒内未收到新的error信息视为故障恢复")]),t._v("\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);