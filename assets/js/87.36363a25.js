(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{440:function(e,s,a){"use strict";a.r(s);var t=a(0),n=Object(t.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h3",{attrs:{id:"k8s使用过程遇到的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s使用过程遇到的问题"}},[e._v("#")]),e._v(" K8S使用过程遇到的问题")]),e._v(" "),s("h4",{attrs:{id:"_1、the-connection-to-the-server-localhost-8080-was-refused-did-you-specify-the-right-host-or-port"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、the-connection-to-the-server-localhost-8080-was-refused-did-you-specify-the-right-host-or-port"}},[e._v("#")]),e._v(" 1、The connection to the server localhost:8080 was refused - did you specify the right host or port?")]),e._v(" "),s("p",[s("strong",[e._v("问题分析")])]),e._v(" "),s("blockquote",[s("p",[e._v("环境变量\n原因：kubernetes master没有与本机绑定，集群初始化的时候没有绑定，此时设置在本机的环境变量即可解决问题。")])]),e._v(" "),s("p",[s("strong",[e._v("解决：")]),e._v("\n步骤一：设置环境变量")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##具体根据情况，此处记录linux设置该环境变量")]),e._v("\nll/etc/kubernetes/kubelet.conf\n-rw------- "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1906")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("月  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(" 09:52 /etc/kubernetes/kubelet.conf\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##方式一：编辑文件设置")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("vim")]),e._v(" /etc/profile\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">>")]),e._v("在底部增加新的环境变量 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("KUBECONFIG")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/etc/kubernetes/kubelet.conf\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##方式二:直接追加文件内容")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"export KUBECONFIG=/etc/kubernetes/kubelet.conf"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">>")]),e._v(" /etc/profile\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br")])]),s("p",[e._v("步骤二：使生效")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("source")]),e._v(" /etc/profile\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[s("strong",[e._v("AWS EKS 解决方法：")])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("aws eks update-kubeconfig "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--region")]),e._v(" cn-north-1 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--name")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("cluster_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2、installation-failed-cannot-re-use-a-name-that-is-still-in-use"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、installation-failed-cannot-re-use-a-name-that-is-still-in-use"}},[e._v("#")]),e._v(" 2、INSTALLATION FAILED: cannot re-use a name that is still in use")]),e._v(" "),s("blockquote",[s("p",[e._v("#执行helm安装时报错\nError: INSTALLATION FAILED: cannot re-use a name that is still in use")])]),e._v(" "),s("p",[e._v("解决：")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("helm "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v(" --all-namespaces\nkubectl delete namespace qsh-test\nkubectl create namespace qsh-test\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("h4",{attrs:{id:"_3、pod无法删除"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、pod无法删除"}},[e._v("#")]),e._v(" 3、Pod无法删除")]),e._v(" "),s("blockquote",[s("p",[e._v("每当删除namespace或pod 等一些Kubernetes资源时，有时资源状态会卡在terminating，很长时间无法删除，甚至有时增加–force flag(强制删除)之后还是无法正常删除。这时就需要edit该资源，将字段finalizers设置为null，之后Kubernetes资源就正常删除了。")])]),e._v(" "),s("p",[e._v("当删除pod时有时会卡住，pod状态变为terminating，无法删除pod")]),e._v(" "),s("p",[s("strong",[e._v("强制删除")])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("kubectl delete pod xxx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" xxx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--force")]),e._v(" --grace-period"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[s("strong",[e._v("如果强制删除还不行，设置finalizers为空")]),e._v("\n（如果一个容器已经在运行，这时需要对一些容器属性进行修改，又不想删除容器，或不方便通过replace的方式进行更新。kubernetes还提供了一种在容器运行时，直接对容器进行修改的方式，就是patch命令。）")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("kubectl patch pod xxx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" xxx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-p")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('\'{"metadata":{"finalizers":null}}\'')]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("这样pod就可以删除了。")]),e._v(" "),s("h4",{attrs:{id:"_4、namespace无法删除"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、namespace无法删除"}},[e._v("#")]),e._v(" 4、Namespace无法删除")]),e._v(" "),s("blockquote",[s("p",[e._v("unable to create new content in namespace posthog because it is being terminated")])]),e._v(" "),s("p",[e._v("现象：")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##命名空间一直处于Terminating状态")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("ec2-user@eks posthog"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("$ kubectl get ns "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-owide")]),e._v("\nNAME                       STATUS        AGE\ndefault                    Active        3d\nkube-node-lease            Active        3d\nkube-public                Active        3d\nkube-system                Active        3d\nposthog                    Terminating   3h23m\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##执行强制删除命令会一直卡住")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("ec2-user@eks posthog"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("$ kubectl delete ns posthog --grace-period"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--force")]),e._v("\nwarning: Immediate deletion does not "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("wait")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" confirmation that the running resource has been terminated. The resource may "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("continue")]),e._v(" to run on the cluster indefinitely.\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("namespace "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"posthog"')]),e._v(" force deleted\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br")])]),s("p",[e._v("解决：")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##查看posthog的命名空间描述")]),e._v("\nkubectl get ns posthog "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-o")]),e._v(" son "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" ns-posthog.json\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##删除spec")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("###删除前内容如下：")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"spec"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"finalizers"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"kubernetes"')]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(",\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("###删除后内容如下：")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"spec"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(",\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##打开一个新窗口运行kubectl proxy跑一个API代理在本地的8081端口")]),e._v("\nkubectl proxy "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--port")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8081")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##curl删除")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-k")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-H")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Content-Type:application/json"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-X")]),e._v(" PUT --data-binary @ns-posthog.json http://127.0.0.1:8081/api/v1/namespaces/posthog/finalize\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##重新检查，发现已删除")]),e._v("\nkubectl get ns\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br")])]),s("h4",{attrs:{id:"_5、pv无法删除"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、pv无法删除"}},[e._v("#")]),e._v(" 5、PV无法删除")]),e._v(" "),s("blockquote",[s("p",[e._v("K8s 集群内有一个已经不再使用的 PV，虽然已经删除了与其关联的 Pod 及 PVC，并对其执行了删除命令，但仍无法正常删除，一直处于 Terminating 状态：")])]),e._v(" "),s("p",[s("img",{attrs:{src:"http://pic.zzppjj.top/LightPicture/2023/05/188dd0bd115f7ff8.png",alt:"188dd0bd115f7ff8.png"}})]),e._v(" "),s("p",[e._v("解决方法：")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##执行如下命令强制删除（efs-pv 替换成实际需要删除的 pv 名称）：")]),e._v("\nkubectl patch "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("pv")]),e._v(" efs-pv "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-p")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('\'{"metadata":{"finalizers":null}}\'')]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##再次查看可以发现该 pv 已被删除")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("h4",{attrs:{id:"_6、创建nginx-ingress-controller-出错"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6、创建nginx-ingress-controller-出错"}},[e._v("#")]),e._v(" 6、创建nginx-ingress-controller 出错")]),e._v(" "),s("blockquote",[s("p",[e._v("Error: INSTALLATION FAILED: rendered manifests contain a resource that already exists. Unable to continue with install: IngressClass “nginx” in namespace “” exists and cannot be imported into the current release: invalid ownership metadata; annotation validation error: missing key “meta.helm.sh/release-name”: must be set to “k8s-nginx”; annotation validation error: missing key “meta.helm.sh/release-namespace”: must be set to “nginx-ingress-controller”\nhelm.go:84: [debug] IngressClass “nginx” in namespace “” exists and cannot be imported into the current release: invalid ownership metadata; annotation validation error: missing key “meta.helm.sh/release-name”: must be set to “k8s-nginx”; annotation validation error: missing key “meta.helm.sh/release-namespace”: must be set to “nginx-ingress-controller”\nrendered manifests contain a resource that already exists. Unable to continue with install")])]),e._v(" "),s("p",[e._v("原因分析：\n使用 helm 创建nginx-ingress-controller时出错")]),e._v(" "),s("p",[e._v("查看helm chart仓库values.yaml文件")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#... ... ...")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("##查看以下字段")]),e._v("\ningressClassResource:\n  name: nginx\n  enabled: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n  default: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("\n  controllerClass: "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"k8s.io/ingress-nginx"')]),e._v("\n  parameters: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#... ... ...")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("p",[e._v("解决方法：")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("helm "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" k8s-nginx mynginx/nginx-ingress-controller "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" nginx-ingress-controller --create-namespace "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--set")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ingressClassResource.name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"nginx-new"')]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("如果没生效，使用以下命令：")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("helm "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" k8s-nginx mynginx/nginx-ingress-controller "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" nginx-ingress-controller --create-namespace "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--set")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("controller.ingressClassResource.name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"nginx-new"')]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h3",{attrs:{id:"etcd集群部署遇到的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#etcd集群部署遇到的问题"}},[e._v("#")]),e._v(" etcd集群部署遇到的问题")]),e._v(" "),s("h4",{attrs:{id:"_1、etcd-serverice启动报错-显示-logger-zap有问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、etcd-serverice启动报错-显示-logger-zap有问题"}},[e._v("#")]),e._v(" 1、etcd.serverice启动报错，显示–logger=zap有问题")]),e._v(" "),s("p",[e._v("解决方法：\n修改配置文件，去掉该参数，重新启动服务")]),e._v(" "),s("h4",{attrs:{id:"_2、publish-error-etcdserver-request-timed-out-由于etcd集群没有同时启动导致"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、publish-error-etcdserver-request-timed-out-由于etcd集群没有同时启动导致"}},[e._v("#")]),e._v(" 2、publish error: etcdserver: request timed out，由于etcd集群没有同时启动导致")]),e._v(" "),s("p",[e._v("解决方法：\n在部署了etcd的节点上，同时启动etcd服务systemctl start etcd")]),e._v(" "),s("h4",{attrs:{id:"_3、error-1-dial-tcp-127-0-0-1-2379-connect-connection-refused-由于参数etcd-listen-client-urls没有将172-0-0-1-2379包含在内"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、error-1-dial-tcp-127-0-0-1-2379-connect-connection-refused-由于参数etcd-listen-client-urls没有将172-0-0-1-2379包含在内"}},[e._v("#")]),e._v(" 3、error #1: dial tcp 127.0.0.1:2379: connect: connection refused，由于参数ETCD_LISTEN_CLIENT_URLS没有将172.0.0.1:2379包含在内")]),e._v(" "),s("p",[e._v("解决方法：\nETCD_LISTEN_CLIENT_URLS添加https://172.0.0.1:2379或者直接改成0.0.0.0:2379")]),e._v(" "),s("h4",{attrs:{id:"_4、error-1-dial-tcp-127-0-0-1-4001-connect-connection-refused-由于低版本的peer的监听端口是否4001"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、error-1-dial-tcp-127-0-0-1-4001-connect-connection-refused-由于低版本的peer的监听端口是否4001"}},[e._v("#")]),e._v(" 4、error #1: dial tcp 127.0.0.1:4001: connect: connection refused，由于低版本的peer的监听端口是否4001")]),e._v(" "),s("p",[e._v("解决方法：\nETCD_LISTEN_CLIENT_URLS添加https://172.0.0.1:2379或者直接改成0.0.0.0:2379")]),e._v(" "),s("h4",{attrs:{id:"_5、error-1-net-http-http-1-x-transport-connection-broken-malformed-http-response-x15-x03-x01-x00-x02-x02-由于配置信息监听地址写成了http"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、error-1-net-http-http-1-x-transport-connection-broken-malformed-http-response-x15-x03-x01-x00-x02-x02-由于配置信息监听地址写成了http"}},[e._v("#")]),e._v(" 5、error #1: net/http: HTTP/1.x transport connection broken: malformed HTTP response “\\x15\\x03\\x01\\x00\\x02\\x02”，由于配置信息监听地址写成了http://")]),e._v(" "),s("p",[e._v("解决方法：\n将监听地址改成https://")]),e._v(" "),s("h3",{attrs:{id:"kube-apiserver-service-遇到的错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kube-apiserver-service-遇到的错误"}},[e._v("#")]),e._v(" kube-apiserver.service 遇到的错误")]),e._v(" "),s("h4",{attrs:{id:"_1、error-unable-to-find-suitable-network-address-error-no-default-routes-found-in-proc-net-route-or-proc-net-ipv6-route-tr-to-fix-this-由于没有配置网关路由问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、error-unable-to-find-suitable-network-address-error-no-default-routes-found-in-proc-net-route-or-proc-net-ipv6-route-tr-to-fix-this-由于没有配置网关路由问题"}},[e._v("#")]),e._v(" 1、error: unable to find suitable network address.error=‘no default routes found in “/proc/net/route” or “/proc/net/ipv6_route”’. Tr… to fix this，由于没有配置网关路由问题")]),e._v(" "),s("p",[e._v("解决方法：")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("route "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" default gw "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("172.16")]),e._v(".0.1\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2、error-etcd-servers-must-be-specified"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、error-etcd-servers-must-be-specified"}},[e._v("#")]),e._v(" 2、error: --etcd-servers must be specified")]),e._v(" "),s("p",[e._v("解决:sudo journalctl -xe -u kube-apiserver | more通过查看更多错误信息，除了error: --etcd-servers must be specified错误提示外无其他错误信息，通过手动执行system unit检查是否配置有误，手动能正常启动，说明配置文件可能存在字符错误，重新写入配置后，启动正常")]),e._v(" "),s("h4",{attrs:{id:"_3、watch-chan-error-etcdserver-mvcc-required-revision-has-been-compacted-由于etcd的版本问题导致的-不影响功能的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、watch-chan-error-etcdserver-mvcc-required-revision-has-been-compacted-由于etcd的版本问题导致的-不影响功能的使用"}},[e._v("#")]),e._v(" 3、watch chan error: etcdserver: mvcc: required revision has been compacted，由于etcd的版本问题导致的，不影响功能的使用")]),e._v(" "),s("p",[e._v("解决方法：\n可以安装对应版本的etcd")]),e._v(" "),s("h3",{attrs:{id:"kubelet和kube-proxy-部署遇到的错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubelet和kube-proxy-部署遇到的错误"}},[e._v("#")]),e._v(" kubelet和kube-proxy 部署遇到的错误")]),e._v(" "),s("h4",{attrs:{id:"_1、failed-complete-v1alpha1-kubeproxyconfiguration-clientconnection"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、failed-complete-v1alpha1-kubeproxyconfiguration-clientconnection"}},[e._v("#")]),e._v(" 1、failed complete: v1alpha1.KubeProxyConfiguration.ClientConnection")]),e._v(" "),s("blockquote",[s("p",[e._v('failed complete: v1alpha1.KubeProxyConfiguration.ClientConnection: readObjectStart: expect { or n, but found “, error found in #10 byte of …|nection”:“kubeconfig|…, bigger context …|pha1”,“bindAddress”:“0.0.0.0”,“clientConnection”:"kubeconfig:/data/kubernetes/cfg/kube-proxy.kubecon|…')])]),e._v(" "),s("p",[e._v('解决方法：\n检查yml文件格式是否正确，yml配置文件遇到":“或者”-"后面必须留一个空格！')]),e._v(" "),s("h4",{attrs:{id:"_2、network-plugin-is-not-ready-cni-config-uninitialized"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、network-plugin-is-not-ready-cni-config-uninitialized"}},[e._v("#")]),e._v(" 2、network plugin is not ready: cni config uninitialized")]),e._v(" "),s("blockquote",[s("p",[e._v("Container runtime network not ready: NetworkReady=false reason:NetworkPluginNotReady message:docker: network plugin is not ready: cni config uninitialized，由于没有插件cni")])]),e._v(" "),s("p",[e._v("解决方法：\n修改kubelet.conf配置文件去掉相关配置参数–network-plugin=cni，重启服务即可或者下在安装cni插件")]),e._v(" "),s("h4",{attrs:{id:"_3、failed-to-get-imagefs-info-unable-to-find-data-in-memory-cache"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、failed-to-get-imagefs-info-unable-to-find-data-in-memory-cache"}},[e._v("#")]),e._v(" 3、failed to get imageFs info: unable to find data in memory cache")]),e._v(" "),s("blockquote",[s("p",[e._v("在错误日志中发现：E0927 15:38:12.475997 16586 kubelet.go:1308] Image garbage collection failed once. Stats initialization may not have completed yet: failed to get imageFs info: unable to find data in memory cache")])]),e._v(" "),s("p",[e._v("解决方法：")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-y")]),e._v(" upgrade systemd\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h4",{attrs:{id:"_4、failed-to-run-kubelet-running-with-swap-on-is-not-supported-please-disable-swap-or-set-fail-swap-on-flag-to-f"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、failed-to-run-kubelet-running-with-swap-on-is-not-supported-please-disable-swap-or-set-fail-swap-on-flag-to-f"}},[e._v("#")]),e._v(" 4、failed to run Kubelet: Running with swap on is not supported, please disable swap! or set --fail-swap-on flag to f…")]),e._v(" "),s("p",[e._v("解决方法：\nnode节点上没有关闭交换分区，临时关闭的swapoff -a，最好就是永久关闭")]),e._v(" "),s("hr"),e._v(" "),s("p",[e._v("原文链接："),s("a",{attrs:{href:"https://blog.51cto.com/qiangsh/4929523",target:"_blank",rel:"noopener noreferrer"}},[e._v("Kubernetes 报错小结_奔跑在路上的技术博客_51CTO博客"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);