(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{431:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"ansible中template简单使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ansible中template简单使用"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199384.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ansible中template简单使用"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("目录")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199384.html#%E4%B8%80%E3%80%81%E6%A8%A1%E6%9D%BF%EF%BC%88template%EF%BC%89%E7%AE%80%E4%BB%8B",target:"_blank",rel:"noopener noreferrer"}},[s._v("一、模板（template）简介"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199384.html#%E4%BA%8C%E3%80%81%E4%BD%BF%E7%94%A8template%E9%83%A8%E7%BD%B2nginx",target:"_blank",rel:"noopener noreferrer"}},[s._v("二、使用template部署nginx"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199384.html#%E4%B8%89%E3%80%81playbook%E4%B8%ADwhen%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8",target:"_blank",rel:"noopener noreferrer"}},[s._v("三、playbook中when简单使用"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("四、playbook中with_items简单使用\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199384.html#41-%E8%BF%AD%E4%BB%A3%EF%BC%9Awith_items",target:"_blank",rel:"noopener noreferrer"}},[s._v("4.1 迭代：with_items"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199384.html#42-%E8%BF%AD%E4%BB%A3%E5%B5%8C%E5%A5%97%E5%AD%90%E5%8F%98%E9%87%8F",target:"_blank",rel:"noopener noreferrer"}},[s._v("4.2 迭代嵌套子变量"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("五、template循环示例\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199384.html#51-%E7%AC%AC%E4%B8%80%E7%A7%8D%E5%86%99%E6%B3%95",target:"_blank",rel:"noopener noreferrer"}},[s._v("5.1 第一种写法"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199384.html#52-%E7%AC%AC%E4%BA%8C%E7%A7%8D%E5%86%99%E6%B3%95",target:"_blank",rel:"noopener noreferrer"}},[s._v("5.2 第二种写法"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199384.html#53-%E7%AC%AC%E4%B8%89%E7%A7%8D%E5%86%99%E6%B3%95",target:"_blank",rel:"noopener noreferrer"}},[s._v("5.3 第三种写法"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lvzhenjiang/p/14199384.html#%E5%85%AD%E3%80%81playbook%E4%B8%ADif%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8",target:"_blank",rel:"noopener noreferrer"}},[s._v("六、playbook中if简单使用"),a("OutboundLink")],1)])]),s._v(" "),a("h3",{attrs:{id:"一、模板-template-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、模板-template-简介"}},[s._v("#")]),s._v(" 一、模板（template）简介")]),s._v(" "),a("ul",[a("li",[s._v("文件文件，嵌套有脚本（使用模板编程语言编写）；")]),s._v(" "),a("li",[s._v("jinja2语言，使用字面量，有以下形式：\n"),a("ul",[a("li",[s._v("字符串：使用单引号或双引号；")]),s._v(" "),a("li",[s._v("数字：整数，浮点数；")]),s._v(" "),a("li",[s._v("列表：[ item1,item2,……]")]),s._v(" "),a("li",[s._v("元组：(item1,item2,……)")]),s._v(" "),a("li",[s._v("字典：{key1:value1,key2,value2,……}")]),s._v(" "),a("li",[s._v("布尔型：true/false")])])]),s._v(" "),a("li",[s._v("算术运算：+，-，*，/，//，%，**")]),s._v(" "),a("li",[s._v("比较操作：==，!=，>，>=，<，<=")]),s._v(" "),a("li",[s._v("逻辑运算：and，or，not")]),s._v(" "),a("li",[s._v("流表达式：for，if，when")])]),s._v(" "),a("h3",{attrs:{id:"二、使用template部署nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、使用template部署nginx"}},[s._v("#")]),s._v(" 二、使用template部署nginx")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("     //建议，安装nginx的yaml和templates目录在同一目录下\ninstall_nginx.yaml  templates\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" install_nginx.yaml \n---\n- hosts: webservers\n  remote_user: root\n  vars:         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建变量信息")]),s._v("\n    - http_port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v("\n\n  tasks:\n    - name: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" package\n      yum: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n    - name: template copy\n      template: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx.conf.j2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/nginx/nginx.conf   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#由于模板文件在tmplate下，所以src后的路径就可以只写配置文件名称")]),s._v("\n      notify: restart "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义notify便于修改文件重启服务")]),s._v("\n    - name: start "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\n      service: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("started "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n\n  handlers:    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义重启服务策略")]),s._v("\n    - name: restart "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\n      service: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("restarted\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" templates/     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意模板的文件名称有一定的要求")]),s._v("\nnginx.conf.j2\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" templates/nginx.conf.j2    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#该文件就是nginx的配置文件复制而成的")]),s._v("\n…………      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#省略部分内容")]),s._v("\nworker_processes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ansible_processor_vcpus**2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用变量是cpu核心数的2次方")]),s._v("\nlisten       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" http_port "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" default_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nlisten       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" http_port "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" default_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用playbook中定义的变量信息")]),s._v("\n$ ansible-playbook install_nginx.yaml\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#运行playbook文件")]),s._v("\n$ ansible webservers "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" shell "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rpm -q nginx'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx确实已经安装成功")]),s._v("\n$ ansible webservers "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" shell "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ss -lnt | grep 8888'")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#端口已经正常开启")]),s._v("\n$ ansible webservers "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" shell "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ps aux | grep nginx'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#确认工作进程数是预期设定的值")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("p",[s._v("至此template批量部署nginx已经实现！")]),s._v(" "),a("h3",{attrs:{id:"三、playbook中when简单使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、playbook中when简单使用"}},[s._v("#")]),s._v(" 三、playbook中when简单使用")]),s._v(" "),a("p",[a("strong",[s._v("when")]),s._v("：可以简单理解为一个条件判断，类似于shell脚本中的if语句！")]),s._v(" "),a("p",[s._v("因为ansible管理的主机可能不是一个系统版本的，那么就需要区别部署了！")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ ansible all "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" setup "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'filter=*distribution*'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看ansible默认支持的变量")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" install_nginx.yaml \n---\n- hosts: all     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#针对所有主机")]),s._v("\n  remote_user: root\n  vars:\n    - http_port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v("\n\n  tasks:\n    - name: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" package\n      yum: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n    - name: template copy "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" centos7\n      template: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx.conf7.j2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/nginx/nginx.conf\n      when: ansible_distribution_major_version "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7"')]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当检测到系统版本为7才执行本模块的操作")]),s._v("\n      notify: restart "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\n    - name: template copy "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" centos6\n      template: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx.conf6.j2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/nginx/nginx.conf\n      when: ansible_distribution_major_version "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6"')]),s._v("\n      notify: restart "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\n    - name: start "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\n      service: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("started "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n\n  handlers:\n    - name: restart "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\n      service: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("restarted\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" templates/   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意一个是nginx6的配置文件，一个nginx7的配置文件")]),s._v("\nnginx.conf6.j2  nginx.conf7.j2\n$ ansible-playbook install_nginx.yaml\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#执行playbook文件")]),s._v("\n$ ansible all "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" shell "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ss -lntp | grep nginx'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#确认centos 6系统的nginx已经启动")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("h3",{attrs:{id:"四、playbook中with-items简单使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、playbook中with-items简单使用"}},[s._v("#")]),s._v(" 四、playbook中with_items简单使用")]),s._v(" "),a("h4",{attrs:{id:"_4-1-迭代-with-items"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-迭代-with-items"}},[s._v("#")]),s._v(" 4.1 迭代：with_items")]),s._v(" "),a("p",[a("strong",[s._v("迭代：with_items")]),s._v("：当有需要重复性执行任务是，可以使用迭代机制！")]),s._v(" "),a("ul",[a("li",[s._v("带迭代项的引用，固定变量为“item”；")]),s._v(" "),a("li",[s._v("在task中使用with_items定义需要迭代的元素列表；")]),s._v(" "),a("li",[s._v("列表格式：\n"),a("ul",[a("li",[s._v("字符串；")]),s._v(" "),a("li",[s._v("字典；")])])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" test.yaml \n---\n- hosts: all\n  remote_user: root\n\n  tasks:\n    - name: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" some "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n      file: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" item "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("touch   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件名定义为列表元素")]),s._v("\n      when: ansible_distribution_major_version "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7"')]),s._v("\n      with_items:      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义列表元素")]),s._v("\n        - file1\n        - file2\n        - file3\n$ ansible-playbook test.yaml\n$ ansible all "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" shell "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ls -l /data'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当满足条件的主机都创建了文件")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h4",{attrs:{id:"_4-2-迭代嵌套子变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-迭代嵌套子变量"}},[s._v("#")]),s._v(" 4.2 迭代嵌套子变量")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" test1.yaml \n---\n- hosts: all\n  remote_user: root\n\n  tasks:\n    - name: create some group\n      group: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" item "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      with_items:\n        - g1\n        - g2\n        - g3\n    - name: create some "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v("\n      user: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" item.name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" item.group "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      with_items:\n        - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user1'")]),s._v(", group: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'g1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user2'")]),s._v(", group: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'g2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user3'")]),s._v(", group: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'g3'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n$ ansible-playbook test1.yaml\n$ ansible all "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" shell "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'getent group'")]),s._v("\n$ ansible all "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" shell "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'getent passwd'")]),s._v("\n$ ansible all "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" shell "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id user1'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进行验证")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h3",{attrs:{id:"五、template循环示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、template循环示例"}},[s._v("#")]),s._v(" 五、template循环示例")]),s._v(" "),a("h4",{attrs:{id:"_5-1-第一种写法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-第一种写法"}},[s._v("#")]),s._v(" 5.1 第一种写法")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" test2.yaml \n---\n- hosts: webservers\n  remote_user: root\n  vars:\n    ports:\n      - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81")]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("82")]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("83")]),s._v("\n\n  tasks:\n    - name: copy conf\n      template: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("for2.conf.j2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/for2.conf\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" templates/for2.conf.j2 \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" ports %"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" port "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% endfor %"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n$ ansible-playbook test2.yaml\n$ ansible webservers "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" shell "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cat /data/for2.conf'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进行验证")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h4",{attrs:{id:"_5-2-第二种写法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-第二种写法"}},[s._v("#")]),s._v(" 5.2 第二种写法")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" test3.yaml \n---\n- hosts: webservers\n  remote_user: root\n  vars:\n    ports:\n      - listen_port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81")]),s._v("\n      - listen_port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("82")]),s._v("\n      - listen_port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("83")]),s._v("\n\n  tasks:\n    - name: copy conf\n      template: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("for3.conf.j2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/for3.conf\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" templates/for3.conf.j2 \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" ports %"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" port.listen_port "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% endfor %"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n$ ansible-playbook test3.yaml\n$ ansible webservers "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" shell "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cat /data/for3.conf'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进行验证  ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h4",{attrs:{id:"_5-3-第三种写法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-第三种写法"}},[s._v("#")]),s._v(" 5.3 第三种写法")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" test4.yaml \n---\n- hosts: webservers\n  remote_user: root\n  vars:\n    ports:\n      - web1:\n        port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81")]),s._v("\n        name: web1.lzj.com\n        rootdir: /data/web1\n      - web2:\n        port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("82")]),s._v("\n        name: web2.lzj.com\n        rootdir: /data/web2\n      - web1:\n        port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("83")]),s._v("\n        name: web3.lzj.com\n        rootdir: /data/web3\n\n  tasks:\n    - name: copy conf\n      template: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("for4.conf.j2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/for4.conf\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" templates/for4.conf.j2 \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" ports %"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" p.port "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    servername "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" p.name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    documentroot "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" p.rootdir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% endfor %"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n$ ansible-playbook test4.yaml\n$ ansible webservers "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" shell "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cat /data/for4.conf'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进行验证")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("h3",{attrs:{id:"六、playbook中if简单使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、playbook中if简单使用"}},[s._v("#")]),s._v(" 六、playbook中if简单使用")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" test5.yaml \n---\n- hosts: webservers\n  remote_user: root\n  vars:\n    ports:\n      - web1:\n        port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81")]),s._v("\n        rootdir: /data/web1\n      - web2:\n        port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("82")]),s._v("\n        name: web2.lzj.com\n        rootdir: /data/web2\n      - web1:\n        port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("83")]),s._v("\n        rootdir: /data/web3\n\n  tasks:\n    - name: copy conf\n      template: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("for5.conf.j2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/for5.conf\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" templates/for5.conf.j2 \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" ports %"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" p.port "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" p.name is defined%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果名称被定义了才给名字赋值")]),s._v("\n    servername "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" p.name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% endif %"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    documentroot "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" p.rootdir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% endfor %"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n$ ansible-playbook test5.yaml      \n$ ansible webservers "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" shell "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cat /data/for5.conf'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进行验证")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("p",[s._v("*************** 当你发现自己的才华撑不起野心时，就请安静下来学习吧！***************")]),s._v(" "),a("p",[s._v("原文链接：https://www.cnblogs.com/lvzhenjiang/p/14199384.html")])])}),[],!1,null,null,null);a.default=e.exports}}]);